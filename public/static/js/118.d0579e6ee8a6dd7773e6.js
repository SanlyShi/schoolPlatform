webpackJsonp([118],{"6ek5":function(t,e){},XiTO:function(t,e){},lfJU:function(t,e,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=l("HzJ8"),s=l.n(a),o=l("C331"),n={data:function(){return{collegeList:[],tableData:[],columns:[],curCollege:"",curRoleId:"",tableDataUrl:"",showEditModal:!1,consultantArr:[],options:[],value:""}},computed:{},methods:{userSelect:function(t){this.value=t.name+"("+t.userNo+")";var e=[];if(this.consultantArr.length){var l=!0,a=!1,o=void 0;try{for(var n,r=s()(this.consultantArr);!(l=(n=r.next()).done);l=!0){var i=n.value;e.push(i.userId)}}catch(t){a=!0,o=t}finally{try{!l&&r.return&&r.return()}finally{if(a)throw o}}if(e.indexOf(t.userId)>=0)return!1;this.consultantArr.push(t)}else this.consultantArr.push(t)},remoteMethod:function(t){var e=this;if(""!==t){this.loading=!0;var l="/api/employment/role/getUserList?value="+t+"&roleId="+this.curRoleId+"&collegeCode="+this.curCollege;Object(o.e)({url:l,type:"get",success:function(t){t.state?(e.options=t.data,e.loading=!1):(e.options=[],e.loading=!1)}})}else this.options=[]},cancle:function(){this.showEditModal=!1,this.value="",this.options=[],this.consultantArr=[]},collegeChange:function(){this.setTable(this.curCollege)},setTable:function(t){var e=this,l="/api/employment/role/getRole?level=COLLEGE&collegeCode="+t;this.tableData=[],Object(o.e)({url:l,type:"get",success:function(t){t.state?e.tableData=t.data:e.tableData=[]}})},getCollegeList:function(){var t=this;Object(o.e)({url:"/api/employment/system/getUnitList",type:"get",success:function(e){e.state?(t.collegeList=e.data,t.curCollege=t.collegeList[0].value,t.setTable(t.curCollege)):t.collegeList=[]}})},deleteConsultant:function(t,e){var l=this;t.old?this.$confirm("是否删除该用户","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){l.consultantArr.forEach(function(e,a){if(e.userId===t.userId){var s="/api/employment/role/deleteRole?roleId="+l.curRoleId+"&userId="+t.userId+"&collegeCode="+l.curCollege;Object(o.e)({url:s,type:"post",success:function(e){e.state?(l.setTable(l.curCollege),l.consultantArr.splice(a,1),l.$toast("删除成功")):l.$toast(t.message)}})}})}).catch(function(){l.$message({type:"info",message:"已取消删除"})}):this.consultantArr.splice(e,1)},sumbitEditConsultant:function(){var t=this;if(!this.consultantArr.length)return!1;var e=[],l=this.consultantArr,a=!0,n=!1,r=void 0;try{for(var i,c=s()(l);!(a=(i=c.next()).done);a=!0){var u=i.value;u.old||e.push(u.userId)}}catch(t){n=!0,r=t}finally{try{!a&&c.return&&c.return()}finally{if(n)throw r}}Object(o.e)({url:"/api/employment/role/addRole",dataType:"json",type:"post",data:{roleId:this.curRoleId,collegeCode:this.curCollege,userIds:e},success:function(e){e.state?(t.$toast("添加成功"),t.setTable(t.curCollege),t.value="",t.showEditModal=!1):t.$toast(e.message)}})}},created:function(){var t=this;this.getCollegeList(),this.columns=[{id:"name",title:"角色名称",className:"text-left",width:150,hidden:!1,search:{type:"input",data:{placeholer:"",autoFocus:!1}}},{id:"remarks",title:"角色说明",className:"text-left",width:150,hidden:!1},{id:"users",title:"用户",className:"text-left",width:150,hidden:!1,formatter:function(t){var e=[];if(t.users.length){var l=!0,a=!1,o=void 0;try{for(var n,r=s()(t.users);!(l=(n=r.next()).done);l=!0){var i=n.value;e.push(i.name)}}catch(t){a=!0,o=t}finally{try{!l&&r.return&&r.return()}finally{if(a)throw o}}return e.join(",")}return"暂无用户"}},{id:"opts",title:"操作",width:80,hidden:!1,formatter:function(e){return[{tag:"a",text:"设置用户",callback:function(e,l){if(t.curRoleId=e.roleId,e.users.length){var a=!0,o=!1,n=void 0;try{for(var r,i=s()(e.users);!(a=(r=i.next()).done);a=!0){r.value.old=!0}}catch(t){o=!0,n=t}finally{try{!a&&i.return&&i.return()}finally{if(o)throw n}}}t.consultantArr=[].concat(e.users),t.showEditModal=!0}}]}}]}},r={render:function(){var t=this,e=t.$createElement,l=t._self._c||e;return l("div",{attrs:{id:"authOfCollege"}},[l("div",{staticClass:"authTable"},[l("v-table",{ref:"authOfSchool",attrs:{order:!0,columns:t.columns,pagesize:"15",search:!1,idField:"id",rows:t.tableData}},[l("div",{staticClass:"pull-left",attrs:{slot:"btn-group"},slot:"btn-group"},[l("div",{staticClass:"collegeSelect"},[l("el-select",{on:{change:t.collegeChange},model:{value:t.curCollege,callback:function(e){t.curCollege=e},expression:"curCollege"}},t._l(t.collegeList,function(t){return l("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1)])])],1),t._v(" "),l("v-modal",{attrs:{show:t.showEditModal,effect:"fade",width:"442"}},[l("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t._v("\n        编辑\n    ")]),t._v(" "),l("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[l("div",{staticClass:"modal-search-user"},[l("el-select",{attrs:{filterable:"",remote:"","remote-method":t.remoteMethod,loading:t.loading,"popper-class":"selectList",placeholder:"请输入学工名称或者学工号"},on:{change:t.userSelect},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},t._l(t.options,function(e){return l("el-option",{key:e.userNo,attrs:{title:e.userNo,value:e}},[t._v("\n                "+t._s(e.name+" ("+e.userNo+")")+"\n            ")])}),1)],1),t._v(" "),l("div",{staticClass:"consultant-name-list"},[l("div",{staticClass:"consultant-name"},t._l(t.consultantArr,function(e,a){return l("el-tag",{key:a,attrs:{closable:"",effect:"dark",type:"plain","disable-transitions":!1},on:{close:function(l){return t.deleteConsultant(e,a)}}},[t._v("\n                "+t._s(e.name)+"\n            ")])}),1)])]),t._v(" "),l("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[l("el-button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.cancle}},[t._v("取消")]),t._v(" "),l("el-button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.sumbitEditConsultant}},[t._v("确定")])],1)])],1)},staticRenderFns:[]};var i=l("C7Lr")(n,r,!1,function(t){l("XiTO"),l("6ek5")},"data-v-98021ae8",null);e.default=i.exports}});