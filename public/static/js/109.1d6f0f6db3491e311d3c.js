webpackJsonp([109],{"/2PL":function(t,e,s){"use strict";(function(t){s("C331")}).call(e,s("qqHy"))},D0Zk:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});s("/2PL");var a=s("pVgB"),i={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"auditList"}},[s("view-box",[s("x-header",{class:t.headerShadow?"shadow":""},[s("span",{attrs:{slot:"overwrite-left"},slot:"overwrite-left"},[s("i",{staticClass:"maticon back-icon",domProps:{innerHTML:t._s(t.icons("navigate_before"))},on:{click:t._back}},[t._v("navigate_before")]),t._v(" "),s("span",{staticClass:"total-desc"},[t._v(t._s(t.total)+"条评论")])])]),t._v(" "),s("div",{staticClass:"comment-container"},[s("div",{staticClass:"comments-list"},t._l(t.comments,function(e,a){return s("div",{key:a,staticClass:"comment"},[s("span",{staticClass:"comment-username"},[t._v(t._s(e.userName))]),s("span",{staticClass:"comment-createtime"},[t._v(t._s(e.createTime))]),t._v(" "),s("span",{staticClass:"like",class:e.isLike?"active":"",on:{click:function(s){return t._likeTo(e)}}},[s("i",{staticClass:"maticon",domProps:{innerHTML:t._s(t.icons("thumb_up"))}}),t._v(" "),s("p",[t._v(t._s(e.likes))])]),t._v(" "),s("p",{staticClass:"comment-content",on:{click:function(s){return t._replyTo(e)}}},[t._v("\n            "+t._s(e.content)+"\n          ")]),t._v(" "),e.replys&&e.replys.length>0?s("div",{staticClass:"comment-replys-list"},[s("div",{staticClass:"divider"}),t._v(" "),t._l(e.replys,function(e,a){return s("p",{key:a,on:{click:function(s){return t._replyTo(e)}}},[s("span",{staticClass:"comment-username"},[t._v(t._s(e.fromUserName))]),e.toUserName?s("span",{staticClass:"reply-text"},[t._v("回复")]):t._e(),e.toUserName?s("span",{staticClass:"comment-username"},[t._v(t._s(e.toUserName))]):t._e(),s("span",{staticClass:"reply-text",staticStyle:{margin:"0"}},[t._v(":")]),s("span",{staticClass:"reply-text"},[t._v(t._s(e.content))])])})],2):t._e()])}),0),t._v(" "),s("p",{staticClass:"view-more",on:{click:t._getCommentPage}},[t._v(t._s(t.allTip))])]),t._v(" "),s("div",{staticClass:"comment-commit"},[s("group",[s("x-input",{ref:"commentInput",attrs:{placeholder:"请输入评论"},model:{value:t.commentVal,callback:function(e){t.commentVal=e},expression:"commentVal"}},[s("span",{staticClass:"comment-release",attrs:{slot:"right"},on:{click:t._commentTo},slot:"right"},[t._v("发表")])])],1)],1),t._v(" "),s("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[s("popup",{attrs:{height:"48px","is-transparent":""},model:{value:t.showReplySubmit,callback:function(e){t.showReplySubmit=e},expression:"showReplySubmit"}},[s("group",{staticClass:"popup-reply-submit"},[s("x-input",{ref:"commentInput",attrs:{placeholder:"回复"+(t.replyObj.fromUserName||t.replyObj.userName)},model:{value:t.replyVal,callback:function(e){t.replyVal=e},expression:"replyVal"}},[s("span",{staticClass:"comment-release",attrs:{slot:"right"},on:{click:t._replySubmit},slot:"right"},[t._v("发表")])])],1)],1)],1)],1)],1)},staticRenderFns:[]};var n=function(t){s("Y9F0")},o=s("C7Lr")(a.a,i,!1,n,null,null);e.default=o.exports},Y9F0:function(t,e){},pVgB:function(t,e,s){"use strict";(function(t){var a=s("C331");e.a={props:{data:{default:null}},data:function(){return{pageIndex:0,pageSize:20,comments:[],isAll:!1,isLoadding:!1,headerShadow:!1,commentVal:"",replyVal:"",replyObj:{},showReplySubmit:!1,total:0,isFocus:!1}},computed:{activityId:function(){return this.data.data.id},allTip:function(){var t="---查看更多---";return this.isAll&&(t=this.comments.length>0?"---没有更多数据了---":"---暂无数据---"),this.isLoadding&&(t="---加载中---"),t},lastPage:function(){return this.data.data.lastPage}},created:function(){this._getCommentPage()},methods:{_back:function(){this.$emit("removeBread",this.data)},_getCommentPage:function(){var t=this;this.isAll||this.isLoadding||(this.isLoadding=!0,Object(a.e)({url:"/api/sc/activitySocializations/getComments",type:"get",data:{pageIndex:this.pageIndex,pageSize:this.pageSize,activityId:this.activityId},success:function(e){t.isLoadding=!1,e.state?(t.total=e.data.totalElements,e.data.content&&e.data.content.length===t.pageSize||(t.isAll=!0),e.data.content&&e.data.content.length>0&&(e.data.content.forEach(function(e){t.comments.push(e)}),t.pageIndex++)):t._toast(e.message)}}))},_likeTo:function(t){var e=this,s="";s=t.isLike?"/api/sc/activitySocializations/cancelLike/COMMENT_LIKE":"/api/sc/activitySocializations/createLike/COMMENT_LIKE",Object(a.e)({url:s,type:"post",data:{id:t.id},success:function(s){s.state?(t.isLike=!t.isLike,t.likes+=t.isLike?1:-1):e._toast(s.message)}})},_replyTo:function(t){var e=this;this.showReplySubmit=!0,this.replyObj=t,this.$nextTick(function(){e.$refs.replyInput.focus()})},_replySubmit:function(){var t=this;if(this.replyVal){var e={};e=this.replyObj.fromUserId?{commentId:this.replyObj.commentId,content:this.replyVal,toUserId:this.replyObj.fromUserId,level:2}:{commentId:this.replyObj.id,content:this.replyVal,toUserId:this.replyObj.userId,level:1},Object(a.e)({url:"/api/sc/activitySocializations/createReply",type:"post",data:e,success:function(e){e.state?(t.showReplySubmit=!1,t.replyVal="",t.replyObj.fromUserId?t.comments.forEach(function(s){s.id===t.replyObj.commentId&&(s.replys||t.$set(s,"replys",[]),s.replys.push(e.data))}):(t.replyObj.replys||t.$set(t.replyObj,"replys",[]),t.replyObj.replys.push(e.data))):t._toast(e.message)}})}else this._toast("说点什么吧！")},_commentTo:function(){var t=this;this.commentVal?Object(a.e)({url:"/api/sc/activitySocializations/createComment",type:"post",data:{content:this.commentVal,activityId:this.activityId},success:function(e){e.state?(t.total=t.comments.unshift(e.data),t.lastPage.bottomInfo.commentCount=t.total,t.lastPage._getComments(),t.commentVal=""):t._toast(e.message)}}):this._toast("说点什么吧！")},_toast:function(t){this.$vux.toast.show({text:t,position:"bottom",type:"text"})}},mounted:function(){var e=this;this.data.data.focus&&this.$refs.commentInput.focus(),this.$pullUpToLoad({container:".comment-container",down:{height:200,callback:function(){e.isAll=!1,e.pageIndex=0,e.comments=[],e._getCommentPage()}},up:{callback:function(){e._getCommentPage()}}});var s=this;t(".comment-container").on("scroll",function(){var e=t(this).scrollTop();s.headerShadow=e>0})}}}).call(e,s("qqHy"))}});