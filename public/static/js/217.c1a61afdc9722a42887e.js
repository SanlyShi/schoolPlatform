webpackJsonp([217],{"0YwO":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("3cXf"),s=i.n(n),d=i("Q8Fq"),a=i.n(d),o=i("NcNL"),l=i.n(o),p=i("C331"),r={props:{data:{default:null}},data:function(){return{exportingToPdf:!1,pageOptions:{colleges:[],grade:[],studentType:[]},pdfSetting:{index:0,list:[],downloading:!1,zip:new a.a,timer:null,modalShow:!1,log:!1,url:"/api/student/manage/secondClass/getList"},columns:[]}},methods:{_getPageOptions:function(){var t=this;Object(p.e)({url:"/api/student/manage/getSelectOptions?",type:"get",data:{type:"school"},success:function(e){e.state?e.data&&(t.pageOptions=e.data,t._initColumns()):t.$toast(e.message)}})},_initColumns:function(){this.columns=[{id:"studentId",title:"学工号",width:120,hidden:!1,className:"text-left",search:{type:"input"}},{id:"name",title:"姓名",width:100,hidden:!1,className:"text-left",search:{type:"input"}},{id:"grade",title:"年级",width:100,hidden:!1,className:"text-left",search:{type:"select",data:{options:this.pageOptions.grade,optionsLabel:"text",optionsValue:"id"}}},{id:"college",title:"学院",width:150,hidden:!1,className:"text-left",search:{type:"select",data:{options:this.pageOptions.colleges,optionsLabel:"text",optionsValue:"id"}}},{id:"type",title:"学生类别",width:120,hidden:!1,className:"text-left",search:{type:"select",data:{options:this.pageOptions.studentType,optionsLabel:"text",optionsValue:"id"}},formatter:function(t,e){return t.studentType}},{id:"instructor",title:"辅导员",width:150,hidden:!1,hover:!1,className:"text-left",formatter:function(t,e){return t.instructor?'<span title="'+t.instructorNo+'">'+t.instructor+"</span>":""}},{id:"opt",title:"操作",width:60,hidden:!1,className:"text-left",options:[{tag:"a",text:"查看",callback:function(t,e){window.open("/sc/report?userId="+t.userId)}}]}]},_outputPdf:function(t){var e=this;this.$waiting.show();var i;i=JSON.parse(s()(this.$refs.secondClass.tableSearchFields)),Object(p.e)({url:this.pdfSetting.url,type:"get",data:i,success:function(t){e.$waiting.close(),t.state?(e.pdfSetting.downloading=!0,e.pdfSetting.list=t.data,e._nextTask(e.pdfSetting.list[e.pdfSetting.index])):e.$toast(t.message)}})},_nextTask:function(t){var e=this;this.pdfSetting.timer=setTimeout(function(){t?e.pdfSetting.modalShow||(e.pdfSetting.modalShow=!0,e._downloadPdf()):(clearTimeout(e.pdfSetting.timer),e.pdfSetting.downloading=!1,e.pdfSetting.log=!1,e.pdfSetting.list=[],e.pdfSetting.index=0,e.pdfSetting.modalShow=!1,e.pdfSetting.zip.generateAsync({type:"blob"}).then(function(t){var i=new Date;l.a.saveAs(t,"第二课堂成绩单"+i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate()),e.$toast("打包成功，开始下载...")}))},500)},_downloadPdf:function(){var t=this;this.pdfSetting.downloading&&(this.pdfSetting.title=this.pdfSetting.list[this.pdfSetting.index].studentId+"-"+this.pdfSetting.list[this.pdfSetting.index].name,this.getPdf(this.pdfSetting.title,function(e){t.pdfSetting.modalShow=!1,t.pdfSetting.list.length-1==t.pdfSetting.index&&(t.pdfSetting.downloading=!1),t.pdfSetting.index++,t.pdfSetting.zip.file(t.pdfSetting.title+".pdf",e,{binary:!0}),t._nextTask(t.pdfSetting.list[t.pdfSetting.index]),t.$toast("打包中...("+t.pdfSetting.index+"/"+t.pdfSetting.list.length+")\nPDF文件较大，导出速度慢")}))}},created:function(){this._getPageOptions()}},g={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"mark-list-page container-fluid"},[e("div",{staticClass:"row"},[e("v-table",{ref:"secondClass",attrs:{title:"成绩单列表",url:"/table-data/student/manage/secondClass",columns:this.columns,pagesize:"10",idField:"id",order:!0,search:!0}},[e("div",{staticClass:"btn-group pull-right",attrs:{slot:"btn-group",role:"group"},slot:"btn-group"},[e("button",{staticClass:"btn btn-bgColor-style clearBtnBorder",on:{click:this._outputPdf}},[this._v("批量导出")])])])],1),this._v(" "),this.pdfSetting.downloading?e("div",{staticClass:"second-export",class:{"exporting-to-pdf":this.pdfSetting.modalShow},attrs:{id:"pdfDom"}},[e("iframe",{attrs:{width:"100%",height:"1188px",src:"/sc/report?userId="+this.pdfSetting.list[this.pdfSetting.index].userId+"&isPdf=true",frameborder:"0"}})]):this._e()])},staticRenderFns:[]};var c=i("C7Lr")(r,g,!1,function(t){i("vNyw")},"data-v-50a10b81",null);e.default=c.exports},vNyw:function(t,e){}});