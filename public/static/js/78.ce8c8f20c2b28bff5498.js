webpackJsonp([78],{"/MbA":function(t,a){},Bpx7:function(t,a,e){"use strict";(function(t){var s=e("3cXf"),i=e.n(s),l=e("C331");a.a={props:{},created:function(){this.systemId=sessionStorage.getItem("_SYSTEM_ID"),this.initTable()},data:function(){return{systemId:"",url:"/table-data/cms/rotary/getRotaryImageList?systemId=",modalType:"add",showAddView:!1,addParams:{title:"",chooseName:"",image:"",listPageUrl:"",moduleUrl:"",newWindow:1},timestamp:"",requireField:[{text:"标题",value:"title"},{text:"跳转链接",value:"url"},{text:"图片",value:"image"}],selectOptions:{source:[{value:"NETWORK_IMAGE",label:"网络图片链接"},{value:"LOCAL_IMAGE",label:"本地图片"}],typeList:[],sonConstantList:[],detailList:[]},selectImageBase64:"",showTypeModal:!1,urlReadOnly:!1,searchField:"name",oldParams:{}}},mounted:function(){this.getDirectionary()},methods:{save:function(){var t=this;for(var a in this.requireField)if(!this.addParams[this.requireField[a].value])return void this.$toast(this.requireField[a].text+"不能为空!");var e=JSON.parse(i()(this.addParams));e.systemId=this.systemId,e.url=e.url;var s="add"==this.modalType?"api/cms/rotary/addRotaryImage":"api/cms/rotary/updateRotaryImage";Object(l.d)(s,e,"post").then(function(a){a.state&&(t.$toast("操作成功!"),t.timestamp="&timestamp="+new Date,t.back())})},onSelectType:function(t){this.addParams.url="",this.addParams.listPageUrl="",this.addParams.chooseName="";var a=this.selectOptions.typeList.find(function(a){return a.value==t});this.addParams.newWindow=a.newWindow},onSelectModule:function(t){this.addParams.url=t},onSelectConstant:function(t){var a=this;this.addParams.chooseName="",this.addParams.url=t;var e=this.selectOptions.sonConstantList.filter(function(a){return a.listPageUrl===t})[0];if("MODULE_CONTENT"!==this.addParams.type){this.searchField=e.searchField,this.addParams.detailPageUrl=e.detailPageUrl||"";var s="api"+e.datalistUrl;Object(l.d)(s).then(function(t){a.selectOptions.detailList=t.data.content})}},onSelectDetail:function(t){var a=this,e=this.selectOptions.detailList.filter(function(e){return e[a.searchField]===t})[0];this.addParams.url=this.addParams.detailPageUrl+","+e.id},getDirectionary:function(){var t=this,a="api/cms/system/getConstantByType?type=ROTARY_IMAGE_CONTENT&systemId="+this.systemId;Object(l.d)(a).then(function(a){a.state?(t.selectOptions.typeList=a.data,t.selectOptions.sonConstantList=t.selectOptions.typeList[0].sonConstantList,t.getModuleList()):t.$toast(a.message)})},getModuleList:function(){var t=this,a="api"+this.selectOptions.typeList[1].datalistUrl+this.systemId;Object(l.d)(a).then(function(a){t.selectOptions.moduleList=a.data.content.map(function(t){return t.name=t.title,t.listPageUrl="/contentManageIndex,"+t.id,t})})},editType:function(){this.showTypeModal=!0,this.oldParams=JSON.parse(i()(this.addParams))},cancelSaveType:function(){this.showTypeModal=!1,this.addParams=JSON.parse(i()(this.oldParams))},confirmSaveType:function(){this.showTypeModal=!1,this.urlReadOnly=!0},onSelectImage:function(t){var a=event.target.files[0],e=this;if(a){event.target.value="";var s=new FileReader;s.onloadend=function(t){var s=new Image;s.src=t.target.result,s.onload=function(){e.$croppa({file:a,width:585,height:223,scale:"",sure:function(t){if(e.addParams.image){var a="api/storage/files/"+e.addParams.image;Object(l.d)(a,{},"post").then(function(t){})}Object(l.d)("/api/storage/base64Images",{data:t}).then(function(a){var s=a.data.hash;e.addParams.image=s,e.selectImageBase64=t})}})}},s.readAsDataURL(a)}},selectImage:function(){t("#carouselImgInput").click()},initTable:function(){var t=this,a=this;this.columns=[{id:"title",title:"标题",width:200,className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"imageExplain",title:"图片",width:200,className:"text-left",hidden:!1},{id:"url",title:"跳转链接",width:300,className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"updateTime",title:"更新时间",className:"text-left",hidden:!1},{id:"opt",title:"操作",className:"text-center",width:"210px",hidden:!1,formatter:function(e,s){return[{tag:"a",text:"编辑",className:"opt-btn",callback:function(e,s){if(a.addParams=e,"MODULE_CONTENT"==e.type)a.addParams.moduleUrl=e.url;else if(a.addParams.url.indexOf(",")>-1){var i=a.addParams.url.split(","),l=t.selectOptions.sonConstantList.find(function(t){return t.detailPageUrl==i[0]});a.addParams.listPageUrl=l.listPageUrl}t.urlReadOnly=0==a.addParams.newWindow,a.addOrEditCarousel("edit")}},{tag:"a",text:"删除",className:"opt-btn",callback:function(a,e){confirm("确认要删除该轮播图吗?")&&Object(l.d)("/api/cms/rotary/"+a.id,{},"post").then(function(a){a.state?(t.$toast("删除成功"),t.timestamp="&timestamp="+new Date):t.$toast(a.message)})}}]}}]},addOrEditCarousel:function(t){this.modalType=t,this.showAddView=!0,"add"==t&&(this.addParams={title:"",chooseName:"",image:"",listPageUrl:"",moduleUrl:"",newWindow:1})},back:function(){this.urlReadOnly=!1,this.showAddView=!1}}}}).call(a,e("qqHy"))},TaiL:function(t,a,e){"use strict";(function(t){var a=e("3cXf");e.n(a),e("C331")}).call(a,e("qqHy"))},vM2W:function(t,a){},wbNi:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});e("TaiL");var s=e("Bpx7"),i={render:function(){var t=this,a=t.$createElement,s=t._self._c||a;return t.showAddView?s("div",{staticClass:"carousel-view"},[s("div",{staticClass:"back-btn"},[s("i",{staticClass:"maticon pull-left",domProps:{innerHTML:t._s(t.icons("arrow_back"))},on:{click:t.back}},[t._v("arrow_back")]),t._v(" "),s("span",{on:{click:t.back}},[t._v("返回")])]),t._v(" "),s("el-form",{ref:"positionInfoForm",staticClass:"box_flex flex_wrap form_wrap",attrs:{model:t.addParams,"label-width":"180px"}},[s("el-form-item",{staticClass:"long_form_item",attrs:{label:"标题",required:""}},[s("el-input",{attrs:{type:"input",placeholder:"标题",resize:"none"},model:{value:t.addParams.title,callback:function(a){t.$set(t.addParams,"title",a)},expression:"addParams.title"}})],1),t._v(" "),s("el-form-item",{staticClass:"long_form_item icon_wrap",attrs:{label:"跳转链接",required:""}},[s("el-input",{attrs:{type:"input",placeholder:"请输入链接地址或选择关联内容",disabled:t.urlReadOnly,resize:"none"},model:{value:t.addParams.url,callback:function(a){t.$set(t.addParams,"url",a)},expression:"addParams.url"}}),t._v(" "),s("div",{staticClass:"add-icon",on:{click:function(a){return t.editType()}}},[s("img",{attrs:{src:e("DW+B"),alt:""}})])],1),t._v(" "),s("el-form-item",{staticClass:"long_form_item",attrs:{label:"图片说明"}},[s("el-input",{attrs:{type:"textarea",rows:"4",placeholder:"请输入轮播图作用，便于部门其他人员查看、操作！",resize:"none"},model:{value:t.addParams.imageExplain,callback:function(a){t.$set(t.addParams,"imageExplain",a)},expression:"addParams.imageExplain"}})],1),t._v(" "),s("el-form-item",{staticClass:"long_form_item",attrs:{label:"上传图片"}},[t.addParams.image?s("div",{staticClass:"img_wrap box_flex column flex_center",on:{click:function(a){return t.selectImage()}}},[s("img",{staticStyle:{width:"100%"},attrs:{src:"/downloads/storage/images/"+t.addParams.image,alt:""}})]):s("div",{staticClass:"img_wrap box_flex column flex_center",on:{click:function(a){return t.selectImage()}}},[s("div",{staticClass:"add-icon"},[s("img",{attrs:{src:e("DW+B"),alt:""}})]),t._v(" "),s("p",[t._v("点击添加图片")]),t._v(" "),s("p",{staticClass:"gray"},[t._v("每次只可上传一张")])])])],1),t._v(" "),s("v-modal",{staticClass:"activityType-modal",attrs:{show:t.showTypeModal,effect:"fade",width:"446"}},[s("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[s("h5",{staticClass:"modal-title"},[t._v("\n        关联系统内容\n      ")])]),t._v(" "),s("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[s("el-form",{ref:"positionInfoForm",attrs:{model:t.addParams,"label-width":"120px"}},[s("el-form-item",{attrs:{label:"关联类型"}},[s("el-select",{attrs:{placeholder:"请选择"},on:{change:t.onSelectType},model:{value:t.addParams.type,callback:function(a){t.$set(t.addParams,"type",a)},expression:"addParams.type"}},t._l(t.selectOptions.typeList,function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.value}})}),1)],1),t._v(" "),"MODULE_CONTENT"!==t.addParams.type?s("el-form-item",{attrs:{label:"关联的内容"}},[s("el-select",{attrs:{placeholder:"请选择"},on:{change:t.onSelectConstant},model:{value:t.addParams.listPageUrl,callback:function(a){t.$set(t.addParams,"listPageUrl",a)},expression:"addParams.listPageUrl"}},t._l(t.selectOptions.sonConstantList,function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.listPageUrl}})}),1)],1):s("el-form-item",{attrs:{label:"关联的内容"}},[s("el-select",{attrs:{placeholder:"请选择"},on:{change:t.onSelectModule},model:{value:t.addParams.moduleUrl,callback:function(a){t.$set(t.addParams,"moduleUrl",a)},expression:"addParams.moduleUrl"}},t._l(t.selectOptions.moduleList,function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.listPageUrl}})}),1)],1),t._v(" "),"MODULE_CONTENT"!==t.addParams.type?s("el-form-item",{attrs:{label:"详细"}},[s("el-select",{attrs:{filterable:"true",placeholder:"请选择"},on:{change:t.onSelectDetail},model:{value:t.addParams.chooseName,callback:function(a){t.$set(t.addParams,"chooseName",a)},expression:"addParams.chooseName"}},t._l(t.selectOptions.detailList,function(a){return s("el-option",{key:a.id,attrs:{label:a[t.searchField],value:a[t.searchField]}})}),1)],1):t._e()],1)],1),t._v(" "),s("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[s("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(a){return t.cancelSaveType()}}},[t._v("取消")]),t._v(" "),s("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.confirmSaveType}},[t._v("确定")])])]),t._v(" "),s("input",{staticStyle:{display:"none"},attrs:{id:"carouselImgInput",type:"file"},on:{change:function(a){return t.onSelectImage()}}}),t._v(" "),s("div",{staticClass:"box_flex flex_center"},[s("button",{staticClass:"btn cancel-btn",staticStyle:{"margin-right":"106px"},on:{click:t.back}},[t._v("取消")]),t._v(" "),s("button",{staticClass:"btn submit-btn",on:{click:function(a){return t.save()}}},[t._v("保存")])])],1):s("div",{staticClass:"carousel-page"},[s("div",{staticClass:"carousel-wrap"},[s("div",{staticClass:"content text-center"},[s("v-table",{attrs:{title:"轮播图列表",url:t.url+t.systemId+t.timestamp,pagesize:10,columns:t.columns,multiple:!1,order:!0,search:!1}},[s("div",{attrs:{slot:"btn-group",role:"group"},slot:"btn-group"},[s("div",{staticClass:"btn-group pull-right "},[s("button",{staticClass:"btn batch-add-btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:function(a){return t.addOrEditCarousel("add")}}},[t._v("新增")])])])])],1)])])},staticRenderFns:[]};var l=function(t){e("vM2W"),e("/MbA")},n=e("C7Lr")(s.a,i,!1,l,"data-v-55d02683",null);a.default=n.exports}});