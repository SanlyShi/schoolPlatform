webpackJsonp([194],{NKcD:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("3cXf"),s=i.n(a),l=(i("kV13"),i("qqHy"),i("C331")),n={props:{account:{default:null}},created:function(){var e=this,t=localStorage.getItem("lang");Object(l.g)(t)&&(this.lang=t);for(var i=(new Date).getFullYear(),a=i+3;a>i-10;a--)this.searchSelectOptions.grade.push({value:a,label:a.toString()});var s="fieldHiddenKey_"+(this.account&&this.account.userId),n=localStorage.getItem(s);n&&(this.recordFieldHidden=JSON.parse(n)),this.importParams.parentPageTitle=this.translate.peopleList.allStaffUrl,this.importParams.importBtnType=[{url:"/apartment/users/batch/update",method:"post",isShowBtn:!0,name:this.translate.overlayImport,success:function(t){t.state&&e._refreshTable()}}],this._getZonesData([]),this._initColumns(),Object(l.e)({url:"/api/apartment/users/exports/fields",type:"get",success:function(t){t.state?(e.formFields=t.data,e.formFields.unshift({fieldName:"allChoice",fieldTitle:"全选"})):e.$toast(t.message)}})},data:function(){return{allStaffUrl:"/table-data/apartment/users/all/page",liveStaffUrl:"/table-data/apartment/users/checkIn/page",columns:[],liveStaffColumns:[],allColumns:[],isSelect:"allStaff",isShowPathNav:!1,subpageName:"",tabs:[{id:"allStaff",label:"全校人员列表"},{id:"liveStaff",label:"在住人员列表"}],showAddTypeModal:!1,showAddModal:!1,outputModalShow:!1,curRoute:"allStaff",addTypeData:[{value:"single",label:"单个新增"},{value:"batch",label:"批量新增"}],addType:"single",importParams:{parentPageTitle:"",downloadTemplateUrl:"/apartment/users/batch/template",downloadErrorTemplateUrl:"/apartment/users/batch/error",checkTemplateUrl:"/apartment/users/batch/excel",templateName:"批量导入模板",importBtnType:null},campusData:[{id:"1",text:"湖里"},{id:"2",text:"思明"}],parkData:[{id:"1",text:"湖里"},{id:"2",text:"思明"}],searchSelectOptions:{peopleType:[{id:"student",text:"学生"},{id:"teacher",text:"老师"},{id:"OTHER",text:"其他"}],campusNames:[],zoneNames:[],buildings:[],checkInStatus:[{value:"WAIT_CHECK_IN",label:"未入住"},{value:"CHECK_IN",label:"已入住"},{value:"IN_CHECK_IN: ",label:"入住确认中"},{value:"RETIREMENT: ",label:"退宿确认中"},{value:"RETIREMENT",label:"已退宿"}],paymentStatus:[{value:"1",label:"已缴费"},{value:"2",label:"未缴费"},{value:"3",label:"免缴费"},{value:"4",label:"生源地/校园地贷款"}],grade:[],studyYears:[{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"}]},checkInStatus:{WAIT_CHECK_IN:"未入住",IN_CHECK_IN:"入住确认中",IN_RETIREMENT:"退宿确认中",CHECK_IN:"已入住",RETIREMENT:"已退宿"},paymentStatus:{1:"已缴费",2:"未缴费",3:"免缴费",4:"生源地/校园地贷款"},isShowSearch:!0,showEidtModal:!1,editTime:{userId:"",expectCheckInTime:"",expectRetirementTime:""},outputList:[],formFields:[],timeStamp:"",recordFieldHidden:{allStaff:{name:!1,userNo:!1,account:!0,typeName:!1,educationLevel:!0,studyYears:!0,sex:!0,college:!1,grade:!0,instructorName:!0,campus:!1,zone:!1,building:!1,room:!1,expectCheckInTime:!0,relCheckInTime:!0,expectRetirementTime:!0,relRetirementTime:!0,paymentStatus:!0,checkInStatus:!0,isGiveUp:!0,phone:!0,opt:!1},liveStaff:{name:!1,userNo:!1,account:!0,typeName:!1,educationLevel:!0,studyYears:!0,sex:!0,college:!1,grade:!0,instructorName:!0,campus:!1,zone:!1,building:!1,room:!1,expectCheckInTime:!0,relCheckInTime:!0,expectRetirementTime:!0,relRetirementTime:!0,paymentStatus:!0,checkInStatus:!0,isGiveUp:!0,phone:!0,opt:!1}},selectCheckInStatus:"",campusIds:[],zoneIds:[],lang:"zh-cn"}},computed:{translate:function(){return Object(l.g)(this.lang).accommodationStaff}},methods:{_initColumns:function(){var e=this;this.columns=[{id:"userNo",title:this.translate.userNo,width:120,className:"text-left",hidden:this.recordFieldHidden[this.isSelect].userNo,search:{type:"input",data:{placeholer:"",autoFocus:!1}}},{id:"account",title:this.translate.freshmanNo,width:100,className:"text-left",hidden:this.recordFieldHidden[this.isSelect].account,search:{type:"input",data:{placeholer:"",autoFocus:!1}}},{id:"name",title:this.translate.name,width:120,className:"text-left",hidden:this.recordFieldHidden[this.isSelect].name,search:{type:"input",data:{placeholer:"",autoFocus:!1}}},{id:"sex",title:"性别",width:80,className:"text-left",hidden:this.recordFieldHidden[this.isSelect].sex,search:{type:"select",data:{url:"/api/apartment/dicts?typeName=性别",optionsLabel:"label",optionsValue:"value"}}},{id:"college",title:this.translate.college,width:100,className:"text-left",hidden:this.recordFieldHidden[this.isSelect].college,search:{type:"multiSelect",data:{url:"/api/apartment/unit/list",optionsLabel:"name",optionsValue:"code"}}},{id:"educationLevel",title:"培养层次",width:80,className:"text-left",hidden:this.recordFieldHidden[this.isSelect].educationLevel,search:{type:"multiSelect",data:{url:"/api/apartment/dicts?typeName=培养层次",optionsLabel:"label",optionsValue:"value"}}},{id:"studyYears",title:this.translate.schoolSystem,width:80,className:"text-left",hidden:this.recordFieldHidden[this.isSelect].studyYears,search:{type:"multiSelect",data:{options:this.searchSelectOptions.studyYears,optionsLabel:"label",optionsValue:"value"}}},{id:"grade",title:this.translate.grade,width:100,className:"text-left",hidden:this.recordFieldHidden[this.isSelect].grade,search:{type:"multiSelect",data:{options:this.searchSelectOptions.grade,optionsLabel:"label",optionsValue:"value"}}},{id:"instructor",title:this.translate.instructor,width:100,className:"text-left",hidden:this.recordFieldHidden[this.isSelect].instructorName,search:{type:"input",data:{placeholer:"",autoFocus:!1}},formatter:function(e){return e.instructorName}},{id:"userType",title:this.translate.peopleType,className:"text-left",width:100,hidden:this.recordFieldHidden[this.isSelect].typeName,search:{type:"multiSelect",data:{options:this.searchSelectOptions.peopleType,optionsLabel:"text",optionsValue:"id"}},formatter:function(e){return e.typeName}},{id:"campus",title:this.translate.formFieldsLabel.campus,width:100,className:"text-left",hidden:this.recordFieldHidden[this.isSelect].campus,search:{type:"multiSelect",data:{url:"/api/apartment/dicts?typeName=校区",optionsLabel:"label",optionsValue:"value",change:function(t){e.campusIds.splice(0,e.campusIds.length),t.value.length>0&&(e.campusIds=t.value.split(",")),e._getZonesData()}}}},{id:"zone",title:this.translate.formFieldsLabel.park,width:100,className:"text-left",hidden:this.recordFieldHidden[this.isSelect].zone,search:{type:"multiSelect",data:{options:this.searchSelectOptions.zoneNames,optionsLabel:"label",optionsValue:"value",change:function(t){e.zoneIds.splice(0,e.zoneIds.length),t.value.length>0&&(e.zoneIds=t.value.split(",")),e._getBuildingsData()}}}},{id:"building",title:this.translate.formFieldsLabel.building,width:100,className:"text-left",hidden:this.recordFieldHidden[this.isSelect].building,search:{type:"select",data:{options:this.searchSelectOptions.buildings,optionsLabel:"label",optionsValue:"value"}}},{id:"room",title:this.translate.formFieldsLabel.roomNumber,width:100,className:"text-left",hidden:this.recordFieldHidden[this.isSelect].room},{id:"expectCheckInTime",title:this.translate.formFieldsLabel.expectedCheckInTime,width:100,className:"text-left",hidden:this.recordFieldHidden[this.isSelect].expectCheckInTime},{id:"relCheckInTime",title:this.translate.formFieldsLabel.realCheckInTime,width:100,className:"text-left",hidden:this.recordFieldHidden[this.isSelect].relCheckInTime},{id:"expectRetirementTime",title:this.translate.formFieldsLabel.expectedLeaveDormitoryTime,width:100,className:"text-left",hidden:this.recordFieldHidden[this.isSelect].expectRetirementTime},{id:"relRetirementTime",title:this.translate.formFieldsLabel.realLeaveDormitoryTime,width:100,className:"text-left",hidden:this.recordFieldHidden[this.isSelect].relRetirementTime},{id:"paymentStatus",title:"缴费情况",width:100,className:"text-left",hidden:this.recordFieldHidden[this.isSelect].paymentStatus,search:{type:"multiSelect",data:{options:this.searchSelectOptions.paymentStatus,optionsLabel:"label",optionsValue:"value"}},formatter:function(t){return t.paymentStatus?e.paymentStatus[t.paymentStatus]:""}}],"allStaff"===this.isSelect?this.columns.push({id:"checkInStatus",title:"入住情况",width:100,className:"text-left",hidden:this.recordFieldHidden[this.isSelect].checkInStatus,search:{type:"multiSelect",data:{options:this.searchSelectOptions.checkInStatus,optionsLabel:"label",optionsValue:"value"}},formatter:function(t){return e.checkInStatus[t.checkInStatus]}}):this.columns.push({id:"checkInStatus",title:"入住情况",width:100,className:"text-left",hidden:this.recordFieldHidden[this.isSelect].checkInStatus,formatter:function(t){return e.checkInStatus[t.checkInStatus]}}),this.columns.push({id:"isGiveUp",title:"是否放弃入住（是/否）",width:150,className:"text-left",hidden:this.recordFieldHidden[this.isSelect].isGiveUp,formatter:function(e){return e.isGiveUp?"是":"否"}},{id:"phone",title:"电话",width:100,className:"text-left",hidden:this.recordFieldHidden[this.isSelect].phone},{id:"opt",title:this.translate.opt,className:"text-centet",width:130,hidden:this.recordFieldHidden[this.isSelect].opt,formatter:function(t){var i=[{tag:"a",text:e.translate.check,className:"opt-btn",callback:function(t,i){e.$emit("addBread",{route:"/apartment/staffInfo?userId="+t.userId,title:t.name+"的信息"})}}];return"RETIREMENT"!==t.checkInStatus&&t.building&&i.unshift({tag:"a",text:e.translate.edit,callback:function(t,i){e.showEidtModal=!0,e.editTime={userId:t.userId,expectCheckInTime:t.expectCheckInTime,expectRetirementTime:t.expectRetirementTime},e.selectCheckInStatus=t.checkInStatus}}),i}}),"allStaff"===this.isSelect?this.allColumns=this.columns:this.liveStaffColumns=this.columns},changeTab:function(e){this.isSelect=e.id,this.curRoute=e.id,this._initColumns()},_columnExchanged:function(e){this.recordFieldHidden[this.isSelect][e.id]=e.hidden;var t="fieldHiddenKey_"+(this.account&&this.account.userId),i=s()(this.recordFieldHidden);localStorage.setItem(t,i)},_getZonesData:function(){var e=this;Object(l.e)({url:"/api/apartment/zones/getByCampuses?campusIds="+this.campusIds,type:"get",success:function(t){t.state?(e.searchSelectOptions.zoneNames.splice(0,e.searchSelectOptions.zoneNames.length),t.data&&t.data.forEach(function(t){e.searchSelectOptions.zoneNames.push({label:t.name,value:t.zoneId})})):e.$toast(t.message)}})},_getBuildingsData:function(){var e=this;Object(l.e)({url:"/api/apartment/buildings/getWithConditions?campusIds="+this.campusIds+"&zoneIds="+this.zoneIds,type:"get",success:function(t){t.state?(e.searchSelectOptions.buildings.splice(0,e.searchSelectOptions.buildings.length),t.data&&t.data.forEach(function(t){e.searchSelectOptions.buildings.push({label:t.name,value:t.buildingId})})):e.$toast(t.message)}})},_sumbitEditTime:function(){var e=this;this.editTime.expectCheckInTime=/\d{4}-\d{1,2}-\d{1,2}/g.exec(this.editTime.expectCheckInTime)[0],this.editTime.expectRetirementTime=/\d{4}-\d{1,2}-\d{1,2}/g.exec(this.editTime.expectRetirementTime)[0],Object(l.e)({url:"/api/apartment/users",type:"post",data:this.editTime,success:function(t){t.state?(e.showEidtModal=!1,e._refreshTable(),e.$toast("编辑成功")):e.$toast(t.message)}})},_dateSelected:function(e,t){var i=this,a=this.editTime.expectCheckInTime,s=this.editTime.expectRetirementTime;if("expectCheckInTime"===t)if(s){if(new Date(e.value).getTime()-new Date(s).getTime()>0)return this.$nextTick(function(){i.toast("预计入住时间要在预计退宿时间之前"),i.editTime.expectCheckInTime=""}),!1;this.editTime.expectCheckInTime=e.value}else this.editTime.expectCheckInTime=e.value;if("expectRetirementTime"===t)if(a){if(new Date(e.value).getTime()-new Date(a).getTime()<0)return this.$nextTick(function(){i.toast("预计退宿时间要在预计入住时间之后"),i.editTime.expectRetirementTime=""}),!1;this.editTime.expectRetirementTime=e.value}else this.editTime.expectRetirementTime=e.value},_exportStaffList:function(){this.outputList=[],this.outputModalShow=!0},_changeOutputList:function(e){if("allChoice"==e.fieldName)if(this.outputList.length==this.formFields.length)this.outputList=[];else{this.outputList=[];for(var t=0;t<this.formFields.length;t++)this.outputList.push(this.formFields[t].fieldName)}else{var i=this.outputList.indexOf(e.fieldName);if(i>=0){this.outputList.splice(i,1);var a=this.outputList.indexOf("allChoice");a>=0&&this.outputList.splice(a,1)}else this.outputList.push(e.fieldName),this.outputList.length==this.formFields.length-1&&"allChoice"!=e.fieldName&&this.outputList.push("allChoice")}},_sureToOutput:function(){if(0!==this.outputList.length){this.outputList.indexOf("allChoice")>=0&&this.outputList.splice(this.outputList.indexOf("allChoice"),1);var e={};e="allStaff"===this.curRoute?JSON.parse(s()(this.$refs.allStaffTable.tableSearchFields)):JSON.parse(s()(this.$refs.liveStaffTable.tableSearchFields));var t="";for(var i in e)e[i]?t+="&"+i+"="+e[i]:t+="&"+i+"=";var a="";this.outputList.forEach(function(e){a+=e+","}),a=a.substring(0,a.length-1);var l=new Date,n=l.getFullYear()+this._getTimeFormat(l.getMonth()+1)+this._getTimeFormat(l.getDate());"allStaff"===this.isSelect?window.location.href="/downloads/apartment/users/apartmentUser/excels?fileName=人员信息_"+n+"&fields="+a+t:window.location.href="/downloads/apartment/users/checkIn/apartmentUser/excels?fileName=人员信息_"+n+"&fields="+a+t,this.outputModalShow=!1}else this.$toast("请选择要导出的字段")},_getTimeFormat:function(e){return e<10?"0"+e:e},_refreshTable:function(){this.timeStamp=Object(l.a)()}}},o={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container-fluid",attrs:{id:"accommodation-staff"}},[i("div",{staticClass:"row text-center"},[i("ul",{staticClass:"nav nav-tabs relationClassManage-tab",attrs:{id:"myTab"}},e._l(e.tabs,function(t,a){return i("li",{key:a,class:{active:e.isSelect==t.id},on:{click:function(i){return e.changeTab(t)}}},[i("a",[e._v(e._s(e.translate.peopleList[t.id]))])])}),0)]),e._v(" "),i("div",{staticClass:"content row"},[i("div",{directives:[{name:"show",rawName:"v-show",value:"allStaff"===e.curRoute,expression:"curRoute === 'allStaff'"}]},[i("v-table",{key:1,ref:"allStaffTable",attrs:{url:e.allStaffUrl+"?timeStamp="+e.timeStamp,pagesize:"10",idField:"id",columns:e.allColumns,order:!0,columnsControl:!0,search:!0},on:{columnExchanged:e._columnExchanged}},[i("div",{staticClass:"btn-group pull-right",attrs:{slot:"btn-group",role:"group"},slot:"btn-group"},[i("button",{staticClass:"btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:e._exportStaffList}},[e._v(e._s(e.translate.export))]),e._v(" "),i("button",{staticClass:"btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:function(t){e.curRoute="importPage"}}},[e._v("批量修改")])])])],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"liveStaff"===e.curRoute,expression:"curRoute === 'liveStaff'"}]},[i("v-table",{key:2,ref:"liveStaffTable",attrs:{url:e.liveStaffUrl,pagesize:"10",idField:"id",columns:e.liveStaffColumns,order:!0,columnsControl:!0,search:!0},on:{columnExchanged:e._columnExchanged}},[i("div",{staticClass:"btn-group pull-right",attrs:{slot:"btn-group",role:"group"},slot:"btn-group"},[i("button",{staticClass:"btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:e._exportStaffList}},[e._v(e._s(e.translate.export))])])])],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"importPage"===e.curRoute,expression:"curRoute === 'importPage'"}]},[i("v-import",e._b({on:{backParentPage:function(t){e.curRoute="allStaff"}}},"v-import",e.importParams,!1))],1)]),e._v(" "),i("v-modal",{attrs:{show:e.showEidtModal,effect:"fade",width:"400"}},[i("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[i("h5",{staticClass:"modal-title"},[e._v("\n          "+e._s(e.translate.edit)+"\n      ")])]),e._v(" "),i("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[i("div",{staticClass:"form-group"},[i("label",{staticClass:"input-label modal-label"},[e._v(e._s(e.translate.formFieldsLabel.expectedCheckInTime))]),e._v(" "),i("v-datepicker",{staticClass:"btn-block form-datepicker-style",attrs:{disabled:"CHECK_IN"===e.selectCheckInStatus,clearButton:!1,showTime:!1},on:{daySelected:function(t){return e._dateSelected(t,"expectCheckInTime")}},model:{value:e.editTime.expectCheckInTime,callback:function(t){e.$set(e.editTime,"expectCheckInTime",t)},expression:"editTime.expectCheckInTime"}})],1),e._v(" "),i("div",{staticClass:"form-group"},[i("label",{staticClass:"input-label modal-label"},[e._v(e._s(e.translate.formFieldsLabel.expectedLeaveDormitoryTime))]),e._v(" "),i("v-datepicker",{staticClass:"btn-block form-datepicker-style",attrs:{clearButton:!1,showTime:!1},on:{daySelected:function(t){return e._dateSelected(t,"expectRetirementTime")}},model:{value:e.editTime.expectRetirementTime,callback:function(t){e.$set(e.editTime,"expectRetirementTime",t)},expression:"editTime.expectRetirementTime"}})],1)]),e._v(" "),i("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[i("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(t){e.showEidtModal=!1}}},[e._v(e._s(e.translate.cancel))]),e._v(" "),i("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:e._sumbitEditTime}},[e._v(e._s(e.translate.confirm))])])]),e._v(" "),i("v-modal",{attrs:{show:e.outputModalShow,effect:"fade",width:"550"}},[i("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[i("h5",{staticClass:"modal-title"},[e._v("\n        导出——字段选择\n    ")])]),e._v(" "),i("div",{staticClass:"modal-body export-modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[i("ul",{staticClass:"list-group"},e._l(e.formFields,function(t,a){return i("li",{key:a,staticClass:"list-group-item field-item",class:e.outputList.indexOf(t.fieldName)<0?"":"output-active",on:{click:function(i){return e._changeOutputList(t)}}},[e.outputList.indexOf(t.fieldName)<0?i("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("check_box_outline_blank"))}},[e._v("check_box_outline_blank")]):i("i",{staticClass:"maticon",domProps:{innerHTML:e._s(e.icons("check_box"))}},[e._v("check_box")]),e._v(" "),i("span",[e._v(e._s(t.fieldTitle))])])}),0)]),e._v(" "),i("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[i("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(t){e.outputModalShow=!1}}},[e._v("取消")]),e._v(" "),i("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:e._sureToOutput}},[e._v("确定")])])])],1)},staticRenderFns:[]};var c=i("C7Lr")(n,o,!1,function(e){i("clSf")},null,null);t.default=c.exports},clSf:function(e,t){}});