webpackJsonp([28],{WVlz:function(e,t){},n7SD:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("kV13"),i=a("C331"),n={props:{data:{default:null}},created:function(){var e=this,t=localStorage.getItem("lang");Object(i.g)(t)&&(this.lang=t),this.data?this.allIsSelect=this.data.data.tabId:this.allIsSelect=this.$route.params.thingsType,this.allAffairsTabs=[{id:"initiate",name:this.translate.myInitiate},{id:"waitHandle",name:this.translate.myWaitHandle},{id:"transfer",name:this.translate.transferToMe},{id:"copySend",name:this.translate.copySendToMe}],this.urlArray=[{id:"initiate",url:"/table-data/processEngine/myProcessInstances"},{id:"waitHandle",url:"/table-data/processEngine/tasks/todo"},{id:"transfer",url:"/table-data/processEngine/tasks/todo/transfer/page"},{id:"copySend",url:"/table-data/processEngine/processInstances/myCarbonCopy"}],this.columns=[{id:"name",title:this.translate.searchName,className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:this.translate.myAffairPlaceholder,autoFocus:!0}},formatter:function(t,a){return"initiate"===e.allIsSelect?e.translate.you+e.translate.of+t.businessName+e.translate[t.currentNode.category]:t.applicant.name+e.translate.of+t.businessName+e.translate[t.currentNode.category]}},{id:"createTime",title:this.translate.updatedTime,className:"text-left",hidden:!1},{id:"status",title:this.translate.status,className:"text-left",hidden:!1,formatter:function(t,a){var s="";return"pending"===t.status.toLowerCase()?s=e.resultMessageJson[t.lastAction]?e.resultMessageJson[t.lastAction].replace("{{node}}",t.currentNode.name):"":"end"===t.status.toLowerCase()&&(s=e.resultMessageJson[t.result.toLowerCase()]?e.resultMessageJson[t.result.toLowerCase()].replace("{{node}}",t.currentNode.name):""),s}},{id:"opt",className:"text-center",title:this.translate.opt,width:"100px",hidden:!1,formatter:function(){return[{tag:"a",text:e.translate.check,className:"opt-btn",callback:function(t,a){e.JumpAffairsPage(t)}}]}}]},data:function(){return{columns:[],handleColumns:[],url:"",urlArray:[],allIsSelect:"initiate",allAffairsTabs:[],curInstance:null,doNotClosePreview:["countermand","carbonCopy"],needAdviceAuthority:["reject","agree","disagree","carbonCopy","transfer"],resultMessageJson:{overtime:"申请在{{node}}节点超时",rescissory:"申请者取消申请",disable:"业务期停用，表单废弃",success:"申请已通过",fail:"申请在{{node}}节点不通过",end:"已结束",submit:"待{{node}}节点审核",agree:"待{{node}}节点审核",reject:"申请被驳回至{{node}}节点",countermand:"申请被撤回至{{node}}节点"},searchName:"",preview:!1,previewObj:{formData:null,authorities:null,recordData:[],log:null,curBusinessId:"",appId:""},definedSearch:{startTime:"",endTime:"",name:""},conditions:[],quotasRows:[],lang:"zh-cn"}},computed:{translate:function(){return Object(i.g)(this.lang).mainPage}},methods:{AllAffairsChangeTab:function(e){this.allIsSelect=e},JumpAffairsPage:function(e){var t=this;this.$waiting.show(),this.previewObj.curBusinessId=e.businessId,this.previewObj.appId=e.appId,this.curInstance=e,this._getLog(e.id,function(e){t.previewObj.log=e||null}),this._getAuthorityData(e.id,function(e){t.previewObj.authorities=e||[]}),this._getFormLayout(e.businessId,e.currentNode.id,function(a){t.previewObj.formData=a,t.previewObj.formData.components.forEach(function(e){s.default.set(e,"x",e.location.left),s.default.set(e,"y",e.location.top),s.default.set(e,"w",e.size.width),s.default.set(e,"h",e.size.height)}),t._getInitData(e.id,function(e){t.$waiting.close(),t.previewObj.recordData=e,t.preview=!0})})},_getInitData:function(e,t){var a=this;Object(i.e)({url:"/api/processEngine/processInstances/"+e,type:"get",success:function(e){e.state?t(e.data):a.$toast(e.message)}})},_getAuthorityData:function(e,t){var a=this;Object(i.e)({url:"/api/processEngine/processInstances/"+e+"/operations",type:"get",success:function(e){e.state?t(e.data):a.$toast(e.message)}})},_getLog:function(e,t){var a=this;Object(i.e)({url:"/api/processEngine/processInstances/"+e+"/handleLogs",type:"get",success:function(e){e.state?t(e.data):a.$toast(e.message)}})},_getFormLayout:function(e,t,a){var s=this;Object(i.e)({url:"/api/processEngine/business/"+e+"/formRenderData?nodeId="+t,type:"get",success:function(e){e.state?a(e.data):s.$toast(e.message)}})},_submit:function(e){var t=this;this.needAdviceAuthority.indexOf(e.type)>=0?this.$prompt({tip:"确认"+e.title+"?",placeholder:"请输入批复意见",callback:function(a){"ok"===a.type&&t._submitAction(e,a.text)}}):"cancel"===e.type?confirm("确认要放弃本申请吗？放弃后申请作废")&&this._submitAction(e):confirm("确认"+e.title+"?")&&this._submitAction(e)},_submitAction:function(e,t){var a=this,s="",n={};(s="submit"===e.type?"/api/processEngine/processInstances":"transfer"===e.type||"carbonCopy"===e.type?"/api/processEngine/update/processInstances?action="+e.type+"&userId="+e.userId:"save"===e.type?"/api/processEngine/business/"+this.previewObj.curBusinessId+"/formData/caches":"/api/processEngine/update/processInstances?action="+e.type+(t?"&message="+t:""),n={id:this.previewObj.recordData?this.previewObj.recordData.id:"",formData:e.formData,variable:{appId:this.previewObj.appId,businessId:this.previewObj.curBusinessId}},-1!==s.indexOf("/api/processEngine/update/processInstances"))&&(e.record&&(n.applicant=e.record.applicant),n={runtimeProcessInstancePO:n,appNodeQuotaTableList:this.quotasRows,conditions:this.conditions||[]});Object(i.e)({url:s,type:"post",data:n,success:function(t){t.state?(a.doNotClosePreview.indexOf(e.type)>=0?a._getAuthorityData(a.curInstance.id,function(e){a.previewObj.authorities=e||[]}):a.preview=!1,"submit"===e.type?a.$toast("提交申请成功"):a.$toast("申请已"+e.title)):a.$toast(t.message)}})}}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"myAffairs-page"}},[a("div",{staticClass:"myAffairs-container container-fluid"},[a("div",{staticClass:"row"},[a("div",{staticClass:" affairs-header myAffairs-header"},[a("div",{staticClass:"header-container"},[a("div",{staticClass:"affairs-title "},[e._v("\n            "+e._s(e.translate.myAffairs)+"\n          ")])]),e._v(" "),a("div",{staticClass:"affairs-nav"},e._l(e.allAffairsTabs,function(t,s){return a("div",{key:s,staticClass:"affairs-tab",class:{active:e.allIsSelect==t.id},on:{click:function(a){return e.AllAffairsChangeTab(t.id)}}},[e._v("\n            "+e._s(t.name)+"\n          ")])}),0)]),e._v(" "),a("div",{staticClass:"affairs-table"},[a("div",{staticClass:"table-search"},[a("div",{staticClass:"input-group search-group pull-left col-md-3 col-md-offset-1"},[a("span",{staticClass:"input-group-addon search-name"},[e._v(e._s(e.translate.startTime))]),e._v(" "),a("v-datepicker",{ref:"datepicker",staticClass:"btn-block time-picker",attrs:{clearButton:!0},model:{value:e.definedSearch.startTime,callback:function(t){e.$set(e.definedSearch,"startTime",t)},expression:"definedSearch.startTime"}})],1),e._v(" "),a("div",{staticClass:"input-group search-group pull-left col-md-3 col-md-offset-1"},[a("span",{staticClass:"input-group-addon search-name"},[e._v(e._s(e.translate.endTime))]),e._v(" "),a("v-datepicker",{ref:"datepicker",staticClass:"btn-block time-picker",attrs:{clearButton:!0},model:{value:e.definedSearch.endTime,callback:function(t){e.$set(e.definedSearch,"endTime",t)},expression:"definedSearch.endTime"}})],1)]),e._v(" "),"initiate"===e.allIsSelect?a("div",[a("v-table",{attrs:{idField:"id",columns:e.columns,url:"/table-data/processEngine/myProcessInstances",pagesize:"10",order:!0,searchParams:e.definedSearch,search:!0}})],1):"waitHandle"===e.allIsSelect?a("div",[a("v-table",{attrs:{idField:"id",columns:e.columns,url:"/table-data/processEngine/tasks/todo",pagesize:"10",order:!0,searchParams:e.definedSearch,search:!0}})],1):"transfer"===e.allIsSelect?a("div",[a("v-table",{attrs:{idField:"id",columns:e.columns,url:"/table-data/processEngine/tasks/todo/transfer/page",pagesize:"10",order:!0,searchParams:e.definedSearch,search:!0}})],1):a("div",[a("v-table",{attrs:{idField:"id",columns:e.columns,url:"/table-data/processEngine/processInstances/myCarbonCopy",pagesize:"10",order:!0,searchParams:e.definedSearch,search:!0}})],1)])])]),e._v(" "),e.preview?a("div",{staticClass:"preview-container"},[a("preview",{attrs:{data:e.previewObj.formData.components,title:e.previewObj.formData.name,script:e.previewObj.formData.property.script,authorities:e.previewObj.authorities,defaultData:e.previewObj.recordData,fileServer:e.uploadFile,log:e.previewObj.log},on:{submit:e._submit,back:function(t){e.preview=!1}}})],1):e._e()])},staticRenderFns:[]};var o=a("C7Lr")(n,r,!1,function(e){a("WVlz")},null,null);t.default=o.exports}});