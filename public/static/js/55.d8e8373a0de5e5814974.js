webpackJsonp([55],{"+Q7T":function(t,e,a){"use strict";(function(t){var s=a("3cXf"),i=a.n(s),n=a("C331");e.a={inject:{windowObj:{default:null}},props:["id","roomId"],data:function(){return{showEdit:!0,rows:[],columns:[],roomInfo:null,checkList:[],checkList_copy:[],isEdit:!1,scrollHeight:null,userList:[],curUser:null,illegal:null,illegalOptions:[],illegalList:[],noteText:"",isEditObj:null,rows_copy:[],hasIllegalList:[],dataKeys:[],imgObjs:[{dataKey:"",src:""}],imgList:[]}},mounted:function(){var t=this;this.$nextTick(function(){t.scrollHeight=document.body.offsetHeight-100})},watch:{windowObj:{deep:!0,handler:function(){this.scrollHeight=document.body.offsetHeight-100}}},methods:{cancle:function(){this.hasIllegalList=JSON.parse(i()(this.illegalOptions)),this.checkList_copy=JSON.parse(i()(this.checkList)),this.isEdit=!1},back:function(){this.$emit("back")},addUpload:function(){if(!(this.imgObjs.length<5))return this.$toast("最多只能上传5张图片");this.imgObjs.push({dataKey:"",src:""})},_fileHeadUpload:function(t,e){var a=this,s=new FormData;s.append("file",t.target.files[0]),s.append("fieldName",t.target.files[0].name);t.target.files[0].name;Object(n.e)({url:"/upload/storage/images",type:"post",data:s,contentType:!1,processData:!1,success:function(t){"88888"===t.code?(a.imgObjs[e].dataKey=t.data.hash,a.imgObjs[e].src="/upload/storage/images/"+t.data.hash):a.$toast(t.message)}}).always(function(){})},deleteTag:function(t,e,a){this.hasIllegalList[e].userDisciplinaryDTOS.splice(a,1)},selectImg:function(e){t(".file_"+e).click()},save:function(){for(var t=this,e=(this.checkList_copy,[]),a=0;a<this.imgObjs.length;a++)""!=this.imgObjs[a].dataKey&&e.push(this.imgObjs[a].dataKey);var s={id:this.id,sanitaryInspectionConfigItemDTOS:this.checkList_copy,sanitaryInspectionDisciplinaryDTOS:this.hasIllegalList,urls:e.join(","),remark:this.noteText};Object(n.e)({url:"/api/apartment/sanitaryInspection/room/update",type:"post",data:s,success:function(e){e.state?(t.getInfo(),t.$toast("保存成功")):t.$toast(e.message)}})},getUsers:function(){var t=this,e="/api/apartment/sanitaryInspection/room/userList/"+this.roomId;Object(n.e)({url:e,type:"get",success:function(e){e.state&&(t.userList=e.data)}})},getIllegalList:function(){var t=this;Object(n.e)({url:"/api/apartment/dicts?typeName=违规类型",type:"get",success:function(e){e.state&&(t.illegalList=e.data)}})},edit:function(){this.hasIllegalList=JSON.parse(i()(this.illegalOptions)),this.checkList_copy=JSON.parse(i()(this.checkList)),this.isEdit=!this.isEdit},setColumns:function(){this.columns=[{id:"configItemName",title:"检查项",className:"text-left",hidden:!1,width:150,search:{type:"input"}},{id:"maxScore",title:"总分",className:"text-left",hidden:!1,width:200,search:{type:"input"}},{id:"score",title:"评分",width:100,className:"text-left",hidden:!1,search:{type:"input"},canEdit:!0,edit:this.isEdit?{type:"input"}:null}]},getInfo:function(){var t=this;this.isEdit=!1;var e="/api/apartment/sanitaryInspection/room/"+this.id;Object(n.e)({url:e,type:"get",success:function(e){if(e.state){if(t.roomInfo=e.data,e.data.sanitaryInspectionConfigItemDTOS&&(t.checkList=e.data.sanitaryInspectionConfigItemDTOS,t.checkList_copy=JSON.parse(i()(e.data.sanitaryInspectionConfigItemDTOS)),t.rows_copy=[].concat(t.checkList),t.illegalOptions=e.data.sanitaryInspectionDisciplinaryDTOS,t.roomInfo.canEdit||(t.showEdit=!1),t.hasIllegalList=JSON.parse(i()(e.data.sanitaryInspectionDisciplinaryDTOS)),e.data.urls)){t.imgList=e.data.urls.split(","),t.imgObjs=[],t.dataKeys=t.imgList;for(var a=0;a<t.imgList.length;a++)t.imgObjs.push({src:"/upload/storage/images/"+t.imgList[a],dataKey:t.imgList[a]})}}else t.roomInfo=null,t.checkList=[],t.rows_copy=[]}})},addRule:function(){var t=this,e=!1,a="";if(!this.curUser)return this.$toast("请选择责任人");if(!this.illegal)return this.$toast("请选择违规项");for(var s=this.hasIllegalList,i=0;i<s.length;i++)if(this.curUser==s[i].userId){a=i;for(var n=0;n<s[i].userDisciplinaryDTOS.length;n++)if(this.illegal==s[i].userDisciplinaryDTOS[n].type)return e=!0,this.$toast("已存在该违规项")}var o="";this.illegalList.map(function(e,a){e.value==t.illegal&&(o=e.label)}),e||(s[a].userDisciplinaryDTOS.push({type:this.illegal,typeName:o,userId:s[a].userId,isDelete:!1}),this.illegal="",this.curUser="")}},created:function(){this.getInfo(),this.getUsers(),this.getIllegalList()}}}).call(e,a("qqHy"))},"3EWY":function(t,e){},AtLG:function(t,e,a){"use strict";(function(t){var e=a("3cXf");a.n(e),a("C331")}).call(e,a("qqHy"))},MNBR:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("C331"),i=(a("AtLG"),a("+Q7T")),n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"hygienismDetails"}},[a("div",{style:"max-height:"+t.scrollHeight+"px"},[a("i",{staticClass:"maticon back-icon-btn",staticStyle:{cursor:"pointer"},domProps:{innerHTML:t._s(t.icons("arrow_back"))},on:{click:t.back}},[t._v("arrow_back")]),t._v(" "),a("div",{staticClass:"header"},[t.roomInfo?a("label",{staticClass:"header-title pull-left"},[t._v("房间："+t._s(t.roomInfo.campusName+t.roomInfo.zoneName+t.roomInfo.buildingName+t.roomInfo.roomName))]):t._e(),t._v(" "),a("div",[a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.showEdit,expression:"showEdit"}],on:{click:t.edit}},[t._v("编辑")])],1)]),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.checkList_copy,stripe:""}},[a("el-table-column",{staticStyle:{width:"40%"},attrs:{prop:"configItemName",label:"描述"}}),t._v(" "),a("el-table-column",{attrs:{prop:"maxScore",label:"总分"}}),t._v(" "),a("el-table-column",{attrs:{prop:"score",label:"评分"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.isEdit?a("el-input-number",{attrs:{min:0,max:e.row.maxScore},model:{value:e.row.score,callback:function(a){t.$set(e.row,"score",a)},expression:"scope.row.score"}}):a("span",[t._v(t._s(e.row.score))])]}}])})],1),t._v(" "),a("div",{staticClass:"content"},[a("h1",[t._v("违规违纪")]),t._v(" "),t.isEdit?a("div",{staticClass:"list"},[a("div",{staticClass:"editSelect"},[a("div",{staticClass:"item"},[a("label",[t._v("责任人：")]),t._v(" "),a("el-select",{model:{value:t.curUser,callback:function(e){t.curUser=e},expression:"curUser"}},t._l(t.userList,function(t){return a("el-option",{key:t.userId,attrs:{label:t.name,value:t.userId}})}),1)],1),t._v(" "),a("div",{staticClass:"item"},[a("label",[t._v("违规项：")]),t._v(" "),a("el-select",{model:{value:t.illegal,callback:function(e){t.illegal=e},expression:"illegal"}},t._l(t.illegalList,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),t._v(" "),a("div",{staticClass:"item"},[a("el-button",{on:{click:t.addRule}},[t._v("添加")])],1)]),t._v(" "),a("div",{staticClass:"group"},[t._m(0),t._v(" "),a("div",{staticClass:"users"},t._l(t.hasIllegalList,function(e,s){return a("div",{key:s,staticClass:"user"},[e.userDisciplinaryDTOS.length?a("li",[a("span",[t._v(t._s(e.name)),a("i",{staticStyle:{"margin-left":"20px"}},t._l(e.userDisciplinaryDTOS,function(e,i){return a("el-tag",{key:i,attrs:{closable:""},on:{close:function(a){return t.deleteTag(e,s,i)}}},[t._v(t._s(e.typeName))])}),1)])]):t._e()])}),0)]),t._v(" "),a("div",{staticClass:"note flex"},[a("label",[t._v("备注：")]),t._v(" "),a("div",{staticClass:"noteText"},[a("el-input",{attrs:{type:"textarea",rows:5,resize:"none"},model:{value:t.noteText,callback:function(e){t.noteText=e},expression:"noteText"}})],1)]),t._v(" "),a("div",{staticClass:"uploads"},[a("h2",[a("label",[t._v("图片：")]),a("el-button",{on:{click:t.addUpload}},[t._v("上传图片")]),a("i",[t._v("提示：支持格式jpg、jpeg、png，文件最大5MB，文件数量最多5个")])],1),t._v(" "),a("div",{staticClass:"flex"},t._l(t.imgObjs,function(e,s){return a("div",{key:s,staticClass:"avatar-uploaders"},[t._m(1,!0),t._v(" "),a("input",{ref:"licenseUpload",refInFor:!0,class:"file_"+s,attrs:{type:"file",id:"upload-file"},on:{change:function(e){return t._fileHeadUpload(e,s)}}}),t._v(" "),""!=e.src?a("img",{staticClass:"licenseImg",attrs:{src:e.src},on:{click:function(e){return t.selectImg(s)}}}):t._e()])}),0)]),t._v(" "),a("div",{staticClass:"btnGroup",staticStyle:{"margin-top":"30px","text-align":"center"}},[a("el-button",{on:{click:t.cancle}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("保存")])],1)]):a("div",{staticClass:"list"},[a("div",{staticClass:"group"},[a("div",{staticClass:"title"},[t._v("已添加违纪项：")]),t._v(" "),a("div",{staticClass:"users"},t._l(t.illegalOptions,function(e,s){return a("div",{key:s,staticClass:"user"},[e.userDisciplinaryDTOS.length?a("li",[a("span",[t._v(t._s(e.name)),a("i",{staticStyle:{"margin-left":"20px"}},t._l(e.userDisciplinaryDTOS,function(e,s){return a("em",{key:s,staticStyle:{"margin-right":"10px"}},[t._v(t._s(e.typeName))])}),0)])]):t._e()])}),0)]),t._v(" "),a("div",{staticClass:"note"},[a("label",{staticStyle:{"margin-right":"20px"}},[t._v("备注：")]),t._v(" "),a("p",[t._v(t._s(t.roomInfo&&t.roomInfo.remark?t.roomInfo.remark:"暂无备注"))])]),t._v(" "),a("div",{staticClass:"imgList"},[a("label",[t._v("图片：")]),t._v(" "),t.imgList?a("div",{staticClass:"imgs"},t._l(t.imgList,function(t,e){return a("div",{key:e,staticClass:"imgObj"},[a("a",{attrs:{href:"/upload/storage/images/"+t+".jpg",target:"blank"}},[a("img",{attrs:{src:"/upload/storage/images/"+t,alt:""}})])])}),0):t._e()])])])],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title"},[e("li",[this._v("已添加违纪项：")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("i",[e("p",{staticClass:"tips"},[e("em")])])}]};var o=function(t){a("cQc/")},l=a("C7Lr")(i.a,n,!1,o,null,null).exports,r={props:["batchId"],components:{hygienismDetails:l},data:function(){return{isImport:!1,activeName:"1",tableUrl:"",columns:[],toEdit:!1,schoolList:[],unitList:[],buildings:[],zoneIds:[],campusIds:[],zoneNames:[],id:"",roomId:"",disciplinary:[],collegeList:[],importParams:{downloadTemplateUrl:"/apartment/sanitaryInspection/template",downloadErrorTemplateUrl:"/apartment/sanitaryInspection/errorFile",checkTemplateUrl:"/apartment/sanitaryInspection/checkExcel",templateName:"批量导入房间信息",importBtnType:null}}},methods:{backParentPage:function(){this.isImport=!1},backToParent:function(){this.toEdit=!1},back:function(){this.$emit("back")},downLoad:function(){var t=this;this.importParams.importBtnType=[{url:"/apartment/sanitaryInspection/room/addByExcel/"+this.batchId,method:"post",isShowBtn:!0,name:"导入检查列表",success:function(e){e.state?(t.isImport=!1,t.setTableurl()):t.$toast(e.message)}}],this.isImport=!0},outPut:function(){var t="/downloads/apartment/sanitaryInspection/room/getExcel/"+this.batchId;window.location.href=t},setTableurl:function(){this.tableUrl="/table-data/apartment/sanitaryInspection/room/List/"+this.batchId+"?sexList="+this.activeName+"&ts="+(new Date).getTime()},handleClick:function(){this.setTableurl()},getSchool:function(){var t=this;Object(s.e)({url:"/api/apartment/dicts?typeName=校区",type:"get",success:function(e){e.state&&(t.schoolList=e.data,t.getUnit(),setTimeout(function(){t.initColumns()},300))}})},getDisciplinary:function(){var t=this;Object(s.e)({url:"/api/apartment/dicts?typeName=违规类型",type:"get",success:function(e){e.state&&(t.disciplinary=e.data)}})},getCollege:function(){var t=this;Object(s.e)({url:"/api/apartment/unit/list",type:"get",success:function(e){e.state&&(t.collegeList=e.data)}})},getUnit:function(){var t=this;Object(s.e)({url:"/api/apartment/unit/list",type:"get",success:function(e){e.state&&(t.unitList=e.data)}})},_getZonesData:function(){var t=this;Object(s.e)({url:"/api/apartment/zones/getByCampuses?campusIds="+this.campusIds,type:"get",success:function(e){e.state?(t.zoneNames.splice(0,t.zoneNames.length),e.data&&(e.data.forEach(function(e){t.zoneNames.push({label:e.name,value:e.name})}),setTimeout(function(){t.initColumns()},200))):t.$toast(e.message)}})},_getBuildingsData:function(){var t=this;Object(s.e)({url:"/api/apartment/buildings/getWithConditions?campusIds="+this.campusIds+"&zoneIds="+this.zoneIds,type:"get",success:function(e){e.state?(t.buildings.splice(0,t.buildings.length),e.data&&e.data.forEach(function(e){t.buildings.push({label:e.name,value:e.buildingId})})):t.$toast(e.message)}})},initColumns:function(){var t=this;this.columns=[{id:"campusNames",title:"校区",className:"text-left",hidden:!1,search:{type:"multiSelect",data:{options:this.schoolList,optionsLabel:"label",optionsValue:"label",change:function(e){t.campusIds.splice(0,t.campusIds.length),e.value.length>0&&(t.campusIds=e.value.split(",")),t._getZonesData()}}},formatter:function(t){return t.campusName}},{id:"zoneNames",title:"园区",width:"150px",className:"text-left",hidden:!1,search:{type:"multiSelect",data:{options:this.zoneNames,optionsLabel:"label",optionsValue:"value",change:function(e){t.zoneIds.splice(0,t.zoneIds.length),e.value.length>0&&(t.zoneIds=e.value.split(","))}}},formatter:function(t){return t.zoneName}},{id:"buildingName",title:"楼栋",className:"text-left",hidden:!1,search:{type:"input"}},{id:"roomName",title:"房间号",className:"text-left",hidden:!1,search:{type:"input"}},{id:"statusList",title:"检查状态",className:"text-left",hidden:!1,search:{type:"multiSelect",data:{options:[{label:"未检查",value:"0"},{label:"已检查",value:"1"}],optionsLabel:"label",optionsValue:"value"}},formatter:function(t){return 0==t.status?"未检查":1==t.status?"已检查":void 0}},{id:"total",title:"卫生检查得分",className:"text-left",hidden:!1,search:{type:"input"},sorting:!0,sortType:""},{id:"disciplinary",title:"违纪事项",className:"text-left over",hidden:!1,search:{type:"multiSelect",data:{options:this.disciplinary,optionsLabel:"label",optionsValue:"value"}}},{id:"colleges",title:"学院",className:"text-left",hidden:!1,search:{type:"multiSelect",data:{options:this.collegeList,optionsLabel:"name",optionsValue:"code"}},formatter:function(t){return t.college}},{id:"opt",title:"操作",className:"text-left",width:60,hidden:!1,formatter:function(e){return[{tag:"a",text:"查看",className:"opt-btn",callback:function(e){t.id=e.id,t.roomId=e.roomId,t.toEdit=!0}}]}}]}},created:function(){this.setTableurl(),this.getSchool(),this.getDisciplinary(),this.getCollege()}},c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"checkDetails"}},[t.toEdit||t.isImport?t._e():a("div",[a("div",{staticClass:"tab"},[a("el-tabs",{attrs:{type:"card"},on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"男生宿舍",name:"1"}}),t._v(" "),a("el-tab-pane",{attrs:{label:"女生宿舍",name:"2"}})],1)],1),t._v(" "),a("div",{staticClass:"row text-center"},[a("v-table",{attrs:{url:t.tableUrl,pagesize:"10",idField:"id",columns:t.columns,order:!0,search:!0}},[a("div",{staticClass:"btn-group pull-left",attrs:{slot:"btn-group",role:"group"},slot:"btn-group"},[a("button",{staticClass:"btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:t.back}},[t._v("返回")])]),t._v(" "),a("div",{staticClass:"btn-group pull-right",attrs:{slot:"btn-group",role:"group"},slot:"btn-group"},[a("button",{staticClass:"btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:t.downLoad}},[t._v("导入")]),t._v(" "),a("button",{staticClass:"btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:t.outPut}},[t._v("导出")])])])],1)]),t._v(" "),t.toEdit?a("hygienism-details",{attrs:{id:t.id,roomId:t.roomId},on:{back:t.backToParent}}):t._e(),t._v(" "),t.isImport?a("v-import",t._b({on:{backParentPage:t.backParentPage}},"v-import",t.importParams,!1)):t._e()],1)},staticRenderFns:[]};var d=a("C7Lr")(r,c,!1,function(t){a("Uw/o")},null,null).exports,p={components:{checkDetails:d},data:function(){var t=this;return{importParams:{downloadTemplateUrl:"/apartment/sanitaryInspection/template",downloadErrorTemplateUrl:"/apartment/sanitaryInspection/errorFile",checkTemplateUrl:"/apartment/sanitaryInspection/checkExcel",templateName:"批量导入房间信息",importBtnType:[{url:"/apartment/sanitaryInspection/checkExcel",method:"post",isShowBtn:!0,name:"导入检查列表",success:function(e){"88888"==e.code&&(t.dataKey=e.data.dataKey)}}]},curBatchId:"",toDetails:!1,activeName:"man",tableUrl:"/table-data/apartment/sanitaryInspection/batchList",columns:[],showBatchModal:!1,schoolList:[],areaList:[],batchInfo:{name:"",inspectTime:"",endTime:"",dimension:"",campusId:"",region:[],proportion:"",inspectorsStr:[]},options:[],inspector:"",curInspectorObj:{},dataKey:"",addUsers:[]}},methods:{back:function(){this.toDetails=!1},downLoad:function(){window.location.href="/downloads/apartment/sanitaryInspection/getExcel"},setProportion:function(){var t=Number(this.batchInfo.proportion);return t<0||!t?this.batchInfo.proportion=0:t>100?this.batchInfo.proportion=100:void 0},deleteUser:function(t,e){this.addUsers.splice(t,1)},selectChange:function(t){},submit:function(){var t=this,e=this.batchInfo,a=(e.region,void 0);if(""==e.name)return this.$toast("请输入批次名称");if(""==e.inspectTime)return this.$toast("请选择检查时间");if(""==e.endTime)return this.$toast("请选择操作截止时间");if(""===e.dimension)return this.$toast("请选择检查维度");if(2!=e.dimension){if(""==e.campusId)return this.$toast("请选择校区");if(!e.region.length)return this.$toast("请选择区域");if(""===e.proportion)return this.$toast("请输入检查比例")}if(!e.inspectorsStr.length&&!this.addUsers.length)return this.$toast("请添加检查员");var i=e.inspectTime,n=e.endTime,o=new Date,l=o.getFullYear()+"-";l+=o.getMonth()+1+"-";var r=(l+=o.getDate()).replace("-","/").replace("-","/"),c=n.replace("-","/").replace("-","/"),d=i.replace("-","/").replace("-","/");if(new Date(d).getTime()-new Date(r).getTime()<864e5)return this.$toast("检查时间应只可“明天”以上的时间");if(new Date(c).getTime()<new Date(d).getTime())return this.$toast("截止时间不得小于检查时间");if(2==e.dimension)if(""!=this.dataKey||e.id){if(e.id){a="/api/apartment/sanitaryInspection/update";for(var p=0;p<this.addUsers.length;p++)e.inspectorsStr.indexOf(this.addUsers[p].userId)<0&&e.inspectorsStr.push(this.addUsers[p].userId)}else a="/api/apartment/sanitaryInspection/add";var u={name:e.name,inspectTime:e.inspectTime,dimension:e.dimension,endTime:e.endTime,campusId:e.campusId,regions:e.region.join(","),proportion:Number(e.proportion)/100,inspectorsStr:e.inspectorsStr.join(","),dataKey:this.dataKey};e.id&&(u.id=e.id),Object(s.e)({url:a,type:"post",data:u,success:function(e){e.state?(t.$toast("保存成功"),t.tableUrl="/table-data/apartment/sanitaryInspection/batchList?ts="+(new Date).getTime(),t.resetForm(),t.showBatchModal=!1):t.$toast(e.message)}})}else this.$confirm("尚未上传宿舍信息, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){if(e.id){a="/api/apartment/sanitaryInspection/update";for(var i=0;i<t.addUsers.length;i++)e.inspectorsStr.indexOf(t.addUsers[i].userId)<0&&e.inspectorsStr.push(t.addUsers[i].userId)}else a="/api/apartment/sanitaryInspection/add";var n={name:e.name,inspectTime:e.inspectTime,dimension:e.dimension,endTime:e.endTime,campusId:e.campusId,regions:e.region.join(","),proportion:Number(e.proportion)/100,inspectorsStr:e.inspectorsStr.join(","),dataKey:t.dataKey};e.id&&(n.id=e.id),Object(s.e)({url:a,type:"post",data:n,success:function(e){e.state?(t.$toast("保存成功"),t.tableUrl="/table-data/apartment/sanitaryInspection/batchList?ts="+(new Date).getTime(),t.resetForm(),t.showBatchModal=!1):t.$toast(e.message)}})}).catch(function(){});else{if(e.id){a="/api/apartment/sanitaryInspection/update";for(var m=0;m<this.addUsers.length;m++)e.inspectorsStr.indexOf(this.addUsers[m].userId)<0&&e.inspectorsStr.push(this.addUsers[m].userId)}else a="/api/apartment/sanitaryInspection/add";var h={name:e.name,inspectTime:e.inspectTime,dimension:e.dimension,endTime:e.endTime,campusId:e.campusId,regions:e.region.join(","),proportion:Number(e.proportion)/100,inspectorsStr:e.inspectorsStr.join(","),dataKey:this.dataKey};e.id&&(h.id=e.id),Object(s.e)({url:a,type:"post",data:h,success:function(e){e.state?(t.$toast("保存成功"),t.tableUrl="/table-data/apartment/sanitaryInspection/batchList?ts="+(new Date).getTime(),t.resetForm(),t.showBatchModal=!1):t.$toast(e.message)}})}},resetForm:function(){this.batchInfo={name:"",inspectTime:"",endTime:"",dimension:"",campusId:"",region:[],proportion:"",inspectorsStr:[]},this.addUsers=[],this.options=[],this.curInspectorObj={},this.areaList=[]},getSchoolList:function(){var t=this;Object(s.e)({url:"/api/apartment/dicts?typeName=校区",type:"get",success:function(e){e.state&&(t.schoolList=e.data)}})},selectDimension:function(t){this.batchInfo.campusId="",this.batchInfo.region=[],this.areaList=[]},selectSchool:function(t){var e=this;if(this.$set(this.batchInfo,"region",[]),1==this.batchInfo.dimension){var a="/api/apartment/sanitaryInspection/getBuildings/"+this.batchInfo.campusId;Object(s.e)({url:a,type:"get",success:function(t){t.state&&(e.areaList=t.data)}})}else if(0==this.batchInfo.dimension){var i="/api/apartment/sanitaryInspection/getColleges/"+this.batchInfo.campusId;Object(s.e)({url:i,type:"get",success:function(t){t.state&&(e.areaList=t.data)}})}},remoteMethod:function(t){var e=this;if(""!==t){this.loading=!0;var a="/api/apartment/users/searchResults?keyword="+t;Object(s.e)({url:a,type:"get",success:function(t){t.state?(e.options=t.data,e.loading=!1):(e.options=[],e.loading=!1)}})}else this.options=[]},addNewBatch:function(){this.addUsers=[],this.showBatchModal=!0},cancle:function(){this.showBatchModal=!1,this.resetForm()}},created:function(){var t=this;this.getSchoolList(),this.columns=[{id:"name",title:"批次名称",className:"text-left",width:200,hidden:!1,search:{type:"input"}},{id:"inspectTimeForSeaRch",title:"检查时间",width:"150px",className:"text-left",hidden:!1,formatter:function(t){var e=t.inspectTime;return e?e.split(" ")[0]:""},search:{type:"input"}},{id:"endTimeForSeaRch",title:"操作截止时间",className:"text-left",hidden:!1,formatter:function(t){var e=t.endTime;return e?e.split(" ")[0]:""},search:{type:"input"}},{id:"inspectStatus",title:"检查情况",className:"text-left",hidden:!1},{id:"inspectorsStr",title:"检查员",className:"text-left",hidden:!0,search:{type:"input"},formatter:function(t){return t.inspectorNames}},{id:"dimensions",title:"检查方式",className:"text-left",hidden:!0,formatter:function(t){return 0==t.dimension?"按学院随机":1==t.dimension?"按楼栋随机":2==t.dimension?"自定义导入":void 0},search:{type:"multiSelect",data:{options:[{code:0,label:"按学院随机"},{code:1,label:"按楼栋随机"},{code:2,label:"自定义导入"}],optionsLabel:"label",optionsValue:"code"}}},{id:"proportion",title:"检查比例",className:"text-left",hidden:!0,formatter:function(t){return 0==t.proportion?0:100*t.proportion+"%"},search:{type:"input"}},{id:"inspectStatusList",title:"状态",className:"text-left",hidden:!1,formatter:function(t){return t.statusName},search:{type:"multiSelect",data:{options:[{code:0,label:"未开始"},{code:1,label:"正在进行"},{code:2,label:"已结束"}],optionsLabel:"label",optionsValue:"code"}}},{id:"creatorName",title:"创建者",className:"text-left",hidden:!0,search:{type:"input"}},{id:"opt",title:"操作",className:"text-left",width:200,hidden:!1,formatter:function(e){return[{tag:"a",text:"查看",className:"opt-btn",callback:function(e){t.curBatchId=e.id,t.toDetails=!0}},{tag:"a",text:"编辑",className:"opt-btn",callback:function(e){return 1==e.status?t.$toast("该批次已开始，不可编辑！"):2==e.status?t.$toast("该批次已结束，不可编辑！"):(t.addUsers=[],t.batchInfo.dimension=e.dimension,t.batchInfo.campusId=e.campusId+"",t.selectSchool(),void Object(s.e)({url:"/api/apartment/sanitaryInspection/"+e.id,type:"get",success:function(e){if(e.state){var a=e.data;if(t.batchInfo={id:a.id,name:a.name,inspectTime:a.inspectTime,endTime:a.endTime,dimension:a.dimension,campusId:a.campusId+"",region:[],proportion:a.proportion,inspectorsStr:[],dataKey:a.dataKey},t.addUsers=e.data.inspectorsUser,a.region){var s=a.region.split(",");t.batchInfo.region=s}t.showBatchModal=!0}}}))}},{tag:"a",text:"关闭批次",className:"opt-btn",callback:function(e){if(2==e.status)return t.$toast("该批次已结束，不可关闭！");t.$confirm("是否关闭该批次?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a="/api/apartment/sanitaryInspection/close/"+e.id;Object(s.e)({url:a,type:"post",success:function(e){e.state&&(t.tableUrl="/table-data/apartment/sanitaryInspection/batchList?ts="+(new Date).getTime(),t.$toast("已关闭"))}})}).catch(function(){t.$message({type:"info",message:"已取消关闭"})})}},{tag:"a",text:"删除",className:"opt-btn",callback:function(e){return 1==e.status?t.$toast("该批次已开始，不可删除！"):2==e.status?t.$toast("该批次已结束，不可删除！"):void t.$confirm("是否删除该批次?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a="/api/apartment/sanitaryInspection/delete/"+e.id;Object(s.e)({url:a,type:"post",success:function(e){e.state&&(t.tableUrl="/table-data/apartment/sanitaryInspection/batchList?ts="+(new Date).getTime(),t.$toast("已删除"))}})}).catch(function(){t.$message({type:"info",message:"已取消关闭"})})}}]}}]}},u={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"hygienism"}},[t.toDetails?t._e():a("div",{staticClass:"tableList"},[a("v-table",{attrs:{url:t.tableUrl,columnsControl:!0,pagesize:"10",idField:"id",columns:t.columns,order:!0,search:!1}},[a("div",{staticClass:"btn-group pull-right",attrs:{slot:"btn-group",role:"group"},slot:"btn-group"},[a("button",{staticClass:"btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:t.addNewBatch}},[t._v("新建批次")]),t._v(" "),a("button",{staticClass:"btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:t.downLoad}},[t._v("导出")])])])],1),t._v(" "),a("div",{staticClass:"dialog"},[a("v-modal",{attrs:{show:t.showBatchModal,effect:"fade",width:"700"}},[a("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[a("h5",{staticClass:"modal-title"},[t._v(t._s(t.batchInfo.id?"编辑批次":"新建批次"))])]),t._v(" "),a("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[a("div",{staticClass:"form"},[a("el-form",{ref:"ruleForm",attrs:{model:t.batchInfo,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"批次名称:"}},[a("el-input",{model:{value:t.batchInfo.name,callback:function(e){t.$set(t.batchInfo,"name",e)},expression:"batchInfo.name"}})],1),t._v(" "),a("div",{staticClass:"flex"},[a("el-form-item",{attrs:{label:"检查时间:"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"date",placeholder:"选择日期"},model:{value:t.batchInfo.inspectTime,callback:function(e){t.$set(t.batchInfo,"inspectTime",e)},expression:"batchInfo.inspectTime"}})],1),t._v(" "),a("el-form-item",{staticClass:"right",attrs:{label:"操作截止时间:"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd 23:59:59",type:"date",placeholder:"选择日期"},model:{value:t.batchInfo.endTime,callback:function(e){t.$set(t.batchInfo,"endTime",e)},expression:"batchInfo.endTime"}})],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"检查维度:"}},[a("el-select",{on:{change:t.selectDimension},model:{value:t.batchInfo.dimension,callback:function(e){t.$set(t.batchInfo,"dimension",e)},expression:"batchInfo.dimension"}},t._l([{label:"按学院选择",id:0},{label:"按楼栋选择",id:1},{label:"自定义导入",id:2}],function(t){return a("el-option",{key:t.id,attrs:{label:t.label,value:t.id}})}),1)],1),t._v(" "),""!==t.batchInfo.dimension&&2!=t.batchInfo.dimension?a("el-form-item",{attrs:{label:"选择校区:"}},[a("el-select",{on:{change:t.selectSchool},model:{value:t.batchInfo.campusId,callback:function(e){t.$set(t.batchInfo,"campusId",e)},expression:"batchInfo.campusId"}},t._l(t.schoolList,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1):t._e(),t._v(" "),""!==t.batchInfo.dimension&&2!=t.batchInfo.dimension?a("div",{staticClass:"choiceArea"},[0===t.batchInfo.dimension?a("el-form-item",{staticStyle:{width:"80%"},attrs:{label:"选择区域:"}},[a("el-select",{attrs:{multiple:""},model:{value:t.batchInfo.region,callback:function(e){t.$set(t.batchInfo,"region",e)},expression:"batchInfo.region"}},t._l(t.areaList,function(t){return a("el-option",{key:t.collegeId,attrs:{label:t.name,value:t.collegeId}})}),1)],1):t._e(),t._v(" "),1===t.batchInfo.dimension?a("el-form-item",{staticStyle:{width:"80%"},attrs:{label:"选择区域:"}},[a("el-select",{attrs:{multiple:""},model:{value:t.batchInfo.region,callback:function(e){t.$set(t.batchInfo,"region",e)},expression:"batchInfo.region"}},t._l(t.areaList,function(t){return a("el-option",{key:t.building_id,attrs:{label:t.name,value:t.building_id}})}),1)],1):t._e(),t._v(" "),a("el-form-item",{attrs:{label:"检查比例:"}},[a("el-input",{on:{blur:t.setProportion},model:{value:t.batchInfo.proportion,callback:function(e){t.$set(t.batchInfo,"proportion",t._n(e))},expression:"batchInfo.proportion"}},[a("template",{slot:"append"},[t._v("%")])],2)],1)],1):t._e(),t._v(" "),2==t.batchInfo.dimension?a("div",{staticClass:"choiceArea"},[a("el-form-item",{attrs:{label:""}},[a("v-import",t._b({attrs:{needBack:!1,needUpload:!1}},"v-import",t.importParams,!1))],1)],1):t._e(),t._v(" "),a("el-form-item",{attrs:{label:"添加检查员:"}},[a("el-select",{attrs:{filterable:"",clearable:"",multiple:"",remote:"","remote-method":t.remoteMethod,loading:t.loading,"popper-class":"selectList",placeholder:"请输入学工名称或者学工号"},on:{change:t.selectChange},model:{value:t.batchInfo.inspectorsStr,callback:function(e){t.$set(t.batchInfo,"inspectorsStr",e)},expression:"batchInfo.inspectorsStr"}},t._l(t.options,function(e){return a("el-option",{key:e.userNo,attrs:{label:e.name,value:e.userId}},[t._v(t._s(e.name+" ("+e.userNo+")"))])}),1)],1),t._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:t.batchInfo.id,expression:"batchInfo.id"}],attrs:{label:"已添加的检查员:"}},t._l(t.addUsers,function(e,s){return a("el-tag",{key:s,staticStyle:{"margin-right":"10px"},attrs:{closable:""},on:{close:function(a){return t.deleteUser(e,s)}}},[t._v("\n                "+t._s(e.name)+"\n              ")])}),1)],1)],1)]),t._v(" "),a("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.submit}},[t._v("确定")]),t._v(" "),a("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.cancle}},[t._v("取消")])])])],1),t._v(" "),t.toDetails?a("check-details",{attrs:{batchId:t.curBatchId},on:{back:t.back}}):t._e()],1)},staticRenderFns:[]};var m=a("C7Lr")(p,u,!1,function(t){a("3EWY")},null,null);e.default=m.exports},"Uw/o":function(t,e){},"cQc/":function(t,e){}});