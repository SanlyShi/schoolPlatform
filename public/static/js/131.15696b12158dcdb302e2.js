webpackJsonp([131],{"+qA5":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("C331"),o={data:function(){return{loading:!1,configModel:{app:"",work:""},configModel_copy:{app:"",work:""},configRules:{app:[{required:!0,message:"请选择配置应用",trigger:"change"}],work:[{required:!0,message:"请选择配置业务期",trigger:"change"}]},configRules_copy:{app:[{required:!0,message:"请选择配置应用",trigger:"change"}],work:[{required:!0,message:"请选择配置业务期",trigger:"change"}]},rules:{},rules_emp:{},appList:[],workList:[],workList_copy:[],fieldList:[],fieldList_emp:[],fieldListOptions:[],fieldListOptions_emp:[],fieldListModel:{},fieldListModel_emp:{},defaultSetting:null,isDefault:!0,configLoading:!1,fitConditon:!1}},watch:{configModel:{handler:function(e,t){var i=this;if(this.fieldListOptions=[],e.app&&e.work){this.configModel_copy.app&&this.configModel_copy.work&&(this.fitConditon=!0,this.isDefault||this.setData()),this.fieldListOptions=[];var o="/api/app/"+e.app+"/publishBusiness/"+e.work+"/formSetting";Object(s.e)({url:o,type:"get",success:function(e){if(e.state&&e.data&&e.data.components.length)for(var t=e.data.components,s=0;s<t.length;s++)i.fieldListOptions.push({label:t[s].title,name:t[s].name})}})}},deep:!0},configModel_copy:{handler:function(e){var t=this;if(this.fieldListOptions_emp=[],e.app&&e.work){this.configModel.app&&this.configModel.work&&(this.fitConditon=!0,this.isDefault||this.setData());var i="/api/app/"+e.app+"/publishBusiness/"+e.work+"/formSetting";Object(s.e)({url:i,type:"get",success:function(e){if(e.state&&e.data&&e.data.components.length)for(var i=e.data.components,s=0;s<i.length;s++)t.fieldListOptions_emp.push({label:i[s].title,name:i[s].name})}})}},deep:!0}},methods:{cancle:function(){this.isDefault=!0,this.workList=[],this.workList_copy=[],this.configModel={app:"",work:""},this.configModel_copy={app:"",work:""},this.setData()},setData:function(){var e=this,t=void 0;this.configLoading=!0,this.loading=!0,t=this.isDefault?{isDefault:!0}:{graduateAppId:this.configModel.app,graduateBusinessId:this.configModel.work,employmentAppId:this.configModel_copy.app,employmentBusinessId:this.configModel_copy.work,isDefault:!1},Object(s.e)({url:"/api/employment/statistics/getConfigInfo",type:"get",data:t,success:function(t){if(t.state){if(e.defaultSetting=t.data,!e.defaultSetting)return e.configLoading=!1,void(e.loading=!1);if(e.defaultSetting&&e.isDefault||e.fitConditon){var i=e.defaultSetting;e.appChange(i.graduateAppId,"workList"),e.appChange(i.employmentAppId,"workList_copy"),e.isDefault&&(e.configModel={app:i.graduateAppId,work:i.graduateBusinessId},e.configModel_copy={app:i.employmentAppId,work:i.employmentBusinessId});var s=i.statisticsFiledMatchingList,o=0,l=0;setTimeout(function(){for(var t=0;t<s.length;t++)"GRADUATE"==s[t].fieldType?(e.$set(e.fieldListModel,"select_"+o,s[t].formFieldName+"/"+s[t].formFieldTitle),o++):(e.$set(e.fieldListModel_emp,"select_"+l,s[t].formFieldName+"/"+s[t].formFieldTitle),l++);e.isDefault=!1,e.fitConditon=!1,e.configLoading=!1,e.loading=!1},1e3)}else e.configLoading=!1,e.loading=!1}}})},saveTitle:function(){},save:function(){var e=this,t=void 0,i=void 0,o=void 0,l=void 0;this.$refs.configForm.validate(function(e){t=e}),this.$refs.configForm_copy.validate(function(e){i=e}),this.$refs.fieldForm.validate(function(e){o=e}),this.$refs.fieldForm_copy.validate(function(e){l=e});if(t&&i&&o&&l){for(var a=[],n={graduateAppId:this.configModel.app,graduateBusinessId:this.configModel.work,employmentAppId:this.configModel_copy.app,employmentBusinessId:this.configModel_copy.work},r=0;r<this.fieldList.length;r++){var p=this.fieldListModel["select_"+r].split("/");a.push({formFieldName:p[0],formFieldTitle:p[1],statisticsField:this.fieldList[r].englishName,fieldType:"GRADUATE"})}for(var d=0;d<this.fieldList_emp.length;d++){var c=this.fieldListModel_emp["select_"+d].split("/");a.push({formFieldName:c[0],formFieldTitle:c[1],statisticsField:this.fieldList_emp[d].englishName,fieldType:"EMPLOYMENT"})}n.statisticsFiledMatchingList=a;Object(s.e)({url:"/api/employment/statistics/addConfig",type:"post",data:n,success:function(t){t.state?e.$message.success("添加成功"):e.$message.error("添加失败")}})}},getAppList:function(){var e=this;Object(s.e)({url:"/api/app/search?category=ALL&typeId=&userType=&keyword=&capital=",type:"get",success:function(t){t.state?e.appList=t.data:e.appList=[]}})},appChange:function(e,t){var i=this;if(e){var o="/api/app/"+e+"/business";this[t]=[],"workList_copy"==t?(this.isDefault||this.fitConditon||(this.configModel_copy.work=""),this.$refs.fieldForm_copy.resetFields(),this.$refs.fieldForm_copy.clearValidate()):(this.isDefault||this.fitConditon||(this.configModel.work=""),this.$refs.fieldForm.resetFields(),this.$refs.fieldForm.clearValidate()),Object(s.e)({url:o,type:"get",success:function(e){if(e.state&&e.data.length)for(var s=e.data,o=0;o<s.length;o++)i[t].push({name:s[o].business.name,id:s[o].business.id})}})}},getForm:function(){var e=this;this.loading=!0;Object(s.e)({url:"/api/employment/statistics/getStatisticsNeedFieldList?statisticsTypeEnum=GRADUATE",type:"get",success:function(t){if(t.state){if(e.fieldList=t.data,e.fieldList.length)for(var i=0;i<e.fieldList.length;i++)e.$set(e.fieldListModel,"select_"+i,""),e.$set(e.rules,"select_"+i,[{required:!0,message:"请输入任意项",trigger:"change"}])}else e.fieldList=[]}}),Object(s.e)({url:"/api/employment/statistics/getStatisticsNeedFieldList?statisticsTypeEnum=EMPLOYMENT",type:"get",success:function(t){if(t.state){if(e.fieldList_emp=t.data,e.fieldList_emp.length)for(var i=0;i<e.fieldList_emp.length;i++)e.$set(e.fieldListModel_emp,"select_"+i,""),e.$set(e.rules_emp,"select_"+i,[{required:!0,message:"请输入任意项",trigger:"change"}])}else e.fieldList_emp=[];e.loading=!1}})}},created:function(){this.getAppList(),this.getForm(),this.setData()}},l={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"statisticsConfig"}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.configLoading,expression:"configLoading"}],staticClass:"config"},[i("h1",[e._v("就业统计配置")]),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form",{ref:"configForm",staticClass:"appForm",attrs:{model:e.configModel,rules:e.configRules,"label-width":"100px"}},[i("el-form-item",{attrs:{prop:"app",label:"配置应用"}},[i("el-select",{on:{change:function(t){return e.appChange(t,"workList")}},model:{value:e.configModel.app,callback:function(t){e.$set(e.configModel,"app",t)},expression:"configModel.app"}},e._l(e.appList,function(t,s){return i("el-option",{key:s,attrs:{label:t.name,value:t.id}},[e._v(e._s(t.name))])}),1)],1),e._v(" "),i("el-form-item",{attrs:{prop:"work",label:"配置业务期"}},[i("el-select",{model:{value:e.configModel.work,callback:function(t){e.$set(e.configModel,"work",t)},expression:"configModel.work"}},e._l(e.workList,function(t,s){return i("el-option",{key:s,attrs:{label:t.name,value:t.id}},[e._v(e._s(t.name))])}),1)],1)],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form",{ref:"configForm_copy",attrs:{model:e.configModel_copy,rules:e.configRules_copy,"label-width":"100px"}},[i("el-form-item",{attrs:{prop:"app",label:"配置应用"}},[i("el-select",{on:{change:function(t){return e.appChange(t,"workList_copy")}},model:{value:e.configModel_copy.app,callback:function(t){e.$set(e.configModel_copy,"app",t)},expression:"configModel_copy.app"}},e._l(e.appList,function(t,s){return i("el-option",{key:s,attrs:{label:t.name,value:t.id}},[e._v(e._s(t.name))])}),1)],1),e._v(" "),i("el-form-item",{attrs:{prop:"work",label:"配置业务期"}},[i("el-select",{model:{value:e.configModel_copy.work,callback:function(t){e.$set(e.configModel_copy,"work",t)},expression:"configModel_copy.work"}},e._l(e.workList_copy,function(t,s){return i("el-option",{key:s,attrs:{label:t.name,value:t.id}},[e._v(e._s(t.name))])}),1)],1)],1)],1)],1),e._v(" "),i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"formList"},[i("el-col",{attrs:{span:12}},[i("div",{staticClass:"left"},[i("h1",[e._v("生源统计对应表单")]),e._v(" "),i("el-form",{ref:"fieldForm",attrs:{model:e.fieldListModel,"label-width":"100px",rules:e.rules}},e._l(e.fieldList,function(t,s){return i("el-form-item",{key:s,attrs:{prop:"select_"+s,label:e.fieldList[s].chineseName}},[i("el-select",{ref:"select",refInFor:!0,on:{change:function(i){return e.saveTitle(i,t)}},model:{value:e.fieldListModel["select_"+s],callback:function(t){e.$set(e.fieldListModel,"select_"+s,t)},expression:"fieldListModel['select_' + index]"}},e._l(e.fieldListOptions,function(e,t){return i("el-option",{key:t,attrs:{label:e.label,value:e.name+"/"+e.label}})}),1)],1)}),1)],1)]),e._v(" "),i("el-col",{attrs:{span:12}},[i("div",{staticClass:"right"},[i("h1",[e._v("就业率统计对应表单")]),e._v(" "),i("el-form",{ref:"fieldForm_copy",attrs:{model:e.fieldListModel_emp,"label-width":"100px",rules:e.rules_emp}},e._l(e.fieldList_emp,function(t,s){return i("el-form-item",{key:s,attrs:{prop:"select_"+s,label:e.fieldList_emp[s].chineseName}},[i("el-select",{model:{value:e.fieldListModel_emp["select_"+s],callback:function(t){e.$set(e.fieldListModel_emp,"select_"+s,t)},expression:"fieldListModel_emp['select_' + index]"}},e._l(e.fieldListOptions_emp,function(e,t){return i("el-option",{key:t,attrs:{label:e.label,value:e.name+"/"+e.label}})}),1)],1)}),1)],1)])],1),e._v(" "),i("div",{staticClass:"btnGroup"},[i("el-button",{attrs:{plain:""},on:{click:e.cancle}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("保存")])],1)])},staticRenderFns:[]};var a=i("C7Lr")(o,l,!1,function(e){i("V6//"),i("swVg")},"data-v-41df203d",null);t.default=a.exports},"V6//":function(e,t){},swVg:function(e,t){}});