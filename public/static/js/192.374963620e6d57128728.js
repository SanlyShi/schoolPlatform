webpackJsonp([192],{OMbl:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("HzJ8"),l=a.n(i),r=a("C331"),s=a("WCPx"),o=a.n(s),n={data:function(){return{typeStatChart:null,subTypeStatChart:null,typeStatChartOptions:{backgroundColor:"#FFFFFF",color:["#64c23a","#e6a23c","#f56c6c","#4091ff"],tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},series:[{name:"活动数量(大类)",type:"pie",radius:"60%",center:["50%","50%"],clockwise:!0,legendHoverLink:!1,selectedMode:"single",selectedOffset:20,data:[],itemStyle:{emphasis:{shadowBlur:50,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.3)"}},label:{normal:{formatter:function(t){return t.name+": "+t.value}}}}]},subTypeStatChartOptions:{backgroundColor:"#FFFFFF",color:["#64c23a","#e6a23c","#f56c6c","#4091ff"],tooltip:{trigger:"item",triggerOn:"mousemove",formatter:"{a} <br/>{b} : {c} ({d}%)"},visualMap:{show:!1,min:0,max:70,inRange:{colorLightness:[.5,.8]}},series:[{name:"活动数量(子类)",type:"pie",radius:"60%",center:["50%","50%"],roseType:"radius",label:{normal:{textStyle:{color:"rgba(0, 0, 0, 0.5)"},formatter:function(t){var e="";for(var a in t.name){e+=t.name[a],(Number(a)+1)%5==0&&(e+="\n")}return e+=": "+t.value}},emphasis:{textStyle:{fontWeight:"bold"}}},labelLine:{normal:{lineStyle:{color:"rgba(0, 0, 0, 0.5)"},smooth:0,length:10,length2:20},emphasis:{lineStyle:{width:2}}},itemStyle:{emphasis:{shadowBlur:50,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.3)"}},animationType:"scale",animationEasing:"elasticOut",animationDelay:function(t){return 200*Math.random()}}]},startTime:"",endTime:"",colleges:[],college:null,collegeActivityTypeStatList:{},loading:!0,colorPattern:["#D32F2F","#7B1FA2","#303F9F","#0288D1","#00796B","#689F38","#FFA000"].reverse()}},mounted:function(){this.initStatChart()},watch:{loading:function(t){t?(this.typeStatChart&&this.typeStatChart.showLoading(),this.subTypeStatChart&&this.subTypeStatChart.showLoading()):(this.typeStatChart&&this.typeStatChart.hideLoading(),this.subTypeStatChart&&this.subTypeStatChart.hideLoading())}},methods:{initStatChart:function(){var t=this;this.typeStatChart=o.a.init(document.getElementById("type-stat-chart")),this.subTypeStatChart=o.a.init(document.getElementById("sub-type-stat-chart")),this.typeStatChart.setOption(this.typeStatChartOptions),this.subTypeStatChart.setOption(this.subTypeStatChartOptions),this.reloadTypeStat(),this.typeStatChart.on("pieselectchanged",function(e){t.processTypeStatPieSelectChange(e)}),this.typeStatChart.on("pieselected",function(e){t.processTypeStatPieSelectChange(e)})},processTypeStatPieSelectChange:function(t){var e=t.selected,a="";for(var i in e)if(e[i]){a=i;break}if(a){var r=void 0,s=!0,o=!1,n=void 0;try{for(var c,h=l()(this.collegeActivityTypeStatList[this.college]);!(s=(c=h.next()).done);s=!0){var d=c.value;d.name===a&&(r=d)}}catch(t){o=!0,n=t}finally{try{!s&&h.return&&h.return()}finally{if(o)throw n}}this.updateSubTypeStatChart(r)}},updateTypeStatChart:function(){var t=[];if(this.collegeActivityTypeStatList[this.college]){var e=!0,a=!1,i=void 0;try{for(var r,s=l()(this.collegeActivityTypeStatList[this.college]);!(e=(r=s.next()).done);e=!0){var o=r.value;t.push({value:o.count,name:o.name,itemStyle:{normal:{color:o.color}}})}}catch(t){a=!0,i=t}finally{try{!e&&s.return&&s.return()}finally{if(a)throw i}}}var n={series:[{data:t}]};this.typeStatChart.setOption(n),this.typeStatChart.dispatchAction({type:"pieSelect",name:t[0].name})},updateSubTypeStatChart:function(t){var e=[],a=!0,i=!1,r=void 0;try{for(var s,o=l()(t.activityChildTypeStatList);!(a=(s=o.next()).done);a=!0){var n=s.value;e.push({value:n.count,name:n.name,itemStyle:{normal:{color:t.color}}})}}catch(t){i=!0,r=t}finally{try{!a&&o.return&&o.return()}finally{if(i)throw r}}var c={visualMap:{min:t.min,max:t.max},color:["#64c23a","#e6a23c","#f56c6c","#4091ff"],series:[{data:e}]};this.subTypeStatChart.setOption(c)},reloadTypeStat:function(t){var e=this;this.loading=!0,Object(r.e)({url:"/api/sc/stat/activities/types",data:{startTime:this.startTime,endTime:this.endTime},success:function(a){if(e.loading=!1,a.state||e.$toast("获取统计数据失败"),e.colleges=[],e.college=null,e.collegeActivityTypeStatList={},a.data.length){var i=!0,r=!1,s=void 0;try{for(var o,n=l()(a.data);!(i=(o=n.next()).done);i=!0){var c=o.value;c.collegeCode||(c.collegeCode="-1",c.collegeName="未知"),e.colleges.push({id:c.collegeCode,text:c.collegeName}),e.collegeActivityTypeStatList[c.collegeCode]=c.activityTypeStatList;var h=0,d=!0,u=!1,p=void 0;try{for(var y,v=l()(c.activityTypeStatList);!(d=(y=v.next()).done);d=!0){var m=y.value,f=1/0,S=0,g=!0,T=!1,C=void 0;try{for(var b,w=l()(m.activityChildTypeStatList);!(g=(b=w.next()).done);g=!0){var x=b.value;S=x.count>S?x.count:S,f=x.count<f?x.count:f}}catch(t){T=!0,C=t}finally{try{!g&&w.return&&w.return()}finally{if(T)throw C}}m.min=f,m.max=S,m.color=e.colorPattern[h++]}}catch(t){u=!0,p=t}finally{try{!d&&v.return&&v.return()}finally{if(u)throw p}}}}catch(t){r=!0,s=t}finally{try{!i&&n.return&&n.return()}finally{if(r)throw s}}e.college=e.colleges[0].id,t&&t()}}})},collegeSelected:function(t){null!=t.value&&(""==t.value?(this.college=this.colleges[0].id,this.updateTypeStatChart()):(this.college=t.value,this.updateTypeStatChart()))},startTimeSelected:function(t){var e=this;if(t.value){var a=this.startTime;if(this.startTime=t.value.split(/\s/g)[0],a===this.startTime)return}else this.startTime="";this.reloadTypeStat(function(){e.updateTypeStatChart()})},endTimeSelected:function(t){var e=this;if(t.value){var a=this.endTime;if(this.endTime=t.value.split(/\s/g)[0],a===this.endTime)return}else this.endTime="";this.reloadTypeStat(function(){e.updateTypeStatChart()})},exportStat:function(){window.location.href="/downloads/sc/stat/activities/types/export/excel?startTime="+this.startTime+"&endTime="+this.endTime}}},c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container-fluid sc-type-stat-container shadow_box"},[a("div",{staticClass:"actions"},[a("div",{staticClass:"filter-college"},[a("span",[t._v("学院")]),t._v(" "),a("v-select",{attrs:{options:t.colleges,optionsLabel:"text",optionsValue:"id"},on:{afterSelected:t.collegeSelected},model:{value:t.college,callback:function(e){t.college=e},expression:"college"}},[t._v(">")])],1),t._v(" "),a("div",{staticClass:"filter-time-label"},[t._v("在此之后开始")]),t._v(" "),a("div",{staticClass:"filter-time"},[a("v-datepicker",{attrs:{width:"100%",placeholder:"请选择时间",format:"yyyy-MM-dd"},on:{daySelected:t.startTimeSelected},model:{value:t.startTime,callback:function(e){t.startTime=e},expression:"startTime"}})],1),t._v(" "),a("div",{staticClass:"filter-time-label"},[t._v("在此之前结束")]),t._v(" "),a("div",{staticClass:"filter-time"},[a("v-datepicker",{attrs:{width:"100%",placeholder:"请选择时间",format:"yyyy-MM-dd"},on:{daySelected:t.endTimeSelected},model:{value:t.endTime,callback:function(e){t.endTime=e},expression:"endTime"}})],1),t._v(" "),a("button",{staticClass:"btn button_1 action-export",attrs:{type:"button"},on:{click:t.exportStat}},[t._v("导出")])]),t._v(" "),t._m(0)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-6 col-sm-12",attrs:{id:"type-stat-chart"}}),this._v(" "),e("div",{staticClass:"col-md-6 col-sm-12",attrs:{id:"sub-type-stat-chart"}})])}]};var h=a("C7Lr")(n,c,!1,function(t){a("P7qm")},null,null);e.default=h.exports},P7qm:function(t,e){}});