webpackJsonp([174],{"7p5i":function(e,t){},npQh:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("a3Yh"),s=a.n(i),n=a("IHPB"),r=a.n(n),l=a("C331"),o=a("y0ro"),d=a("9xzn"),c=(o.a,d.a,{mixins:[o.a],components:{sign:d.a},data:function(){return{showSign:!1,fileUrl:"/table-data/archives/getBaseInfo",fileColumns:[],timestamp:"?timestamp=",fileUserNo:"",showDialogStatus:!1,showImgDetailStatus:!1,deleteImgWidth:1,orgDepartmentList:[],fileAddList:[],positionList:[],orgDepartmentId:"",selectOrgDepartment:{},selectPosition:{},positionId:"",isEdit:!1,showDetailStatus:!1,dialogList:[],unitList:[],addParams:{studentName:"",noticeNo:"",land:"",examNo:"",studentNo:"",province:"",city:"",area:"",collegeName:"",barCode:"",archivesReceiveTime:"",archivesReceiveUnit:"",archivesReceiveMemberName:"",archivesReceiveMemberNo:"",instructorName:"",instructorId:"",archivesCome:""},signParams:{date:"",unit:"",receiverNo:""},addOptions:[{name:"姓名",type:"input",value:"studentName",require:!1,noEdit:!0},{name:"通知书单号",type:"input",value:"noticeNo",require:!1,noEdit:!0},{name:"生源地",type:"input",value:"land",require:!1,noEdit:!0},{name:"考生号",type:"input",value:"examNo",require:!1,noEdit:!0},{name:"学号",type:"input",value:"studentNo",require:!1,noEdit:!0},{name:"院系",type:"input",value:"collegeName",require:!1,noEdit:!0},{name:"辅导员",type:"input",value:"instructorName",placeholder:"检测姓名",label:"instructorName",require:!1,noEdit:!0,url:"/api/archives/queryInstructor"},{name:"档案接收日期",type:"date",value:"archivesReceiveTime",require:!1},{name:"档案接收部门",type:"detect",value:"archivesReceiveUnit",placeholder:"检测部门名称",label:"archivesReceiveUnit",require:!1,url:"/api/archives/queryUnit"},{name:"档案接收人",type:"detect",value:"archivesReceiveMemberNo",placeholder:"检测姓名",label:"archivesReceiveMemberName",require:!1,url:"/api/archives/queryArchiveReceiver"},{name:"EMS单号",type:"input",value:"emsNumber",require:!1,noEdit:!1},{name:"院系档案接收日期",type:"date",value:"collegeArchivesDate",require:!1}],signOptions:[{name:"档案接收部门",type:"select",value:"unit",placeholder:"检测部门名称",require:!1},{name:"院系档案接收日期",type:"date",value:"date",require:!1},{name:"档案接收人",type:"detect",value:"receiverNo",placeholder:"检测姓名",require:!1,url:"/api/archives/queryArchiveReceiver"}],lang:"zh-cn",beginTime:"",checkRows:[],endTime:""}},props:{selectItem:{default:function(){return{organizationId:null}}},orgM:{default:!1}},created:function(){var e=this,t=localStorage.getItem("lang"),a=this;this.fileColumns=[{id:"archivesNo",title:this.translate.archiveNo,className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"studentName",title:this.translate.name,className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"studentNo",title:this.translate.studentId,className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"collegeName",title:this.translate.college,className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"noticeNo",title:"通知书单号",className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"land",title:"生源地",className:"text-left",hidden:!0,search:{type:"input",data:{placeholder:""}}},{id:"examNo",title:"考生号",className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"archivesStatus",title:"档案状态",className:"text-left",hidden:!1,search:{type:"select",data:{options:[{value:"已转交",label:"已转交"},{value:"未转交",label:"未转交"}],optionsLabel:"label",optionsValue:"value",placeholder:""}}},{id:"archivesReceiveTime",title:"档案接收日期",className:"text-left",hidden:!1},{id:"archivesReceiveUnit",title:"档案接收部门",className:"text-left",hidden:!0,search:{type:"select",data:{url:"/api/archives/queryUnit",optionsLabel:"unitName",optionsValue:"unitName",placeholder:""}}},{id:"archivesReceiveMemberName",title:"档案接收人",className:"text-left",hidden:!0,search:{type:"input",data:{placeholder:""}}},{id:"collegeArchivesDate",title:"院系档案接收日期",className:"text-left",hidden:!0},{id:"instructorName",title:"辅导员",className:"text-left",hidden:!0,search:{type:"input",data:{placeholder:""}}},{id:"emsNumber",title:"EMS单号",className:"text-left",hidden:!0,search:{type:"input",data:{placeholder:""}}},{id:"opt",title:this.translate.opt,className:"text-center",width:"230px",hidden:!1,formatter:function(e){return[{tag:"a",text:a.translate.edit,className:"opt-btn",callback:function(e,t){a.editFile(e)}}]}}],Object(l.g)(t)&&(this.lang=t),this.importParams={parentPageTitle:"",downloadTemplateUrl:"/sc/organizations/"+this.selectItem.organizationId+"/files/batch/import/template",downloadErrorTemplateUrl:"/sc/organizations/"+this.selectItem.organizationId+"/files/batch/import/error",checkTemplateUrl:"/sc/organizations/"+this.selectItem.organizationId+"/files/batch/import/check",templateName:"批量导入模板",importBtnType:[{url:"/sc/organizations/"+this.selectItem.organizationId+"/files/batch/import",method:"post",isShowBtn:!0,name:"增量导入",success:function(t){e.timestamp="?timestamp="+(new Date).getTime(),e.curRoute="allStaff"}}]},this.getDepartmentList()},methods:{showImgDetail:function(e){this.showImgDetailStatus=!0,this.imgDetailSrc=e,window.onmousewheel=document.onmousewheel=this.scrollImg},scrollImg:function(e){this.showImgDetailStatus&&(e.deltaY>0?this.deleteImgWidth<2&&(this.deleteImgWidth+=.1):this.deleteImgWidth>.2&&(this.deleteImgWidth-=.1))},_showDialog:function(){var e=this;if(this.showDialogStatus)this.showDialogStatus=!1;else{var t="api/archives/getLog?userNo="+this.addParams.studentNo;Object(l.d)(t).then(function(t){if(t.state){e.showDialogStatus=!0;var a=[].concat([{name:"档案接收人",value:"archivesReceiveMemberName"},{name:"辅导员",value:"instructorName"}],r()(e.addOptions));e.dialogList=t.data.map(function(e){return a.forEach(function(t){-1!==e.content.indexOf(t.value)&&(e.content=e.content.replace(t.value,t.name))}),e.contentList=e.content.split(";"),e})}})}},getDepartmentList:function(){var e=this;Object(l.d)("api/archives/queryUnit").then(function(t){e.unitList=t.data.map(function(e){return{text:e.unitName,id:e.unitName}})})},overwrite:function(){this.$refs.mySign.overwrite()},afterSignDetect:function(e){this.signParams.receiverName=e.name,this.signParams.receiverNo=e.userNo},submitSign:function(){var e,t=this,a=this.$refs.mySign.getFile();this.signParams.image=a,this.signParams.userNo=this.checkRows.map(function(e){return e.studentNo});var i=new FormData;for(var n in this.signOptions)if(!this.signParams[this.signOptions[n].value])return void this.$toast(this.signOptions[n].name+"不能为空");for(var n in this.signParams)i.append(n,this.signParams[n]);Object(l.e)((e={url:"upload/archives/sign",dataType:"json",processData:!1,contentType:!1,type:"post",data:i},s()(e,"processData",!1),s()(e,"success",function(e){"88888"===e.code?(t.$toast("签收成功!"),t.showSign=!1,t.timestamp="?timestamp="+(new Date).getTime()):t.$toast(e.message)}),e))},submitAddFile:function(){var e=this,t="api/archives/add";if(this.isEdit)t="api/archives/updateArchive";else for(var a in this.addParams.land=this.addParams.province?this.addParams.province:""+this.addParams.city?","+this.addParams.city:""+this.addParams.area?","+this.addParams.area:"",this.addOptions)if(this.addOptions[a].require&&!this.addParams[this.addOptions[a].value])return void this.$toast(this.addOptions[a].name+"不能为空!");this.addParams.emsNo=this.addParams.emsNumber,this.addParams.archivesReceivedUnit=this.addParams.archivesReceiveUnit,this.addParams.archiveNo=this.addParams.archivesNo,Object(l.d)(t,this.addParams).then(function(t){t.state?(e.showDetailStatus=!1,e.timestamp="?timestamp="+(new Date).getTime(),e.$toast(e.isEdit?"编辑成功!":"新增成功!")):e.$toast(t.message)})},afterDetect:function(e,t){-1!==t.value.indexOf("Id")?(this.addParams[t.value]=e.userId,this.addParams[t.label]=e.name):-1!==t.value.indexOf("No")?(this.addParams[t.value]=e.userNo,this.addParams[t.label]=e.name):-1!==t.value.indexOf("archivesReceiveUnit")&&(this.addParams[t.value]=e.unitName)},getSelectOptions:function(e){return this.unitList},getAddressOptions:function(e,t,a){return"province"===e?this.provinceList:"city"===e?this._getCityList(t):"area"===e?this._getAreaList(t,a):void 0},afterChecked:function(e){this.checkRows=e},editFile:function(e){if(this.addParams=e,this.addParams.land){var t=e.land.replace("，",",").split(",");this.addParams.province=t[0],this.getAddressOptions("city",this.addParams.province).length?(this.addParams.city=t[1]?t[1]:"",this.addParams.area=t[2]?t[2]:""):this.addParams.province=""}this.isEdit=!0,this.showDetailStatus=!0},getSelect:function(e,t){for(var a in this[t])if(this[t][a].id==e)return this[t][a];return{text:"",id:""}},_backParentPage:function(){this.$parent.showFile=!1,this.$parent.pageSign="organizationList"},_showDetailStatus:function(){this.showDetailStatus=!0,this.isEdit=!1},_batchSignFile:function(){this.checkRows.length?this.showSign=!0:this.$toast("请选择批量签收的档案!")}},computed:{translate:function(){return Object(l.g)(this.lang).fileManage}}}),m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.showDetailStatus?a("div",{staticClass:"detail_wrap"},[a("label",{staticClass:"back pull-left box_flex flex_between",staticStyle:{padding:"0",width:"100%"}},[a("div",{on:{click:function(t){e.showDetailStatus=e.showDialogStatus=!1}}},[a("i",{staticClass:"maticon pull-left",domProps:{innerHTML:e._s(e.icons("arrow_back"))}},[e._v("arrow_back")]),e._v(" "),a("span",[e._v("返回")])]),e._v(" "),a("div",{staticClass:"opt-btn btn",staticStyle:{color:"#298df7"},on:{click:e._showDialog}},[e._v("日志")])]),e._v(" "),a("div",{staticClass:"form-wrap box_flex align_center"},[e._l(e.addOptions,function(t,i){return a("div",{key:i,staticClass:"form-group box_flex align_center"},[a("div",{staticClass:"label"},[a("span",[e._v(e._s(t.name)+":")])]),e._v(" "),"input"==t.type?a("input",{directives:[{name:"model",rawName:"v-model",value:e.addParams[t.value],expression:"addParams[item.value]"}],staticClass:"form-control search-input organization-input",attrs:{type:"text",disabled:e.isEdit&&t.noEdit},domProps:{value:e.addParams[t.value]},on:{input:function(a){a.target.composing||e.$set(e.addParams,t.value,a.target.value)}}}):e._e(),e._v(" "),"address"==t.type?a("v-select",{attrs:{options:e.getAddressOptions("province"),search:!0,"options-value":"name",disabled:e.isEdit&&t.noEdit,"options-label":"name","data-index":i},model:{value:e.addParams.province,callback:function(t){e.$set(e.addParams,"province",t)},expression:"addParams['province']"}}):e._e(),e._v(" "),e.addParams.province&&"address"==t.type?a("v-select",{attrs:{options:e.getAddressOptions("city",e.addParams.province),search:!0,"options-value":"name","options-label":"name"},model:{value:e.addParams.city,callback:function(t){e.$set(e.addParams,"city",t)},expression:"addParams['city']"}}):e._e(),e._v(" "),e.addParams.city&&"address"==t.type?a("v-select",{attrs:{options:e.getAddressOptions("area",e.addParams.city,e.addParams.province),search:!0,"options-value":"name","options-label":"name"},model:{value:e.addParams.area,callback:function(t){e.$set(e.addParams,"area",t)},expression:"addParams['area']"}}):e._e(),e._v(" "),"detect"==t.type?a("detect",{attrs:{url:t.url,searchVal:e.addParams[t.label],placeholder:t.placeholder},on:{afterSelected:function(a){e.afterDetect(a,t)}}}):e._e(),e._v(" "),"select"==t.type?a("v-select",{attrs:{options:e.getSelectOptions(t.value),"options-value":"id","options-label":"text","close-on-select":"",justify:""},model:{value:e.addParams[t.value],callback:function(a){e.$set(e.addParams,t.value,a)},expression:"addParams[item.value]"}}):e._e(),e._v(" "),"date"==t.type?a("v-datepicker",{model:{value:e.addParams[t.value],callback:function(a){e.$set(e.addParams,t.value,a)},expression:"addParams[item.value]"}}):e._e()],1)}),e._v(" "),a("div",{staticClass:"box_flex flex_center",staticStyle:{position:"absolute",bottom:"50px",width:"100%","padding-right":"200px"}},[a("button",{staticClass:"btn submit-btn",on:{click:e.submitAddFile}},[e._v("保存")])])],2),e._v(" "),e.showDialogStatus?a("div",{staticClass:"dialog_wrap"},e._l(e.dialogList,function(t,i){return a("div",{key:i},[a("p",{staticClass:"gray"},[e._v(e._s(t.updateTime))]),e._v(" "),e._l(t.contentList,function(t,i){return a("p",{key:i},[e._v(e._s(t))])}),e._v(" "),t.imageName?a("div",[a("p",{staticClass:"gray"},[e._v("更新了档案签字")]),e._v(" "),a("img",{attrs:{src:"/downloads/archives/getLogImage?fileName="+t.imageName,alt:""},on:{click:function(a){return e.showImgDetail("/downloads/archives/getLogImage?fileName="+t.imageName)}}})]):e._e()],2)}),0):e._e(),e._v(" "),a("v-modal",{staticClass:"img_modal",attrs:{show:e.showImgDetailStatus,backdrop:"true"},on:{onHide:function(t){e.showImgDetailStatus=!1}}},[a("div",{staticClass:"modal-body box_flex flex_center",staticStyle:{width:"400px",background:"white"},style:{transform:"scale("+e.deleteImgWidth+")"},attrs:{slot:"modal-body"},on:{click:function(t){e.showImgDetailStatus=!1}},slot:"modal-body"},[a("img",{staticStyle:{width:"100%"},attrs:{id:"detailImg",src:e.imgDetailSrc,alt:""}})])])],1):a("div",{staticClass:"file"},[a("v-table",{ref:"fileTable",attrs:{title:"档案管理",url:e.fileUrl+e.timestamp,columnsControl:!0,pagesize:"10",idField:"id",columns:e.fileColumns,multiple:"true",order:!0,search:!1},on:{afterChecked:e.afterChecked}},[a("div",{staticClass:"btn-group pull-right",attrs:{slot:"btn-group",role:"group"},slot:"btn-group"},[a("button",{staticClass:"btn batch-add-btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:e._batchSignFile}},[e._v(e._s(e.translate.batch)+e._s(e.translate.sign)+e._s(e.translate.file))])])]),e._v(" "),a("v-modal",{staticClass:"organization-modal",attrs:{show:e.showSign,effect:"fade",width:"566"}},[a("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[a("h5",{staticClass:"modal-title"},[e._v("签名")])]),e._v(" "),a("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[a("div",{staticClass:"form-wrap box_flex align_center"},[e._l(e.signOptions,function(t,i){return a("div",{key:i,staticClass:"form-group box_flex align_center"},[a("div",{staticClass:"label",class:{require:t.require}},[a("span",[e._v(e._s(t.name)+":")])]),e._v(" "),"input"==t.type?a("input",{directives:[{name:"model",rawName:"v-model",value:e.signParams[t.value],expression:"signParams[item.value]"}],staticClass:"form-control search-input organization-input",attrs:{type:"text"},domProps:{value:e.signParams[t.value]},on:{input:function(a){a.target.composing||e.$set(e.signParams,t.value,a.target.value)}}}):e._e(),e._v(" "),"detect"==t.type?a("detect",{attrs:{url:t.url,placeholder:t.placeholder},on:{afterSelected:function(a){e.afterSignDetect(a,t.value)}}}):e._e(),e._v(" "),"select"==t.type?a("v-select",{attrs:{options:e.getSelectOptions(t.value),"options-value":"id","options-label":"text","close-on-select":"",justify:""},model:{value:e.signParams[t.value],callback:function(a){e.$set(e.signParams,t.value,a)},expression:"signParams[item.value]"}}):e._e(),e._v(" "),"date"==t.type?a("v-datepicker",{model:{value:e.signParams[t.value],callback:function(a){e.$set(e.signParams,t.value,a)},expression:"signParams[item.value]"}}):e._e()],1)}),e._v(" "),a("div",{staticClass:"form-group box_flex"},[a("div",{staticClass:"label"},[a("span",[e._v("档案接收人签字:")])]),e._v(" "),a("div",{staticClass:"sign_wrap"},[a("sign",{ref:"mySign"})],1)])],2)]),e._v(" "),a("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:e.overwrite}},[e._v("清除签字")]),e._v(" "),a("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(t){e.showSign=!1}}},[e._v(e._s(e.translate.cancel))]),e._v(" "),a("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:e.submitSign}},[e._v(e._s(e.translate.confirm))])])]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"importPage"===e.curRoute,expression:"curRoute === 'importPage'"}],staticClass:"importPageClass"},[a("v-import",e._b({on:{backParentPage:function(t){e.curRoute="allStaff"}}},"v-import",e.importParams,!1))],1)],1)},staticRenderFns:[]};var u=a("C7Lr")(c,m,!1,function(e){a("7p5i")},"data-v-88f5a0da",null);t.default=u.exports}});