webpackJsonp([74],{"7WeZ":function(t,a){},N1X9:function(t,a){},VXww:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});e("f/gj");var s=e("zb7t"),i={render:function(){var t=this,a=t.$createElement,s=t._self._c||a;return t.showAddView?s("div",{staticClass:"carousel-view"},[s("div",{staticClass:"back-btn"},[s("i",{staticClass:"maticon pull-left",domProps:{innerHTML:t._s(t.icons("arrow_back"))},on:{click:t.back}},[t._v("arrow_back")]),t._v(" "),s("span",{on:{click:t.back}},[t._v("返回")])]),t._v(" "),s("el-form",{ref:"positionInfoForm",staticClass:"box_flex flex_wrap form_wrap",attrs:{model:t.addParams,"label-width":"180px"}},[s("el-form-item",{staticClass:"long_form_item icon_wrap",attrs:{label:"跳转链接"}},[s("el-input",{attrs:{type:"input",placeholder:"请输入链接地址(选填)"},model:{value:t.addParams.url,callback:function(a){t.$set(t.addParams,"url",a)},expression:"addParams.url"}})],1),t._v(" "),"edit"==t.modalType?s("el-form-item",{staticClass:"long_form_item",attrs:{label:"排序权重",required:""}},["edit"==t.modalType?s("el-input",{attrs:{type:"input",placeholder:"权重越高，播放位置越靠前(必填)"},model:{value:t.addParams.sort,callback:function(a){t.$set(t.addParams,"sort",a)},expression:"addParams.sort"}}):t._e()],1):t._e(),t._v(" "),"add"==t.modalType?s("el-form-item",{staticClass:"long_form_item",attrs:{label:"排序权重",required:""}},[s("el-input",{attrs:{type:"input",placeholder:"权重越高，播放位置越靠前(必填)"},model:{value:t.addParams.highestRak,callback:function(a){t.$set(t.addParams,"highestRak",a)},expression:"addParams.highestRak"}})],1):t._e(),t._v(" "),s("el-form-item",{staticClass:"long_form_item",attrs:{label:"上传图片",required:""}},[t.addParams.image?s("div",{staticClass:"img_wrap box_flex column flex_center",on:{click:function(a){return t.selectImage()}}},[s("img",{staticStyle:{width:"100%"},attrs:{src:"/downloads/storage/images/"+t.addParams.image,alt:""}})]):s("div",{staticClass:"img_wrap box_flex column flex_center",on:{click:function(a){return t.selectImage()}}},[s("div",{staticClass:"add-icon"},[s("img",{attrs:{src:e("DW+B"),alt:""}})]),t._v(" "),s("p",[t._v("点击添加图片")]),t._v(" "),s("p",{staticClass:"gray"},[t._v("每次只可上传一张，支持jpg、jpeg、gif、png、bmp的图片")])])])],1),t._v(" "),s("input",{staticStyle:{display:"none"},attrs:{id:"carouselImgInput",type:"file"},on:{change:function(a){return t.onSelectImage()}}}),t._v(" "),s("div",{staticClass:"box_flex flex_center"},[s("button",{staticClass:"btn cancel-btn",staticStyle:{"margin-right":"106px"},on:{click:t.back}},[t._v("取消")]),t._v(" "),s("button",{staticClass:"btn submit-btn",on:{click:function(a){return t.save()}}},[t._v("保存")])])],1):s("div",{staticClass:"carousel-page"},[s("div",{staticClass:"carousel-wrap"},[s("div",{staticClass:"content text-center"},[s("v-table",{attrs:{title:"首页轮播图列表",url:t.url,paginationShow:!1,pagesize:10,columns:t.columns,multiple:!1,order:!0,search:null}},[s("div",{attrs:{slot:"btn-group",role:"group"},slot:"btn-group"},[s("div",{staticClass:"btn-group pull-right "},[s("button",{staticClass:"btn batch-add-btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:function(a){return t.addOrEditCarousel("add")}}},[t._v("新增")])])])])],1)])])},staticRenderFns:[]};var r=function(t){e("7WeZ"),e("N1X9")},n=e("C7Lr")(s.a,i,!1,r,"data-v-253877e2",null);a.default=n.exports},"f/gj":function(t,a,e){"use strict";(function(t){e("C331")}).call(a,e("qqHy"))},zb7t:function(t,a,e){"use strict";(function(t){var s=e("C331");a.a={created:function(){this.initTable()},data:function(){return{opType:"",highestRak:"",url:"/table-data/firstPage/getPictureList",modalType:"add",showAddView:!1,addParams:{title:"",chooseName:"",image:"",sort:0,listPageUrl:"",moduleUrl:"",newWindow:1,highestRak:"",url:"",hash:""},timestamp:"",selectImageBase64:"",showTypeModal:!1,searchField:"name",oldParams:{}}},mounted:function(){},methods:{save:function(){var t=this,a={url:this.addParams.url,bannerStrength:this.addParams.highestRak,hash:this.addParams.image};if("add"==this.modalType){var e="api/firstPage/addPicture?url="+a.url+"&bannerStrength="+a.bannerStrength+"&hash="+a.hash;if(!a.bannerStrength||!a.hash)return void this.$toast("权重和图片必填！");Object(s.d)(e,a,"post").then(function(a){a.state?(t.$toast("新增成功!"),t.url=t.url+"?timestamp="+new Date,t.back()):t.$toast(a.message)})}else if("edit"==this.modalType){var i={url:this.addParams.url,sort:this.addParams.sort,picture_hash:this.addParams.image,id:this.addParams.id};if(!i.sort||!i.picture_hash)return void this.$toast("权重和图片必填！");Object(s.d)("api/firstPage/updateBanner",i,"post").then(function(a){a.state?(t.$toast("编辑成功!"),t.url=t.url+"?timestamp="+new Date,t.back()):t.$toast(a.message)})}},onSelectImage:function(t){var a=event.target.files[0],e=this;if(a){event.target.value="";var i=new FileReader;i.onloadend=function(t){var i=new Image;i.src=t.target.result,i.onload=function(){e.$croppa({file:a,width:960,height:250,scale:"",sure:function(t){if(e.addParams.image){var a="api/storage/files/"+e.addParams.image;Object(s.d)(a,{},"post").then(function(t){})}Object(s.d)("/api/storage/base64Images",{data:t}).then(function(a){var s=a.data.hash;e.addParams.image=s,e.$nextTick(function(){e.addParams.image=s}),e.selectImageBase64=t})}})}},i.readAsDataURL(a)}},selectImage:function(){t("#carouselImgInput").click()},initTable:function(){var t=this,a=this;this.columns=[{id:"picture_hash",title:"图片",hover:!1,width:200,className:"text-center",hidden:!1,formatter:function(t){return'<img src="/downloads/storage/images/'+t.picture_hash+'" style="width:80%;padding:5px 5px" alt="">'}},{id:"url",title:"跳转网站链接",width:300,className:"text-left",hidden:!1},{id:"sort",title:"排序权重",className:"text-left",hidden:!1},{id:"opt",title:"操作",className:"text-center",width:"210px",hidden:!1,formatter:function(e,i){var r={tag:"a",text:"编辑",className:"opt-btn",callback:function(t,e){a.addParams.url=t.url,a.addParams.sort=t.sort,a.addParams.image=t.picture_hash,a.addParams.id=t.id,a.addOrEditCarousel("edit")}},n={tag:"a",text:"禁用",className:"opt-btn",callback:function(a,e){confirm("确定禁用该轮播图?")&&Object(s.d)("/api/firstPage/closeAndOpen?openButton=1&hash="+a.picture_hash+"&id="+a.id,{},"post").then(function(a){a.state?(t.$toast("禁用成功"),t.url=t.url+"?timestamp="+new Date):t.$toast(a.message)})}},l={tag:"a",text:"启用",className:"opt-btn",callback:function(a,e){Object(s.d)("/api/firstPage/closeAndOpen?openButton=0&hash="+a.picture_hash+"&id="+a.id,{},"post").then(function(a){a.state?(t.$toast("启用成功"),t.url=t.url+"?timestamp="+new Date):t.$toast(a.message)})}},o=[];return o.push(r),0==e.is_enable?o.push(n):1==e.is_enable&&o.push(l),o}}]},addOrEditCarousel:function(t){var a=this;Object(s.d)("/api/firstPage/getPictureList?timestamp="+new Date).then(function(e){if(e.state){var i=0;if(e.data.content.length>0&&e.data.content.forEach(function(t){0==t.is_enable&&i++}),i<5||"edit"==t){Object(s.d)("api/firstPage/getBannerStrength").then(function(t){t.state?a.addParams.highestRak=t.data:a.$toast(t.message)}),a.modalType=t,a.showAddView=!0}else a.$toast("已开启的轮播数量超过5张，无法新增")}else a.$toast(e.message)}),"add"==t&&(this.addParams.url="",this.addParams.image="")},back:function(){this.showAddView=!1}}}}).call(a,e("qqHy"))}});