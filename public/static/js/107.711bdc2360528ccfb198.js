webpackJsonp([107],{KA0E:function(t,i,n){"use strict";(function(t){var o=n("C331");i.a={props:{data:{default:""},update:{default:!1}},data:function(){return{isShowExport:!1,signInListData:[],menus:{edit:"编辑",delete:"删除"},activityInfo:{},showConfirm:!1,confirmMsg:"",isDeleteSignOut:"",signId:"",confirmBtnText:"",confirmTitle:"",confirmType:"",exportUrl:"",isShowBoxShadow:!1}},created:function(){this.activityInfo=this.data.data,this._initPage()},watch:{update:function(t){t&&this._initPage()}},methods:{_back:function(){this.$emit("removeBread",this.data)},_initPage:function(){var t=this;Object(o.e)({url:"/api/sc/activityProcesses/signs/"+this.activityInfo.id,type:"get",success:function(i){i.state?(t.signInListData=i.data,t.signInListData.forEach(function(i){t.$set(i,"isShowSignOutPopover",!1),t.$set(i,"isShowSignInPopover",!1)}),t._monitorScroll()):t.$vux.toast.show({text:i.message,position:"bottom",type:"text"})}})},_monitorScroll:function(){var i=this;t(".signInList-content").on("scroll",function(){var n=t(this).scrollTop();i.isShowBoxShadow=n>=50})},_showExportPopover:function(){this.isShowExport=!0,this.signInListData.forEach(function(t){t.isShowSignOutPopover=!1,t.isShowSignInPopover=!1})},_closeExportPopover:function(){this.isShowExport=!1,this.signInListData.forEach(function(t){t.isShowSignOutPopover=!1,t.isShowSignInPopover=!1})},_showMenus:function(t,i){this.isShowExport=!1,this.signInListData.forEach(function(n,o){n.signId===i.signId?"signIn"===t?(n.isShowSignInPopover=!0,n.isShowSignOutPopover=!1):(n.isShowSignInPopover=!1,n.isShowSignOutPopover=!0):(n.isShowSignInPopover=!1,n.isShowSignOutPopover=!1)})},_creatSignIn:function(){this.$emit("addBread",{route:"/activity/MCreateSignIn",title:"",activityInfo:this.activityInfo,isSignOut:!1,data:""})},_signInDetail:function(t,i){this.$emit("addBread",{route:"/activity/MSignInDetail",title:"",isSignOut:"signIn"!==t,data:i})},_edit:function(t,i){i.isShowSignInPopover=!1,i.isShowSignOutPopover=!1,this.$emit("addBread",{route:"/activity/MCreateSignIn",title:"",activityInfo:this.activityInfo,isSignOut:"signIn"!==t,data:i})},_delete:function(t,i){this.showConfirm=!0,this.signId=i.signId,this.confirmBtnText="确定",this.confirmTitle="",this.confirmType="delete","signIn"===t?i.haveSignOut?(this.confirmMsg="确定删除吗？执行后将连同该次签退一起删除。并不保留签到人员信息",this.isDeleteSignOut="SIGN_IN"):(this.confirmMsg="确定删除吗？执行后不保留签到人员信息",this.isDeleteSignOut="SIGN_IN"):(this.confirmMsg="确定删除吗？执行后将不保留签退人员信息",this.isDeleteSignOut="SIGN_OUT")},onConfirm:function(){var t=this;if("delete"===this.confirmType)Object(o.e)({url:"/api/sc/activityProcesses/deleteSign/"+this.signId+"/"+this.isDeleteSignOut,type:"post",success:function(i){i.state?t._initPage():t.$vux.toast.show({text:i.message,position:"bottom",type:"text"})}});else{if(/(iP)/g.test(navigator.userAgent))return this.$vux.toast.show({text:"您的ios设备不支持附件下载，请复制上面链接！造成不便尽请谅解~",position:"bottom",type:"text"}),!1;var i=document.createElement("iframe");i.src=this.exportUrl,i.style.display="none",document.body.appendChild(i)}},_exportSignInTable:function(){var t=this;this.confirmBtnText="下载",this.confirmTitle="如果无法下载请复制下面链接",this.showConfirm=!0,this.confirmType="export",Object(o.e)({url:"/api/sc/activityProcesses/exportSignUsers?activityId="+this.activityInfo.id+"&filename="+this.activityInfo.name+"签到表",type:"get",success:function(i){i.state?(t.exportUrl="/downloads"+i.data,t.confirmMsg=window.location.origin+"/downloads"+i.data):t.$vux.toast.show({text:i.message,position:"bottom",type:"text"})}})}}}}).call(i,n("qqHy"))},W7pB:function(t,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});n("b4KM");var o=n("KA0E"),s={render:function(){var t=this,i=t.$createElement,n=t._self._c||i;return n("div",{attrs:{id:"signInList"},on:{click:t._closeExportPopover}},[n("view-box",[n("x-header",{staticClass:"signInList-header",style:{"box-shadow":t.isShowBoxShadow?"0 0 4px 0 rgba(0,0,0,0.12), 0 4px 4px 0 rgba(0,0,0,0.12)":"none"}},[n("i",{staticClass:"maticon back-icon",attrs:{slot:"overwrite-left"},domProps:{innerHTML:t._s(t.icons("navigate_before"))},on:{click:t._back},slot:"overwrite-left"},[t._v("navigate_before")]),t._v(" "),n("i",{staticClass:"maticon right-icon",attrs:{slot:"right"},domProps:{innerHTML:t._s(t.icons("more_vert"))},on:{click:function(i){return i.stopPropagation(),t._showExportPopover(i)}},slot:"right"},[t._v("more_vert")])]),t._v(" "),t.isShowExport?n("div",{staticClass:"export-popover",on:{click:t._exportSignInTable}},[t._v("\n       导出签到表\n    ")]):t._e(),t._v(" "),n("div",{staticClass:"signInList-content"},t._l(t.signInListData,function(i,o){return n("div",{key:o,staticClass:"signIn-list"},[n("div",{staticClass:"signIn-view"},[n("div",{staticClass:"signIn-cell",on:{click:function(n){return n.stopPropagation(),t._signInDetail("signIn",i)}}},[n("span",{staticClass:"title"},[t._v(t._s(i.signName)+"签到")]),t._v(" "),n("i",{staticClass:"maticon more-opt-icon",domProps:{innerHTML:t._s(t.icons("more_horiz"))},on:{click:function(n){return n.stopPropagation(),t._showMenus("signIn",i)}}},[t._v("more_horiz")]),t._v(" "),i.isShowSignInPopover?n("div",{staticClass:"customize-popover"},[n("div",{staticClass:"edit-div",on:{click:function(n){return n.stopPropagation(),t._edit("signIn",i)}}},[t._v("编辑")]),t._v(" "),n("div",{staticClass:"delete-div",on:{click:function(n){return n.stopPropagation(),t._delete("signIn",i)}}},[t._v("删除")])]):t._e()]),t._v(" "),i.haveSignOut?n("div",{staticClass:"signOut-cell",on:{click:function(n){return n.stopPropagation(),t._signInDetail("signOut",i)}}},[n("span",{staticClass:"title"},[t._v(t._s(i.signName)+"签退")]),t._v(" "),n("i",{staticClass:"maticon more-opt-icon",domProps:{innerHTML:t._s(t.icons("more_horiz"))},on:{click:function(n){return n.stopPropagation(),t._showMenus("signOut",i)}}},[t._v("more_horiz")]),t._v(" "),i.isShowSignOutPopover?n("div",{staticClass:"customize-popover"},[n("div",{staticClass:"edit-div",on:{click:function(n){return n.stopPropagation(),t._edit("signOut",i)}}},[t._v("编辑")]),t._v(" "),n("div",{staticClass:"delete-div",on:{click:function(n){return n.stopPropagation(),t._delete("signOut",i)}}},[t._v("删除")])]):t._e()]):t._e()])])}),0),t._v(" "),0===t.signInListData.length?n("div",{staticClass:"tips"},[t._v("当前没有签到，请点击按钮创建")]):t._e(),t._v(" "),n("div",{staticClass:"add-div"},[n("i",{staticClass:"maticon add-icon",domProps:{innerHTML:t._s(t.icons("add"))},on:{click:t._creatSignIn}},[t._v("add")])]),t._v(" "),n("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}],attrs:{id:"activity-signInList-transfer-dom"}},[n("confirm",{staticClass:"activity-signInList-confirm",attrs:{title:t.confirmTitle,"confirm-text":t.confirmBtnText},on:{"on-cancel":t.onCancel,"on-confirm":t.onConfirm},model:{value:t.showConfirm,callback:function(i){t.showConfirm=i},expression:"showConfirm"}},[n("p",{staticStyle:{"text-align":"center"}},[t._v(t._s(t.confirmMsg))])])],1)],1)],1)},staticRenderFns:[]};var e=function(t){n("tzlZ")},a=n("C7Lr")(o.a,s,!1,e,null,null);i.default=a.exports},b4KM:function(t,i,n){"use strict";(function(t){n("C331")}).call(i,n("qqHy"))},tzlZ:function(t,i){}});