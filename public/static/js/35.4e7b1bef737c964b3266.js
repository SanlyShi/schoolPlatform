webpackJsonp([35],{"/DvT":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("3cXf"),i=a.n(s),n=(a("kV13"),a("y0ro")),o=a("C331"),r=a("zKJS"),l=a("clE5"),d=a("yFgL"),c=(Array,String,{data:function(){return{courseClassId:this.tabList[0].id,timestamp:"",columns:[],classArr:[],addPersonParams:{},showAddModal:!1,showAddOnePersonModal:!1,tableUrl:"/table-data/ca/person/page/"}},props:{tabList:{type:Array,default:function(){return[]}},courseName:String},created:function(){this.getClassList()},methods:{addOnePerson:function(){var t=this,e="api/ca/person/"+this.courseClassId+"?userId="+this.addPersonParams.userId;Object(o.d)(e,null,"post").then(function(e){e.state&&(t.$toast("操作成功!"),t.showAddOnePersonModal=!1,t.upDataTable())})},getClassList:function(){var t=this;Object(o.d)("/api/relClass/classes/list").then(function(e){e.state&&(t.classArr=e.data,t.initTable())})},afterSelectAddPerson:function(t){this.addPersonParams.userId=t.userId,this.addPersonParams.userNo=t.userNo,this.addPersonParams.name=t.name},addPersonByOne:function(){this.showAddOnePersonModal=!0,this.showAddModal=!1},addSignPeople:function(t){var e=this,a="api/ca/person/"+this.courseClassId+"?userId="+t.userId;Object(o.d)(a).then(function(t){t.state&&e.$toast("签到成功!")})},batchAddPerson:function(){var t=this;this.$parent.importParams={parentPageTitle:"",downloadTemplateUrl:"/ca/person/batch/template",downloadErrorTemplateUrl:"/ca/courses/batch/error",checkTemplateUrl:"/ca/person/batch/excel/"+this.courseClassId,templateName:"批量导入模板",importBtnType:[{url:"/ca/person/batch/update",method:"post",isShowBtn:!0,name:"增量导入",success:function(e){t.timestamp="?timestamp="+(new Date).getTime(),t.curRoute="personList"}}]},this.$parent.quickAddRecord()},initTable:function(){var t=this;this.columns=[{id:"userNo",title:"学号",className:"text-left",width:"120px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"name",title:"姓名",className:"text-left",width:"55px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"college",title:"学院",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code",placeholder:""}},formatter:function(t){return t.college}},{id:"className",title:"行政班级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.classArr,optionsLabel:"text",optionsValue:"text",placeholder:""}},formatter:function(t){return t.className}},{id:"opt",title:"操作",className:"text-center",width:"230px",formatter:function(e){return[{tag:"a",text:"删除",className:"opt-btn",callback:function(e,a){if(confirm("是否删除?")){var s="api/ca/person/delete/"+t.courseClassId+"?userId="+e.userId;Object(o.d)(s,null,"post").then(function(e){e.state&&(t.$toast("操作成功!"),t.upDataTable())})}}}]}}]},upDataTable:function(){this.timestamp="?timestamp="+(new Date).getTime()},back:function(){this.$emit("back")}}}),u={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a",{staticClass:"box_flex align_center back_wrap",attrs:{type:"button"},on:{click:function(e){return t.back()}}},[a("i",{staticClass:"maticon back-icon-btn",domProps:{innerHTML:t._s(t.icons("arrow_back"))}},[t._v("arrow_back")]),a("span",{staticClass:"nav-title"},[t._v("返回")])]),t._v(" "),a("div",[a("div",{staticClass:"tab-div"},t._l(t.tabList,function(e,s){return a("div",{key:s,staticClass:"tab",class:t.courseClassId===e.id?"active":"",attrs:{title:e.className},on:{click:function(a){t.courseClassId=e.id}}},[t._v(t._s(e.className))])}),0),t._v(" "),a("v-table",{attrs:{url:t.tableUrl+t.courseClassId+t.timestamp,title:t.courseName,search:!1,pagesize:"10",idField:"id",order:!0,columns:t.columns}},[a("div",{attrs:{slot:"btn-group",role:"group"},slot:"btn-group"},[a("div",{staticClass:"btn-group pull-right"},[a("button",{staticClass:"btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.showAddModal=!0}}},[t._v("新增人员名单")])])])]),t._v(" "),a("v-modal",{attrs:{show:t.showAddModal,effect:"fade",width:"420"}},[a("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[a("h5",{staticClass:"modal-title"},[t._v("\n          新增考勤人员名单\n        ")])]),t._v(" "),a("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[a("button",{staticClass:"btn submit-btn clearBtnBorder",staticStyle:{width:"380px","text-align":"center"},attrs:{type:"button"},on:{click:t.addPersonByOne}},[t._v("单条增加")]),t._v(" "),a("button",{staticClass:"btn submit-btn clearBtnBorder",staticStyle:{width:"380px","text-align":"center","margin-top":"20px"},attrs:{type:"button"},on:{click:function(e){return t.batchAddPerson()}}},[t._v("批量导入")])]),t._v(" "),a("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.showAddModal=!1}}},[t._v("取消")])])]),t._v(" "),a("v-modal",{attrs:{show:t.showAddOnePersonModal,effect:"fade",width:"400"}},[a("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[a("h5",{staticClass:"modal-title"},[t._v("\n          新增考勤人员名单\n        ")])]),t._v(" "),a("div",{staticClass:"modal-body container-fluid",staticStyle:{overflow:"inherit"},attrs:{slot:"modal-body"},slot:"modal-body"},[a("div",{staticClass:"form-group"},[a("detect",{attrs:{url:"/api/ca/users/students/searchResults",placeholder:t.请输入学号或者姓名},on:{afterSelected:t.afterSelectAddPerson}})],1)]),t._v(" "),a("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.showAddOnePersonModal=!1}}},[t._v("取消")]),t._v(" "),a("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.addOnePerson}},[t._v("确定")])])])],1)])},staticRenderFns:[]};var h=a("C7Lr")(c,u,!1,function(t){a("J7ad")},"data-v-b1317158",null).exports,g=(n.a,r.a,l.a,d.a,{mixins:[n.a],components:{SignInfoModal:r.a,checkbox:l.a,SignInfo:d.a,personlist:h},created:function(){this.$route.query.isPerson&&(this.isPerson=!0,this.url="/table-data/ca/courses/page/person"),this.$route.query.isAgent&&(this.isAgent=!0,this.url="/table-data/ca/courses/page/agent"),this.timestamp="?timestamp="+(new Date).getTime(),this.getYearList(),this.getCourserTypeList()},computed:{i18n:function(){return Object(o.g)(this.lang).iSign},tableUrl:function(){return this.curbatchId?this.url+this.timestamp+"&batchId="+this.curbatchId:""}},data:function(){return{url:"/table-data/ca/courses/page/school",classUrl:"/table-data/ca/signIn/page/",columns:[],courseClassId:"",courseId:"",courseName:"",lang:"zh-cn",classColumns:[],curbatchId:"",yearValue:"",isPerson:!1,isAgent:!1,yearOptions:[],termsOptions:[],timestamp:"?timestamp=",isEdit:!1,coursesTypeList:[],addUserData:null,addUserItem:null,showAddAgentUser:!1,requireOptions:[{value:"courseName",label:"考勤课程"},{value:"courseType",label:"课程类别"},{value:"teacherUserId",label:"任课教师"}],addParams:{courseName:"",courseType:"",classes:[{className:""}]},showAddOrEditModal:!1,newSignModal:{show:!1,name:null,startTime:"",endTime:"",signWays:{qrcode:"qrcode",location:"location"},isSignOut:!1,needOut:!0,signWay:"qrcode",useDynamicCode:!1,scanQrcodeWithLocation:!1,locations:[],qrcodeLocations:[],activeLocationIndex:0,project:null,projectId:null,maxLength:20,dateFormat:"yyyy-MM-dd hh:ii:ss"},agentList:[{agentType:"SCHOOL",agentRoles:{},agentUsers:[]}],roleOptions:{SCHOOL:[],COLLEGE:[],INSTRUCTOR:[],CLASS:[],USER:[]},signInfo:{project:null,sign:null,userType:"MANAGE"},agentTypeList:[{label:"全校统一分配",value:"SCHOOL"},{label:"以学院关系分配",value:"COLLEGE"},{label:"以带生关系分配",value:"INSTRUCTOR"},{label:"以班级关系分配",value:"CLASS"},{label:"自定义分配",value:"USER"}],showAddModal:!1}},watch:{yearValue:function(t){this.termsOptions=this.yearOptions.filter(function(e){return e.value===t})[0].terms,this.curbatchId=this.termsOptions[0].value}},methods:{onSelectAgentType:function(t,e){var a=0;this.agentList.forEach(function(e){e.agentType===t.value&&(a+=1)}),2===a?(this.agentList=JSON.parse(i()(this.oldAgentList)),this.$toast("该代理分配方式已被占用，请重新选择！")):this.oldAgentList=JSON.parse(i()(this.agentList))},addAgentUser:function(t){this.addUserData=null,this.addUserItem=t,this.showAddAgentUser=!0},saveAddAgentUser:function(){this.addUserData?-1===this.addUserItem.agentUsers.map(function(t){return t.userId}).indexOf(this.addUserData)?(this.addUserItem.agentUsers.push(this.addUserData),this.showAddAgentUser=!1):this.$toast("授权人员已存在!"):this.$toast("请选择授权人员!")},afterSelectAgentUser:function(t){this.addUserData=t},deleteAgentUser:function(t){t.agentUsers.splice(t.agentUsers.length-1,1)},saveAgent:function(){var t=this,e=JSON.parse(i()(this.agentList));e.map(function(t){var e=[];if("USER"!==t.agentType)for(var a in t.agentRoles)t.agentRoles[a]&&e.push({roleId:a});return t.agentRoles=e,t});var a="api/ca/agents/setting/"+this.courseClassId;Object(o.d)(a,e,"post").then(function(e){e.state?t.$toast("操作成功!"):t.$toast(e.message)})},setPower:function(){var t=this;this.curRoute="agent";var e="api/ca/agents/setting/"+this.courseClassId;Object(o.d)(e).then(function(e){t.agentList=e.data,t.agentList.map(function(t){if(t.agentRoles.length){var e={};t.agentRoles.forEach(function(t){e[t.roleId]=!0}),t.agentRoles=e}return t}),0==t.agentList.length&&(t.addAgent(),t.addAgent())}),this.getRoleOptions()},addAgent:function(){var t=this,e=!0,a=this.agentList.map(function(t){return t.agentType});this.agentTypeList.forEach(function(s){-1===a.indexOf(s.value)&&e&&(t.agentList.push({agentType:s.value,agentRoles:{},agentUsers:[]}),e=!1)}),e&&this.$toast("没有更多分配方式了!"),this.oldAgentList=JSON.parse(i()(this.agentList))},deleteAgent:function(t){this.agentList.splice(t,1),this.oldAgentList=JSON.parse(i()(this.agentList))},getRoleOptions:function(){var t=this;Object(o.d)("api/ca/system/classCommittee").then(function(e){t.roleOptions.CLASS=e.data});Object(o.d)("api/ca/system/roles/SCHOOL").then(function(e){t.roleOptions.SCHOOL=e.data});Object(o.d)("api/ca/system/roles/COLLEGE").then(function(e){t.roleOptions.COLLEGE=e.data})},addSign:function(t){var e=this,a=JSON.parse(i()(t));a.signInName=a.name,a.signInTimeStart=a.startTime,a.signInTimeEnd=a.endTime,a.dynamicCode=a.useDynamicCode,a.isLocation=a.scanQrcodeWithLocation,a.ranges=a.qrcodeLocations.map(function(t){return{longitude:t.lng,latitude:t.lat,distance:t.radius,address:t.address}});var s="api/ca/signIn/"+this.courseClassId;Object(o.d)(s,a).then(function(t){t.state?(e.newSignModal.show=!1,e.timestamp="?timestamp="+(new Date).getTime(),e.$toast("操作成功!")):e.$toast(t.message)})},toAddSign:function(t){this.newSignModal={show:!0,name:null,signWays:{qrcode:"qrcode",location:"location"},isSignOut:!1,needOut:!0,signWay:"qrcode",useDynamicCode:!1,scanQrcodeWithLocation:!1,locations:[],qrcodeLocations:[],activeLocationIndex:0,project:null,projectId:null,maxLength:20,dateFormat:"yyyy-MM-dd hh:ii:ss"}},batchAddCourse:function(){var t=this;this.isPerson?this.importParams={parentPageTitle:"",downloadTemplateUrl:"/ca/courses/personal/batch/template",downloadErrorTemplateUrl:"/ca/courses/batch/error",checkTemplateUrl:"/ca/courses/personal/batch/excel/"+this.curbatchId,templateName:"批量导入模板",importBtnType:[{url:"/ca/courses/batch/update",method:"post",isShowBtn:!0,name:"增量导入",success:function(e){t.timestamp="?timestamp="+(new Date).getTime(),t.curRoute="allStaff"}}]}:this.importParams={parentPageTitle:"",downloadTemplateUrl:"/ca/courses/school/batch/template",downloadErrorTemplateUrl:"/ca/courses/batch/error",checkTemplateUrl:"/ca/courses/batch/excel/"+this.curbatchId,templateName:"批量导入模板",importBtnType:[{url:"/ca/courses/batch/update",method:"post",isShowBtn:!0,name:"增量导入",success:function(e){t.timestamp="?timestamp="+(new Date).getTime(),t.curRoute="allStaff"}}]},this.quickAddRecord()},batchAddPerson:function(){var t=this;this.isPerson?this.importParams={parentPageTitle:"",downloadTemplateUrl:"/ca/courses/personal/batch/person/template",downloadErrorTemplateUrl:"/ca/courses/batch/error",checkTemplateUrl:"/ca/courses/batch/person/excel/"+this.curbatchId,templateName:"批量导入模板",importBtnType:[{url:"/ca/courses/batch/person/update",method:"post",isShowBtn:!0,name:"增量导入",success:function(e){t.timestamp="?timestamp="+(new Date).getTime(),t.curRoute="allStaff"}}]}:this.importParams={parentPageTitle:"",downloadTemplateUrl:"/ca/courses/school/batch/person/template",downloadErrorTemplateUrl:"/ca/courses/batch/error",checkTemplateUrl:"/ca/courses/batch/person/excel/"+this.curbatchId,templateName:"批量导入模板",importBtnType:[{url:"/ca/courses/batch/person/update",method:"post",isShowBtn:!0,name:"增量导入",success:function(e){t.timestamp="?timestamp="+(new Date).getTime(),t.curRoute="allStaff"}}]},this.quickAddRecord()},getSearchVal:function(){return this.addParams.userName?this.addParams.userName+"("+this.addParams.userNo+")":""},saveAddOrEdit:function(){var t=this;for(var e in this.requireOptions)if(!this.addParams[this.requireOptions[e].value])return void this.$toast(this.requireOptions[e].label+"不能为空!");for(var a in this.addParams.classes)if(!this.addParams.classes[a].className)return void this.$toast("课程班级名称不能为空!");var s="api/ca/courses";this.isPerson&&(s="api/ca/courses/personal");var i="post";this.isEdit&&(s="api/ca/courses/"+this.addParams.id,i="post",this.isPerson&&(s="api/ca/courses/personal/"+this.addParams.id)),this.addParams.batchId||(this.addParams.batchId=this.curbatchId),Object(o.d)(s,this.addParams,i).then(function(e){e.state?(t.$toast("操作成功!"),t.showAddOrEditModal=!1,t.timestamp="?timestamp="+(new Date).getTime()):t.$toast(e.message)})},deleteClass:function(t){this.addParams.classes.splice(t,1)},addClass:function(){this.addParams.classes.push({className:""})},addCourse:function(){this.addParams={courseName:"",courseType:"",classes:[{className:""}]},this.isEdit=!1,this.showAddModal=!1,this.showAddOrEditModal=!0},getCourserTypeList:function(){var t=this;Object(o.d)("api/ca/dict?typeName=课程类别").then(function(e){e.state&&(t.coursesTypeList=e.data,t.initTable())})},afterDetect:function(t){this.addParams.userName=t.name,this.addParams.userNo=t.userNo,this.addParams.teacherUserId=t.userId},initTable:function(){var t=this;this.classColumns=[{id:"signInName",title:"名称",className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"signInTimeStart",title:"签到开始时间",className:"text-left",hidden:!1,search:{type:"search",data:{dateFormat:"yyyy-mm-dd hh:ii"}}},{id:"signInTimeEnd",title:"签到结束时间",className:"text-left",hidden:!1,search:{type:"search",data:{dateFormat:"yyyy-mm-dd hh:ii"}}},{id:"signOutTimeStart",title:"签退开始时间",className:"text-left",hidden:!1,search:{type:"search",data:{dateFormat:"yyyy-mm-dd hh:ii"}},formatter:function(t){return t.isSignOut?t.signOutTimeStart:" "}},{id:"signOutTimeEnd",title:"签退结束时间",className:"text-left",hidden:!1,search:{type:"search",data:{dateFormat:"yyyy-mm-dd hh:ii"}},formatter:function(t){return t.isSignOut?t.signOutTimeEnd:" "}},{id:"opt",title:"操作",className:"text-center",width:"230px",formatter:function(e){return t.isAgent?[{tag:"a",text:"查看",className:"opt-btn",callback:function(e,a){t.newSignModal.isAgent=!0,t.showSignDetail(e)}}]:[{tag:"a",text:"查看",className:"opt-btn",callback:function(e,a){t.showSignDetail(e)}},{tag:"a",text:"删除",className:"opt-btn",callback:function(e,a){if(confirm("是否删除签到?")){var s="api/ca/signIn/delete/"+e.id;Object(o.d)(s,{},"post").then(function(e){e.state?(t.timestamp="?timestamp="+(new Date).getTime(),t.$toast("操作成功")):t.$toast(e.message)})}}}]}}],this.columns=[{id:"courseName",title:"课程名称",className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"courseType",title:"课程类别",className:"text-left",hidden:!1,search:{type:"select",data:{optionsLabel:"label",optionsValue:"value",options:t.coursesTypeList}},formatter:function(t){return t.courseTypeName}},{id:"userNo",title:"任课教师学工号",className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"userName",title:"任课教师姓名",className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"className",title:"课程班级",className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:""}},formatter:function(t){return t.classes.map(function(t){return t.className}).join(",")}},{id:"opt",title:"操作",className:"text-center",width:"230px",formatter:function(e){return t.isAgent?[{tag:"a",text:"查看",className:"opt-btn",callback:function(e,a){t.showDetail(e,"classList")}}]:[{tag:"a",text:"查看",className:"opt-btn",callback:function(e,a){t.showDetail(e,"classList")}},{tag:"a",text:"人员名单",className:"opt-btn",callback:function(e,a){t.showDetail(e,"personList")}},{tag:"a",text:"编辑",className:"opt-btn",callback:function(e,a){t.editCourse(e)}},{tag:"a",text:"删除",className:"opt-btn",callback:function(e,a){t.deleteCourse(e)}}]}}]},showDetail:function(t,e){var a=this;this.courseId=t.id,this.courseName=t.courseName;var s="api/ca/person/classes/"+this.courseId;if(this.isAgent)this.courseId;Object(o.d)(s).then(function(t){a.tabList=t.data,a.tabList.length?(a.courseClassId=a.tabList[0].id,a.curRoute=e):$toast("没有课程班级你想看什么?")})},editCourse:function(t){this.addParams=JSON.parse(i()(t)),this.isEdit=!0,this.showAddOrEditModal=!0},showSignDetail:function(t){var e="api/ca/signIn/"+t.id,a=this;Object(o.d)(e).then(function(t){var e=t.data;a.newSignModal.id=e.id,a.newSignModal.name=e.signInName,a.newSignModal.startTime=e.signInTimeStart,a.newSignModal.endTime=e.signInTimeEnd,a.newSignModal.signOutTimeStart=e.signOutTimeStart,a.newSignModal.signOutTimeEnd=e.signOutTimeEnd,a.newSignModal.useDynamicCode=e.dynamicCode,a.newSignModal.isSignOut=e.isSignOut,a.newSignModal.scanQrcodeWithLocation=e.isLocation,e.ranges&&(a.newSignModal.qrcodeLocations=e.ranges.map(function(t){return{lng:t.longitude,lat:t.latitude,radius:t.distance,address:t.address,showMap:!1,init:!0}})),a.signInfo.sign=a.newSignModal,a.curRoute="signInfo"})},deleteCourse:function(t){var e=this,a="api/ca/courses/delete/"+t.id;this.isPerson&&(a="api/ca/courses/personal/delete/"+t.id),confirm("确定删除该课程吗？删除后数据将无法恢复")&&Object(o.d)(a,{},"post").then(function(t){t.state?(e.$toast("操作成功!"),e.timestamp="?timestamp="+(new Date).getTime()):e.$toast(t.message)})},getYearList:function(){var t=this;Object(o.d)("api/ca/courses/options/schoolYears").then(function(e){e.state&&(t.yearOptions=e.data,e.data.forEach(function(e){e.terms.forEach(function(a){new Date(a.dateEnd)>new Date&&new Date>new Date(a.dateStart)&&(t.yearValue=e.value,t.curbatchId=a.value)})}))})}}}),p={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return"allStaff"===t.curRoute?a("div",{staticClass:"container-fluid"},[a("div",{staticClass:"row text-center"},[a("v-table",{attrs:{url:t.tableUrl,pagesize:"10",search:!1,idField:"id",order:!0,columns:t.columns}},[a("div",{attrs:{slot:"btn-group",role:"group"},slot:"btn-group"},[a("div",{staticClass:"btn-group pull-left"},[a("v-select",{attrs:{options:t.yearOptions,required:"true",optionsLabel:"label",optionsValue:"value"},on:{afterSelected:t.changeYear},model:{value:t.yearValue,callback:function(e){t.yearValue=e},expression:"yearValue"}}),t._v(" "),a("v-select",{staticStyle:{"margin-left":"15px"},attrs:{options:t.termsOptions,required:"true",optionsLabel:"label",optionsValue:"value"},on:{afterSelected:t.changeTerm},model:{value:t.curbatchId,callback:function(e){t.curbatchId=e},expression:"curbatchId"}})],1),t._v(" "),t.isAgent?t._e():a("div",{staticClass:"btn-group pull-right"},[a("button",{staticClass:"btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.showAddModal=!0}}},[t._v("新建考勤课程")]),t._v(" "),a("button",{staticClass:"btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:t.batchAddPerson}},[t._v("批量导入人员名单")])])])])],1),t._v(" "),a("v-modal",{attrs:{show:t.showAddModal,effect:"fade",width:"420"}},[a("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[a("h5",{staticClass:"modal-title"},[t._v("\n        新增考勤课程\n      ")])]),t._v(" "),a("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[a("button",{staticClass:"btn submit-btn clearBtnBorder",staticStyle:{width:"380px","text-align":"center"},attrs:{type:"button"},on:{click:function(e){return t.addCourse()}}},[t._v("单条增加")]),t._v(" "),a("button",{staticClass:"btn submit-btn clearBtnBorder",staticStyle:{width:"380px","text-align":"center","margin-top":"20px"},attrs:{type:"button"},on:{click:function(e){return t.batchAddCourse()}}},[t._v("批量导入")])]),t._v(" "),a("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.showAddModal=!1}}},[t._v("取消")])])]),t._v(" "),a("v-modal",{attrs:{show:t.showAddOrEditModal,effect:"fade",width:"420"}},[a("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t.isEdit?a("h5",{staticClass:"modal-title"},[t._v("\n        编辑\n      ")]):a("h5",{staticClass:"modal-title"},[t._v("\n        新增\n      ")])]),t._v(" "),a("div",{staticClass:"modal-body form-wrap",attrs:{slot:"modal-body"},slot:"modal-body"},[a("div",{staticClass:"form-group box_flex align_center"},[a("div",{staticClass:"label require"},[a("span",[t._v("考勤课程:")])]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.addParams.courseName,expression:"addParams['courseName']"}],staticClass:"form-control search-input",attrs:{type:"text"},domProps:{value:t.addParams.courseName},on:{input:function(e){e.target.composing||t.$set(t.addParams,"courseName",e.target.value)}}})]),t._v(" "),a("div",{staticClass:"form-group box_flex align_center"},[a("div",{staticClass:"label require"},[a("span",[t._v("课程类别:")])]),t._v(" "),a("v-select",{attrs:{options:t.coursesTypeList,"options-value":"value","options-label":"label","close-on-select":"",justify:""},model:{value:t.addParams.courseType,callback:function(e){t.$set(t.addParams,"courseType",e)},expression:"addParams['courseType']"}})],1),t._v(" "),a("div",{staticClass:"form-group box_flex align_center"},[a("div",{staticClass:"label require"},[a("span",[t._v("任课教师:")])]),t._v(" "),a("detect",{attrs:{url:"api/ca/users/searchResults",searchVal:t.getSearchVal(),placeholder:t.请输入学号或者姓名},on:{afterSelected:t.afterDetect}})],1),t._v(" "),a("div",{staticClass:"bar"}),t._v(" "),a("div",{staticClass:"class_wrap"},[a("div",{staticStyle:{"text-align":"right"}},[a("div",{staticClass:"add new_icon",on:{click:function(e){return t.addClass()}}})]),t._v(" "),t._l(t.addParams.classes,function(e,s){return a("div",{key:s,staticClass:"form-group box_flex align_center"},[a("div",{staticClass:"label require"},[a("span",[t._v("课程班级名称:")])]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.className,expression:"item.className"}],staticClass:"form-control search-input",attrs:{type:"text"},domProps:{value:e.className},on:{input:function(a){a.target.composing||t.$set(e,"className",a.target.value)}}}),t._v(" "),s>0?a("div",{staticClass:"action delete box_flex flex_center",on:{click:function(e){return t.deleteClass(s)}}}):t._e()])})],2)]),t._v(" "),a("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.showAddOrEditModal=!1}}},[t._v("取消")]),t._v(" "),a("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){return t.saveAddOrEdit()}}},[t._v("保存")])])])],1):"classList"===t.curRoute?a("div",[a("a",{staticClass:"box_flex align_center back_wrap",attrs:{type:"button"},on:{click:function(e){t.curRoute="allStaff"}}},[a("i",{staticClass:"maticon back-icon-btn",domProps:{innerHTML:t._s(t.icons("arrow_back"))}},[t._v("arrow_back")]),a("span",{staticClass:"nav-title"},[t._v("返回")])]),t._v(" "),a("div",{staticClass:"tab-div"},t._l(t.tabList,function(e,s){return a("div",{key:s,staticClass:"tab",class:t.courseClassId===e.id?"active":"",attrs:{title:e.className},on:{click:function(a){t.courseClassId=e.id}}},[t._v(t._s(e.className))])}),0),t._v(" "),a("v-table",{attrs:{url:t.classUrl+t.courseClassId+t.timestamp,title:t.courseName,pagesize:"10",idField:"id",order:!0,columns:t.classColumns}},[a("div",{attrs:{slot:"btn-group",role:"group"},slot:"btn-group"},[t.isAgent?t._e():a("div",{staticClass:"btn-group pull-right"},[a("button",{staticClass:"btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:t.setPower}},[t._v("代理授权")]),t._v(" "),a("button",{staticClass:"btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:t.toAddSign}},[t._v("新建签到")])])])]),t._v(" "),a("sign-info-modal",{attrs:{title:"新增签到",signInfo:t.newSignModal,i18n:t.i18n},on:{confirm:t.addSign}})],1):"agent"===t.curRoute?a("div",{staticClass:"agent_wrap"},[a("a",{staticClass:"box_flex align_center back_wrap",attrs:{type:"button"},on:{click:function(e){t.curRoute="classList"}}},[a("i",{staticClass:"maticon back-icon-btn",domProps:{innerHTML:t._s(t.icons("arrow_back"))}},[t._v("arrow_back")]),a("span",{staticClass:"nav-title"},[t._v("返回")])]),t._v(" "),a("div",{staticClass:"form-wrap"},t._l(t.agentList,function(e,s){return a("div",{key:s,staticClass:"agent_row"},[a("div",{staticClass:"title"},[t._v("\n        代理授权\n      ")]),t._v(" "),a("div",{staticClass:"box_flex agent_item"},[a("div",{staticClass:"form-group"},[t._m(0,!0),t._v(" "),a("v-select",{attrs:{options:t.agentTypeList,"options-value":"value","options-label":"label",required:"true","close-on-select":"",justify:""},on:{change:function(e){t.onSelectAgentType(e,s)}},model:{value:e.agentType,callback:function(a){t.$set(e,"agentType",a)},expression:"item['agentType']"}})],1),t._v(" "),a("div",{staticClass:"form-group"},[t._m(1,!0),t._v(" "),"USER"!==e.agentType?a("div",{staticClass:"box_flex flex_wrap"},t._l(t.roleOptions[e.agentType],function(s,i){return a("div",{key:i},[a("checkbox",{attrs:{name:s.label},model:{value:e.agentRoles[s.value],callback:function(a){t.$set(e.agentRoles,s.value,a)},expression:"item.agentRoles[role.value]"}})],1)}),0):a("div",{staticClass:"box_flex flex_wrap user_wrap"},[t._l(e.agentUsers,function(e,s){return a("div",{key:s,staticClass:"user_item"},[t._v("\n              "+t._s(e.name)+"\n            ")])}),t._v(" "),a("div",{staticClass:"action add box_flex flex_center",on:{click:function(a){return t.addAgentUser(e)}}}),t._v(" "),e.agentUsers.length?a("div",{staticClass:"action delete box_flex flex_center",on:{click:function(a){return t.deleteAgentUser(e)}}}):t._e()],2)])]),t._v(" "),s===t.agentList.length-1?a("div",[a("div",{staticClass:"action add box_flex flex_center",on:{click:function(e){return t.addAgent()}}}),t._v(" "),t.agentList.length>1?a("div",{staticClass:"action delete box_flex flex_center",on:{click:function(e){return t.deleteAgent(s)}}}):t._e()]):t._e()])}),0),t._v(" "),a("div",{staticClass:"box_flex flex_center",staticStyle:{padding:"20px"}},[a("button",{staticClass:"btn cancel-btn",staticStyle:{"margin-right":"80px"},on:{click:function(e){t.curRoute="classList"}}},[t._v("取消")]),t._v(" "),a("button",{staticClass:"btn submit-btn",on:{click:function(e){return t.saveAgent()}}},[t._v("保存")])]),t._v(" "),a("v-modal",{attrs:{show:t.showAddAgentUser,effect:"fade",width:"420"}},[a("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[a("h5",{staticClass:"modal-title"},[t._v("\n        新增授权人员\n      ")])]),t._v(" "),a("div",{staticClass:"modal-body form-wrap",staticStyle:{overflow:"inherit"},attrs:{slot:"modal-body"},slot:"modal-body"},[a("detect",{attrs:{url:"api/ca/users/searchResults",placeholder:t.请输入学号或者姓名},on:{afterSelected:t.afterSelectAgentUser}})],1),t._v(" "),a("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.showAddAgentUser=!1}}},[t._v("取消")]),t._v(" "),a("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){return t.saveAddAgentUser()}}},[t._v("确定")])])])],1):"signInfo"===t.curRoute?a("div",[a("sign-info",t._b({key:t.signInfo.sign.id,on:{back:function(e){t.curRoute="classList"}}},"sign-info",t.signInfo,!1))],1):"personList"===t.curRoute?a("div",[a("personlist",{attrs:{courseName:t.courseName,tabList:t.tabList},on:{back:function(e){t.curRoute="allStaff"}}})],1):a("div",{staticClass:"importPageClass"},[a("v-import",t._b({on:{backParentPage:function(e){t.curRoute="allStaff"}}},"v-import",t.importParams,!1))],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"label"},[e("span",[this._v("代理权分配方式:")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"label require"},[e("span",[this._v("角色设置:")])])}]};var m=a("C7Lr")(g,p,!1,function(t){a("P05U")},"data-v-43261198",null);e.default=m.exports},B6Gn:function(t,e,a){"use strict";var s=a("C331");e.a={getManagerAuthority:function(t){var e={},a={};if(Object(s.e)({async:!1,url:"/api/currentUser/roles/41/authorities",success:function(t){e=t},error:t}),Object(s.e)({async:!1,url:"/api/currentUser/roles/24/authorities",success:function(t){a=t},error:t}),e.state&&a.state){t(null,e.data||a.data?{data:!0,state:!0}:{data:!1,state:!0})}},getProjectCategories:function(t,e,a){Object(s.e)({url:"/api/iSignIn/projects/projectTypes/list/"+i.changeTabToInterface(t)+"?keyWord="+(e||""),success:function(t){t.state&&(t.data=t.data.map(function(t){return{id:t.id,name:t.typeName}})),a(null,t)},error:a})},getProjectById:function(t,e){Object(s.e)({url:"/api/iSignIn/projects?projectId="+t,success:function(t){t.state&&(t.data=i.getProject(t.data)),e(null,t)},error:e})},getProjectsByCategoryId:function(t,e,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5,r=arguments[5];Object(s.e)({url:"/api/iSignIn/projects/"+t+"/"+e+"?page="+n+"&size="+o+"&keyWord="+(a||""),success:function(t){t.state&&(t.list=(t.data.content||[]).map(i.getProject),t.count=t.data.totalElements,t.totalPages=t.data.totalPages),r(null,t)},error:r})},getProjectPeopleCountByProjectId:function(t,e){Object(s.e)({url:"/api/iSignIn/projects/projectPeoplesCount/"+t,success:function(t){e(null,t)},error:e})},getSignsByProjectId:function(t,e){Object(s.e)({url:"/api/signIns/list/"+t,success:function(t){t.state&&(t.data=t.data.map(i.getSign)),e(null,t)},error:e})},getSignById:function(t,e){Object(s.e)({url:"/api/signIns/"+t,success:function(t){t.state&&(t.data=i.getSign(t.data)),e(null,t)},error:e})},getMySignsByProjectId:function(t,e){Object(s.e)({url:"/api/signIns/my/"+t,success:function(t){t.state&&(t.data=t.data.map(i.getSign)),e(null,t)},error:e})},addCategory:function(t,e){Object(s.e)({url:"/api/iSignIn/projects/projectTypes",type:"post",data:{typeName:t},success:function(t){t.state&&(t.data={id:t.data.id,name:t.data.typeName}),e(null,t)},error:e})},addProject:function(t,e){Object(s.e)({url:"/api/iSignIn/projects",type:"post",data:t,success:function(t){t.state&&(t.data=i.getProject(t.data)),e(null,t)},error:e})},editProject:function(t,e){Object(s.e)({url:"/api/iSignIn/projects/update",type:"post",data:{projectId:t.id,projectName:t.name,projectTypeId:t.categoryId},success:function(t){return e(null,t)},error:e})},editCategory:function(t,e){Object(s.e)({url:"/api/iSignIn/projects/projectTypes/"+t.id,type:"post",data:{typeName:t.name},success:function(t){return e(null,t)},error:e})},setProjectProxy:function(t,e,a){Object(s.e)({url:"/api/iSignIn/projects/projectAgents/"+t,type:"post",data:e,success:function(t){return a(null,t)},error:a})},editSign:function(t,e){var a="SCAN";t.signWay===t.signWays.location&&(a="LOCATION"),t.signWay===t.signWays.outside&&(a="OUTSIDE");var i={signInId:t.signId,projectId:t.projectId,checkInType:t.checkInType,frequency:t.selectType,hourStart:t.startTimeToHours,hourEnd:t.endTimeToHours,signInName:t.name,timeStart:t.startTime,timeEnd:t.endTime,weekDay:t.weekDay,useDynamicCode:t.useDynamicCode,signInType:a,isLocation:t.scanQrcodeWithLocation,signInRange:(t.signWay===t.signWays.qrcode?t.qrcodeLocations:t.locations).map(function(t){return{address:t.address,distance:t.radius,longitude:t.lng,latitude:t.lat}})};"single"===i.checkInType&&(i.frequency=null),Object(s.e)({url:"/api/signIns/update",type:"post",data:i,success:function(t){return e(null,t)},error:e})},getLimitConditions:function(t){Object(s.e)({url:"/api/iSignIn/projects/peopleLimit/conditions",success:function(e){return t(null,e)},error:t})},setLimitType:function(t,e,a,i){(a=a||{}).studentStatus=a.inSchoolStatus,"0"!==a.grade&&0!=a.grade||(a.grade=null),"0"!==a.educationLevel&&0!=a.educationLevel||(a.educationLevel=null),"0"!==a.currentSchoolStatus&&0!=a.currentSchoolStatus||(a.currentSchoolStatus=null),"0"!==a.inSchoolStatus&&0!=a.inSchoolStatus||(a.inSchoolStatus=null),"0"!==a.studentStatus&&0!=a.studentStatus||(a.studentStatus=null),Object(s.e)({url:"/api/iSignIn/projects/peopleLimit/"+t+"/"+e,type:"post",data:a,success:function(t){return i(null,t)},error:i})},addSign:function(t,e){var a="SCAN";t.signWay===t.signWays.location&&(a="LOCATION"),t.signWay===t.signWays.outside&&(a="OUTSIDE");var n={projectId:t.projectId,signInName:t.name,timeStart:t.startTime,timeEnd:t.endTime,useDynamicCode:t.useDynamicCode,signInType:a,isLocation:t.scanQrcodeWithLocation,signInRange:(t.signWay===t.signWays.qrcode?t.qrcodeLocations:t.locations).map(function(t){return{address:t.address,distance:t.radius,longitude:t.lng,latitude:t.lat}})};("single"==t.checkInType||"loop"==t.checkInType&&"day"==t.selectType)&&(n.hourStart=t.startTimeToHours+":00",n.hourEnd=t.endTimeToHours+":00"),"loop"==t.checkInType&&(n.weekDay=t.weekDay,n.frequency=t.selectType),Object(s.e)({url:"/api/signIns",type:"post",data:n,success:function(t){t.state&&(t.data=i.getSign(t.data)),e(null,t)},error:e})},addSignPeople:function(t,e,a,i){Object(s.e)({url:"/api/signIns/peoples",type:"post",data:{signInId:e,projectId:t,userId:a},success:function(t){return i(null,t)},error:i})},checkUserNo:function(t,e){Object(s.e)({url:"/api/users/"+t,type:"get",success:function(t){return e(null,t)},error:e})},deleteSign:function(t,e){Object(s.e)({url:"/api/signIns/"+t,type:"post",success:function(t){return e(null,t)},error:e})},signManual:function(t){Object(s.e)({url:"/api/signIns/signInStatus",type:"post",data:{signInId:t.signId,userId:t.userId,remark:t.remark,createDate:t.createDate},success:function(e){return t.callback(null,e)},error:t.callback})},removePersonFromSign:function(t,e,a,i){var n="";n=a?"/api/signIns/peoples/"+t+"/"+e+"?createDate="+a:"/api/signIns/peoples/"+t+"/"+e,Object(s.e)({url:n,type:"post",success:function(t){return i(null,t)},error:i})},getMyProxies:function(t,e){Object(s.e)({url:"/api/signIns/"+t+"/agents",type:"get",success:function(t){e(null,t)},error:e})},getBaseSearchOptions:function(t){Object(s.e)({url:"/api/colleges",type:"get",success:function(e){t(null,e)},error:t})},getProxySettings:function(t,e){Object(s.e)({url:"/api/iSignIn/projects/list/agents/"+t,type:"get",success:function(t){e(null,t)},error:e})},createSignUrl:function(t,e,a,i,n,o){Object(s.e)({url:"/api/signIns/"+t+"/signInUrl",type:"post",data:{distribution:e,collegeCode:a,classId:i,expireTime:n},success:function(t){o(null,t)},error:o})},getGeneralSignStat:function(t,e,a,i){Object(s.e)({url:"/api/signInStatistics/overviews/"+t+"?startTime="+e+"&endTime="+a,type:"get",success:function(t){return i(null,t)},error:i})},getSignStatByType:function(t,e,a,i,n){Object(s.e)({url:"/api/signInStatistics/statistics/"+t+"/"+e+"?startTime="+a+"&endTime="+i,type:"get",success:function(t){return n(null,t)},error:n})},exportSignsOfManage:function(t,e,a,s,i,n){window.location.href="/downloads/signIns/peoples/excel/MANAGE?signInId="+t+"&name="+(e||"")+"&userNo="+(a||"")+"&college="+(s||"")+"&signInStatus="+(i||"")+"&classId="+(n||"")},exportSignsOfProxy:function(t,e,a,s,i,n,o,r,l){window.location.href="/downloads/signIns/"+t+"/people/excel?signInId="+t+"&startTime="+(l?l[0]:"")+"&endTime="+(l?l[1]:"")+"&agentId="+e+"&name="+(a||"")+"&userNo="+(s||"")+"&collegeCode="+(i||"")+"&classId="+(n||"")+"&status="+(o||"")+"&filename="+r}};var i={getProject:function(t){return{classIds:t.classIds,colleges:t.colleges,classNames:t.classNames,collegeNames:t.collegeNames,checkInType:t.checkInType,id:t.projectId,name:t.projectName,categoryId:t.projectTypeId,categoryName:t.projectTypeName,limitListOfPeople:t.limitListOfPeople,peopleCount:t.projectPeopleCount,educationLevel:t.educationLevel,educationLevelLabel:t.educationLevelName,grade:t.grade,level:t.level,inSchoolStatus:t.studentStatus,currentSchoolStatus:t.currentSchoolStatus,peopleLoading:!0,signs:{init:!1,loading:!1,list:[]}}},getSign:function(t){var e="qrcode";"LOCATION"===t.signInType&&(e="location"),"OUTSIDE"===t.signInType&&(e="outside");var a={id:t.signInId,name:t.signInName,projectId:t.projectId,startTime:t.timeStart,endTime:t.timeEnd,useDynamicCode:t.useDynamicCode,signInStatus:t.signInStatus,signWay:e,scanQrcodeWithLocation:t.isLocation,qrcodeLocations:[],locations:[],frequency:t.frequency,checkInType:t.checkInType,weekDay:t.weekDay,hourEnd:t.hourEnd,hourStart:t.hourStart},s=t.signInRange.map(function(t){return{address:t.address,radius:t.distance,lng:t.longitude,lat:t.latitude,init:!0,showMap:!1}});return"SCAN"===t.signInType?a.qrcodeLocations=s:a.locations=s,a},changeTabToInterface:function(t){return{ALL:"ALL",MANAGE:"MANAGE",PROXY:"AGENT",MINE:"MY"}[t]}}},J7ad:function(t,e){},LqYc:function(t,e,a){var s,i;i=function(){function t(t){this.mode=a.MODE_8BIT_BYTE,this.data=t,this.parsedData=[];for(var e=0,s=this.data.length;e<s;e++){var i=[],n=this.data.charCodeAt(e);n>65536?(i[0]=240|(1835008&n)>>>18,i[1]=128|(258048&n)>>>12,i[2]=128|(4032&n)>>>6,i[3]=128|63&n):n>2048?(i[0]=224|(61440&n)>>>12,i[1]=128|(4032&n)>>>6,i[2]=128|63&n):n>128?(i[0]=192|(1984&n)>>>6,i[1]=128|63&n):i[0]=n,this.parsedData.push(i)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function e(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}t.prototype={getLength:function(t){return this.parsedData.length},write:function(t){for(var e=0,a=this.parsedData.length;e<a;e++)t.put(this.parsedData[e],8)}},e.prototype={addData:function(e){var a=new t(e);this.dataList.push(a),this.dataCache=null},isDark:function(t,e){if(t<0||this.moduleCount<=t||e<0||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(t,a){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var s=0;s<this.moduleCount;s++){this.modules[s]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[s][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,a),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,a)},setupPositionProbePattern:function(t,e){for(var a=-1;a<=7;a++)if(!(t+a<=-1||this.moduleCount<=t+a))for(var s=-1;s<=7;s++)e+s<=-1||this.moduleCount<=e+s||(this.modules[t+a][e+s]=0<=a&&a<=6&&(0==s||6==s)||0<=s&&s<=6&&(0==a||6==a)||2<=a&&a<=4&&2<=s&&s<=4)},getBestMaskPattern:function(){for(var t=0,e=0,a=0;a<8;a++){this.makeImpl(!0,a);var s=g.getLostPoint(this);(0==a||t>s)&&(t=s,e=a)}return e},createMovieClip:function(t,e,a){var s=t.createEmptyMovieClip(e,a);this.make();for(var i=0;i<this.modules.length;i++)for(var n=1*i,o=0;o<this.modules[i].length;o++){var r=1*o;this.modules[i][o]&&(s.beginFill(0,100),s.moveTo(r,n),s.lineTo(r+1,n),s.lineTo(r+1,n+1),s.lineTo(r,n+1),s.endFill())}return s},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},setupPositionAdjustPattern:function(){for(var t=g.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var a=0;a<t.length;a++){var s=t[e],i=t[a];if(null==this.modules[s][i])for(var n=-2;n<=2;n++)for(var o=-2;o<=2;o++)this.modules[s+n][i+o]=-2==n||2==n||-2==o||2==o||0==n&&0==o}},setupTypeNumber:function(t){for(var e=g.getBCHTypeNumber(this.typeNumber),a=0;a<18;a++){var s=!t&&1==(e>>a&1);this.modules[Math.floor(a/3)][a%3+this.moduleCount-8-3]=s}for(a=0;a<18;a++){s=!t&&1==(e>>a&1);this.modules[a%3+this.moduleCount-8-3][Math.floor(a/3)]=s}},setupTypeInfo:function(t,e){for(var a=this.errorCorrectLevel<<3|e,s=g.getBCHTypeInfo(a),i=0;i<15;i++){var n=!t&&1==(s>>i&1);i<6?this.modules[i][8]=n:i<8?this.modules[i+1][8]=n:this.modules[this.moduleCount-15+i][8]=n}for(i=0;i<15;i++){n=!t&&1==(s>>i&1);i<8?this.modules[8][this.moduleCount-i-1]=n:i<9?this.modules[8][15-i-1+1]=n:this.modules[8][15-i-1]=n}this.modules[this.moduleCount-8][8]=!t},mapData:function(t,e){for(var a=-1,s=this.moduleCount-1,i=7,n=0,o=this.moduleCount-1;o>0;o-=2)for(6==o&&o--;;){for(var r=0;r<2;r++)if(null==this.modules[s][o-r]){var l=!1;n<t.length&&(l=1==(t[n]>>>i&1)),g.getMask(e,s,o-r)&&(l=!l),this.modules[s][o-r]=l,-1==--i&&(n++,i=7)}if((s+=a)<0||this.moduleCount<=s){s-=a,a=-a;break}}}},e.PAD0=236,e.PAD1=17,e.createData=function(t,a,s){for(var i=v.getRSBlocks(t,a),n=new y,o=0;o<s.length;o++){var r=s[o];n.put(r.mode,4),n.put(r.getLength(),g.getLengthInBits(r.mode,t)),r.write(n)}var l=0;for(o=0;o<i.length;o++)l+=i[o].dataCount;if(n.getLengthInBits()>8*l)throw new Error("code length overflow. ("+n.getLengthInBits()+">"+8*l+")");for(n.getLengthInBits()+4<=8*l&&n.put(0,4);n.getLengthInBits()%8!=0;)n.putBit(!1);for(;!(n.getLengthInBits()>=8*l||(n.put(e.PAD0,8),n.getLengthInBits()>=8*l));)n.put(e.PAD1,8);return e.createBytes(n,i)},e.createBytes=function(t,e){for(var a=0,s=0,i=0,n=new Array(e.length),o=new Array(e.length),r=0;r<e.length;r++){var l=e[r].dataCount,d=e[r].totalCount-l;s=Math.max(s,l),i=Math.max(i,d),n[r]=new Array(l);for(var c=0;c<n[r].length;c++)n[r][c]=255&t.buffer[c+a];a+=l;var u=g.getErrorCorrectPolynomial(d),h=new f(n[r],u.getLength()-1).mod(u);o[r]=new Array(u.getLength()-1);for(c=0;c<o[r].length;c++){var p=c+h.getLength()-o[r].length;o[r][c]=p>=0?h.get(p):0}}var m=0;for(c=0;c<e.length;c++)m+=e[c].totalCount;var v=new Array(m),y=0;for(c=0;c<s;c++)for(r=0;r<e.length;r++)c<n[r].length&&(v[y++]=n[r][c]);for(c=0;c<i;c++)for(r=0;r<e.length;r++)c<o[r].length&&(v[y++]=o[r][c]);return v};for(var a={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},i={L:1,M:0,Q:3,H:2},n=0,o=1,r=2,l=3,d=4,c=5,u=6,h=7,g={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(t){for(var e=t<<10;g.getBCHDigit(e)-g.getBCHDigit(g.G15)>=0;)e^=g.G15<<g.getBCHDigit(e)-g.getBCHDigit(g.G15);return(t<<10|e)^g.G15_MASK},getBCHTypeNumber:function(t){for(var e=t<<12;g.getBCHDigit(e)-g.getBCHDigit(g.G18)>=0;)e^=g.G18<<g.getBCHDigit(e)-g.getBCHDigit(g.G18);return t<<12|e},getBCHDigit:function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},getPatternPosition:function(t){return g.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,a){switch(t){case n:return(e+a)%2==0;case o:return e%2==0;case r:return a%3==0;case l:return(e+a)%3==0;case d:return(Math.floor(e/2)+Math.floor(a/3))%2==0;case c:return e*a%2+e*a%3==0;case u:return(e*a%2+e*a%3)%2==0;case h:return(e*a%3+(e+a)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){for(var e=new f([1],0),a=0;a<t;a++)e=e.multiply(new f([1,p.gexp(a)],0));return e},getLengthInBits:function(t,e){if(1<=e&&e<10)switch(t){case a.MODE_NUMBER:return 10;case a.MODE_ALPHA_NUM:return 9;case a.MODE_8BIT_BYTE:case a.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(e<27)switch(t){case a.MODE_NUMBER:return 12;case a.MODE_ALPHA_NUM:return 11;case a.MODE_8BIT_BYTE:return 16;case a.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(e<41))throw new Error("type:"+e);switch(t){case a.MODE_NUMBER:return 14;case a.MODE_ALPHA_NUM:return 13;case a.MODE_8BIT_BYTE:return 16;case a.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},getLostPoint:function(t){for(var e=t.getModuleCount(),a=0,s=0;s<e;s++)for(var i=0;i<e;i++){for(var n=0,o=t.isDark(s,i),r=-1;r<=1;r++)if(!(s+r<0||e<=s+r))for(var l=-1;l<=1;l++)i+l<0||e<=i+l||0==r&&0==l||o==t.isDark(s+r,i+l)&&n++;n>5&&(a+=3+n-5)}for(s=0;s<e-1;s++)for(i=0;i<e-1;i++){var d=0;t.isDark(s,i)&&d++,t.isDark(s+1,i)&&d++,t.isDark(s,i+1)&&d++,t.isDark(s+1,i+1)&&d++,0!=d&&4!=d||(a+=3)}for(s=0;s<e;s++)for(i=0;i<e-6;i++)t.isDark(s,i)&&!t.isDark(s,i+1)&&t.isDark(s,i+2)&&t.isDark(s,i+3)&&t.isDark(s,i+4)&&!t.isDark(s,i+5)&&t.isDark(s,i+6)&&(a+=40);for(i=0;i<e;i++)for(s=0;s<e-6;s++)t.isDark(s,i)&&!t.isDark(s+1,i)&&t.isDark(s+2,i)&&t.isDark(s+3,i)&&t.isDark(s+4,i)&&!t.isDark(s+5,i)&&t.isDark(s+6,i)&&(a+=40);var c=0;for(i=0;i<e;i++)for(s=0;s<e;s++)t.isDark(s,i)&&c++;return a+=10*(Math.abs(100*c/e/e-50)/5)}},p={glog:function(t){if(t<1)throw new Error("glog("+t+")");return p.LOG_TABLE[t]},gexp:function(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return p.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},m=0;m<8;m++)p.EXP_TABLE[m]=1<<m;for(m=8;m<256;m++)p.EXP_TABLE[m]=p.EXP_TABLE[m-4]^p.EXP_TABLE[m-5]^p.EXP_TABLE[m-6]^p.EXP_TABLE[m-8];for(m=0;m<255;m++)p.LOG_TABLE[p.EXP_TABLE[m]]=m;function f(t,e){if(void 0==t.length)throw new Error(t.length+"/"+e);for(var a=0;a<t.length&&0==t[a];)a++;this.num=new Array(t.length-a+e);for(var s=0;s<t.length-a;s++)this.num[s]=t[s+a]}function v(t,e){this.totalCount=t,this.dataCount=e}function y(){this.buffer=[],this.length=0}f.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var e=new Array(this.getLength()+t.getLength()-1),a=0;a<this.getLength();a++)for(var s=0;s<t.getLength();s++)e[a+s]^=p.gexp(p.glog(this.get(a))+p.glog(t.get(s)));return new f(e,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var e=p.glog(this.get(0))-p.glog(t.get(0)),a=new Array(this.getLength()),s=0;s<this.getLength();s++)a[s]=this.get(s);for(s=0;s<t.getLength();s++)a[s]^=p.gexp(p.glog(t.get(s))+e);return new f(a,0).mod(t)}},v.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],v.getRSBlocks=function(t,e){var a=v.getRsBlockTable(t,e);if(void 0==a)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e);for(var s=a.length/3,i=[],n=0;n<s;n++)for(var o=a[3*n+0],r=a[3*n+1],l=a[3*n+2],d=0;d<o;d++)i.push(new v(r,l));return i},v.getRsBlockTable=function(t,e){switch(e){case i.L:return v.RS_BLOCK_TABLE[4*(t-1)+0];case i.M:return v.RS_BLOCK_TABLE[4*(t-1)+1];case i.Q:return v.RS_BLOCK_TABLE[4*(t-1)+2];case i.H:return v.RS_BLOCK_TABLE[4*(t-1)+3];default:return}},y.prototype={get:function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},put:function(t,e){for(var a=0;a<e;a++)this.putBit(1==(t>>>e-a-1&1))},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var b=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]];function I(){var t=!1,e=navigator.userAgent;if(/android/i.test(e)){t=!0;var a=e.toString().match(/android ([0-9]\.[0-9])/i);a&&a[1]&&(t=parseFloat(a[1]))}return t}var w=function(){var t=function(t,e){this._el=t,this._htOption=e};return t.prototype.draw=function(t){var e=this._htOption,a=this._el,s=t.getModuleCount();Math.floor(e.width/s),Math.floor(e.height/s);function i(t,e){var a=document.createElementNS("http://www.w3.org/2000/svg",t);for(var s in e)e.hasOwnProperty(s)&&a.setAttribute(s,e[s]);return a}this.clear();var n=i("svg",{viewBox:"0 0 "+String(s)+" "+String(s),width:"100%",height:"100%",fill:e.colorLight});n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),a.appendChild(n),n.appendChild(i("rect",{fill:e.colorLight,width:"100%",height:"100%"})),n.appendChild(i("rect",{fill:e.colorDark,width:"1",height:"1",id:"template"}));for(var o=0;o<s;o++)for(var r=0;r<s;r++)if(t.isDark(o,r)){var l=i("use",{x:String(r),y:String(o)});l.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),n.appendChild(l)}},t.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},t}(),_="svg"===document.documentElement.tagName.toLowerCase()?w:"undefined"==typeof CanvasRenderingContext2D?function(){var t=function(t,e){this._el=t,this._htOption=e};return t.prototype.draw=function(t){for(var e=this._htOption,a=this._el,s=t.getModuleCount(),i=Math.floor(e.width/s),n=Math.floor(e.height/s),o=['<table style="border:0;border-collapse:collapse;">'],r=0;r<s;r++){o.push("<tr>");for(var l=0;l<s;l++)o.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+i+"px;height:"+n+"px;background-color:"+(t.isDark(r,l)?e.colorDark:e.colorLight)+';"></td>');o.push("</tr>")}o.push("</table>"),a.innerHTML=o.join("");var d=a.childNodes[0],c=(e.width-d.offsetWidth)/2,u=(e.height-d.offsetHeight)/2;c>0&&u>0&&(d.style.margin=u+"px "+c+"px")},t.prototype.clear=function(){this._el.innerHTML=""},t}():function(){function t(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}if(this._android&&this._android<=2.1){var e=1/window.devicePixelRatio,a=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(t,s,i,n,o,r,l,d,c){if("nodeName"in t&&/img/i.test(t.nodeName))for(var u=arguments.length-1;u>=1;u--)arguments[u]=arguments[u]*e;else void 0===d&&(arguments[1]*=e,arguments[2]*=e,arguments[3]*=e,arguments[4]*=e);a.apply(this,arguments)}}var s=function(t,e){this._bIsPainted=!1,this._android=I(),this._htOption=e,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=e.width,this._elCanvas.height=e.height,t.appendChild(this._elCanvas),this._el=t,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.alt="Scan me!",this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return s.prototype.draw=function(t){var e=this._elImage,a=this._oContext,s=this._htOption,i=t.getModuleCount(),n=s.width/i,o=s.height/i,r=Math.round(n),l=Math.round(o);e.style.display="none",this.clear();for(var d=0;d<i;d++)for(var c=0;c<i;c++){var u=t.isDark(d,c),h=c*n,g=d*o;a.strokeStyle=u?s.colorDark:s.colorLight,a.lineWidth=1,a.fillStyle=u?s.colorDark:s.colorLight,a.fillRect(h,g,n,o),a.strokeRect(Math.floor(h)+.5,Math.floor(g)+.5,r,l),a.strokeRect(Math.ceil(h)-.5,Math.ceil(g)-.5,r,l)}this._bIsPainted=!0},s.prototype.makeImage=function(){this._bIsPainted&&function(t,e){var a=this;if(a._fFail=e,a._fSuccess=t,null===a._bSupportDataURI){var s=document.createElement("img"),i=function(){a._bSupportDataURI=!1,a._fFail&&a._fFail.call(a)};return s.onabort=i,s.onerror=i,s.onload=function(){a._bSupportDataURI=!0,a._fSuccess&&a._fSuccess.call(a)},void(s.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}!0===a._bSupportDataURI&&a._fSuccess?a._fSuccess.call(a):!1===a._bSupportDataURI&&a._fFail&&a._fFail.call(a)}.call(this,t)},s.prototype.isPainted=function(){return this._bIsPainted},s.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},s.prototype.round=function(t){return t?Math.floor(1e3*t)/1e3:t},s}();function S(t,e){for(var a=1,s=function(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)}(t),n=0,o=b.length;n<=o;n++){var r=0;switch(e){case i.L:r=b[n][0];break;case i.M:r=b[n][1];break;case i.Q:r=b[n][2];break;case i.H:r=b[n][3]}if(s<=r)break;a++}if(a>b.length)throw new Error("Too long data");return a}return(s=function(t,e){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:i.H},"string"==typeof e&&(e={text:e}),e)for(var a in e)this._htOption[a]=e[a];"string"==typeof t&&(t=document.getElementById(t)),this._htOption.useSVG&&(_=w),this._android=I(),this._el=t,this._oQRCode=null,this._oDrawing=new _(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)}).prototype.makeCode=function(t){this._oQRCode=new e(S(t,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(t),this._oQRCode.make(),this._el.title=t,this._oDrawing.draw(this._oQRCode),this.makeImage()},s.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},s.prototype.clear=function(){this._oDrawing.clear()},s.CorrectLevel=i,s},t.exports=i()},P05U:function(t,e){},PuR5:function(t,e){},gvMr:function(t,e,a){"use strict";var s='<svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50;" xml:space="preserve">\n                  <path fill="rgba(0, 0, 0, 0.54)" d="M43.935,25.145c0-10.318-8.364-18.683-18.683-18.683c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615c8.072,0,14.615,6.543,14.615,14.615H43.935z" transform="rotate(30.0001 25 25)">\n                    <animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform>\n                  </path>\n                </svg>';e.a={icon:s,small:'<svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="18px" height="18px" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50;" xml:space="preserve">\n                <path fill="rgba(0, 0, 0, 0.54)" d="M43.935,25.145c0-10.318-8.364-18.683-18.683-18.683c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615c8.072,0,14.615,6.543,14.615,14.615H43.935z" transform="rotate(30.0001 25 25)">\n                  <animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform>\n                </path>\n              </svg>',iconWithText:s+"加载中"}},hBSA:function(t,e,a){(function(t){function a(t,e){for(var a=0,s=t.length-1;s>=0;s--){var i=t[s];"."===i?t.splice(s,1):".."===i?(t.splice(s,1),a++):a&&(t.splice(s,1),a--)}if(e)for(;a--;a)t.unshift("..");return t}function s(t,e){if(t.filter)return t.filter(e);for(var a=[],s=0;s<t.length;s++)e(t[s],s,t)&&a.push(t[s]);return a}e.resolve=function(){for(var e="",i=!1,n=arguments.length-1;n>=-1&&!i;n--){var o=n>=0?arguments[n]:t.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(e=o+"/"+e,i="/"===o.charAt(0))}return e=a(s(e.split("/"),function(t){return!!t}),!i).join("/"),(i?"/":"")+e||"."},e.normalize=function(t){var n=e.isAbsolute(t),o="/"===i(t,-1);return(t=a(s(t.split("/"),function(t){return!!t}),!n).join("/"))||n||(t="."),t&&o&&(t+="/"),(n?"/":"")+t},e.isAbsolute=function(t){return"/"===t.charAt(0)},e.join=function(){var t=Array.prototype.slice.call(arguments,0);return e.normalize(s(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},e.relative=function(t,a){function s(t){for(var e=0;e<t.length&&""===t[e];e++);for(var a=t.length-1;a>=0&&""===t[a];a--);return e>a?[]:t.slice(e,a-e+1)}t=e.resolve(t).substr(1),a=e.resolve(a).substr(1);for(var i=s(t.split("/")),n=s(a.split("/")),o=Math.min(i.length,n.length),r=o,l=0;l<o;l++)if(i[l]!==n[l]){r=l;break}var d=[];for(l=r;l<i.length;l++)d.push("..");return(d=d.concat(n.slice(r))).join("/")},e.sep="/",e.delimiter=":",e.dirname=function(t){if("string"!=typeof t&&(t+=""),0===t.length)return".";for(var e=t.charCodeAt(0),a=47===e,s=-1,i=!0,n=t.length-1;n>=1;--n)if(47===(e=t.charCodeAt(n))){if(!i){s=n;break}}else i=!1;return-1===s?a?"/":".":a&&1===s?"/":t.slice(0,s)},e.basename=function(t,e){var a=function(t){"string"!=typeof t&&(t+="");var e,a=0,s=-1,i=!0;for(e=t.length-1;e>=0;--e)if(47===t.charCodeAt(e)){if(!i){a=e+1;break}}else-1===s&&(i=!1,s=e+1);return-1===s?"":t.slice(a,s)}(t);return e&&a.substr(-1*e.length)===e&&(a=a.substr(0,a.length-e.length)),a},e.extname=function(t){"string"!=typeof t&&(t+="");for(var e=-1,a=0,s=-1,i=!0,n=0,o=t.length-1;o>=0;--o){var r=t.charCodeAt(o);if(47!==r)-1===s&&(i=!1,s=o+1),46===r?-1===e?e=o:1!==n&&(n=1):-1!==e&&(n=-1);else if(!i){a=o+1;break}}return-1===e||-1===s||0===n||1===n&&e===s-1&&e===a+1?"":t.slice(e,s)};var i="b"==="ab".substr(-1)?function(t,e,a){return t.substr(e,a)}:function(t,e,a){return e<0&&(e=t.length+e),t.substr(e,a)}}).call(e,a("V0EG"))},hazC:function(t,e){},qvNH:function(t,e){},tgYt:function(t,e){},yFgL:function(t,e,a){"use strict";var s=a("a3Yh"),i=a.n(s),n=a("3cXf"),o=a.n(n),r=a("HzJ8"),l=a.n(r),d=(a("kV13"),a("HJbL")),c=a("zKJS"),u=a("C331"),h=a("B6Gn"),g=a("WCPx"),p=a.n(g),m=a("LqYc"),f=a.n(m),v=a("gvMr"),y=(a("hBSA"),a("Y/Kc"),{NOT_SIGN:"未签到",SIGN:"已签到",MANUAL_ENTRY:"手工签到",TIME_OUT_NOT_SIGN:"超时未签到"}),b={SIGN_IN:" 已签到",NOT_SIGN_IN:" 未签到",MANUAL_SIGN_IN:"手动签到",SIGN_OUT:" 已签退",NOT_SIGN_OUT:" 未签退",MANUAL_SIGN_OUT:"手动签退",ASK_FOR_LEAVE:"请假"},I="SCHOOL",w="COLLEGE",_="CLASS",S="RELATIONSHIP",T=(i()({components:{VIcon:d.a,SignInfoModal:c.a},props:{project:Object,sign:Object,userType:String},data:function(){return{signWayText:{location:"定位签到",qrcode:"扫码签到",outside:"外勤打卡"},searchVal:"",statType:"",statDate:[],eduList:[],gradeYear:[],formFields:[],unitList:[],tableUrl:"",dateArea:"",outputModalShow:!1,outputList:[],downLoadDate:"",classArr:[],loader:v.a,lang:"zh-cn",datePickerStartTime:"",datePickerEndTime:"",showAdviceModal:!1,adviceParams:{sendTimeType:"IMMEDIATELY",sendTime:"",content:"",messageToTarget:"ALL_STUDENT"},sendTimeTypeList:[{label:"立即发送",value:"IMMEDIATELY"},{label:"定时发送",value:"TIMING"}],tableParams:{pagesize:10,idField:"id",columns:[],multi:!1,order:!0,search:!1,ts:+new Date},showAddModal:!1,signTabVal:"signIn",searchOptions:{colleges:[],status:[{id:"NOT_SIGN",text:"未签到"},{id:"SIGN",text:"已签到"},{id:"MANUAL_ENTRY",text:"手工签到"}],newSignInStatus:[{id:"SIGN_IN",text:"已签到"},{id:"NOT_SIGN_IN",text:"未签到"},{id:"MANUAL_SIGN_IN",text:"手动签到"},{id:"ASK_FOR_LEAVE",text:"请假"}],newSignOutStatus:[{id:"SIGN_OUT",text:"已签退"},{id:"NOT_SIGN_OUT",text:"未签退"},{id:"MANUAL_SIGN_OUT",text:"手动签退"},{id:"ASK_FOR_LEAVE",text:"请假"}],managedColleges:[]},addPersonModal:{show:!1,userNo:null,userName:null,userId:null,tip:null},signManualModal:{show:!1,remark:null,signId:null,userId:null,userNo:null},editSignModal:{hourStart:"",hourEnd:"",weekDay:"",weekDayList:[],show:!1,name:null,startTime:"",isSignOut:!1,startTimeToHours:"",endTimeToHours:"",endTime:"",signWays:{qrcode:"qrcode",location:"location",outside:"outside"},signWay:"qrcode",useDynamicCode:!1,scanQrcodeWithLocation:!1,locations:[],qrcodeLocations:[],activeLocationIndex:0,project:null,projectId:null,maxLength:20,dateFormat:"yyyy-MM-dd hh:ii:ss"},qrcode:{fullscreen:!1,oldInstance:null,url:"",instance:null,timer:null},statModal:{show:!1,syncTime:"",totalWidth:550,minWidth:10,loading:!1,noStat:!1,generalChart:{init:!1,instance:null,options:{tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},color:["rgba(92, 107, 192, 1)","rgba(92, 107, 192, .75)","rgba(92, 107, 192, .5)"],series:[{name:"统计",type:"pie",radius:"60%",center:["49%","41%"],data:[],label:{normal:{show:!0}},labelLine:{normal:{show:!0}},itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},legend:{done:{color:"rgba(92, 107, 192, 1)",text:"已签到",num:0},todo:{color:"rgba(92, 107, 192, 0.5)",text:"未签到",num:0}}},currentControl:"general",control:{general:{text:"总览",show:!0,checked:!0,loading:!1},college:{text:"各学院对比",show:!0,checked:!1,type:"COLLEGE",data:[],loading:!1},instructor:{text:"各辅导员对比",show:!0,checked:!1,type:"INSTRUCTOR",data:[],loading:!1},clazz:{text:"各班级对比",show:!0,checked:!1,type:"CLAZZ",data:[],loading:!1}}},proxy:{proxies:[],id:null,distributary:I,proxyId:null,name:"",classId:"",collegeCode:""},exporting:!1,showImgDetailStatus:!1,showAddressModal:!1,addressRecord:{},deleteImgWidth:1,imgDetailSrc:""}},beforeDestroy:function(){this.setInterFun&&(clearInterval(this.setInterFun),this.setInterFun=null,this.oldHasSignList=null)},created:function(){var t=this;if(this.setUrl(),this.getUnitList(),this.setGrade(),this.getEdu(),"loop"==this.sign.checkInType&&"week"==this.sign.frequency){this.editSignModal.weekDay=this.sign.weekDay,this.editSignModal.weekDayList=[];for(var e=this.sign.weekDay.split("&"),a=0;a<e.length;a++){var s=e[a].split(",");this.editSignModal.weekDayList.push({date:this.dateToCn(a),startTime:s[1],endTime:s[2]})}}var i=window.localStorage.getItem("lang");i&&Object(u.g)(i)&&(this.lang=i),this.datePickerStartTime=this.sign.startTime,this.datePickerEndTime=this.sign.endTime,Object(u.e)({url:"/api/relClass/classes/list",dataType:"json",type:"get",async:!1,success:function(e){e.state&&(t.classArr=e.data)}}),this.isProxy&&this.initProxies(),this.initEditSignModal(),this.sign.needOut?this.initTable():this.initManagedColleges(function(){t.initTable()}),this.stopQrcodeTimer()},mounted:function(){this.isProxy||"qrcode"===this.editSignModal.signWay&&this.initQrcode()},computed:{messageToTargetList:function(){return this.editSignModal.isSignOut?[{label:"所有人",value:"ALL_STUDENT"},{label:"未签到",value:"NOT_SIGN"},{label:"请假",value:"ASK_FOR_LEAVE"}]:[{label:"所有人",value:"ALL_STUDENT"},{label:"未签到",value:"NOT_SIGN"}]},tabList:function(){return this.editSignModal.isSignOut?[{id:"signIn",name:"签到"},{id:"signOut",name:"签退"}]:[{id:"signIn",name:"签到"}]},i18n:function(){return Object(u.g)(this.lang).iSign},isManager:function(){return"MANAGE"===this.userType},isALL:function(){return"ALL"===this.userType},isProxy:function(){return"PROXY"===this.userType},qrCodeExpireTime:function(){return this.sign.useDynamicCode?15:0}},watch:{signTabVal:function(){this.initTable(),this.refreshQrcode()},"tableParams.ts":function(){this.setUrl()}},methods:{goToSendMessage:function(){sessionStorage.setItem("signIdSend",this.sign.id),sessionStorage.setItem("fromOutSedMessage",!0),this.$addBread({route:"/messageBox/messageManage",title:"消息盒子"})},showImgDetail:function(t){this.showImgDetailStatus=!0,this.imgDetailSrc="/downloads/storage/images/"+t,window.onmousewheel=document.onmousewheel=this.scrollImg},showAddressDetail:function(t){this.showAddressModal=!0,this.addressRecord={lat:t.latitude,lng:t.longitude}},scrollImg:function(t){this.showImgDetailStatus&&(t.deltaY>0?this.deleteImgWidth<2&&(this.deleteImgWidth+=.1):this.deleteImgWidth>.2&&(this.deleteImgWidth-=.1))},statDateChange:function(t){t&&("general"!=this.statModal.currentControl?this.changeStatType(this.statModal.currentControl):this.showStat())},getUnitList:function(){var t=this;Object(u.e)({type:"get",url:"/api/colleges/units",success:function(e){e.state?t.unitList=e.data:t.unitList=[]}})},_sureToOutput:function(){if(!this.outputList.length)return this.$toast("请选择导出的字段");var t="/downloads/signIns/peoples/excel/"+this.userType+"?signInId="+this.sign.id+"&fields="+this.outputList.join(","),e=this.$refs["sign-table"].tableSearchFields||{};for(var a in this.dateArea.length&&(t+="&startTime="+this.dateArea[0]+"&endTime="+this.dateArea[1]+"&"),e)t+=a+"="+e[a]+"&";window.location.href=t},setUrl:function(){this.sign.needOut?(this.sign.isAgent&&(this.tableUrl="/table-data/ca/signIn/agent/person/page/"+this.signTabVal+"/"+this.sign.id+"?ts="+this.tableParams.ts),this.tableUrl="/table-data/ca/signIn/person/page/"+this.signTabVal+"/"+this.sign.id+"?ts="+this.tableParams.ts):this.isManager||this.isALL?this.tableUrl="/table-data/signIns/peoples/MANAGE?signInId="+this.sign.id+"&ts="+this.tableParams.ts:this.isProxy&&(this.proxy.proxyId?this.tableUrl="/table-data/signIns/"+this.sign.id+"/people/pages?ts="+this.tableParams.ts+"&agentId="+this.proxy.proxyId+"&classId="+(this.proxy.classId||"")+"&collegeCode="+(this.proxy.collegeCode||""):this.tableUrl="")},dateChange:function(t){var e=this;this.isALL=!0,this.isManager=!1,this.$nextTick(function(){e.isProxy?e.proxy.proxyId?e.tableUrl="/table-data/signIns/"+e.sign.id+"/people/pages?ts="+e.tableParams.ts+"&startTime="+t[0]+"&endTime="+t[1]+"&agentId="+e.proxy.proxyId+"&classId="+(e.proxy.classId||"")+"&collegeCode="+(e.proxy.collegeCode||""):e.tableUrl="":e.tableUrl="/table-data/signIns/peoples/MANAGE?signInId="+e.sign.id+"&startTime="+t[0]+"&endTime="+t[1]+"&ts="+(new Date).getTime()})},editMethod:function(t){var e=this;setTimeout(function(){if("day"==t.selectType)e.$set(e.editSignModal,"hourStart",e.editSignModal.startTimeToHours),e.$set(e.editSignModal,"hourEnd",e.editSignModal.endTimeToHours);else{var a=e.editSignModal.weekDay,s=[];e.editSignModal.weekDayList=[];for(var i=a.split("&"),n=0;n<i.length;n++){var o=i[n].split(",");s.push({date:e.dateToCn(n),startTime:o[1],endTime:o[2]})}e.$set(e.editSignModal,"weekDayList",s)}},300)},dateToCn:function(t){switch(t){case 0:return"星期一";case 1:return"星期二";case 2:return"星期三";case 3:return"星期四";case 4:return"星期五";case 5:return"星期六";case 6:return"星期日"}},setGrade:function(){for(var t=(new Date).getFullYear(),e=[],a=[],s=0;s<6;s++)e.push({label:t-s+"",value:t-s});for(var i=1;i<11;i++)a.push({label:t+i+"",value:t+i});this.gradeYear=e.reverse().concat(a)},getEdu:function(){var t=this;Object(u.e)({url:"/api/system/dicts?dictType=培养层次",type:"get",success:function(e){e.state?t.eduList=e.data:t.eduList=[]}})},_changeOutputList:function(t){var e=this.outputList.indexOf(t.fieldName);if(e>=0){this.outputList.splice(e,1);var a=this.outputList.indexOf("allChoice");a>=0&&this.outputList.splice(a,1)}else this.outputList.push(t.fieldName)},sendMessage:function(){var t=this,e="api/ca/signIn/person/message/"+this.signTabVal+"/"+this.sign.id;this.sign.isAgent&&(e="api/ca/signIn/agent/person/message/"+this.signTabVal+"/"+this.sign.id),this.adviceParams.sendTimeType?"TIMING"!==this.adviceParams.sendTimeType||this.adviceParams.sendTime?this.adviceParams.content?this.adviceParams.messageToTarget?Object(u.d)(e,this.adviceParams).then(function(e){e.state&&(t.showAdviceModal=!1,t.$toast("操作成功!"))}):this.$toast("请选择发送对象!"):this.$toast("请输入发送内容!"):this.$toast("发送时间不能为空!"):this.$toast("请选择发送!")},sendTimeSelected:function(t){t.value&&new Date(t.value)<new Date&&(this.$toast("发送时间已过期!"),this.adviceParams.sendTime="")},addPersonByOne:function(){this.addPersonModal.show=!0,this.showAddModal=!1},batchAddPerson:function(){var t=this;this.$parent.importParams={parentPageTitle:"",downloadTemplateUrl:"/ca/signIn/batch/template",downloadErrorTemplateUrl:"/ca/courses/batch/error",checkTemplateUrl:"/ca/signIn/batch/excel/"+this.sign.id,templateName:"批量导入模板",importBtnType:[{url:"/ca/signIn/batch/update",method:"post",isShowBtn:!0,name:"增量导入",success:function(e){t.$parent.timestamp="?timestamp="+(new Date).getTime(),t.$parent.curRoute="signInfo"}}]},this.sign.isAgent&&(this.$parent.importParams.checkTemplateUrl="/ca/signIn/agent/batch/excel/"+this.sign.id),this.$parent.quickAddRecord()},back:function(){this.$emit("back")},initEditSignModal:function(){this.editSignModal.signId=this.sign.id,this.editSignModal.projectId=this.sign.projectId,this.editSignModal.hourStart=this.sign.hourStart,this.editSignModal.hourEnd=this.sign.hourEnd,this.editSignModal.name=this.sign.name,this.editSignModal.startTime=this.sign.startTime,this.editSignModal.endTime=this.sign.endTime,this.editSignModal.useDynamicCode=this.sign.useDynamicCode,this.editSignModal.signWay=this.sign.signWay,this.editSignModal.scanQrcodeWithLocation=this.sign.scanQrcodeWithLocation,this.editSignModal.qrcodeLocations=this.sign.qrcodeLocations,this.editSignModal.locations=this.sign.locations.map(function(t){return t.init=!0,t}),this.editSignModal.signOutTimeEnd=this.sign.signOutTimeEnd,this.editSignModal.signOutTimeStart=this.sign.signOutTimeStart,this.editSignModal.isSignOut=this.sign.isSignOut,this.editSignModal.needOut=this.sign.needOut},initTable:function(){var t=this;if(this.sign.needOut){var e=this;this.tableParams.columns=[{id:"userNo",title:this.i18n.signInfo.userNo,className:"text-left",width:"120px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"name",title:this.i18n.signInfo.userName,className:"text-left",width:"55px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"college",title:this.i18n.signInfo.college,className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code",placeholder:""}},formatter:function(t){return t.college}},{id:"classId",title:"行政班级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.classArr,optionsLabel:"text",optionsValue:"id",placeholder:""}},formatter:function(t){return t.className}},{id:"signInStatus",title:"签到状态",className:"text-left",width:"80px",hidden:"signIn"!==e.signTabVal,formatter:function(t){return b[t.signInStatus]},search:{type:"select",data:{options:this.searchOptions.newSignInStatus,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signInTime",title:this.i18n.signInfo.signTime,className:"text-left",width:"150px",hidden:"signIn"!==e.signTabVal},{id:"signOutStatus",title:"签退状态",className:"text-left",width:"60px",hidden:"signIn"===e.signTabVal,formatter:function(t){return"请假"===b[t.signInStatus]?b[t.signInStatus]:b[t.signOutStatus]},search:{type:"select",data:{options:this.searchOptions.newSignOutStatus,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signOutTime",title:"签退时间",className:"text-left",width:"150px",hidden:"signIn"===e.signTabVal},{id:"opt",title:"操作",className:"text-right",hidden:!1,formatter:function(t){var a={signInStatus:{in:"SIGN_IN",not:"NOT_SIGN_IN",manual:"MANUAL_SIGN_IN"},signOutStatus:{in:"SIGN_OUT",not:"NOT_SIGN_OUT",manual:"MANUAL_SIGN_OUT"}},s=[],i="",n="";return"signIn"===e.signTabVal?(i="signInStatus",n="签到"):(i="signOutStatus",n="签退"),"ASK_FOR_LEAVE"==t.signInStatus?"signIn"===e.signTabVal&&s.push({tag:"a",text:"取消请假",className:"opt-btn",callback:function(t,a){var s="api/ca/signIn/cancel/askForLeave/"+e.signTabVal+"/"+t.userId+"/"+t.signInId;Object(u.d)(s,{},"post").then(function(t){e.tableParams.ts=+new Date})}}):"ASK_FOR_LEAVE"===t.signOutStatus?"signIn"!==e.signTabVal&&s.push({tag:"a",text:"取消请假",className:"opt-btn",callback:function(t,a){var s="api/ca/signIn/cancel/askForLeave/"+e.signTabVal+"/"+t.userId+"/"+t.signInId;Object(u.d)(s,{},"post").then(function(t){e.tableParams.ts=+new Date})}}):t[i]==a[i].not?(s.push({tag:"a",text:"手动"+n,className:"opt-btn",callback:function(t,a){var s="api/ca/signIn/manualSign/"+e.signTabVal+"/"+t.userId+"/"+t.signInId;Object(u.d)(s,{},"post").then(function(t){e.tableParams.ts=+new Date})}}),s.push({tag:"a",text:"请假",className:"opt-btn",callback:function(t,a){var s="api/ca/signIn/askForLeave/"+e.signTabVal+"/"+t.userId+"/"+t.signInId;Object(u.d)(s,{},"post").then(function(t){e.tableParams.ts=new Date})}})):t[i]==a[i].manual&&s.push({tag:"a",text:"取消手动"+n,className:"opt-btn",callback:function(t,a){var s="api/ca/signIn/cancel/manualSign/"+e.signTabVal+"/"+t.userId+"/"+t.signInId;Object(u.d)(s,{},"post").then(function(t){e.tableParams.ts=+new Date})}}),s.push({tag:"a",text:"删除",className:"opt-btn",callback:function(t,a){if(confirm("是否删除?")){var s="api/ca/signIn/delete/"+t.userId+"/"+t.signInId;Object(u.d)(s,{},"post").then(function(t){e.tableParams.ts=new Date})}}}),s}}]}else"outside"!==this.editSignModal.signWay?"PROXY"===this.userType?this.tableParams.columns=[{id:"name",title:this.i18n.signInfo.userName,className:"text-left",width:"55px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"userNo",title:this.i18n.signInfo.userNo,className:"text-left",width:"120px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"collegeCode",title:this.i18n.signInfo.college,className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code",placeholder:""}},formatter:function(t){return t.college}},{id:"classId",title:"班级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.classArr,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"status",title:this.i18n.signInfo.signStatus,className:"text-left",width:"60px",hidden:!1,formatter:function(t){return y[t.signInStatus]},search:{type:"select",data:{options:this.searchOptions.status,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signInTime",title:this.i18n.signInfo.signTime,className:"text-left",width:"150px",hidden:!1},{id:"remark",title:this.i18n.signInfo.remark,className:"text-left",width:"250px",hidden:!1},{id:"opt",title:"",className:"text-right",hidden:!1,formatter:function(e){var a=[];return"NOT_SIGN"==e.signInStatus&&a.push({tag:"a",text:t.i18n.signInfo.recordByHand,className:"opt-btn",callback:function(e,a){t.signManualModal.userId=e.userId,t.signManualModal.userNo=e.userNo,t.signManualModal.signId=e.signInId,t.signManualModal.createDate=e.createDate,t.signManualModal.show=!0}}),t.isManager&&a.push({tag:"a",text:t.i18n.signInfo.remove,className:"opt-btn",callback:function(e,a){window.confirm("确定把"+e.name+"从此次签到中移除?")&&h.a.removePersonFromSign(e.signInId,e.userId,e.createDate,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast(t.i18n.tip.removeSuccess),void(t.tableParams.ts=+new Date)):t.$toast(a.message)})}}),a}}]:this.tableParams.columns=[{id:"name",title:this.i18n.signInfo.userName,className:"text-left",width:"55px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"userNo",title:this.i18n.signInfo.userNo,className:"text-left",width:"120px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"college",title:this.i18n.signInfo.college,className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code",placeholder:""}},formatter:function(t){return t.college}},{id:"classId",title:"班级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.classArr,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"grade",title:"年级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.gradeYear,optionsLabel:"label",optionsValue:"value",placeholder:""}}},{id:"educationLevel ",title:"培养层次",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.eduList,optionsLabel:"label",optionsValue:"value",placeholder:""}}},{id:"unit",title:"部门",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.unitList,optionsLabel:"name",optionsValue:"id",placeholder:""}}},{id:"signInStatus",title:this.i18n.signInfo.signStatus,className:"text-left",width:"60px",hidden:!1,formatter:function(t){return y[t.signInStatus]},search:{type:"select",data:{options:this.searchOptions.status,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signInTime",title:this.i18n.signInfo.signTime,className:"text-left",width:"150px",hidden:!1},{id:"remark",title:this.i18n.signInfo.remark,className:"text-left",width:"250px",hidden:!1},{id:"opt",title:"",className:"text-right",hidden:!1,formatter:function(e){var a=[];return"NOT_SIGN"==e.signInStatus&&a.push({tag:"a",text:t.i18n.signInfo.recordByHand,className:"opt-btn",callback:function(e,a){t.signManualModal.userId=e.userId,t.signManualModal.userNo=e.userNo,t.signManualModal.signId=e.signInId,t.signManualModal.createDate=e.createDate,t.signManualModal.show=!0}}),t.isManager&&a.push({tag:"a",text:t.i18n.signInfo.remove,className:"opt-btn",callback:function(e,a){window.confirm("确定把"+e.name+"从此次签到中移除?")&&h.a.removePersonFromSign(e.signInId,e.userId,e.createDate,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast(t.i18n.tip.removeSuccess),void(t.tableParams.ts=+new Date)):t.$toast(a.message)})}}),a}}]:"PROXY"===this.userType?this.tableParams.columns=[{id:"name",title:this.i18n.signInfo.userName,className:"text-left",width:"55px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"userNo",title:this.i18n.signInfo.userNo,className:"text-left",width:"120px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"collegeCode",title:this.i18n.signInfo.college,className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code",placeholder:""}},formatter:function(t){return t.college}},{id:"classId",title:"班级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.classArr,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"status",title:this.i18n.signInfo.signStatus,className:"text-left",width:"60px",hidden:!1,formatter:function(t){return y[t.signInStatus]},search:{type:"select",data:{options:this.searchOptions.status,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signInTime",title:this.i18n.signInfo.signTime,className:"text-left",width:"150px",hidden:!1},{id:"address",title:"打卡地点",className:"text-left",width:"150px",hidden:!1,formatter:function(e){var a=[];return a.push({tag:"a",text:e.address,className:"opt-btn",callback:function(e,a){t.showAddressDetail(e)}}),a}},{id:"remark",title:this.i18n.signInfo.remark,className:"text-left",width:"250px",hidden:!1},{id:"opt",title:"",className:"text-right",hidden:!1,formatter:function(e){var a=[];return"NOT_SIGN"==e.signInStatus&&a.push({tag:"a",text:t.i18n.signInfo.recordByHand,className:"opt-btn",callback:function(e,a){t.signManualModal.userId=e.userId,t.signManualModal.userNo=e.userNo,t.signManualModal.signId=e.signInId,t.signManualModal.createDate=e.createDate,t.signManualModal.show=!0}}),t.isManager&&a.push({tag:"a",text:t.i18n.signInfo.remove,className:"opt-btn",callback:function(e,a){window.confirm("确定把"+e.name+"从此次签到中移除?")&&h.a.removePersonFromSign(e.signInId,e.userId,e.createDate,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast(t.i18n.tip.removeSuccess),void(t.tableParams.ts=+new Date)):t.$toast(a.message)})}}),a}}]:this.tableParams.columns=[{id:"name",title:this.i18n.signInfo.userName,className:"text-left",width:"55px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"userNo",title:this.i18n.signInfo.userNo,className:"text-left",width:"120px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"college",title:this.i18n.signInfo.college,className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code",placeholder:""}},formatter:function(t){return t.college}},{id:"classId",title:"班级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.classArr,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"grade",title:"年级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.gradeYear,optionsLabel:"label",optionsValue:"value",placeholder:""}}},{id:"educationLevel ",title:"培养层次",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.eduList,optionsLabel:"label",optionsValue:"value",placeholder:""}}},{id:"unit",title:"部门",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.unitList,optionsLabel:"name",optionsValue:"id",placeholder:""}}},{id:"signInStatus",title:this.i18n.signInfo.signStatus,className:"text-left",width:"60px",hidden:!1,formatter:function(t){return y[t.signInStatus]},search:{type:"select",data:{options:this.searchOptions.status,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signInTime",title:this.i18n.signInfo.signTime,className:"text-left",width:"150px",hidden:!1},{id:"address",title:"打卡地点",className:"text-left",width:"150px",hidden:!1,formatter:function(e){var a=[];return a.push({tag:"a",text:e.address,className:"opt-btn",callback:function(e,a){t.showAddressDetail(e)}}),a}},{id:"remark",title:this.i18n.signInfo.remark,className:"text-left",width:"250px",hidden:!1},{id:"opt",title:"",className:"text-right",hidden:!1,formatter:function(e){var a=[];return e.picture&&a.push({tag:"a",text:"查看图片",className:"opt-btn",callback:function(e,a){t.showImgDetail(e.picture)}}),"NOT_SIGN"==e.signInStatus&&a.push({tag:"a",text:t.i18n.signInfo.recordByHand,className:"opt-btn",callback:function(e,a){t.signManualModal.userId=e.userId,t.signManualModal.userNo=e.userNo,t.signManualModal.signId=e.signInId,t.signManualModal.createDate=e.createDate,t.signManualModal.show=!0}}),t.isManager&&a.push({tag:"a",text:t.i18n.signInfo.remove,className:"opt-btn",callback:function(e,a){window.confirm("确定把"+e.name+"从此次签到中移除?")&&h.a.removePersonFromSign(e.signInId,e.userId,e.createDate,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast(t.i18n.tip.removeSuccess),void(t.tableParams.ts=+new Date)):t.$toast(a.message)})}}),a}}]},toEditSign:function(){this.editSignModal.show=!0},normalizeDateString:function(t){return t&&19!==t.length?t+":00":t},changeProxy:function(t){if(t.val){var e=t.val,a=!0,s=!1,i=void 0;try{for(var n,o=l()(this.proxy.proxies);!(a=(n=o.next()).done);a=!0){var r=n.value;r.id===e&&(this.setCurrentProxy(r),this.refreshQrcode())}}catch(t){s=!0,i=t}finally{try{!a&&o.return&&o.return()}finally{if(s)throw i}}}},saveSign:function(){var t=this;if(this.sign.needOut){var e=JSON.parse(o()(this.editSignModal));e.signInName=e.name,e.signInTimeStart=e.startTime,e.signInTimeEnd=e.endTime,e.dynamicCode=!!e.useDynamicCode,e.isLocation=!!e.scanQrcodeWithLocation,e.ranges=e.qrcodeLocations.map(function(t){return{longitude:t.lng,latitude:t.lat,distance:t.radius,address:t.address}});var a="api/ca/signIn/update/"+this.editSignModal.signId;Object(u.d)(a,e,"post").then(function(e){e.state?(t.editSignModal.useDynamicCode?(t.sign.useDynamicCode=!0,t.initQrcode()):(t.sign.useDynamicCode=!1,t.stopQrcodeTimer()),t.editSignModal.show=!1,t.$toast("操作成功!")):t.$toast(e.message)})}else h.a.editSign(this.editSignModal,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.syncSignInfo(),t.editSignModal.show=!1,"qrcode"===t.editSignModal.signWay?t.initQrcode():t.stopQrcodeTimer(),void t.$toast(t.i18n.tip.saveSuccess)):t.$toast(a.message)})},syncSignInfo:function(){this.sign.name=this.editSignModal.name,this.sign.startTime=this.editSignModal.startTime,this.sign.endTime=this.editSignModal.endTime,this.sign.hourStart=this.editSignModal.hourStart,this.sign.hourEnd=this.editSignModal.hourEnd,this.sign.useDynamicCode=this.editSignModal.useDynamicCode,this.sign.signWay=this.editSignModal.signWay,this.sign.scanQrcodeWithLocation=this.editSignModal.scanQrcodeWithLocation,this.sign.qrcodeLocations=this.editSignModal.qrcodeLocations,this.sign.locations=this.editSignModal.locations},showStat:function(){var t=this;this.statModal.loading=!0,this.statModal.show=!0;var e="",a="";this.statDate.length&&(e=this.statDate[0],a=this.statDate[1]),h.a.getGeneralSignStat(this.sign.id,e,a,function(e,a){if(e)return t.$toast(t.i18n.error.networkError);if(!a.state)return t.$toast(a.message);t.statModal.loading=!1;var s=a.data;if(!s)return t.statModal.noStat=!0;t.statModal.noStat=!1,t.statModal.generalChart.legend.done.num=s.countSign,t.statModal.generalChart.legend.todo.num=s.countNotSinIn,t.statModal.syncTime=s.timeTemp,t.$nextTick(function(){t.refreshGeneralChart()})})},getSignOptionWidth:function(t){var e=t.done/t.total,a=t.manual/t.total,s=t.todo/t.total;(0==t.total||s==e&&s==a)&&(s=e=a=.3333333);var i=this.statModal.totalWidth*e,n=this.statModal.totalWidth*a,o=this.statModal.totalWidth*s,r=0;return i<10&&(r+=10-i,i=10),n<10&&(r+=10-n,n=10),o<10&&(r+=10-o,o=10),i<n?n>o?n-=r:i>o?i-=r:o-=r:i>o?i-=r:n>o?n-=r:o-=r,{done:i,manual:n,todo:o}},initChartIfNotInit:function(){this.statModal.generalChart.instance=p.a.init(document.getElementById("general-chart"))},initQrcode:function(){var t=this;this.createSignUrl(function(e){e&&(t.qrcode.url=e,t.qrcode.instance?(t.qrcode.instance.clear(),t.qrcode.instance.makeCode(e)):t.sign.needOut||(t.qrcode.instance=new f.a("sign-qrcode",{text:e,width:400,height:400})),t.sign.useDynamicCode?t.startQrcodeTimer():t.stopQrcodeTimer())})},refreshQrcode:function(){var t=this;this.createSignUrl(function(e){e&&(t.qrcode.url=e,t.qrcode.instance?(t.qrcode.instance.clear(),t.qrcode.instance.makeCode(e)):t.sign.needOut||(t.qrcode.instance=new f.a("sign-qrcode",{text:e,width:400,height:400})))})},startQrcodeTimer:function(){var t=this;this.stopQrcodeTimer(),this.qrcode.timer=setInterval(function(){t.refreshQrcode()},1e4)},stopQrcodeTimer:function(){this.qrcode.timer&&(clearInterval(this.qrcode.timer),this.qrcode.timer=null)},refreshGeneralChart:function(){this.initChartIfNotInit(),this.statModal.generalChart.options.series[0].data=[{value:this.statModal.generalChart.legend.done.num,name:"已签到"},{name:"未签到",value:this.statModal.generalChart.legend.todo.num}],this.statModal.generalChart.instance.setOption(this.statModal.generalChart.options)},getRadioIcon:function(t){return t?"radio_button_checked":"radio_button_unchecked"},changeStatType:function(t){var e=this;this.statType=t;var a=this.statModal.control[t];for(var s in this.statModal.control)this.statModal.control[s].checked=!1;if(a.checked=!0,this.statModal.currentControl=t,"general"!=t){var i="",n="";this.statDate.length&&(i=this.statDate[0],n=this.statDate[1]),h.a.getSignStatByType(this.sign.id,a.type,i,n,function(t,s){return t?e.$toast(e.i18n.error.networkError):s.state?void(a.data=s.data.map(function(t){var a={overview:{total:t.overview.count,done:t.overview.countSign,manual:t.overview.countManualEntry,todo:t.overview.countNotSinIn},title:t.title,sort:t.sort};return a.widthData=e.getSignOptionWidth(a.overview),a})):e.$toast(s.message)})}else this.showStat()},fullscreen:function(){var t=this;this.qrcode.oldInstance=this.qrcode.instance,this.qrcode.fullscreen=!0,this.$nextTick(function(){t.sign.needOut?t.$parent.isAgent?t.qrcode.instance=new f.a("needOut-sign-qrcode-isAgent-fullscreen",{text:t.qrcode.url,width:400,height:400}):t.$parent.isPerson?t.qrcode.instance=new f.a("needOut-sign-qrcode-isPerson-fullscreen",{text:t.qrcode.url,width:400,height:400}):t.qrcode.instance=new f.a("needOut-sign-qrcode-fullscreen",{text:t.qrcode.url,width:400,height:400}):t.qrcode.instance=new f.a("sign-qrcode-fullscreen",{text:t.qrcode.url,width:400,height:400})}),this.sign.needOut&&(this.getHasSignList(),this.setInterFun=setInterval(function(){t.getHasSignList()},5e3))},getHasSignList:function(){var t=this,e=this.tableUrl;"signIn"===this.signTabVal?e+="&signInStatus=SIGN_IN":e+="&signOutStatus=SIGN_OUT",Object(u.d)(e).then(function(e){if(t.oldHasSignList&&(e.data.length||t.oldHasSignList.length)){var a=e.data.filter(function(e,a,s){return-1===t.oldHasSignList.indexOf(e.userNo)}),s="signIn"===t.signTabVal?"签到成功!":"签退成功!",i=0,n=t;a.length&&function t(){var e=a[i];n.$notify({title:"提示",message:e.college+e.name+s}),(i+=1)<a.length&&setTimeout(t,1e3)}()}t.oldHasSignList=e.data.map(function(t){return t.userNo})})},existFullscreen:function(){this.setInterFun&&(clearInterval(this.setInterFun),this.setInterFun=null,this.oldHasSignList=null),this.clearQrcodeInstance(),this.qrcode.instance.clear(),this.qrcode.fullscreen=!1,this.qrcode.instance=this.qrcode.oldInstance},clearQrcodeInstance:function(){for(var t=this.qrcode.instance._el;t.hasChildNodes();)t.removeChild(t.lastChild)},initManagedColleges:function(t){var e=this;h.a.getBaseSearchOptions(function(a,s){if(a)return e.$toast(e.i18n.error.networkError);if(!s.state)return e.$toast(s.message);var i=!0,n=!1,o=void 0;try{for(var r,d=l()(s.data);!(i=(r=d.next()).done);i=!0){var c=r.value;-1==c.id&&(c.id="")}}catch(a){n=!0,o=a}finally{try{!i&&d.return&&d.return()}finally{if(n)throw o}}e.searchOptions.managedColleges=s.data,e.searchOptions.colleges=e.searchOptions.managedColleges,t&&t()})},initProxies:function(){var t=this;h.a.getMyProxies(this.sign.id,function(e,a){if(e)return t.$toast(t.i18n.error.networkError);if(!a.state)return t.$toast(a.message);if(!a.data)return t.$toast(t.i18n.error.dataError);var s=[],i=[],n=[],o=[],r=!1,d=!1,c=!1,u=!1,h=!0,g=!1,p=void 0;try{for(var m,f=l()(a.data);!(h=(m=f.next()).done);h=!0){var v=m.value;switch(v.distribution){case I:s.push(t.createMixProxy(I,v.agentId,v.agentName,v.agentName,null,null)),r=!0;break;case w:for(var y in v.colleges)i.push(t.createMixProxy(w,v.agentId,v.agentName,v.colleges[y],null,y));d=!0;break;case _:for(var b in v.clazz)n.push(t.createMixProxy(_,v.agentId,v.agentName,v.clazz[b],b,null));c=!0;break;case S:o.push(t.createMixProxy(S,v.agentId,v.agentName,v.agentName,null,null)),u=!0}}}catch(e){g=!0,p=e}finally{try{!h&&f.return&&f.return()}finally{if(g)throw p}}t.proxy.proxies=s.concat(i.concat(n.concat(o))),t.setCurrentProxy(t.proxy.proxies[0]),t.$nextTick(function(){t.initQrcode()}),t.statModal.control.college.show=!1,t.statModal.control.instructor.show=!1,t.statModal.control.clazz.show=!1,r?(t.statModal.control.college.show=!0,t.statModal.control.instructor.show=!0,t.statModal.control.clazz.show=!0):d?(t.statModal.control.college.show=!0,t.statModal.control.clazz.show=!0):(u||c)&&(t.statModal.control.clazz.show=!0)})},setCurrentProxy:function(t){this.proxy.id=t.id,this.proxy.proxyId=t.proxyId,this.proxy.name=t.name,this.proxy.collegeCode=t.collegeCode,this.proxy.classId=t.classId,this.proxy.distributary=t.distributary,t.distributary===w?this.searchOptions.colleges=[{id:t.collegeCode,text:t.name}]:this.searchOptions.colleges=this.searchOptions.managedColleges,this.tableParams.ts=(new Date).getTime()},createMixProxy:function(t,e,a,s,i,n){return{id:t+"-"+e+"-"+(i||"__")+"-"+(n||"__"),proxyId:e,distributary:t,proxyName:a,name:s,classId:i||"",collegeCode:n||""}},signManual:function(){var t=this;if(!this.signManualModal.remark)return this.$toast("您还未填写备注");var e={createDate:this.signManualModal.createDate,signId:this.sign.id,userId:this.signManualModal.userId,remark:this.signManualModal.remark,callback:function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast(t.i18n.tip.setSuccess),t.tableParams.ts=(new Date).getTime(),void(t.signManualModal.show=!1)):t.$toast(a.message)}};h.a.signManual(e)},checkUser:function(){var t=this;if(!this.addPersonModal.userNo)return this.$toast("请输入学号");this.addPersonModal.userId=null,this.addPersonModal.tip="检测中...",h.a.checkUserNo(this.addPersonModal.userNo,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.addPersonModal.userId=a.data.userId,void(t.addPersonModal.userName=t.addPersonModal.tip=a.data.name)):"50001"==a.code?t.addPersonModal.tip="不存在该学号":t.$toast(a.message)})},afterSelectAddPerson:function(t){this.addPersonModal.userId=t.userId,this.addPersonModal.userNo=t.userNo,this.addPersonModal.name=t.name},cancelAddSignPeople:function(){this.addPersonModal.show=!1},addSignPeople:function(){var t=this;if(!this.addPersonModal.userId)return this.$toast("请输入学号或者姓名!");if(this.sign.needOut){var e="api/ca/signIn/"+this.addPersonModal.userId+"/"+this.sign.id;return this.sign.isAgent&&(e="api/ca/signIn/agent/"+this.addPersonModal.userId+"/"+this.sign.id),void Object(u.d)(e,{},"post").then(function(e){e.state?(t.$toast("添加成功"),t.tableParams.ts=+new Date,t.addPersonModal.show=!1):t.$toast(e.message)})}h.a.addSignPeople(this.project.id,this.sign.id,this.addPersonModal.userId,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast("添加成功"),t.tableParams.ts=+new Date,void(t.addPersonModal.show=!1)):"50003"==a.code?t.$toast("该人员已经在签到名单中"):t.$toast(a.message)})},createSignUrl:function(t){var e=this;this.sign.needOut?Object(u.d)("api/ca/system/saasId").then(function(a){var s="default";a.state&&(s=a.data);var i=window.location.origin+"/mobileTowCodeSign?isSign=true&signId="+e.sign.id+"&signTabVal="+e.signTabVal+"&timestamp="+(new Date).getTime()+"&sysId="+s;t(i)}):h.a.createSignUrl(this.sign.id,this.proxy.distributary,this.proxy.collegeCode,this.proxy.classId,this.qrCodeExpireTime,function(a,s){if(a)return t(),e.$toast(e.i18n.error.networkError);if(!s.state)return t(),e.$toast(s.message);var i=window.location.origin+s.data+"?scope=yiban_scan_result";t(i)})},getOutText:function(){var t=this;if(this.formFields.length)return!1;Object(u.e)({url:"/api/signIns/peoples/export/fields",type:"get",success:function(e){if(e.state)for(var a in e.data)t.formFields.push({fieldName:a,fieldTitle:e.data[a]});else t.formFields=[]}})},exportSigns:function(){var t=this.$refs["sign-table"].tableSearchFields||{};if(this.sign.needOut){var e=(new Date).format("yyyy-MM-dd")+this.sign.name;"signIn"===this.signTabVal?e+="签到列表":e+="签退列表";var a="/downloads/ca/signIn/person/export/"+this.signTabVal+"/"+this.sign.id+"?filename="+e+"&";for(var s in this.sign.isAgent&&(a="/downloads/ca/signIn/agent/person/export/"+this.signTabVal+"/"+this.sign.id+"?filename="+e+"&"),t)a+=s+"="+t[s]+"&";return a=a.substring(0,a.length-1),void(window.location.href=a)}if(this.isManager)this.getOutText(),this.outputModalShow=!0;else{var i=this.project.name+this.sign.name+".xlsx";h.a.exportSignsOfProxy(this.sign.id,this.proxy.proxyId,t.name,t.userNo,this.proxy.collegeCode||t.college,this.proxy.classId,t.signInStatus,i,this.dateArea)}}}},"beforeDestroy",function(){this.stopQrcodeTimer()}),{NOT_SIGN:"未签到",SIGN:"已签到",MANUAL_ENTRY:"手工签到",TIME_OUT_NOT_SIGN:"超时未签到"}),x={SIGN_IN:" 已签到",NOT_SIGN_IN:" 未签到",MANUAL_SIGN_IN:"手动签到",SIGN_OUT:" 已签退",NOT_SIGN_OUT:" 未签退",MANUAL_SIGN_OUT:"手动签退",ASK_FOR_LEAVE:"请假"},M="SCHOOL",C="COLLEGE",D="CLASS",N="RELATIONSHIP",k=i()({components:{VIcon:d.a,SignInfoModal:c.a},props:{project:Object,sign:Object,userType:String},data:function(){return{signWayText:{location:"定位签到",qrcode:"扫码签到",outside:"外勤打卡"},searchVal:"",statType:"",statDate:[],eduList:[],gradeYear:[],formFields:[],unitList:[],tableUrl:"",dateArea:"",outputModalShow:!1,outputList:[],downLoadDate:"",classArr:[],loader:v.a,lang:"zh-cn",datePickerStartTime:"",datePickerEndTime:"",showAdviceModal:!1,adviceParams:{sendTimeType:"IMMEDIATELY",sendTime:"",content:"",messageToTarget:"ALL_STUDENT"},sendTimeTypeList:[{label:"立即发送",value:"IMMEDIATELY"},{label:"定时发送",value:"TIMING"}],tableParams:{pagesize:10,idField:"id",columns:[],multi:!1,order:!0,search:!1,ts:+new Date},showAddModal:!1,signTabVal:"signIn",searchOptions:{colleges:[],status:[{id:"NOT_SIGN",text:"未签到"},{id:"SIGN",text:"已签到"},{id:"MANUAL_ENTRY",text:"手工签到"}],newSignInStatus:[{id:"SIGN_IN",text:"已签到"},{id:"NOT_SIGN_IN",text:"未签到"},{id:"MANUAL_SIGN_IN",text:"手动签到"},{id:"ASK_FOR_LEAVE",text:"请假"}],newSignOutStatus:[{id:"SIGN_OUT",text:"已签退"},{id:"NOT_SIGN_OUT",text:"未签退"},{id:"MANUAL_SIGN_OUT",text:"手动签退"},{id:"ASK_FOR_LEAVE",text:"请假"}],managedColleges:[]},addPersonModal:{show:!1,userNo:null,userName:null,userId:null,tip:null},signManualModal:{show:!1,remark:null,signId:null,userId:null,userNo:null},editSignModal:{hourStart:"",hourEnd:"",weekDay:"",weekDayList:[],show:!1,name:null,startTime:"",isSignOut:!1,startTimeToHours:"",endTimeToHours:"",endTime:"",signWays:{qrcode:"qrcode",location:"location",outside:"outside"},signWay:"qrcode",useDynamicCode:!1,scanQrcodeWithLocation:!1,locations:[],qrcodeLocations:[],activeLocationIndex:0,project:null,projectId:null,maxLength:20,dateFormat:"yyyy-MM-dd hh:ii:ss"},qrcode:{fullscreen:!1,oldInstance:null,url:"",instance:null,timer:null},statModal:{show:!1,syncTime:"",totalWidth:550,minWidth:10,loading:!1,noStat:!1,generalChart:{init:!1,instance:null,options:{tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},color:["rgba(92, 107, 192, 1)","rgba(92, 107, 192, .75)","rgba(92, 107, 192, .5)"],series:[{name:"统计",type:"pie",radius:"60%",center:["49%","41%"],data:[],label:{normal:{show:!0}},labelLine:{normal:{show:!0}},itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},legend:{done:{color:"rgba(92, 107, 192, 1)",text:"已签到",num:0},todo:{color:"rgba(92, 107, 192, 0.5)",text:"未签到",num:0}}},currentControl:"general",control:{general:{text:"总览",show:!0,checked:!0,loading:!1},college:{text:"各学院对比",show:!0,checked:!1,type:"COLLEGE",data:[],loading:!1},instructor:{text:"各辅导员对比",show:!0,checked:!1,type:"INSTRUCTOR",data:[],loading:!1},clazz:{text:"各班级对比",show:!0,checked:!1,type:"CLAZZ",data:[],loading:!1}}},proxy:{proxies:[],id:null,distributary:M,proxyId:null,name:"",classId:"",collegeCode:""},exporting:!1,showImgDetailStatus:!1,showAddressModal:!1,addressRecord:{},deleteImgWidth:1,imgDetailSrc:""}},beforeDestroy:function(){this.setInterFun&&(clearInterval(this.setInterFun),this.setInterFun=null,this.oldHasSignList=null)},created:function(){var t=this;if(this.setUrl(),this.getUnitList(),this.setGrade(),this.getEdu(),"loop"==this.sign.checkInType&&"week"==this.sign.frequency){this.editSignModal.weekDay=this.sign.weekDay,this.editSignModal.weekDayList=[];for(var e=this.sign.weekDay.split("&"),a=0;a<e.length;a++){var s=e[a].split(",");this.editSignModal.weekDayList.push({date:this.dateToCn(a),startTime:s[1],endTime:s[2]})}}var i=window.localStorage.getItem("lang");i&&Object(u.g)(i)&&(this.lang=i),this.datePickerStartTime=this.sign.startTime,this.datePickerEndTime=this.sign.endTime,Object(u.e)({url:"/api/relClass/classes/list",dataType:"json",type:"get",async:!1,success:function(e){e.state&&(t.classArr=e.data)}}),this.isProxy&&this.initProxies(),this.initEditSignModal(),this.sign.needOut?this.initTable():this.initManagedColleges(function(){t.initTable()}),this.stopQrcodeTimer()},mounted:function(){this.isProxy||"qrcode"===this.editSignModal.signWay&&this.initQrcode()},computed:{messageToTargetList:function(){return this.editSignModal.isSignOut?[{label:"所有人",value:"ALL_STUDENT"},{label:"未签到",value:"NOT_SIGN"},{label:"请假",value:"ASK_FOR_LEAVE"}]:[{label:"所有人",value:"ALL_STUDENT"},{label:"未签到",value:"NOT_SIGN"}]},tabList:function(){return this.editSignModal.isSignOut?[{id:"signIn",name:"签到"},{id:"signOut",name:"签退"}]:[{id:"signIn",name:"签到"}]},i18n:function(){return Object(u.g)(this.lang).iSign},isManager:function(){return"MANAGE"===this.userType},isALL:function(){return"ALL"===this.userType},isProxy:function(){return"PROXY"===this.userType},qrCodeExpireTime:function(){return this.sign.useDynamicCode?15:0}},watch:{signTabVal:function(){this.initTable(),this.refreshQrcode()},"tableParams.ts":function(){this.setUrl()}},methods:{goToSendMessage:function(){sessionStorage.setItem("signIdSend",this.sign.id),sessionStorage.setItem("fromOutSedMessage",!0),this.$addBread({route:"/messageBox/messageManage",title:"消息盒子"})},showImgDetail:function(t){this.showImgDetailStatus=!0,this.imgDetailSrc="/downloads/storage/images/"+t,window.onmousewheel=document.onmousewheel=this.scrollImg},showAddressDetail:function(t){this.showAddressModal=!0,this.addressRecord={lat:t.latitude,lng:t.longitude}},scrollImg:function(t){this.showImgDetailStatus&&(t.deltaY>0?this.deleteImgWidth<2&&(this.deleteImgWidth+=.1):this.deleteImgWidth>.2&&(this.deleteImgWidth-=.1))},statDateChange:function(t){t&&("general"!=this.statModal.currentControl?this.changeStatType(this.statModal.currentControl):this.showStat())},getUnitList:function(){var t=this;Object(u.e)({type:"get",url:"/api/colleges/units",success:function(e){e.state?t.unitList=e.data:t.unitList=[]}})},_sureToOutput:function(){if(!this.outputList.length)return this.$toast("请选择导出的字段");var t="/downloads/signIns/peoples/excel/"+this.userType+"?signInId="+this.sign.id+"&fields="+this.outputList.join(","),e=this.$refs["sign-table"].tableSearchFields||{};for(var a in this.dateArea.length&&(t+="&startTime="+this.dateArea[0]+"&endTime="+this.dateArea[1]+"&"),e)t+=a+"="+e[a]+"&";window.location.href=t},setUrl:function(){this.sign.needOut?(this.sign.isAgent&&(this.tableUrl="/table-data/ca/signIn/agent/person/page/"+this.signTabVal+"/"+this.sign.id+"?ts="+this.tableParams.ts),this.tableUrl="/table-data/ca/signIn/person/page/"+this.signTabVal+"/"+this.sign.id+"?ts="+this.tableParams.ts):this.isManager||this.isALL?this.tableUrl="/table-data/signIns/peoples/MANAGE?signInId="+this.sign.id+"&ts="+this.tableParams.ts:this.isProxy&&(this.proxy.proxyId?this.tableUrl="/table-data/signIns/"+this.sign.id+"/people/pages?ts="+this.tableParams.ts+"&agentId="+this.proxy.proxyId+"&classId="+(this.proxy.classId||"")+"&collegeCode="+(this.proxy.collegeCode||""):this.tableUrl="")},dateChange:function(t){var e=this;this.isALL=!0,this.isManager=!1,this.$nextTick(function(){e.isProxy?e.proxy.proxyId?e.tableUrl="/table-data/signIns/"+e.sign.id+"/people/pages?ts="+e.tableParams.ts+"&startTime="+t[0]+"&endTime="+t[1]+"&agentId="+e.proxy.proxyId+"&classId="+(e.proxy.classId||"")+"&collegeCode="+(e.proxy.collegeCode||""):e.tableUrl="":e.tableUrl="/table-data/signIns/peoples/MANAGE?signInId="+e.sign.id+"&startTime="+t[0]+"&endTime="+t[1]+"&ts="+(new Date).getTime()})},editMethod:function(t){var e=this;setTimeout(function(){if("day"==t.selectType)e.$set(e.editSignModal,"hourStart",e.editSignModal.startTimeToHours),e.$set(e.editSignModal,"hourEnd",e.editSignModal.endTimeToHours);else{var a=e.editSignModal.weekDay,s=[];e.editSignModal.weekDayList=[];for(var i=a.split("&"),n=0;n<i.length;n++){var o=i[n].split(",");s.push({date:e.dateToCn(n),startTime:o[1],endTime:o[2]})}e.$set(e.editSignModal,"weekDayList",s)}},300)},dateToCn:function(t){switch(t){case 0:return"星期一";case 1:return"星期二";case 2:return"星期三";case 3:return"星期四";case 4:return"星期五";case 5:return"星期六";case 6:return"星期日"}},setGrade:function(){for(var t=(new Date).getFullYear(),e=[],a=[],s=0;s<6;s++)e.push({label:t-s+"",value:t-s});for(var i=1;i<11;i++)a.push({label:t+i+"",value:t+i});this.gradeYear=e.reverse().concat(a)},getEdu:function(){var t=this;Object(u.e)({url:"/api/system/dicts?dictType=培养层次",type:"get",success:function(e){e.state?t.eduList=e.data:t.eduList=[]}})},_changeOutputList:function(t){var e=this.outputList.indexOf(t.fieldName);if(e>=0){this.outputList.splice(e,1);var a=this.outputList.indexOf("allChoice");a>=0&&this.outputList.splice(a,1)}else this.outputList.push(t.fieldName)},sendMessage:function(){var t=this,e="api/ca/signIn/person/message/"+this.signTabVal+"/"+this.sign.id;this.sign.isAgent&&(e="api/ca/signIn/agent/person/message/"+this.signTabVal+"/"+this.sign.id),this.adviceParams.sendTimeType?"TIMING"!==this.adviceParams.sendTimeType||this.adviceParams.sendTime?this.adviceParams.content?this.adviceParams.messageToTarget?Object(u.d)(e,this.adviceParams).then(function(e){e.state&&(t.showAdviceModal=!1,t.$toast("操作成功!"))}):this.$toast("请选择发送对象!"):this.$toast("请输入发送内容!"):this.$toast("发送时间不能为空!"):this.$toast("请选择发送!")},sendTimeSelected:function(t){t.value&&new Date(t.value)<new Date&&(this.$toast("发送时间已过期!"),this.adviceParams.sendTime="")},addPersonByOne:function(){this.addPersonModal.show=!0,this.showAddModal=!1},batchAddPerson:function(){var t=this;this.$parent.importParams={parentPageTitle:"",downloadTemplateUrl:"/ca/signIn/batch/template",downloadErrorTemplateUrl:"/ca/courses/batch/error",checkTemplateUrl:"/ca/signIn/batch/excel/"+this.sign.id,templateName:"批量导入模板",importBtnType:[{url:"/ca/signIn/batch/update",method:"post",isShowBtn:!0,name:"增量导入",success:function(e){t.$parent.timestamp="?timestamp="+(new Date).getTime(),t.$parent.curRoute="signInfo"}}]},this.sign.isAgent&&(this.$parent.importParams.checkTemplateUrl="/ca/signIn/agent/batch/excel/"+this.sign.id),this.$parent.quickAddRecord()},back:function(){this.$emit("back")},initEditSignModal:function(){this.editSignModal.signId=this.sign.id,this.editSignModal.projectId=this.sign.projectId,this.editSignModal.hourStart=this.sign.hourStart,this.editSignModal.hourEnd=this.sign.hourEnd,this.editSignModal.name=this.sign.name,this.editSignModal.startTime=this.sign.startTime,this.editSignModal.endTime=this.sign.endTime,this.editSignModal.useDynamicCode=this.sign.useDynamicCode,this.editSignModal.signWay=this.sign.signWay,this.editSignModal.scanQrcodeWithLocation=this.sign.scanQrcodeWithLocation,this.editSignModal.qrcodeLocations=this.sign.qrcodeLocations,this.editSignModal.locations=this.sign.locations.map(function(t){return t.init=!0,t}),this.editSignModal.signOutTimeEnd=this.sign.signOutTimeEnd,this.editSignModal.signOutTimeStart=this.sign.signOutTimeStart,this.editSignModal.isSignOut=this.sign.isSignOut,this.editSignModal.needOut=this.sign.needOut},initTable:function(){var t=this;if(this.sign.needOut){var e=this;this.tableParams.columns=[{id:"userNo",title:this.i18n.signInfo.userNo,className:"text-left",width:"120px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"name",title:this.i18n.signInfo.userName,className:"text-left",width:"55px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"college",title:this.i18n.signInfo.college,className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code",placeholder:""}},formatter:function(t){return t.college}},{id:"classId",title:"行政班级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.classArr,optionsLabel:"text",optionsValue:"id",placeholder:""}},formatter:function(t){return t.className}},{id:"signInStatus",title:"签到状态",className:"text-left",width:"80px",hidden:"signIn"!==e.signTabVal,formatter:function(t){return x[t.signInStatus]},search:{type:"select",data:{options:this.searchOptions.newSignInStatus,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signInTime",title:this.i18n.signInfo.signTime,className:"text-left",width:"150px",hidden:"signIn"!==e.signTabVal},{id:"signOutStatus",title:"签退状态",className:"text-left",width:"60px",hidden:"signIn"===e.signTabVal,formatter:function(t){return"请假"===x[t.signInStatus]?x[t.signInStatus]:x[t.signOutStatus]},search:{type:"select",data:{options:this.searchOptions.newSignOutStatus,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signOutTime",title:"签退时间",className:"text-left",width:"150px",hidden:"signIn"===e.signTabVal},{id:"opt",title:"操作",className:"text-right",hidden:!1,formatter:function(t){var a={signInStatus:{in:"SIGN_IN",not:"NOT_SIGN_IN",manual:"MANUAL_SIGN_IN"},signOutStatus:{in:"SIGN_OUT",not:"NOT_SIGN_OUT",manual:"MANUAL_SIGN_OUT"}},s=[],i="",n="";return"signIn"===e.signTabVal?(i="signInStatus",n="签到"):(i="signOutStatus",n="签退"),"ASK_FOR_LEAVE"==t.signInStatus?"signIn"===e.signTabVal&&s.push({tag:"a",text:"取消请假",className:"opt-btn",callback:function(t,a){var s="api/ca/signIn/cancel/askForLeave/"+e.signTabVal+"/"+t.userId+"/"+t.signInId;Object(u.d)(s,{},"post").then(function(t){e.tableParams.ts=+new Date})}}):"ASK_FOR_LEAVE"===t.signOutStatus?"signIn"!==e.signTabVal&&s.push({tag:"a",text:"取消请假",className:"opt-btn",callback:function(t,a){var s="api/ca/signIn/cancel/askForLeave/"+e.signTabVal+"/"+t.userId+"/"+t.signInId;Object(u.d)(s,{},"post").then(function(t){e.tableParams.ts=+new Date})}}):t[i]==a[i].not?(s.push({tag:"a",text:"手动"+n,className:"opt-btn",callback:function(t,a){var s="api/ca/signIn/manualSign/"+e.signTabVal+"/"+t.userId+"/"+t.signInId;Object(u.d)(s,{},"post").then(function(t){e.tableParams.ts=+new Date})}}),s.push({tag:"a",text:"请假",className:"opt-btn",callback:function(t,a){var s="api/ca/signIn/askForLeave/"+e.signTabVal+"/"+t.userId+"/"+t.signInId;Object(u.d)(s,{},"post").then(function(t){e.tableParams.ts=new Date})}})):t[i]==a[i].manual&&s.push({tag:"a",text:"取消手动"+n,className:"opt-btn",callback:function(t,a){var s="api/ca/signIn/cancel/manualSign/"+e.signTabVal+"/"+t.userId+"/"+t.signInId;Object(u.d)(s,{},"post").then(function(t){e.tableParams.ts=+new Date})}}),s.push({tag:"a",text:"删除",className:"opt-btn",callback:function(t,a){if(confirm("是否删除?")){var s="api/ca/signIn/delete/"+t.userId+"/"+t.signInId;Object(u.d)(s,{},"post").then(function(t){e.tableParams.ts=new Date})}}}),s}}]}else"outside"!==this.editSignModal.signWay?"PROXY"===this.userType?this.tableParams.columns=[{id:"name",title:this.i18n.signInfo.userName,className:"text-left",width:"55px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"userNo",title:this.i18n.signInfo.userNo,className:"text-left",width:"120px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"collegeCode",title:this.i18n.signInfo.college,className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code",placeholder:""}},formatter:function(t){return t.college}},{id:"classId",title:"班级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.classArr,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"status",title:this.i18n.signInfo.signStatus,className:"text-left",width:"60px",hidden:!1,formatter:function(t){return T[t.signInStatus]},search:{type:"select",data:{options:this.searchOptions.status,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signInTime",title:this.i18n.signInfo.signTime,className:"text-left",width:"150px",hidden:!1},{id:"remark",title:this.i18n.signInfo.remark,className:"text-left",width:"250px",hidden:!1},{id:"opt",title:"",className:"text-right",hidden:!1,formatter:function(e){var a=[];return"NOT_SIGN"==e.signInStatus&&a.push({tag:"a",text:t.i18n.signInfo.recordByHand,className:"opt-btn",callback:function(e,a){t.signManualModal.userId=e.userId,t.signManualModal.userNo=e.userNo,t.signManualModal.signId=e.signInId,t.signManualModal.createDate=e.createDate,t.signManualModal.show=!0}}),t.isManager&&a.push({tag:"a",text:t.i18n.signInfo.remove,className:"opt-btn",callback:function(e,a){window.confirm("确定把"+e.name+"从此次签到中移除?")&&h.a.removePersonFromSign(e.signInId,e.userId,e.createDate,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast(t.i18n.tip.removeSuccess),void(t.tableParams.ts=+new Date)):t.$toast(a.message)})}}),a}}]:this.tableParams.columns=[{id:"name",title:this.i18n.signInfo.userName,className:"text-left",width:"55px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"userNo",title:this.i18n.signInfo.userNo,className:"text-left",width:"120px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"college",title:this.i18n.signInfo.college,className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code",placeholder:""}},formatter:function(t){return t.college}},{id:"classId",title:"班级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.classArr,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"grade",title:"年级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.gradeYear,optionsLabel:"label",optionsValue:"value",placeholder:""}}},{id:"educationLevel ",title:"培养层次",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.eduList,optionsLabel:"label",optionsValue:"value",placeholder:""}}},{id:"unit",title:"部门",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.unitList,optionsLabel:"name",optionsValue:"id",placeholder:""}}},{id:"signInStatus",title:this.i18n.signInfo.signStatus,className:"text-left",width:"60px",hidden:!1,formatter:function(t){return T[t.signInStatus]},search:{type:"select",data:{options:this.searchOptions.status,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signInTime",title:this.i18n.signInfo.signTime,className:"text-left",width:"150px",hidden:!1},{id:"remark",title:this.i18n.signInfo.remark,className:"text-left",width:"250px",hidden:!1},{id:"opt",title:"",className:"text-right",hidden:!1,formatter:function(e){var a=[];return"NOT_SIGN"==e.signInStatus&&a.push({tag:"a",text:t.i18n.signInfo.recordByHand,className:"opt-btn",callback:function(e,a){t.signManualModal.userId=e.userId,t.signManualModal.userNo=e.userNo,t.signManualModal.signId=e.signInId,t.signManualModal.createDate=e.createDate,t.signManualModal.show=!0}}),t.isManager&&a.push({tag:"a",text:t.i18n.signInfo.remove,className:"opt-btn",callback:function(e,a){window.confirm("确定把"+e.name+"从此次签到中移除?")&&h.a.removePersonFromSign(e.signInId,e.userId,e.createDate,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast(t.i18n.tip.removeSuccess),void(t.tableParams.ts=+new Date)):t.$toast(a.message)})}}),a}}]:"PROXY"===this.userType?this.tableParams.columns=[{id:"name",title:this.i18n.signInfo.userName,className:"text-left",width:"55px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"userNo",title:this.i18n.signInfo.userNo,className:"text-left",width:"120px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"collegeCode",title:this.i18n.signInfo.college,className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code",placeholder:""}},formatter:function(t){return t.college}},{id:"classId",title:"班级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.classArr,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"status",title:this.i18n.signInfo.signStatus,className:"text-left",width:"60px",hidden:!1,formatter:function(t){return T[t.signInStatus]},search:{type:"select",data:{options:this.searchOptions.status,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signInTime",title:this.i18n.signInfo.signTime,className:"text-left",width:"150px",hidden:!1},{id:"address",title:"打卡地点",className:"text-left",width:"150px",hidden:!1,formatter:function(e){var a=[];return a.push({tag:"a",text:e.address,className:"opt-btn",callback:function(e,a){t.showAddressDetail(e)}}),a}},{id:"remark",title:this.i18n.signInfo.remark,className:"text-left",width:"250px",hidden:!1},{id:"opt",title:"",className:"text-right",hidden:!1,formatter:function(e){var a=[];return"NOT_SIGN"==e.signInStatus&&a.push({tag:"a",text:t.i18n.signInfo.recordByHand,className:"opt-btn",callback:function(e,a){t.signManualModal.userId=e.userId,t.signManualModal.userNo=e.userNo,t.signManualModal.signId=e.signInId,t.signManualModal.createDate=e.createDate,t.signManualModal.show=!0}}),t.isManager&&a.push({tag:"a",text:t.i18n.signInfo.remove,className:"opt-btn",callback:function(e,a){window.confirm("确定把"+e.name+"从此次签到中移除?")&&h.a.removePersonFromSign(e.signInId,e.userId,e.createDate,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast(t.i18n.tip.removeSuccess),void(t.tableParams.ts=+new Date)):t.$toast(a.message)})}}),a}}]:this.tableParams.columns=[{id:"name",title:this.i18n.signInfo.userName,className:"text-left",width:"55px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"userNo",title:this.i18n.signInfo.userNo,className:"text-left",width:"120px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"college",title:this.i18n.signInfo.college,className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code",placeholder:""}},formatter:function(t){return t.college}},{id:"classId",title:"班级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.classArr,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"grade",title:"年级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.gradeYear,optionsLabel:"label",optionsValue:"value",placeholder:""}}},{id:"educationLevel ",title:"培养层次",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.eduList,optionsLabel:"label",optionsValue:"value",placeholder:""}}},{id:"unit",title:"部门",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.unitList,optionsLabel:"name",optionsValue:"id",placeholder:""}}},{id:"signInStatus",title:this.i18n.signInfo.signStatus,className:"text-left",width:"60px",hidden:!1,formatter:function(t){return T[t.signInStatus]},search:{type:"select",data:{options:this.searchOptions.status,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signInTime",title:this.i18n.signInfo.signTime,className:"text-left",width:"150px",hidden:!1},{id:"address",title:"打卡地点",className:"text-left",width:"150px",hidden:!1,formatter:function(e){var a=[];return a.push({tag:"a",text:e.address,className:"opt-btn",callback:function(e,a){t.showAddressDetail(e)}}),a}},{id:"remark",title:this.i18n.signInfo.remark,className:"text-left",width:"250px",hidden:!1},{id:"opt",title:"",className:"text-right",hidden:!1,formatter:function(e){var a=[];return e.picture&&a.push({tag:"a",text:"查看图片",className:"opt-btn",callback:function(e,a){t.showImgDetail(e.picture)}}),"NOT_SIGN"==e.signInStatus&&a.push({tag:"a",text:t.i18n.signInfo.recordByHand,className:"opt-btn",callback:function(e,a){t.signManualModal.userId=e.userId,t.signManualModal.userNo=e.userNo,t.signManualModal.signId=e.signInId,t.signManualModal.createDate=e.createDate,t.signManualModal.show=!0}}),t.isManager&&a.push({tag:"a",text:t.i18n.signInfo.remove,className:"opt-btn",callback:function(e,a){window.confirm("确定把"+e.name+"从此次签到中移除?")&&h.a.removePersonFromSign(e.signInId,e.userId,e.createDate,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast(t.i18n.tip.removeSuccess),void(t.tableParams.ts=+new Date)):t.$toast(a.message)})}}),a}}]},toEditSign:function(){this.editSignModal.show=!0},normalizeDateString:function(t){return t&&19!==t.length?t+":00":t},changeProxy:function(t){if(t.val){var e=t.val,a=!0,s=!1,i=void 0;try{for(var n,o=l()(this.proxy.proxies);!(a=(n=o.next()).done);a=!0){var r=n.value;r.id===e&&(this.setCurrentProxy(r),this.refreshQrcode())}}catch(t){s=!0,i=t}finally{try{!a&&o.return&&o.return()}finally{if(s)throw i}}}},saveSign:function(){var t=this;if(this.sign.needOut){var e=JSON.parse(o()(this.editSignModal));e.signInName=e.name,e.signInTimeStart=e.startTime,e.signInTimeEnd=e.endTime,e.dynamicCode=!!e.useDynamicCode,e.isLocation=!!e.scanQrcodeWithLocation,e.ranges=e.qrcodeLocations.map(function(t){return{longitude:t.lng,latitude:t.lat,distance:t.radius,address:t.address}});var a="api/ca/signIn/update/"+this.editSignModal.signId;Object(u.d)(a,e,"post").then(function(e){e.state?(t.editSignModal.useDynamicCode?(t.sign.useDynamicCode=!0,t.initQrcode()):(t.sign.useDynamicCode=!1,t.stopQrcodeTimer()),t.editSignModal.show=!1,t.$toast("操作成功!")):t.$toast(e.message)})}else h.a.editSign(this.editSignModal,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.syncSignInfo(),t.editSignModal.show=!1,"qrcode"===t.editSignModal.signWay?t.initQrcode():t.stopQrcodeTimer(),void t.$toast(t.i18n.tip.saveSuccess)):t.$toast(a.message)})},syncSignInfo:function(){this.sign.name=this.editSignModal.name,this.sign.startTime=this.editSignModal.startTime,this.sign.endTime=this.editSignModal.endTime,this.sign.hourStart=this.editSignModal.hourStart,this.sign.hourEnd=this.editSignModal.hourEnd,this.sign.useDynamicCode=this.editSignModal.useDynamicCode,this.sign.signWay=this.editSignModal.signWay,this.sign.scanQrcodeWithLocation=this.editSignModal.scanQrcodeWithLocation,this.sign.qrcodeLocations=this.editSignModal.qrcodeLocations,this.sign.locations=this.editSignModal.locations},showStat:function(){var t=this;this.statModal.loading=!0,this.statModal.show=!0;var e="",a="";this.statDate.length&&(e=this.statDate[0],a=this.statDate[1]),h.a.getGeneralSignStat(this.sign.id,e,a,function(e,a){if(e)return t.$toast(t.i18n.error.networkError);if(!a.state)return t.$toast(a.message);t.statModal.loading=!1;var s=a.data;if(!s)return t.statModal.noStat=!0;t.statModal.noStat=!1,t.statModal.generalChart.legend.done.num=s.countSign,t.statModal.generalChart.legend.todo.num=s.countNotSinIn,t.statModal.syncTime=s.timeTemp,t.$nextTick(function(){t.refreshGeneralChart()})})},getSignOptionWidth:function(t){var e=t.done/t.total,a=t.manual/t.total,s=t.todo/t.total;(0==t.total||s==e&&s==a)&&(s=e=a=.3333333);var i=this.statModal.totalWidth*e,n=this.statModal.totalWidth*a,o=this.statModal.totalWidth*s,r=0;return i<10&&(r+=10-i,i=10),n<10&&(r+=10-n,n=10),o<10&&(r+=10-o,o=10),i<n?n>o?n-=r:i>o?i-=r:o-=r:i>o?i-=r:n>o?n-=r:o-=r,{done:i,manual:n,todo:o}},initChartIfNotInit:function(){this.statModal.generalChart.instance=p.a.init(document.getElementById("general-chart"))},initQrcode:function(){var t=this;this.createSignUrl(function(e){e&&(t.qrcode.url=e,t.qrcode.instance?(t.qrcode.instance.clear(),t.qrcode.instance.makeCode(e)):t.sign.needOut||(t.qrcode.instance=new f.a("sign-qrcode",{text:e,width:400,height:400})),t.sign.useDynamicCode?t.startQrcodeTimer():t.stopQrcodeTimer())})},refreshQrcode:function(){var t=this;this.createSignUrl(function(e){e&&(t.qrcode.url=e,t.qrcode.instance?(t.qrcode.instance.clear(),t.qrcode.instance.makeCode(e)):t.sign.needOut||(t.qrcode.instance=new f.a("sign-qrcode",{text:e,width:400,height:400})))})},startQrcodeTimer:function(){var t=this;this.stopQrcodeTimer(),this.qrcode.timer=setInterval(function(){t.refreshQrcode()},1e4)},stopQrcodeTimer:function(){this.qrcode.timer&&(clearInterval(this.qrcode.timer),this.qrcode.timer=null)},refreshGeneralChart:function(){this.initChartIfNotInit(),this.statModal.generalChart.options.series[0].data=[{value:this.statModal.generalChart.legend.done.num,name:"已签到"},{name:"未签到",value:this.statModal.generalChart.legend.todo.num}],this.statModal.generalChart.instance.setOption(this.statModal.generalChart.options)},getRadioIcon:function(t){return t?"radio_button_checked":"radio_button_unchecked"},changeStatType:function(t){var e=this;this.statType=t;var a=this.statModal.control[t];for(var s in this.statModal.control)this.statModal.control[s].checked=!1;if(a.checked=!0,this.statModal.currentControl=t,"general"!=t){var i="",n="";this.statDate.length&&(i=this.statDate[0],n=this.statDate[1]),h.a.getSignStatByType(this.sign.id,a.type,i,n,function(t,s){return t?e.$toast(e.i18n.error.networkError):s.state?void(a.data=s.data.map(function(t){var a={overview:{total:t.overview.count,done:t.overview.countSign,manual:t.overview.countManualEntry,todo:t.overview.countNotSinIn},title:t.title,sort:t.sort};return a.widthData=e.getSignOptionWidth(a.overview),a})):e.$toast(s.message)})}else this.showStat()},fullscreen:function(){var t=this;this.qrcode.oldInstance=this.qrcode.instance,this.qrcode.fullscreen=!0,this.$nextTick(function(){t.sign.needOut?t.$parent.isAgent?t.qrcode.instance=new f.a("needOut-sign-qrcode-isAgent-fullscreen",{text:t.qrcode.url,width:400,height:400}):t.$parent.isPerson?t.qrcode.instance=new f.a("needOut-sign-qrcode-isPerson-fullscreen",{text:t.qrcode.url,width:400,height:400}):t.qrcode.instance=new f.a("needOut-sign-qrcode-fullscreen",{text:t.qrcode.url,width:400,height:400}):t.qrcode.instance=new f.a("sign-qrcode-fullscreen",{text:t.qrcode.url,width:400,height:400})}),this.sign.needOut&&(this.getHasSignList(),this.setInterFun=setInterval(function(){t.getHasSignList()},5e3))},getHasSignList:function(){var t=this,e=this.tableUrl;"signIn"===this.signTabVal?e+="&signInStatus=SIGN_IN":e+="&signOutStatus=SIGN_OUT",Object(u.d)(e).then(function(e){if(t.oldHasSignList&&(e.data.length||t.oldHasSignList.length)){var a=e.data.filter(function(e,a,s){return-1===t.oldHasSignList.indexOf(e.userNo)}),s="signIn"===t.signTabVal?"签到成功!":"签退成功!",i=0,n=t;a.length&&function t(){var e=a[i];n.$notify({title:"提示",message:e.college+e.name+s}),(i+=1)<a.length&&setTimeout(t,1e3)}()}t.oldHasSignList=e.data.map(function(t){return t.userNo})})},existFullscreen:function(){this.setInterFun&&(clearInterval(this.setInterFun),this.setInterFun=null,this.oldHasSignList=null),this.clearQrcodeInstance(),this.qrcode.instance.clear(),this.qrcode.fullscreen=!1,this.qrcode.instance=this.qrcode.oldInstance},clearQrcodeInstance:function(){for(var t=this.qrcode.instance._el;t.hasChildNodes();)t.removeChild(t.lastChild)},initManagedColleges:function(t){var e=this;h.a.getBaseSearchOptions(function(a,s){if(a)return e.$toast(e.i18n.error.networkError);if(!s.state)return e.$toast(s.message);var i=!0,n=!1,o=void 0;try{for(var r,d=l()(s.data);!(i=(r=d.next()).done);i=!0){var c=r.value;-1==c.id&&(c.id="")}}catch(a){n=!0,o=a}finally{try{!i&&d.return&&d.return()}finally{if(n)throw o}}e.searchOptions.managedColleges=s.data,e.searchOptions.colleges=e.searchOptions.managedColleges,t&&t()})},initProxies:function(){var t=this;h.a.getMyProxies(this.sign.id,function(e,a){if(e)return t.$toast(t.i18n.error.networkError);if(!a.state)return t.$toast(a.message);if(!a.data)return t.$toast(t.i18n.error.dataError);var s=[],i=[],n=[],o=[],r=!1,d=!1,c=!1,u=!1,h=!0,g=!1,p=void 0;try{for(var m,f=l()(a.data);!(h=(m=f.next()).done);h=!0){var v=m.value;switch(v.distribution){case M:s.push(t.createMixProxy(M,v.agentId,v.agentName,v.agentName,null,null)),r=!0;break;case C:for(var y in v.colleges)i.push(t.createMixProxy(C,v.agentId,v.agentName,v.colleges[y],null,y));d=!0;break;case D:for(var b in v.clazz)n.push(t.createMixProxy(D,v.agentId,v.agentName,v.clazz[b],b,null));c=!0;break;case N:o.push(t.createMixProxy(N,v.agentId,v.agentName,v.agentName,null,null)),u=!0}}}catch(e){g=!0,p=e}finally{try{!h&&f.return&&f.return()}finally{if(g)throw p}}t.proxy.proxies=s.concat(i.concat(n.concat(o))),t.setCurrentProxy(t.proxy.proxies[0]),t.$nextTick(function(){t.initQrcode()}),t.statModal.control.college.show=!1,t.statModal.control.instructor.show=!1,t.statModal.control.clazz.show=!1,r?(t.statModal.control.college.show=!0,t.statModal.control.instructor.show=!0,t.statModal.control.clazz.show=!0):d?(t.statModal.control.college.show=!0,t.statModal.control.clazz.show=!0):(u||c)&&(t.statModal.control.clazz.show=!0)})},setCurrentProxy:function(t){this.proxy.id=t.id,this.proxy.proxyId=t.proxyId,this.proxy.name=t.name,this.proxy.collegeCode=t.collegeCode,this.proxy.classId=t.classId,this.proxy.distributary=t.distributary,t.distributary===C?this.searchOptions.colleges=[{id:t.collegeCode,text:t.name}]:this.searchOptions.colleges=this.searchOptions.managedColleges,this.tableParams.ts=(new Date).getTime()},createMixProxy:function(t,e,a,s,i,n){return{id:t+"-"+e+"-"+(i||"__")+"-"+(n||"__"),proxyId:e,distributary:t,proxyName:a,name:s,classId:i||"",collegeCode:n||""}},signManual:function(){var t=this;if(!this.signManualModal.remark)return this.$toast("您还未填写备注");var e={createDate:this.signManualModal.createDate,signId:this.sign.id,userId:this.signManualModal.userId,remark:this.signManualModal.remark,callback:function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast(t.i18n.tip.setSuccess),t.tableParams.ts=(new Date).getTime(),void(t.signManualModal.show=!1)):t.$toast(a.message)}};h.a.signManual(e)},checkUser:function(){var t=this;if(!this.addPersonModal.userNo)return this.$toast("请输入学号");this.addPersonModal.userId=null,this.addPersonModal.tip="检测中...",h.a.checkUserNo(this.addPersonModal.userNo,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.addPersonModal.userId=a.data.userId,void(t.addPersonModal.userName=t.addPersonModal.tip=a.data.name)):"50001"==a.code?t.addPersonModal.tip="不存在该学号":t.$toast(a.message)})},afterSelectAddPerson:function(t){this.addPersonModal.userId=t.userId,this.addPersonModal.userNo=t.userNo,this.addPersonModal.name=t.name},cancelAddSignPeople:function(){this.addPersonModal.show=!1},addSignPeople:function(){var t=this;if(!this.addPersonModal.userId)return this.$toast("请输入学号或者姓名!");if(this.sign.needOut){var e="api/ca/signIn/"+this.addPersonModal.userId+"/"+this.sign.id;return this.sign.isAgent&&(e="api/ca/signIn/agent/"+this.addPersonModal.userId+"/"+this.sign.id),void Object(u.d)(e,{},"post").then(function(e){e.state?(t.$toast("添加成功"),t.tableParams.ts=+new Date,t.addPersonModal.show=!1):t.$toast(e.message)})}h.a.addSignPeople(this.project.id,this.sign.id,this.addPersonModal.userId,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast("添加成功"),t.tableParams.ts=+new Date,void(t.addPersonModal.show=!1)):"50003"==a.code?t.$toast("该人员已经在签到名单中"):t.$toast(a.message)})},createSignUrl:function(t){var e=this;this.sign.needOut?Object(u.d)("api/ca/system/saasId").then(function(a){var s="default";a.state&&(s=a.data);var i=window.location.origin+"/mobileTowCodeSign?isSign=true&signId="+e.sign.id+"&signTabVal="+e.signTabVal+"&timestamp="+(new Date).getTime()+"&sysId="+s;t(i)}):h.a.createSignUrl(this.sign.id,this.proxy.distributary,this.proxy.collegeCode,this.proxy.classId,this.qrCodeExpireTime,function(a,s){if(a)return t(),e.$toast(e.i18n.error.networkError);if(!s.state)return t(),e.$toast(s.message);var i=window.location.origin+s.data+"?scope=yiban_scan_result";t(i)})},getOutText:function(){var t=this;if(this.formFields.length)return!1;Object(u.e)({url:"/api/signIns/peoples/export/fields",type:"get",success:function(e){if(e.state)for(var a in e.data)t.formFields.push({fieldName:a,fieldTitle:e.data[a]});else t.formFields=[]}})},exportSigns:function(){var t=this.$refs["sign-table"].tableSearchFields||{};if(this.sign.needOut){var e=(new Date).format("yyyy-MM-dd")+this.sign.name;"signIn"===this.signTabVal?e+="签到列表":e+="签退列表";var a="/downloads/ca/signIn/person/export/"+this.signTabVal+"/"+this.sign.id+"?filename="+e+"&";for(var s in this.sign.isAgent&&(a="/downloads/ca/signIn/agent/person/export/"+this.signTabVal+"/"+this.sign.id+"?filename="+e+"&"),t)a+=s+"="+t[s]+"&";return a=a.substring(0,a.length-1),void(window.location.href=a)}if(this.isManager)this.getOutText(),this.outputModalShow=!0;else{var i=this.project.name+this.sign.name+".xlsx";h.a.exportSignsOfProxy(this.sign.id,this.proxy.proxyId,t.name,t.userNo,this.proxy.collegeCode||t.college,this.proxy.classId,t.signInStatus,i,this.dateArea)}}}},"beforeDestroy",function(){this.stopQrcodeTimer()}),O={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{directives:[{name:"show",rawName:"v-show",value:t.qrcode.fullscreen,expression:"qrcode.fullscreen"}],attrs:{id:"qrcode-fullscreen"}},[s("v-icon",{attrs:{name:"close"},nativeOn:{click:function(e){return t.existFullscreen(e)}}}),t._v(" "),s("div",{staticClass:"qrcode-container"},[s("div",{attrs:{id:"sign-qrcode-name"}},[t._v(t._s(t.sign.name))]),t._v(" "),t.sign.useDynamicCode?s("div",{attrs:{id:"sign-qrcode-type"}},[t._v("动态码(刷新间隔10s)")]):t._e(),t._v(" "),t.editSignModal.needOut&&t.$parent.isAgent?s("div",{attrs:{id:"needOut-sign-qrcode-isAgent-fullscreen"}}):t.editSignModal.needOut&&t.$parent.isPerson?s("div",{attrs:{id:"needOut-sign-qrcode-isPerson-fullscreen"}}):t.editSignModal.needOut?s("div",{attrs:{id:"needOut-sign-qrcode-fullscreen"}}):s("div",{attrs:{id:"sign-qrcode-fullscreen"}}),t._v(" "),s("div",{attrs:{id:"sign-qrcode-time"}},[t._v(t._s(t.sign.startTime+" ~ "+t.sign.endTime))])])],1),t._v(" "),s("a",{staticClass:"box_flex align_center back_wrap",attrs:{type:"button"}},[s("i",{staticClass:"maticon back-icon-btn",domProps:{innerHTML:t._s(t.icons("arrow_back"))},on:{click:t.back}},[t._v("arrow_back")]),t._v(" "),s("span",{staticClass:"nav-title",on:{click:t.back}},[t._v(t._s(t.isProxy?t.sign.name:"返回"))])]),t._v(" "),s("div",{attrs:{id:"sign-info"}},[t.sign.needOut?s("div",{staticClass:"tab-div"},t._l(t.tabList,function(e,a){return s("div",{key:a,staticClass:"tab",class:t.signTabVal===e.id?"active":"",attrs:{title:e.name},on:{click:function(a){t.signTabVal=e.id}}},[t._v(t._s(e.name))])}),0):t._e(),t._v(" "),s("div",{staticClass:"box_flex",staticStyle:{"align-items":"stretch","margin-left":"-15px"}},[s("div",{staticClass:"col-md-9"},[s("v-table",{ref:"sign-table",attrs:{title:t.isManager?t.sign.name:"",url:t.tableUrl,pagesize:t.tableParams.pagesize,idField:t.tableParams.idField,columns:t.tableParams.columns,multiple:t.tableParams.multi,order:t.tableParams.order,search:t.tableParams.search}},[s("div",{attrs:{slot:"btn-group",role:"group"},slot:"btn-group"},[t.isProxy?s("div",{staticClass:"btn-group college-select pull-left"},[s("v-select",{attrs:{options:this.proxy.proxies,value:this.proxy.id,"options-value":"id","options-label":"name",required:!0,"close-on-select":"",justify:""},on:{afterSelected:t.changeProxy}})],1):t._e(),t._v(" "),"single"==t.sign.checkInType||t.editSignModal.needOut?t._e():s("div",{staticClass:"dateSelect pull-left"},[s("el-date-picker",{staticStyle:{width:"80%"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},on:{change:t.dateChange},model:{value:t.dateArea,callback:function(e){t.dateArea=e},expression:"dateArea"}})],1),t._v(" "),s("div",{staticClass:"pull-right"},[s("button",{staticClass:"btn btn-bgColor-style edit-btn",attrs:{type:"button"},on:{click:t.goToSendMessage}},[t._v("通知")]),t._v(" "),s("button",{staticClass:"btn btn-bgColor-style edit-btn",class:{disabled:t.exporting},attrs:{type:"button"},domProps:{innerHTML:t._s(t.exporting?t.loader.small+"导出中":t.i18n.export)},on:{click:t.exportSigns}}),t._v(" "),t.isManager?s("button",{staticClass:"btn btn-bgColor-style edit-btn",attrs:{type:"button"},on:{click:function(e){t.showAddModal=!0}}},[t._v(t._s(t.i18n.signInfo.editPeople))]):t._e(),t._v(" "),t.sign.needOut?t._e():s("button",{staticClass:"btn btn-bgColor-style stat-btn",attrs:{type:"button"},on:{click:t.showStat}},[s("v-icon",{staticClass:"pull-left",attrs:{name:"donut_large"}}),t._v("\n                "+t._s(t.i18n.signInfo.stat)+"\n              ")],1)])])])],1),t._v(" "),s("div",{class:["col-md-3","sign-detail","week"==t.sign.frequency?"over":""]},[s("div",{staticClass:"sign-detail-div"},[t.editSignModal.needOut?s("div",{staticClass:"info-row"},[s("span",{staticClass:"title"},[t._v("二维码")]),t._v(" "),s("img",{staticClass:"tow_code",attrs:{src:a("EBaK"),alt:""},on:{click:t.fullscreen}})]):t._e(),t._v(" "),s("div",{staticClass:"info-row"},[s("span",{staticClass:"title"},[t._v(t._s(t.editSignModal.name))]),t._v(" "),"PROXY"!==t.userType?s("v-icon",{staticClass:"edit",attrs:{name:"edit"},nativeOn:{click:function(e){return t.toEditSign(e)}}}):t._e()],1),t._v(" "),s("div",{staticClass:"info-row",staticStyle:{display:"flex"}},[s("span",{staticClass:"title"},[t._v(t._s("single"==t.sign.checkInType?t.i18n.signInfo.start:"开始日期"))]),t._v(" "),"single"==t.sign.checkInType?s("div",[s("span",{staticClass:"time"},[t._v(t._s(t.editSignModal.startTime))])]):"loop"==t.sign.checkInType?s("div",["day"==t.sign.frequency?s("span",{staticClass:"time"},[t._v(t._s(t.editSignModal.startTime.split(" ")[0]))]):t._e(),t._v(" "),"week"==t.sign.frequency?s("span",{staticClass:"time"},[t._v(t._s(t.editSignModal.startTime.split(" ")[0]))]):t._e()]):s("span",{staticClass:"time"},[t._v(t._s(t.editSignModal.startTime))])]),t._v(" "),s("div",{staticClass:"info-row",staticStyle:{display:"flex"}},[s("span",{staticClass:"title"},[t._v(t._s("single"==t.sign.checkInType?t.i18n.signInfo.end:"结束日期"))]),t._v(" "),"single"==t.sign.checkInType?s("div",[s("span",{staticClass:"time"},[t._v(t._s(t.editSignModal.endTime))])]):"loop"==t.sign.checkInType?s("div",["day"==t.sign.frequency?s("span",{staticClass:"time"},[t._v(t._s(t.editSignModal.endTime.split(" ")[0]))]):t._e(),t._v(" "),"week"==t.sign.frequency?s("span",{staticClass:"time"},[t._v(t._s(t.editSignModal.endTime.split(" ")[0]))]):t._e()]):s("span",{staticClass:"time"},[t._v(t._s(t.editSignModal.endTime))])]),t._v(" "),"loop"==t.sign.checkInType&&"day"==t.sign.frequency?[s("div",{staticClass:"weekDay"},[s("p",{staticClass:"info-row"},[s("i",[t._v("签到开始时间")]),t._v(" "),s("em",[t._v(t._s(t.editSignModal.hourStart?t.editSignModal.hourStart.substring(0,8):""))])]),t._v(" "),s("p",{staticClass:"info-row",staticStyle:{"border-bottom":"1px solid #e0e0e0"}},[s("i",[t._v("签到结束时间")]),t._v(" "),s("em",[t._v(t._s(t.editSignModal.hourEnd?t.editSignModal.hourEnd.substring(0,8):""))])])])]:t._e(),t._v(" "),"loop"==t.sign.checkInType&&"week"==t.sign.frequency?t._l(t.editSignModal.weekDayList,function(e,a){return s("div",{key:a,staticClass:"weekDay"},[s("span",[t._v(t._s(e.date))]),t._v(" "),s("p",{staticClass:"info-row"},[s("i",[t._v("签到开始时间")]),t._v(" "),s("em",[t._v(t._s(e.startTime))])]),t._v(" "),s("p",{staticClass:"info-row",staticStyle:{"border-bottom":"1px solid #e0e0e0"}},[s("i",[t._v("签到结束时间")]),t._v(" "),s("em",[t._v(t._s(e.endTime))])])])}):t._e(),t._v(" "),t.editSignModal.needOut?s("div",[s("div",{staticClass:"info-row"},[s("div",{staticClass:"switch",class:{on:t.editSignModal.isSignOut,readonly:!0}},[s("span",{staticClass:"label"},[t._v("需要签退")]),t._v(" "),t._m(0)])]),t._v(" "),t.editSignModal.isSignOut?s("div",{staticClass:"info-row"},[s("span",{staticClass:"title"},[t._v("签退开始时间")]),t._v(" "),s("span",{staticClass:"time"},[t._v(t._s(t.editSignModal.signOutTimeStart))])]):t._e(),t._v(" "),t.editSignModal.isSignOut?s("div",{staticClass:"info-row"},[s("span",{staticClass:"title"},[t._v("签退结束时间")]),t._v(" "),s("span",{staticClass:"time"},[t._v(t._s(t.editSignModal.signOutTimeEnd))])]):t._e()]):t._e(),t._v(" "),s("div",{staticClass:"info-row"},[s("span",{staticClass:"title"},[t._v("签到方式")]),t._v(" "),s("span",{staticClass:"time"},[t._v(t._s(t.signWayText[t.editSignModal.signWay]))])]),t._v(" "),"qrcode"===t.editSignModal.signWay?s("div",{staticClass:"info-row"},[s("div",{staticClass:"switch",class:{on:t.editSignModal.useDynamicCode,readonly:!0}},[s("span",{staticClass:"label"},[t._v(t._s(t.i18n.useDynamicCode))]),t._v(" "),t._m(1)])]):t._e(),t._v(" "),"qrcode"===t.editSignModal.signWay?s("div",{staticClass:"info-row"},[s("div",{staticClass:"switch",class:{on:t.editSignModal.scanQrcodeWithLocation,readonly:!0}},[s("span",{staticClass:"label"},[t._v("扫码定位限制")]),t._v(" "),t._m(2)])]):t._e(),t._v(" "),"qrcode"===t.editSignModal.signWay&&t.editSignModal.scanQrcodeWithLocation?s("div",{staticClass:"info-row auto-height"},[s("span",{staticClass:"title"},[t._v("地点")]),t._v(" "),s("div",{staticClass:"list"},t._l(t.editSignModal.qrcodeLocations,function(e,a){return s("div",{key:a,staticClass:"item"},[t._v(t._s(e.address+" 范围："+e.radius+"米"))])}),0)]):t._e(),t._v(" "),"location"===t.editSignModal.signWay?s("div",{staticClass:"info-row auto-height"},[s("span",{staticClass:"title"},[t._v("地点")]),t._v(" "),s("div",{staticClass:"list"},t._l(t.editSignModal.locations,function(e,a){return s("div",{key:a,staticClass:"item"},[t._v(t._s(e.address+" 范围："+e.radius+"米"))])}),0)]):t._e(),t._v(" "),"qrcode"!==t.editSignModal.signWay||t.editSignModal.needOut?t._e():s("div",{staticClass:"qr-code-container"},[s("div",{staticClass:"qr-code"},[s("v-icon",{attrs:{name:"zoom_out_map"},nativeOn:{click:function(e){return t.fullscreen(e)}}}),t._v(" "),s("div",{attrs:{id:"sign-qrcode"}})],1)])],2)])]),t._v(" "),s("v-modal",{attrs:{show:t.addPersonModal.show,effect:"fade",width:"400"}},[s("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[s("h5",{staticClass:"modal-title"},[t._v(t._s(t.i18n.signInfo.editPeople))])]),t._v(" "),s("div",{staticClass:"modal-body container-fluid",staticStyle:{overflow:"inherit"},attrs:{slot:"modal-body"},slot:"modal-body"},[t.editSignModal.needOut&&"PROXY"===t.userType?s("div",{staticClass:"form-group"},[s("detect",{attrs:{url:"api/ca/users/agent/students/searchResults",placeholder:t.请输入学号或者姓名},on:{afterSelected:t.afterSelectAddPerson}})],1):t.editSignModal.needOut?s("div",{staticClass:"form-group"},[s("detect",{ref:"searchVal",attrs:{url:"api/ca/users/students/searchResults",placeholder:t.请输入学号或者姓名},on:{afterSelected:t.afterSelectAddPerson}})],1):s("div",{staticClass:"form-group"},[s("detect",{ref:"searchVal",attrs:{url:"/api/users/check/searchResults",placeholder:t.请输入学号或者姓名},on:{afterSelected:t.afterSelectAddPerson}})],1)]),t._v(" "),s("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[s("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.cancelAddSignPeople}},[t._v(t._s(t.i18n.cancel))]),t._v(" "),s("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.addSignPeople}},[t._v(t._s(t.i18n.sure))])])]),t._v(" "),s("v-modal",{attrs:{show:t.showAdviceModal,effect:"fade",width:"520"}},[s("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[s("h5",{staticClass:"modal-title"},[t._v("通知")])]),t._v(" "),s("div",{staticClass:"modal-body form-wrap advice-modal",attrs:{slot:"modal-body"},slot:"modal-body"},[s("div",{staticClass:"form-group box_flex"},[s("div",{staticClass:"label require"},[s("span",[t._v("通知发送时间:")])]),t._v(" "),s("v-select",{attrs:{options:t.sendTimeTypeList,"options-value":"value","options-label":"label","close-on-select":"",justify:""},model:{value:t.adviceParams.sendTimeType,callback:function(e){t.$set(t.adviceParams,"sendTimeType",e)},expression:"adviceParams.sendTimeType"}})],1),t._v(" "),"TIMING"===t.adviceParams.sendTimeType?s("div",{staticClass:"form-group box_flex"},[s("div",{staticClass:"label require"},[s("span",[t._v("发送时间:")])]),t._v(" "),s("v-datepicker",{staticClass:"btn-block time-picker",attrs:{format:"yyyy-MM-dd hh:ii:ss",placeholder:"请选择发送时间",clearButton:!1},on:{daySelected:t.sendTimeSelected},model:{value:t.adviceParams.sendTime,callback:function(e){t.$set(t.adviceParams,"sendTime",e)},expression:"adviceParams.sendTime"}})],1):t._e(),t._v(" "),s("div",{staticClass:"form-group box_flex"},[s("div",{staticClass:"label require"},[s("span",[t._v("消息内容:")])]),t._v(" "),s("v-textarea",{staticStyle:{height:"88px"},attrs:{lineHeight:"22",placeholder:"请输入消息内容",rows:"6",maxlength:"255"},model:{value:t.adviceParams.content,callback:function(e){t.$set(t.adviceParams,"content",e)},expression:"adviceParams.content"}})],1),t._v(" "),s("div",{staticClass:"form-group box_flex"},[s("div",{staticClass:"label require"},[s("span",[t._v("发送对象:")])]),t._v(" "),s("v-select",{attrs:{options:t.messageToTargetList,"options-value":"value","options-label":"label","close-on-select":"",justify:""},model:{value:t.adviceParams.messageToTarget,callback:function(e){t.$set(t.adviceParams,"messageToTarget",e)},expression:"adviceParams.messageToTarget"}})],1)]),t._v(" "),s("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[s("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.showAdviceModal=!1}}},[t._v("取消")]),t._v(" "),s("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){return t.sendMessage()}}},[t._v("发送")])])]),t._v(" "),s("v-modal",{attrs:{show:t.showAddModal,effect:"fade",width:"420"}},[s("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[s("h5",{staticClass:"modal-title"},[t._v("新增签到人员")])]),t._v(" "),s("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[s("button",{staticClass:"btn submit-btn clearBtnBorder",staticStyle:{width:"380px","text-align":"center"},attrs:{type:"button"},on:{click:t.addPersonByOne}},[t._v("单条增加")]),t._v(" "),t.editSignModal.needOut?s("button",{staticClass:"btn submit-btn clearBtnBorder",staticStyle:{width:"380px","text-align":"center","margin-top":"20px"},attrs:{type:"button"},on:{click:function(e){return t.batchAddPerson()}}},[t._v("批量导入")]):t._e()]),t._v(" "),s("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[s("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.showAddModal=!1}}},[t._v("取消")])])]),t._v(" "),s("v-modal",{attrs:{show:t.signManualModal.show,effect:"fade",width:"400"}},[s("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[s("h5",{staticClass:"modal-title"},[t._v(t._s(t.i18n.signInfo.recordByHand))])]),t._v(" "),s("div",{staticClass:"modal-body container-fluid",attrs:{slot:"modal-body"},slot:"modal-body"},[s("div",{staticClass:"form-group"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.signManualModal.remark,expression:"signManualModal.remark"},{name:"focus",rawName:"v-focus"}],staticClass:"form-control modal-input",attrs:{type:"text",maxlength:"100",placeholder:t.i18n.signInfo.recordByHandPlaceholder},domProps:{value:t.signManualModal.remark},on:{input:function(e){e.target.composing||t.$set(t.signManualModal,"remark",e.target.value)}}})]),t._v(" "),s("div",{staticClass:"form-group"})]),t._v(" "),s("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[s("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.signManualModal.show=!1}}},[t._v(t._s(t.i18n.cancel))]),t._v(" "),s("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.signManual}},[t._v(t._s(t.i18n.sure))])])]),t._v(" "),s("v-modal",{attrs:{id:"stat-modal",show:t.statModal.show,effect:"fade",width:"900"}},[s("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[s("h5",{staticClass:"modal-title"},[s("v-icon",{attrs:{name:"close"},nativeOn:{click:function(e){t.statModal.show=!1}}}),t._v(" "),s("span",[t._v(t._s(t.i18n.signInfo.stat))]),t._v(" "),s("el-date-picker",{staticStyle:{width:"50%"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},on:{change:t.statDateChange},model:{value:t.statDate,callback:function(e){t.statDate=e},expression:"statDate"}})],1)]),t._v(" "),s("div",{staticClass:"modal-body container-fluid",attrs:{slot:"modal-body"},slot:"modal-body"},[t.statModal.loading?s("div",{staticClass:"loader",domProps:{innerHTML:t._s(t.loader.iconWithText)}}):t.statModal.noStat?s("div",{staticClass:"loader"},[t._v("暂无统计数据")]):s("div",{staticStyle:{display:"inline-block"}},[s("div",{attrs:{id:"stat-control"}},[s("ul",t._l(t.statModal.control,function(e,a){return e.show?s("li",{key:a,on:{click:function(e){return t.changeStatType(a)}}},[s("v-icon",{attrs:{name:t.getRadioIcon(e.checked)}}),t._v(" "),s("span",[t._v(t._s(e.text))])],1):t._e()}),0)]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:"general"===t.statModal.currentControl,expression:"statModal.currentControl === 'general'"}]},[s("div",{attrs:{id:"general-chart-text"}},[s("ul",t._l(t.statModal.generalChart.legend,function(e,a){return s("li",{key:a},[s("span",{staticClass:"color",style:{background:e.color}}),t._v(" "),s("span",{staticClass:"text"},[t._v(t._s(e.text))]),t._v(" "),s("span",{staticClass:"num"},[t._v(t._s(e.num))])])}),0)]),t._v(" "),s("div",{attrs:{id:"general-chart"}})]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:"general"!==t.statModal.currentControl,expression:"statModal.currentControl !== 'general'"}]},[s("div",{attrs:{id:"bar-chart"}},t._l(t.statModal.control,function(e,a){return"manage"!=a&&e.checked?s("ul",{key:a,staticClass:"items"},t._l(e.data,function(e){return s("li",{key:e.title,staticClass:"item"},[s("div",{staticClass:"title",attrs:{title:e.title}},[t._v(t._s(e.title))]),t._v(" "),s("div",{staticClass:"bar"},[s("ul",{staticClass:"bar-chart"},[s("li",{staticClass:"part bar-done",style:{width:e.widthData.done+"px"},attrs:{title:"已签到:"+e.overview.done}}),t._v(" "),s("li",{staticClass:"part bar-manual",style:{width:e.widthData.manual+"px"},attrs:{title:"手工签到:"+e.overview.manual}}),t._v(" "),s("li",{staticClass:"part bar-todo",style:{width:e.widthData.todo+"px"},attrs:{title:"未签到:"+e.overview.todo}})]),t._v(" "),s("ul",{staticClass:"bar-tip"},[s("li",{staticClass:"text",style:{width:e.widthData.done+"px"}},[t._v(t._s(e.widthData.done>36?"已签到 "+e.overview.done:""))]),t._v(" "),s("li",{staticClass:"text",style:{width:e.widthData.manual+"px"}},[t._v(t._s(e.widthData.manual>36?"手工签到 "+e.overview.manual:""))]),t._v(" "),s("li",{staticClass:"text",style:{width:e.widthData.todo+"px"}},[t._v(t._s(e.widthData.todo>36?"未签到 "+e.overview.todo:""))])])])])}),0):t._e()}),0)]),t._v(" "),s("div",{attrs:{id:"stat-sync-time"}},[t._v("以上数据统计截止至："+t._s(t.statModal.syncTime))])])])]),t._v(" "),s("sign-info-modal",{attrs:{title:"编辑签到",weekDay:t.sign.weekDay,frequency:t.sign.frequency,checkInType:t.sign.checkInType,signInfo:t.editSignModal,i18n:t.i18n},on:{editMethod:t.editMethod,confirm:t.saveSign}}),t._v(" "),s("v-modal",{attrs:{show:t.outputModalShow,effect:"fade",width:"550"}},[s("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[s("h5",{staticClass:"modal-title"},[t._v("导出——字段选择")])]),t._v(" "),s("div",{staticClass:"modal-body export-modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[s("div",{staticClass:"loopTitle"},[s("h1",[t._v("选择导出时间范围")]),t._v(" "),"single"!=t.sign.checkInType?s("div",[s("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},on:{change:t.dateChange},model:{value:t.dateArea,callback:function(e){t.dateArea=e},expression:"dateArea"}})],1):t._e()]),t._v(" "),s("ul",{staticClass:"list-group outPut"},t._l(t.formFields,function(e,a){return s("li",{key:a,staticClass:"list-group-item field-item",class:t.outputList.indexOf(e.fieldName)<0?"":"output-active",on:{click:function(a){return t._changeOutputList(e)}}},[t.outputList.indexOf(e.fieldName)<0?s("i",{staticClass:"maticon",domProps:{innerHTML:t._s(t.icons("check_box_outline_blank"))}},[t._v("check_box_outline_blank")]):s("i",{staticClass:"maticon",domProps:{innerHTML:t._s(t.icons("check_box"))}},[t._v("check_box")]),t._v(" "),s("span",[t._v(t._s(e.fieldTitle))])])}),0)]),t._v(" "),s("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[s("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.outputModalShow=!1,t.outputList=[]}}},[t._v("取消")]),t._v(" "),s("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t._sureToOutput}},[t._v("确定")])])]),t._v(" "),s("v-modal",{staticClass:"img_modal",attrs:{show:t.showImgDetailStatus,backdrop:"true"},on:{onHide:function(e){t.showImgDetailStatus=!1}}},[s("div",{staticClass:"modal-body box_flex flex_center",style:{transform:"scale("+t.deleteImgWidth+")"},attrs:{slot:"modal-body"},on:{click:function(e){t.showImgDetailStatus=!1}},slot:"modal-body"},[s("img",{staticStyle:{width:"100%",height:"350px"},attrs:{id:"detailImg",src:t.imgDetailSrc,alt:""}})])]),t._v(" "),s("v-modal",{attrs:{show:t.showAddressModal,backdrop:"true"},on:{onHide:function(e){t.showAddressModal=!1}}},[s("div",{staticClass:"modal-body box_flex flex_center",staticStyle:{width:"600px",height:"400px"},attrs:{slot:"modal-body"},slot:"modal-body"},[t.addressRecord.lat?s("v-map",{attrs:{showPosition:!0,center:t.addressRecord}}):t._e()],1)])],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"slider"},[e("div",{staticClass:"pipe"}),this._v(" "),e("div",{staticClass:"head"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"slider"},[e("div",{staticClass:"pipe"}),this._v(" "),e("div",{staticClass:"head"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"slider"},[e("div",{staticClass:"pipe"}),this._v(" "),e("div",{staticClass:"head"})])}]};var L=a("C7Lr")(k,O,!1,function(t){a("tgYt"),a("qvNH")},null,null);e.a=L.exports},zKJS:function(t,e,a){"use strict";var s=a("HzJ8"),i=a.n(s),n=a("3cXf"),o=a.n(n),r=a("aA9S"),l=a.n(r),d=(a("kV13"),a("HJbL")),c=a("FEOm"),u=(d.a,c.a,String,String,Object,Object,String,Array,String,{components:{VIcon:d.a,Locations:c.a},props:{weekDay:String,checkInType:String,i18n:Object,signInfo:Object,title:String,locations:{type:Array,default:function(){return[]}},frequency:String},watch:{signInfo:function(t){this.signData=t,this.signData.signWays?"loop"===this.checkInType&&(this.signData.signWays={qrcode:"qrcode",location:"location",outside:"outside"}):"loop"==this.checkInType?this.signData.signWays={qrcode:"qrcode",location:"location",outside:"outside"}:this.signData.signWays={qrcode:"qrcode",location:"location"},this.formatDateArea()},dateArea:function(t,e){var a=this;this.noWatchDateArea?setTimeout(function(){a.noWatchDateArea=!1},100):t&&(new Date(t[0])<new Date?(this.$toast("选择失败！只能选择当前时间之后的签到时间！"),this.noWatchDateArea=!0,this.dateArea=e):new Date(t[0]).format("yyyy-MM-dd")!==new Date(t[1]).format("yyyy-MM-dd")?(this.$toast("签到开始与结束时间需要在同一天"),this.noWatchDateArea=!0,this.dateArea=e):(this.signData.startTime=t[0],this.signData.endTime=t[1]))},dateArea2:function(t,e){this.noWatchDateArea?this.noWatchDateArea=!1:t&&(new Date(t[0])<new Date?(this.$toast("选择失败！只能选择当前时间之后的签退时间！"),this.noWatchDateArea=!0,this.dateArea2=e):new Date(t[0]).format("yyyy-MM-dd")!==new Date(t[1]).format("yyyy-MM-dd")?(this.$toast("签退开始与结束时间需要在同一天"),this.noWatchDateArea=!0,this.dateArea2=e):(this.signData.signOutTimeStart=t[0],this.signData.signOutTimeEnd=t[1]))}},data:function(){return{weeklyDate:[],selectWeekDay:[],isChecked:!1,signDataBak:null,signData:{},dateArea:["",""],dateArea2:["",""],typeList:[{text:"每日签到",id:"day"},{text:"每周签到",id:"week"}],selectType:"day",pickOptions:{disabledDate:function(t){return t.getTime()+864e5<Date.now()}}}},created:function(){this.frequency&&(this.selectType=this.frequency),this.weeklyDate=[];for(var t=0;t<7;t++)this.weeklyDate.push({index:t,isChecked:!1,startHours:"",endHours:""});if(this.weekDay)for(var e=this.weekDay.split("&"),a=0;a<e.length;a++){var s=e[a].split(","),i=Number(s[0])-1;l()(this.weeklyDate[i],{index:i,isChecked:!0,startHours:s[1],endHours:s[2]})}this.signDataBak=JSON.parse(o()(this.signInfo)),this.signData=this.signInfo,"day"==this.frequency&&(this.signData.startTimeToHours=this.signInfo.hourStart,this.signData.endTimeToHours=this.signInfo.hourEnd),this.signData.signWays||("loop"==this.checkInType?this.signData.signWays={qrcode:"qrcode",location:"location",outside:"outside"}:this.signData.signWays={qrcode:"qrcode",location:"location"}),this.formatDateArea()},computed:{},methods:{checkboxChange:function(){},dateChange_day:function(t,e){"start"==e?2==this.signData.startTimeToHours.split(":").length&&(this.signData.startTimeToHours=t+":00"):2==this.signData.endTimeToHours.split(":").length&&(this.signData.endTimeToHours=t+":00")},dateChange:function(t,e){this.weeklyDate[e].startHours&&2==this.weeklyDate[e].startHours.split(":").length&&(this.weeklyDate[e].startHours=t+":00")},dateChange_end:function(t,e){this.weeklyDate[e].endHours&&2==this.weeklyDate[e].endHours.split(":").length&&(this.weeklyDate[e].endHours=t+":00")},dateToCn:function(t){switch(t){case 0:return"星期一";case 1:return"星期二";case 2:return"星期三";case 3:return"星期四";case 4:return"星期五";case 5:return"星期六";case 6:return"星期日"}},formatDateArea:function(){this.noWatchDateArea=!0,this.dateArea=["",""],this.dateArea2=["",""],this.signData.startTime&&(this.dateArea=[this.signData.startTime,this.signData.endTime]),this.signData.signOutTimeStart&&(this.dateArea2=[this.signData.signOutTimeStart,this.signData.signOutTimeEnd])},beforeStartTimeStartSelect:function(t){if("single"===this.checkInType)return!0;if(new Date(t).getTime()>(new Date).getTime()-864e5){if(this.signData.endTime){if(new Date(t)>new Date(this.signData.endTime))return this.$toast(this.i18n.endTimeMustBeAfterStartTime),!1;if(new Date(t).format("yyyy-MM-dd")!==new Date(this.signData.endTime).format("yyyy-MM-dd"))return this.$toast("签到开始与结束时间需要在同一天"),!1}return!0}return this.$toast("选择失败！只能选择当前时间之后的签到时间！"),!1},beforeEndTimeStartSelect:function(t){return"single"===this.checkInType||(new Date(t).getTime()>(new Date).getTime()-864e5?!(this.signData.startTime&&new Date(this.signData.startTime)>new Date(t))||(this.$toast(this.i18n.endTimeMustBeAfterStartTime),!1):(this.$toast("选择失败！只能选择当前时间之后的签到时间！"),!1))},beforeOutTimeStartSelect:function(t){return new Date(t)>new Date?!(this.signData.signOutTimeEnd&&new Date(t)>new Date(this.signData.signOutTimeEnd))||(this.$toast(this.i18n.endTimeMustBeAfterStartTime),!1):(this.$toast("选择失败！只能选择当前时间之后的签退时间！"),!1)},beforeOutTimeEndSelect:function(t){if(new Date(t)>new Date){if(this.signData.signOutTimeStart){if(new Date(this.signData.signOutTimeStart)>new Date(t))return this.$toast(this.i18n.endTimeMustBeAfterStartTime),!1;if(new Date(this.signData.signOutTimeStart).format("yyyy-MM-dd")!==new Date(t).format("yyyy-MM-dd"))return this.$toast("签退开始与结束时间需要在同一天"),!1}return!0}return this.$toast("选择失败！只能选择当前时间之后的签退时间！"),!1},changeIsSignOut:function(){"signOut"!==this.$parent.signTabVal?(this.signData.isSignOut=!this.signData.isSignOut,this.$forceUpdate()):this.$toast("签退列表使用中,无法取消签退!")},setSignWay:function(t){this.signData.signWay=t},cancel:function(){l()(this.signData,this.signInfo),"loop"==this.checkInType&&"day"==this.frequency&&(this.signData.startTimeToHours=this.signInfo.hourStart,this.signData.endTimeToHours=this.signInfo.hourEnd),this.signData.show=!1},confirm:function(){if(!this.signData.startTime)return this.$toast(this.i18n.error.pleaseChooseStartTime);if(!this.signData.endTime)return this.$toast(this.i18n.error.pleaseChooseEndTime);if(this.signData.isSignOut){if(!this.signData.signOutTimeStart)return this.$toast("请选择签退开始时间!");if(!this.signData.signOutTimeEnd)return this.$toast("请选择签退结束时间!");if(this.signData.signOutTimeStart>this.signData.signOutTimeEnd)return this.$toast("签退结束时间必须在开始时间之后!");if(new Date(this.signData.signOutTimeStart).format("yyyy-MM-dd")!==new Date(this.signData.signOutTimeEnd).format("yyyy-MM-dd"))return void this.$toast("签到开始与结束时间需要在同一天")}if(!this.signData.name)return this.$toast(this.i18n.error.pleaseFillInSignName);if(this.signData.signWay===this.signData.signWays.qrcode&&this.signData.scanQrcodeWithLocation){if(!this.signData.qrcodeLocations.length)return this.$toast("请添加地点");var t=!0,e=!1,a=void 0;try{for(var s,n=i()(this.signData.qrcodeLocations);!(t=(s=n.next()).done);t=!0){if(!s.value.init)return this.$toast("请选择地图中的地点作为中心点")}}catch(t){e=!0,a=t}finally{try{!t&&n.return&&n.return()}finally{if(e)throw a}}}if(this.signData.signWay===this.signData.signWays.location){if(!this.signData.locations.length)return this.$toast("请添加地点");var o=!0,r=!1,l=void 0;try{for(var d,c=i()(this.signData.locations);!(o=(d=c.next()).done);o=!0){if(!d.value.address)return this.$toast("请选择地图中的地点作为中心点")}}catch(t){r=!0,l=t}finally{try{!o&&c.return&&c.return()}finally{if(r)throw l}}}if("week"==this.selectType){this.selectWeekDay=[];for(var u=0;u<this.weeklyDate.length;u++)if(this.weeklyDate[u].isChecked){if(""==this.weeklyDate[u].startHours||""==this.weeklyDate[u].endHours)return this.$toast("请选择时间");var h=void 0,g=void 0;h=2==this.weeklyDate[u].startHours.split(":").length?this.weeklyDate[u].startHours+":00":this.weeklyDate[u].startHours,g=2==this.weeklyDate[u].endHours.split(":").length?this.weeklyDate[u].endHours+":00":this.weeklyDate[u].endHours,this.selectWeekDay.push(u+1+","+h+","+g)}if(0==this.selectWeekDay.length)return this.$toast("请选择签到日期");this.signData.weekDay=this.selectWeekDay.join("&")}this.signData.needOut?this.$emit("confirm",this.signData):("编辑签到"==this.title?(this.signData.checkInType=this.checkInType,this.selectType,this.$emit("editMethod",this.signData)):this.signData.checkInType=this.signInfo.project.checkInType,this.signData.selectType=this.selectType,this.$emit("confirm",this.signData))},signStartSelected:function(t){this.signData.startTime=t.value},signEndSelected:function(t){this.signData.endTime=t.value},signOutStartSelected:function(t){this.signData.signOutTimeStart=t.value},signOutEndSelected:function(t){this.signData.signOutTimeEnd=t.value}}}),h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-modal",{attrs:{show:t.signData.show,effect:"fade",width:"500"}},[a("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[a("h5",{staticClass:"modal-title"},[t._v(t._s(t.title))])]),t._v(" "),a("div",{staticClass:"modal-body modal-full-width container-fluid new-sign-modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},["loop"==t.checkInType?a("div",{staticClass:"signType data-wrap"},[a("v-select",{staticClass:"seleced_role",staticStyle:{width:"50%"},attrs:{disabled:"编辑签到"==t.title,required:"",options:t.typeList,optionsLabel:"text",optionsValue:"id",placeholder:"请选择签到类型"},model:{value:t.selectType,callback:function(e){t.selectType=e},expression:"selectType"}})],1):t._e(),t._v(" "),a("div",{staticClass:"form-group data-wrap"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.signData.name,expression:"signData.name"}],staticClass:"form-control",attrs:{type:"text",maxlength:t.signData.maxLength,placeholder:t.i18n.addSignPlaceholder},domProps:{value:t.signData.name},on:{input:function(e){e.target.composing||t.$set(t.signData,"name",e.target.value)}}})]),t._v(" "),"single"==t.checkInType||t.signData.needOut?a("div",[t.signData.needOut?a("div",{staticClass:"box_flex flex_center data-wrap date_picker_wrap"},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{"picker-options":t.pickOptions,disabled:new Date(t.signData.startTime)<new Date,"value-format":"yyyy-MM-dd HH:mm:ss",clearable:!1,type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.dateArea,callback:function(e){t.dateArea=e},expression:"dateArea"}})],1):a("div",{staticClass:"form-group data-wrap box_flex box_center"},[a("v-datepicker",{ref:"startTime",staticClass:"btn-block time-picker",attrs:{value:t.signData.startTime,format:t.signData.dateFormat,placeholder:t.i18n.signStartPlaceholder,clearButton:!1},on:{daySelected:t.signStartSelected}}),t._v(" "),a("div",{staticClass:"date_center"},[t._v("至")]),t._v(" "),a("v-datepicker",{ref:"endTime",staticClass:"btn-block time-picker",attrs:{value:t.signData.endTime,format:t.signData.dateFormat,placeholder:t.i18n.signEndPlaceholder,clearButton:!1},on:{daySelected:t.signEndSelected}})],1)]):a("div",["day"==t.selectType?a("div",[a("div",{staticClass:"form-group data-wrap box_flex box_center"},[a("v-datepicker",{ref:"startTime",staticClass:"btn-block time-picker",attrs:{beforeSelect:t.beforeStartTimeStartSelect,value:t.signData.startTime,format:"yyyy-MM-dd",clearButton:!1},on:{daySelected:t.signStartSelected}}),t._v(" "),a("div",{staticClass:"date_center"},[t._v("至")]),t._v(" "),a("v-datepicker",{ref:"startTime",staticClass:"btn-block time-picker",attrs:{beforeSelect:t.beforeEndTimeStartSelect,value:t.signData.endTime,format:"yyyy-MM-dd",clearButton:!1},on:{daySelected:t.signEndSelected}})],1),t._v(" "),a("div",{staticClass:"notice"},[a("i",{staticClass:"el-icon-warning"}),t._v(" "),a("span",[t._v("开始日期和结束日期必须大于当日")])]),t._v(" "),a("div",{staticClass:"form-group data-wrap box_flex box_center my-elwrap"},[a("el-time-select",{staticStyle:{width:"30%"},attrs:{"picker-options":{start:"06:00",step:"00:15",end:"24:00",maxTime:t.signData.endTimeToHours},placeholder:"起始时间","value-format":"HH:mm:ss"},on:{change:function(e){return t.dateChange_day(t.signData.startTimeToHours,"start")}},model:{value:t.signData.startTimeToHours,callback:function(e){t.$set(t.signData,"startTimeToHours",e)},expression:"signData.startTimeToHours"}}),t._v(" "),a("el-time-select",{staticStyle:{width:"30%"},attrs:{"picker-options":{start:"06:00",step:"00:15",end:"24:00",minTime:t.signData.startTimeToHours},placeholder:"结束时间","value-format":"HH:mm:ss"},on:{change:function(e){return t.dateChange_day(t.signData.endTimeToHours,"end")}},model:{value:t.signData.endTimeToHours,callback:function(e){t.$set(t.signData,"endTimeToHours",e)},expression:"signData.endTimeToHours"}})],1)]):a("div",[a("div",{staticClass:"form-group data-wrap box_flex box_center"},[a("v-datepicker",{ref:"startTime",staticClass:"btn-block time-picker",attrs:{beforeSelect:t.beforeStartTimeStartSelect,value:t.signData.startTime,format:"yyyy-MM-dd",clearButton:!1},on:{daySelected:t.signStartSelected}}),t._v(" "),a("div",{staticClass:"date_center"},[t._v("至")]),t._v(" "),a("v-datepicker",{ref:"startTime",staticClass:"btn-block time-picker",attrs:{beforeSelect:t.beforeEndTimeStartSelect,value:t.signData.endTime,format:"yyyy-MM-dd",clearButton:!1},on:{daySelected:t.signEndSelected}})],1),t._v(" "),a("div",{staticClass:"weeklyDate"},t._l(t.weeklyDate,function(e,s){return a("div",{key:s,staticStyle:{display:"flex","line-height":"40px"}},[a("el-checkbox",{attrs:{disabled:"编辑签到"==t.title},on:{change:t.checkboxChange},model:{value:e.isChecked,callback:function(a){t.$set(e,"isChecked",a)},expression:"item.isChecked"}},[t._v(t._s(t.dateToCn(e.index)))]),t._v(" "),e.isChecked?a("div",{staticClass:"form-group data-wrap box_flex box_center my-elwrap"},[a("el-time-select",{staticStyle:{width:"40%"},attrs:{"picker-options":{start:"06:00",step:"00:15",end:"24:00",maxTime:e.endHours},placeholder:"起始时间","value-format":"HH:mm:ss"},on:{change:function(a){return t.dateChange(e.startHours,s)}},model:{value:e.startHours,callback:function(a){t.$set(e,"startHours",a)},expression:"item.startHours"}}),t._v(" "),a("el-time-select",{staticStyle:{width:"40%"},attrs:{"picker-options":{start:"06:00",step:"00:15",end:"24:00",minTime:e.startHours},placeholder:"结束时间","value-format":"HH:mm:ss"},on:{change:function(a){return t.dateChange_end(e.endHours,s)}},model:{value:e.endHours,callback:function(a){t.$set(e,"endHours",a)},expression:"item.endHours"}})],1):t._e()],1)}),0)])]),t._v(" "),t.signData.needOut?a("div",{staticClass:"data-wrap"},[a("div",{staticClass:"sign-ways"},[a("div",{staticClass:"switch box_flex box_between"},[a("span",{staticClass:"label"},[t._v("使用签退")]),t._v(" "),a("el-switch",{model:{value:t.signData.isSignOut,callback:function(e){t.$set(t.signData,"isSignOut",e)},expression:"signData.isSignOut"}})],1),t._v(" "),a("div",{staticClass:"form-group box_flex box_center date_picker_wrap"},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{"picker-options":t.pickOptions,disabled:t.signData.signOutTimeStart&&new Date(t.signData.signOutTimeStart)<new Date||!t.signData.isSignOut,"value-format":"yyyy-MM-dd HH:mm:ss",clearable:!1,type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.dateArea2,callback:function(e){t.dateArea2=e},expression:"dateArea2"}})],1)])]):t._e(),t._v(" "),a("div",{staticClass:"form-group"},[a("div",{staticClass:"sign-ways"},[a("div",{directives:[{name:"show",rawName:"v-show",value:!t.signData.needOut,expression:"!signData.needOut"}],staticClass:"sign-way",class:{active:t.signData.signWay===t.signData.signWays.qrcode},on:{click:function(e){return t.setSignWay(t.signData.signWays.qrcode)}}},[a("v-icon",{attrs:{name:t.signData.signWay===t.signData.signWays.qrcode?"radio_button_checked":"radio_button_unchecked"}}),t._v(" "),a("span",[t._v("扫码签到")])],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.signData.signWay===t.signData.signWays.qrcode,expression:"signData.signWay === signData.signWays.qrcode"}]},[a("div",{staticClass:"switch box_flex box_between"},[a("span",{staticClass:"label"},[t._v(t._s(t.i18n.useDynamicCode))]),t._v(" "),a("el-switch",{model:{value:t.signData.useDynamicCode,callback:function(e){t.$set(t.signData,"useDynamicCode",e)},expression:"signData.useDynamicCode"}})],1),t._v(" "),a("div",{staticClass:"switch box_flex box_between"},[a("span",{staticClass:"label"},[t._v("开启定位限制")]),t._v(" "),a("el-switch",{model:{value:t.signData.scanQrcodeWithLocation,callback:function(e){t.$set(t.signData,"scanQrcodeWithLocation",e)},expression:"signData.scanQrcodeWithLocation"}})],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.signData.scanQrcodeWithLocation,expression:"signData.scanQrcodeWithLocation"}],staticClass:"qrcode-locations"},[a("locations",{attrs:{moreAddress:!t.signData.needOut,locations:t.signData.qrcodeLocations}})],1)]),t._v(" "),t.signData.needOut?t._e():a("div",{staticClass:"sign-way",class:{active:t.signData.signWay===t.signData.signWays.location},on:{click:function(e){return t.setSignWay(t.signData.signWays.location)}}},[a("v-icon",{attrs:{name:t.signData.signWay===t.signData.signWays.location?"radio_button_checked":"radio_button_unchecked"}}),t._v(" "),a("span",[t._v("定位签到")])],1),t._v(" "),t.signData.needOut||"loop"!==t.checkInType?t._e():a("div",{staticClass:"sign-way",class:{active:t.signData.signWay===t.signData.signWays.outside},on:{click:function(e){return t.setSignWay(t.signData.signWays.outside)}}},[a("v-icon",{attrs:{name:t.signData.signWay===t.signData.signWays.outside?"radio_button_checked":"radio_button_unchecked"}}),t._v(" "),a("span",[t._v("外勤打卡")])],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.signData.signWay===t.signData.signWays.location,expression:"signData.signWay === signData.signWays.location"}]},[a("locations",{attrs:{locations:t.signData.locations}})],1)])])]),t._v(" "),a("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.cancel}},[t._v(t._s(t.i18n.cancel))]),t._v(" "),a("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.confirm}},[t._v(t._s(t.i18n.sure))])])])},staticRenderFns:[]};var g=a("C7Lr")(u,h,!1,function(t){a("hazC"),a("PuR5")},"data-v-46b79174",null);e.a=g.exports}});