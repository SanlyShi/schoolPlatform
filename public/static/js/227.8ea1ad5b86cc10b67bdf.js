webpackJsonp([227],{"+sFj":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("aA9S"),a=n.n(i),o=n("C331"),l=n("7Adc"),s={props:{data:{default:null}},data:function(){return{hasSaveInfo:!0,title:{add:"新建",edit:"编辑",check:"查看"},minuteListValue:"",semester:"",groupInfo:{groups:[{hasParticipant:!1,gutter:"0",title:null,cells:[{title:"年份",name:"year",type:"picker"},{title:"省份",name:"province",type:"picker"},{title:"地区",name:"provinceSecond",type:"picker"},{title:"时间",name:"submitTime",type:"datetime",format:"YYYY-MM-DD"},{title:"学年",name:"studyYear",type:"cell"}]},{hasParticipant:!1,gutter:"10px",title:null,cells:[{title:"活动类别",name:"activityType",type:"picker",isDict:!0},{title:"活动性质",name:"activityNature",type:"picker",isDict:!0},{title:"中学/咨询会",name:"middleConsult",type:"picker",isDict:!0},{title:"中学性质（仅中学填写）",name:"middleNature",type:"textarea"},{title:"中学/咨询会联系人",name:"middleConsultPeople",type:"input",width:"158px",placeholder:"联系人姓名"},{title:"中学名称/咨询会地址",name:"middleConsultPlace",type:"picker"},{title:"有无讲座",name:"theLecture",type:"picker",isDict:!0},{title:"讲座题目",name:"lectureName",type:"input",placeholder:"无讲座填写“无”"},{title:"专家姓名",name:"expertsName",type:"input",placeholder:"无讲座填写“无”"}]},{gutter:"10px",title:null,cells:[{title:"其他人员",name:"otherJoinPeople",type:"input",placeholder:"其他人员姓名/联系方式"}]},{gutter:"10px",title:null,cells:[{title:"工作内容说明",name:"workDescribe",type:"textarea"}]}],initData:{year:{list:[],value:[]},province:{list:[],value:[]},provinceSecond:{list:[],value:[]},activityType:{list:[],value:[]},activityNature:{list:[],value:[]},middleConsult:{list:[],value:[]},middleConsultPlace:{list:[],value:[]},theLecture:{list:[],value:[]}}},schoolJoinPeople:{hasParticipant:!0,gutter:"10px",title:"我校参加人员",cells:[{title:"姓氏",name:"surnames",type:"input",placeholder:"请输入姓氏"},{title:"名字",name:"name",type:"input",placeholder:"请输入名字"},{title:"联系方式",name:"phone",type:"input",placeholder:"请输入联系方式"}]},journeyInfo:{id:null,userId:null,userName:"",year:"",studyYear:"",addressCode:"",provinceSecond:"",submitTime:null,activityType:"",activityNature:"",middleConsult:"",middleNature:"",middleConsultPeople:"",middleConsultPlace:"",theLecture:"",lectureName:"",expertsName:"",schoolJoinPeopleSurnames:"",schoolJoinPeopleName:"",schoolJoinPeoplePhone:"",schoolJoinPeopleVO:null,otherJoinPeople:"",workDescribe:"",note:"",status:"",reason:"",createTime:"",updateTime:""}}},computed:{getProvince:function(){return this.groupInfo.initData.province.value[0]},getMiddleConsult:function(){return this.groupInfo.initData.middleConsult.value[0]},getMiddle:function(){return this.groupInfo.initData.middleConsultPlace.value[0]}},watch:{getProvince:function(t){this.initCity(t)},getMiddleConsult:function(t){"13001"==t?(this.groupInfo.groups[1].cells[5].type="picker",this.getMiddleList(this.groupInfo.initData.province.value[0],this.groupInfo.initData.provinceSecond.value[0])):this.groupInfo.groups[1].cells[5].type="textarea"},getMiddle:function(t){"其他"==t&&"middleConsultPlace"!==this.groupInfo.groups[1].cells[6].name?this.groupInfo.groups[1].cells.splice(6,0,{title:"",name:"middleConsultPlace",type:"textarea"}):"其他"!==t&&"middleConsultPlace"===this.groupInfo.groups[1].cells[6].name&&this.groupInfo.groups[1].cells.splice(6,1)}},created:function(){this.initPickerData(),this.initYear(),this.initSchoolYear(),this.initArea()},mounted:function(){"add"!==this.data.type?(this.journeyInfo=a()({},this.data.journeyObj),this.initJourneyPeople(),"咨询会"==this.journeyInfo.middleConsult&&(this.groupInfo.groups[1].cells[5].type="textarea"),"edit"==this.data.type&&this.initEditData()):this.isSaved()},methods:{isSaved:function(){var t=this;Object(o.e)({url:"/api/archives/trip/getOneArrange?status=SAVE",type:"get",success:function(e){e.state?(e.data.content.length>0?(t.journeyInfo=e.data.content[0],t.initEditData()):t.hasSaveInfo=!1,t.initJourneyPeople()):t._toast(e.message)}})},submit:function(t){var e=this;for(var n in this.groupInfo.initData)("middleConsultPlace"!=n||"13002"!=this.groupInfo.initData.middleConsult.value[0]&&"其他"!=this.groupInfo.initData[n].value[0])&&(this.journeyInfo[n]=this.groupInfo.initData[n].value[0]);var i="trip/insertArrange";"edit"==this.data.type&&(i="trip/"+this.journeyInfo.id+"/updateOneArrange"),this.journeyInfo.status=t,Object(o.e)({url:"/api/archives/"+i,dataType:"json",data:this.journeyInfo,type:"POST",success:function(n){n.state?(e.hasSaveInfo=!0,e._toast(("WAIT"==t?"提交":"保存")+"成功"),"edit"==e.data.type&&e.updateData(),"WAIT"==t&&Object(l.setTimeout)(function(){e._back()},500)):e._toast(n.message)}})},updateData:function(){var t=this;for(var e in this.data.journeyObj)this.data.journeyObj[e]=this.journeyInfo[e];var n=function(e){if("middleConsultPlace"==e);else{var n=t.groupInfo.initData[e].list[0].find(function(n){return n.value==t.journeyInfo[e]});n&&(t.data.journeyObj[e]=n.name)}};for(var i in this.groupInfo.initData)n(i)},initEditData:function(){var t=this,e=function(e){"middleConsultPlace"==e&&"咨询会"==t.journeyInfo.middleConsult||("province"!==e&&"provinceSecond"!==e||!t.journeyInfo[e]?t.groupInfo.initData[e].list.length>0&&Object(l.setTimeout)(function(){var n=t.groupInfo.initData[e].list[0].find(function(n){return n.name==t.journeyInfo[e]});n&&t.groupInfo.initData[e].value.push(n.value)},500):t.groupInfo.initData[e].value.push(t.journeyInfo[e+"Code"]))};for(var n in this.groupInfo.initData)e(n)},initPickerData:function(){var t=this;this.groupInfo.groups[1].cells.map(function(e,n){e.isDict&&t.initDict(e)})},initDict:function(t){var e=this;Object(o.e)({url:"/api/archives/demo/getSysDict?name="+t.title,dataType:"json",type:"GET",async:!1,success:function(n){if(n.state){var i=[];n.data.length>0&&(i=n.data.map(function(t){return{name:t.name,value:t.value}})),e.groupInfo.initData[t.name].list[0]=i}else e._toast(t.title+"获取失败")}})},initYear:function(){for(var t=[],e=(new Date).getFullYear(),n=0;n<5;n++)t.push({name:""+(e-n),value:""+(e-n),label:""+(e-n)});this.groupInfo.initData.year.list[0]=t},initSchoolYear:function(){var t=(new Date).getFullYear(),e=new Date(t+"-7-31 23:59:59"),n="";n=new Date>e?t+"-"+(t+1):t-1+"-"+t,this.journeyInfo.studyYear=n},getMiddleList:function(t,e){var n=this;Object(o.e)({url:"/api/archives/trip/getMiddleData?province="+t+"&provinceSecond="+e,dataType:"json",type:"GET",async:!1,success:function(t){if(t.state){var e=[];t.data.length>0&&(e=t.data.map(function(t){return{name:t.name,value:t.name}})),e.push({name:"其他",value:"其他"}),n.$set(n.groupInfo.initData.middleConsultPlace,"list",[e])}else n._toast("中学名称获取失败")}})},_back:function(){var t=this;"add"!=this.data.type||this.hasSaveInfo?(this.data.isUpdateLastPage=!0,this.$emit("removeBread",this.data)):this.$vux.confirm.show({content:"行程未保存，是否继续返回？",onConfirm:function(e){t.data.isUpdateLastPage=!0,t.$emit("removeBread",t.data)},onCancel:function(t){}})},_edit:function(){this.data.type="edit",this.journeyInfo.schoolJoinPeopleVO||(this.journeyInfo.schoolJoinPeopleVO=[],this.journeyInfo.schoolJoinPeopleVO.push({surnames:"",name:"",phone:""})),this.initEditData()},initJourneyPeople:function(){var t=this;this.journeyInfo.schoolJoinPeopleVO&&this.journeyInfo.schoolJoinPeopleVO.length>0?this.journeyInfo.schoolJoinPeopleVO.map(function(e){t._addContactPeople()}):(this.journeyInfo.schoolJoinPeopleVO=[],this._addOnePeople())},_addOnePeople:function(){this.journeyInfo.schoolJoinPeopleVO.push({surnames:"",name:"",phone:""}),this._addContactPeople()},_addContactPeople:function(){var t=this.groupInfo.groups.length-2;this.groupInfo.groups.splice(t,0,this.schoolJoinPeople)},_deleteContactPeople:function(t){this.groupInfo.groups.splice(t,1),this.journeyInfo.schoolJoinPeopleVO.splice(t-2,1)},initArea:function(){var t=this;Object(o.e)({url:"/api/archives/permissions/getProvinceList",dataType:"json",type:"GET",success:function(e){e.state?(e.data.forEach(function(t){t.name=t.label}),t.$set(t.groupInfo.initData.province,"list",[e.data])):t.$toast(e.message)}})},initCity:function(t){var e=this;Object(o.e)({url:"/api/archives/permissions/getProvinceSecond?value="+t,dataType:"json",type:"GET",success:function(t){t.state?(t.data.forEach(function(t){t.name=t.label}),e.$set(e.groupInfo.initData.provinceSecond,"list",[t.data])):e._toast(t.message)}})},_toast:function(t){this.$vux.toast.show({text:t,position:"bottom",type:"text"})}}},r={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"createJourney"},[n("view-box",[n("x-header",{staticClass:"journey-header",attrs:{title:t.title[this.data.type]+"行程"}},[n("i",{staticClass:"maticon back-icon",attrs:{slot:"overwrite-left"},domProps:{innerHTML:t._s(t.icons("navigate_before"))},on:{click:t._back},slot:"overwrite-left"},[t._v("navigate_before")])]),t._v(" "),"add"==this.data.type||"edit"==this.data.type?n("div",{staticClass:"addRoute"},[t._l(t.groupInfo.groups,function(e,i){return e.hasParticipant?n("group",{staticClass:"route-info"},[n("group-title",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.title+(i-1))+"\n        "),i<t.groupInfo.groups.length-2&&t.groupInfo.groups.length>5?n("div",{staticClass:"delete-btn",staticStyle:{float:"right"},on:{click:function(e){return t._deleteContactPeople(i)}}},[t._v("删除")]):t._e()]),t._v(" "),t._l(e.cells,function(e,a){return"input"==e.type?n("x-input",{key:a,attrs:{"label-width":e.width,title:e.title,"text-align":"right",placeholder:e.placeholder},model:{value:t.journeyInfo.schoolJoinPeopleVO[i-2][e.name],callback:function(n){t.$set(t.journeyInfo.schoolJoinPeopleVO[i-2],e.name,n)},expression:"journeyInfo.schoolJoinPeopleVO[gIndex-2][cell.name]"}}):t._e()}),t._v(" "),i==t.groupInfo.groups.length-3?n("x-button",{staticClass:"add-btn",nativeOn:{click:function(e){return t._addOnePeople(e)}}},[t._v("+ 增加我校联系人")]):t._e()],2):n("group",{key:i,staticClass:"route-info",attrs:{gutter:e.gutter}},t._l(e.cells,function(e,i){return"datetime"==e.type?n("datetime",{key:i,attrs:{title:e.title,"border-intent":!1,format:e.format,placeholder:"请选择"},model:{value:t.journeyInfo[e.name],callback:function(n){t.$set(t.journeyInfo,e.name,n)},expression:"journeyInfo[cell.name]"}}):"picker"==e.type?n("popup-picker",{attrs:{title:e.title,data:t.groupInfo.initData[e.name].list,"show-name":"",placeholder:"请选择"},model:{value:t.groupInfo.initData[e.name].value,callback:function(n){t.$set(t.groupInfo.initData[e.name],"value",n)},expression:"groupInfo.initData[cell.name].value"}}):"cell"==e.type?n("cell",{attrs:{title:e.title,"border-intent":!1,value:t.journeyInfo[e.name]}}):"textarea"==e.type?[e.title?n("cell",{attrs:{title:e.title,"border-intent":!1}}):t._e(),t._v(" "),n("x-textarea",{staticClass:"textarea",attrs:{placeholder:"请输入"},model:{value:t.journeyInfo[e.name],callback:function(n){t.$set(t.journeyInfo,e.name,n)},expression:"journeyInfo[cell.name]"}})]:"input"==e.type?n("x-input",{attrs:{"label-width":e.width,title:e.title,"text-align":"right",placeholder:e.placeholder},model:{value:t.journeyInfo[e.name],callback:function(n){t.$set(t.journeyInfo,e.name,n)},expression:"journeyInfo[cell.name]"}}):t._e()}),1)}),t._v(" "),n("div",{staticClass:"footer"},[n("x-button",{staticClass:"btn btn-line",nativeOn:{click:function(e){return t.submit(t.journeyInfo.status||"SAVE")}}},[t._v("保存")]),t._v(" "),n("x-button",{staticClass:"btn btn-bg",nativeOn:{click:function(e){return t.submit("WAIT")}}},[t._v("提交")])],1)],2):n("div",{staticClass:"showAllDetail"},[t._l(t.groupInfo.groups,function(e,i){return e.hasParticipant?n("group",{staticClass:"route-info"},[n("group-title",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.title+(i-1)))]),t._v(" "),t._l(e.cells,function(e,a){return"input"==e.type?n("cell",{key:a,attrs:{title:e.title,value:t.journeyInfo.schoolJoinPeopleVO?t.journeyInfo.schoolJoinPeopleVO[i-2][e.name]:"","text-align":"right"}}):t._e()})],2):n("group",{key:i,staticClass:"route-info",attrs:{gutter:e.gutter}},t._l(e.cells,function(e,i){return"textarea"!=e.type?n("cell",{key:i,attrs:{title:e.title,value:t.journeyInfo[e.name],"label-width":e.width,"text-align":"right","border-intent":!1}}):[n("cell",{attrs:{title:e.title,"border-intent":!1}}),t._v(" "),n("x-textarea",{staticClass:"textarea",attrs:{disabled:"true",value:t.journeyInfo[e.name]||"无","value-align":"left"}})]}),1)}),t._v(" "),"NO"==t.journeyInfo.status?n("div",{staticClass:"footer-edit"},[n("x-button",{staticClass:"btn edit-btn",nativeOn:{click:function(e){return t._edit(e)}}},[t._v("编辑")])],1):t._e()],2)],1)],1)},staticRenderFns:[]};var u=n("C7Lr")(s,r,!1,function(t){n("Koz6")},null,null);e.default=u.exports},Koz6:function(t,e){}});