webpackJsonp([39],{EC1l:function(s,e){},Et2o:function(s,e){},UgL4:function(s,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t("3cXf"),a=t.n(i),n=t("kV13"),o=t("qqHy"),r=t.n(o),c=t("C331"),u=t("ksuH"),l=t("7CEZ"),p=t("lh7w"),d=t("fhnB"),h=t("oUxH");n.default.component("app-info",u.a),n.default.component("FormSetManage",l.default),n.default.component("FlowSetManage",p.default),n.default.component("FormEngineInfo",d.a),n.default.component("JoinRoleSetManage",h.a);n.default.component("app-info",u.a),n.default.component("FormSetManage",l.default),n.default.component("FlowSetManage",p.default),n.default.component("FormEngineInfo",d.a),n.default.component("JoinRoleSetManage",h.a);var m={props:{role:""},created:function(){var s=localStorage.getItem("lang");Object(c.g)(s)&&(this.lang=s),this._initDepartmentList()},data:function(){return{studentBie:!1,departmentList:[],departmentId:0,appList:[],typeList:{student:{userType:"1",bigType:"student",dragging:!1,types:[]},teacher:{userType:"2",bigType:"teacher",dragging:!1,types:[]},freshman:{userType:"3",bigType:"freshman",dragging:!1,types:[]},instructor:{userType:"4",bigType:"instructor",dragging:!1,types:[]}},dragData:{name:"",icon:""},dragType:{},appInfo:{w:0,h:0},newType:{name:"",userType:""},miniRoutes:"appManage",curCheckRoutes:"",dragContainer:null,dragTarget:null,dropTarget:null,editType:"",newApp:{name:"",imgPath:"school",imgType:1,remark:"",settingType:"",appTypeId:"",departmentId:"",sort:0},appCats:[{appTypeId:"1",settingType:"WORKFLOW",name:"workflow"},{appTypeId:"2",settingType:"LINK",name:"link"},{appTypeId:"3",settingType:"FORM",name:"form"}],newAppName:"",curApp:null,modelId:"",initWay:"create",showTypeModal:!1,showAddModal:!1,selectAppType:"1",addAppType:"",parentPage:"",searchName:"",businessId:null,appName:"",showImportModal:!1,clearInputShow:!0,selectFileName:"",fileData:"",formData:null,appUserType:"",lang:"zh-cn"}},computed:{translate:function(){return Object(c.g)(this.lang).appManage}},mounted:function(){var s=this;this.$dragging.$on("dragged",function(e){var t=e.draged;e.value;s.dragType=t})},methods:{_saveTypeOrder:function(s){var e=this;s.types.forEach(function(s,e){s.sort=e}),s.dragging?Object(c.e)({url:"/api/app/type/sort",type:"post",data:s.types,success:function(t){s.dragging=!1,t.state?e.$toast("排序成功！"):e.$toast(t.message)}}):s.dragging=!0},_containsSearchName:function(s){var e=this,t=!1;return s.forEach(function(s){(s.name&&s.name.indexOf(e.searchName)>=0||s.app&&s.app.name.indexOf(e.searchName)>=0)&&(t=!0)}),t},_updateApp:function(s){this.curApp.name=s.name,this.curApp.imgPath=s.imgPath,this.curApp.background=s.background},_initDepartmentList:function(){if("manager"===this.role)this.departmentId="",this._initPopular(),this._initTypes("1"),this._initTypes("2"),this._initTypes("3"),this._initTypes("4");else{var s=this;Object(c.e)({url:"/api/currentUser/approverDepartment?rule=应用管理",type:"get",success:function(e){e.state?(s.departmentList=e.data,s.departmentId=e.data[0]?e.data[0].id:""):s.$toast(e.message)}})}},_changeDepartment:function(s){this.departmentId&&(this._initTypes("1"),this._initTypes("2"),this._initTypes("3"),this._initTypes("4"))},_initPopular:function(){var s=this;Object(c.e)({url:"/api/app/popular",type:"get",success:function(e){e.state?s.appList=e.data.sort(function(s,e){return s.sort-e.sort}):s.$toast(e.message)}})},_initTypes:function(s){var e=this,t=[];"1"===s?t=e.typeList.student:"2"===s?t=e.typeList.teacher:"3"===s?t=e.typeList.freshman:"4"===s&&(t=e.typeList.instructor),t.types=[],Object(c.e)({url:"/api/app/type",type:"get",data:{userType:s},success:function(i){i.state?(i.data.forEach(function(s,e){var i={};for(var a in s)n.default.set(i,a,s[a]);n.default.set(i,"appList",[]),t.types.push(i)}),t.types=e._resort(t.types),e._initAppList(e.departmentId,s)):e.$toast(i.message)}})},_resort:function(s){var e=[];return s.forEach(function(s){(s.sort||0)>=e.length?e.splice(e.length,0,s):e.splice(s.sort,0,s)}),e.forEach(function(s,e){s.sort=e}),e},_initAppList:function(s,e){var t=this,i=null;"1"===e?i=t.typeList.student:"2"===e?i=t.typeList.teacher:"3"===e?i=t.typeList.freshman:"4"===e&&(i=t.typeList.instructor),Object(c.e)({url:"/api/app",type:"get",data:{departmentId:s,userType:e},success:function(s){s.state?s.data.forEach(function(s,e){i.types.forEach(function(e,t){e.id===s.appType.id&&e.appList.push(s)})}):t.$toast(s.message)}})},_draggable:function(){return!(!this.dropTarget||!this.dragTarget||"manager"!==this.role)&&((!this.dragTarget.attr("data-bigtype")||!this.dropTarget.attr("data-bigtype")||this.dropTarget.attr("data-bigtype")===this.dragTarget.attr("data-bigtype"))&&("total"===this.dropTarget.attr("data-type")||"total"!==this.dragTarget.attr("data-type")))},_dragStart:function(s){this.dragTarget=r()(s.target).parents(".app"),this.dragTarget.addClass("dragging");var e=0;if("total"===this.dragTarget.attr("data-type"))e=this.dragTarget.attr("data-key"),this.dragData=this.appList[e];else{var t=this.dragTarget.attr("data-bigtype"),i=this.dragTarget.attr("data-index");e=this.dragTarget.attr("data-key"),this.dragData=this.typeList[t].types[i].appList[e]}},_dragEnd:function(s){var e=this;if(this._draggable()){var t,i,n,o,c,u="",l="";if("total"===this.dropTarget.attr("data-type"))if(t=this.dragTarget.attr("data-key"),i=this.dropTarget.attr("data-key"),u=parseInt(this.dragTarget.attr("data-id")),c=JSON.parse(a()(this.dragData)),"total"===this.dragTarget.attr("data-type"))this.appList.splice(t,1),this.appList.splice(i,0,c),this._saveOrder(this,"popular");else{var p=!1;this.appList.forEach(function(s,e){s.app.id===u&&(p=!0)}),p||this._addPopular(i||this.appList.length,function(s){e.appList.splice(i,0,s)})}else t=parseInt(this.dragTarget.attr("data-key")),n=parseInt(this.dragTarget.attr("data-index")),i=parseInt(this.dropTarget.attr("data-key")),o=parseInt(this.dropTarget.attr("data-index")),l=this.dragTarget.attr("data-bigtype"),c=JSON.parse(a()(this.dragData)),this.typeList[l].types[n].appList.splice(t,1),this.typeList[l].types[o].appList.splice(i,0,c),this._saveOrder(this.typeList[l].types[n]),n!==o&&this._saveOrder(this.typeList[l].types[o])}this.dragTarget.removeClass("dragging"),r()(".drag.active").removeClass("active"),this.dragTarget=null,this.dropTarget=null},_dragOver:function(s){this._draggable()&&s.preventDefault()},_dragEnter:function(s){r()(s.target).is(".drag")?this.dropTarget=r()(s.target):this.dropTarget=r()(s.target).parents(".drag"),r()(".drag.active").removeClass("active"),this._draggable()&&(r()(".drag.active").removeClass("active"),this.dropTarget.addClass("active"))},_dragLeave:function(s){this.dropTarget.removeClass("active")},_saveOrder:function(s,e){var t=this;s.appList.forEach(function(t,i){t.sort=i,"popular"!==e&&(t.appType={id:s.id,name:s.name,sort:s.sort,userType:s.userType})});var i="";i="popular"===e?"/api/app/popular/sort":"/api/app/sort",Object(c.e)({url:i,type:"post",data:s.appList,success:function(s){s.state||t.$toast(s.message)}})},_editAppType:function(s){this.editType=s.id,this.newAppName=s.name},_saveAppType:function(s,e){var t=this;Object(c.e)({url:"/api/app/type/"+s.id,type:"post",data:{id:s.id,name:this.newAppName,userType:s.userType,sort:s.sort},success:function(e){e.state?(t.editType="",s.name=t.newAppName):t.$toast(e.message)}})},_removeAppType:function(s,e,t){var i=this;s.appList.length>0?this.$toast(this.translate.appExistTip):confirm(this.translate.appTypeRemoveConfirm)&&(this.$waiting.show(),Object(c.e)({url:"/api/app/type/"+s.id+"/delete",type:"post",success:function(s){s.state?(t.types.splice(e,1),i.$toast("",0,"check")):i.$toast(s.message)}}).always(function(){i.$waiting.close()}))},_createAppType:function(){var s=this;if(""!==this.newType.name)if(""!==this.newType.userType){var e=null;for(var t in this.typeList)this.typeList[t].userType===this.newType.userType&&(e=this.typeList[t]);this.$waiting.show(),Object(c.e)({url:"/api/app/type",type:"post",data:{name:this.newType.name,userType:this.newType.userType,sort:e.types.length},success:function(t){t.state?(s.showTypeModal=!1,e.types.push({id:t.data.id,name:s.newType.name,appList:[],userType:s.newType.userType,sort:0}),s.$toast("",0,"check")):s.$toast(t.message)}}).always(function(){s.$waiting.close()})}else this.$toast(this.translate.appAddTip2);else this.$toast(this.translate.appAddTip1)},_removeApp:function(s,e,t){var i=this,a="";a=t?"/api/app/popular/"+s[e].id:"/api/app/"+s[e].id,confirm(this.translate.appRemoveConfirm)&&Object(c.e)({url:a,type:"post",success:function(t){t.state?(s.splice(e,1),i._initPopular(),i.$toast("",0,"check")):i.$toast(t.message)}})},_editApp:function(s,e){var t=this;if("department"===this.role)if(s)this.$waiting.show(),this.curApp=s,this.appName=this.curApp.name,s.appType&&s.appType.userType&&(this.appUserType=s.appType.userType),"WORKFLOW"===s.setting.type?this.miniRoutes="appInfo":"LINK"===s.setting.type?(this.miniRoutes="link",this.curCheckRoutes="link"):(this.miniRoutes="formEngine",this.curCheckRoutes="formEngine"),this.$waiting.close();else{if(""===this.newApp.name||!this.newApp.settingType||!this.newApp.appTypeId)return void this.$toast(this.translate.editTip2);this.$waiting.show(),this.appName=this.newApp.name,this.newApp.departmentId=this.departmentId,this.newApp.sort=e.appList.length,this.showAddModal=!1,Object(c.e)({url:"/api/app",type:"post",data:this.newApp,success:function(s){s.state?(t.appUserType=s.data.appType.userType,t.curApp={id:s.data.id,name:s.data.name,imgPath:s.data.imgPath,setting:{type:s.data.setting.type}},setTimeout(function(){"WORKFLOW"===s.data.setting.type?t.miniRoutes="appInfo":"LINK"===s.data.setting.type?(t.miniRoutes="link",t.curCheckRoutes="link"):(t.miniRoutes="formEngine",t.curCheckRoutes="formEngine")},600),e.appList.push(t.curApp),t.$toast("",0,"check")):t.$toast(s.message)}}).always(function(){t.$waiting.close()}),this.curApp=null}},_addPopular:function(s,e){var t=this;Object(c.e)({url:"/api/app/popular",type:"post",data:{app:this.dragData,sort:s},success:function(s){s.state?e(s.data):t.$toast(t.translate.appAddTip3)}})},_saveFormInfo:function(s){var e=this,t="";t=this.businessId?"/api/app/"+this.curApp.id+"/publishBusiness/"+this.businessId+"/formSetting":"/api/apps/"+this.curApp.id+"/settings/forms",this.$waiting.show(),Object(c.e)({url:t,type:"post",data:s,success:function(s){s.state?(e.$toast(e.translate.saveSuccessTip1,0,"check"),e._backToPage(e.parentPage)):e.$toast(s.message)}}).always(function(){e.$waiting.close()})},_saveFlowInfo:function(s){var e=this,t="";t=this.businessId?"/api/app/"+this.curApp.id+"/publishBusiness/"+this.businessId+"/flowSetting":"/api/apps/"+this.curApp.id+"/settings/flows",this.$waiting.show(),Object(c.e)({url:t,type:"post",data:s,success:function(s){s.state?(e.$toast(e.translate.saveSuccessTip2,0,"check"),e._backToPage("appInfo")):e.$toast(s.message)}}).always(function(){e.$waiting.close()})},_savePlayers:function(s){var e=this,t="";t=this.businessId?"/api/app/"+this.curApp.id+"/publishBusiness/"+this.businessId+"/playerSetting":"/api/apps/"+this.curApp.id+"/settings/players",this.$waiting.show(),Object(c.e)({url:t,type:"post",data:s,success:function(s){s.state?(e.$toast(e.translate.saveSuccessTip3,0,"check"),e._backToPage("formEngine")):e.$toast(s.message)}}).always(function(){e.$waiting.close()})},_setForm:function(s,e){this.miniRoutes="formSetManage",this.parentPage=e,this.modelId=s.modelId,this.initWay=s.type,this.businessId=s.businessId,this.$emit("fullScreen",!0)},_setFlow:function(s){this.miniRoutes="flowSetManage",this.modelId=s.modelId,this.businessId=s.businessId,this.$emit("fullScreen",!0)},_setJoinRole:function(s){this.miniRoutes="joinRoleSet",this.businessId=s.businessId,this.$emit("fullScreen",!0)},_backToPage:function(s){this.miniRoutes=s,this.$emit("fullScreen",!1)},_createApp:function(){this.showAddModal=!0,r()(".app-type-content").animate({scrollTop:"0px"},100),this.newApp.name="",this.newApp.settingType="",this.newApp.appTypeId=""},_showImportModal:function(){this.showImportModal=!0,r()(".app-type-content").animate({scrollTop:"0px"},100),this.newApp.appTypeId="",this.selectFileName=this.translate.selectFile},getFile:function(s){this.formData=new FormData,this.fileData=null,this.fileData=s.target.files[0],this.formData.append("file",this.fileData),this.clearInputShow=!1,this.fileData&&(this.selectFileName=this.fileData.name,this.clearInputShow=!0)},_importApp:function(s){var e=this;if(!this.fileData)return this.$toast("请选择文件");this.newApp.appTypeId?(this.formData.append("appTypeId",this.newApp.appTypeId),this.formData.append("departmentId",this.departmentId),this.$waiting.show(),Object(c.e)({url:"/upload/app/import",dataType:"json",data:this.formData,processData:!1,contentType:!1,type:"post",success:function(t){e.showImportModal=!1,"88888"===t.code?(e.curApp={id:t.data.id,name:t.data.name,imgPath:t.data.imgPath,setting:{type:t.data.setting.type}},setTimeout(function(){"WORKFLOW"===t.data.setting.type?e.miniRoutes="appInfo":"LINK"===t.data.setting.type?(e.miniRoutes="link",e.curCheckRoutes="link"):(e.miniRoutes="formEngine",e.curCheckRoutes="formEngine")},600),s.appList.push(e.curApp),e.$toast("",0,"check")):e.$toast(t.message)}}).always(function(){e.$waiting.close()})):this.$toast(this.translate.editTip2)}},beforeDestroy:function(){this.$dragging.$off("dragged")}},b={render:function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",{staticClass:"app-page",class:{"container-fluid":["formSetManage","flowSetManage","joinRoleSet"].indexOf(s.miniRoutes)<0,"layout-manage":"department"!==s.role}},[t("div",{directives:[{name:"show",rawName:"v-show",value:"appManage"===s.miniRoutes,expression:"miniRoutes === 'appManage'"}],staticClass:"row",attrs:{id:"appManage"}},[t("div",{staticClass:"head"},[t("h3",{staticClass:"pull-left"},[s._v(s._s(s.translate.appManage)+"\n        "),"department"===s.role&&s.departmentId?t("v-select",{staticClass:"info-value",attrs:{options:s.departmentList,required:!0,"options-value":"id","options-label":"name","close-on-select":""},on:{afterSelected:s._changeDepartment},model:{value:s.departmentId,callback:function(e){s.departmentId=e},expression:"departmentId"}}):s._e()],1),s._v(" "),t("button",{staticClass:"btn pull-right import-file-btn",on:{click:s._showImportModal}},[s._v(s._s(s.translate.import))]),s._v(" "),"department"===s.role?t("button",{staticClass:"btn pull-right",on:{click:s._createApp}},[t("i",{staticClass:"maticon pull-left",domProps:{innerHTML:s._s(s.icons("create"))}}),s._v(s._s(s.translate.createApp))]):t("button",{staticClass:"btn pull-right",on:{click:function(e){s.showTypeModal=!0}}},[t("i",{staticClass:"maticon pull-left",domProps:{innerHTML:s._s(s.icons("playlist_add"))}}),s._v(s._s(s.translate.createAppType))]),s._v(" "),"department"===s.role?t("input",{directives:[{name:"model",rawName:"v-model",value:s.searchName,expression:"searchName"}],staticClass:"form-control pull-right app-search",attrs:{type:"text",placeholder:"搜索..."},domProps:{value:s.searchName},on:{input:function(e){e.target.composing||(s.searchName=e.target.value)}}}):s._e()]),s._v(" "),t("GeminiScrollbar",{staticClass:"body",attrs:{scrollX:!1}},["department"!==s.role?t("div",{staticClass:"container-fluid type-group"},[t("label",{staticClass:"pull-left type-head"},[s._v(s._s(s.translate.hot))]),s._v(" "),t("div",{staticClass:"apps-container"},[s._l(s.appList,function(e,i){return e.app.name.indexOf(s.searchName)>=0?t("div",{key:i,staticClass:"app drag",attrs:{"data-key":i,"data-id":e.id,"data-type":"total"},on:{dragover:s._dragOver,dragenter:s._dragEnter,click:function(t){return s._editApp(e)}}},[t("div",{staticClass:"active-show"}),s._v(" "),"department"!==s.role?t("i",{staticClass:"maticon remove-app",domProps:{innerHTML:s._s(s.icons("cancel"))},on:{click:function(e){return e.stopPropagation(),s._removeApp(s.appList,i,"popular")}}},[s._v("cancel")]):s._e(),s._v(" "),t("div",{staticClass:"app-icon-div",style:{background:e.app.background}},[e.app.imgType&&"1"!==e.app.imgType?"2"===e.app.imgType?t("i",{staticClass:"maticon app-icon-style theme-icon-application",class:e.app.isPublished?"":"disabled",attrs:{draggable:""},on:{dragstart:s._dragStart,dragenter:s._dragEnter,dragend:s._dragEnd}},[t("span",{staticClass:"saasicon-44px",class:["saasicon-44px-"+e.app.imgPath]})]):s._e():t("i",{staticClass:"maticon app-icon-style theme-icon-application",class:e.app.isPublished?"":"disabled",attrs:{draggable:""},domProps:{innerHTML:s._s(s.icons(e.app.imgPath||"school"))},on:{dragstart:s._dragStart,dragenter:s._dragEnter,dragend:s._dragEnd}},[s._v(s._s(e.app.imgPath||"school"))])]),s._v(" "),t("p",{staticClass:"text-center"},[s._v(s._s(e.app.name))])]):s._e()}),s._v(" "),t("div",{staticClass:"app drag add",attrs:{"data-type":"total"},on:{dragover:s._dragOver,dragenter:s._dragEnter}},[t("div",{staticClass:"active-show",staticStyle:{left:"0"}})])],2)]):s._e(),s._v(" "),s._l(s.typeList,function(e,i){return"department"===s.role&&s.departmentId||"department"!==s.role?t("div",{key:i,staticClass:"bigtype"},[t("div",{staticClass:"bigtype-header"},[t("span",{staticClass:"pull-left",staticStyle:{"margin-right":"8px"}},[t("i",{staticClass:"maticon pull-left",domProps:{innerHTML:s._s(s.icons("list"))}},[s._v("list")]),s._v(s._s(s.translate[e.bigType]))]),s._v(" "),"department"!==s.role?t("span",{staticClass:"pull-right move-icon",class:{active:e.dragging},on:{click:function(t){return s._saveTypeOrder(e)}}},[t("i",{staticClass:"maticon pull-left",staticStyle:{"margin-right":"0"},domProps:{innerHTML:s._s(s.icons("swap_vert"))}},[s._v("swap_vert")]),s._v("\n            "+s._s(e.dragging?"完成":"排序")+"\n          ")]):s._e()]),s._v(" "),s._l(e.types,function(i,a){return s._containsSearchName(i.appList)||"department"!==s.role?t("div",{directives:[{name:"show",rawName:"v-show",value:!e.dragging,expression:"!bigtype.dragging"}],key:a,staticClass:"container-fluid type-group"},[s.editType!==i.id?t("label",{staticClass:"pull-left type-head"},[s._v("\n            "+s._s(i.name)+"\n            "),"department"!==s.role?t("i",{staticClass:"maticon pull-right",domProps:{innerHTML:s._s(s.icons("cancel"))},on:{click:function(t){return t.stopPropagation(),s._removeAppType(i,a,e)}}},[s._v("cancel")]):s._e(),s._v(" "),"department"!==s.role?t("i",{staticClass:"maticon pull-right",domProps:{innerHTML:s._s(s.icons("edit"))},on:{click:function(e){return s._editAppType(i)}}},[s._v("edit")]):s._e()]):t("div",{staticClass:"pull-left type-head type-edit"},[t("div",{staticClass:"input-group"},[t("input",{directives:[{name:"model",rawName:"v-model",value:s.newAppName,expression:"newAppName"}],staticClass:"form-control type-name",attrs:{type:"text",maxlength:"16",placeholder:"请输入16字内的应用分类名称"},domProps:{value:s.newAppName},on:{input:function(e){e.target.composing||(s.newAppName=e.target.value)}}}),s._v(" "),t("span",{staticClass:"input-group-addon",on:{click:function(e){s.editType=""}}},[s._v(s._s(s.translate.cancel))]),s._v(" "),t("span",{staticClass:"input-group-addon sure",on:{click:function(e){return s._saveAppType(i,a)}}},[s._v(s._s(s.translate.sure))])])]),s._v(" "),t("div",{staticClass:"apps-container"},[0===i.appList.length?t("div",{staticClass:"app drag",attrs:{"data-index":a,"data-key":"0","data-type":"type"},on:{dragover:s._dragOver,dragenter:s._dragEnter}},[t("div",{staticClass:"active-show",staticStyle:{left:"0"}})]):s._e(),s._v(" "),s._l(i.appList,function(n,o){return n.name.indexOf(s.searchName)>=0?t("div",{key:o,staticClass:"app",class:{drag:"department"!==s.role},attrs:{"data-key":o,"data-type":"type","data-index":a,"data-id":n.id,"data-bigtype":e.bigType,title:n.name},on:{dragover:s._dragOver,dragenter:s._dragEnter,click:function(e){return s._editApp(n)}}},[t("div",{staticClass:"active-show"}),s._v(" "),"department"===s.role?t("i",{staticClass:"maticon remove-app",domProps:{innerHTML:s._s(s.icons("cancel"))},on:{click:function(e){return e.stopPropagation(),s._removeApp(i.appList,o)}}},[s._v("cancel")]):s._e(),s._v(" "),t("div",{staticClass:"app-icon-div",style:{background:n.background}},[n.imgType&&"1"!==n.imgType?"2"===n.imgType?t("i",{staticClass:"maticon app-icon-style theme-icon-application",class:n.isPublished?"":"disabled",attrs:{draggable:""},on:{dragstart:s._dragStart,dragenter:s._dragEnter,dragend:s._dragEnd}},[t("span",{staticClass:"saasicon-44px",class:["saasicon-44px-"+n.imgPath]})]):s._e():t("i",{staticClass:"maticon app-icon-style theme-icon-application",class:n.isPublished?"":"disabled",attrs:{draggable:""},domProps:{innerHTML:s._s(s.icons(n.imgPath||"school"))},on:{dragstart:s._dragStart,dragenter:s._dragEnter,dragend:s._dragEnd}},[s._v(s._s(n.imgPath||"school"))])]),s._v(" "),t("p",{staticClass:"text-center"},[s._v(s._s(n.name))])]):s._e()})],2)]):s._e()}),s._v(" "),s._l(e.types,function(a,n){return"department"!==s.role?t("div",{directives:[{name:"dragging",rawName:"v-dragging",value:{item:a,list:e.types,group:i},expression:"{ item: moveType, list: bigtype.types, group: bIndex }"},{name:"show",rawName:"v-show",value:e.dragging,expression:"bigtype.dragging"}],key:n,staticClass:"container-fluid type-group dragging-div",class:{active:a.id===s.dragType.id}},[t("label",{staticClass:"pull-left type-head"},[s._v("\n            "+s._s(a.name)+"\n          ")])]):s._e()})],2):s._e()})],2),s._v(" "),t("v-modal",{attrs:{show:s.showAddModal,width:"400"}},[t("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[s._v("\n          "+s._s(s.translate.createApp)+"\n        ")])]),s._v(" "),t("div",{staticClass:"modal-body container-fluid creat-app-body",staticStyle:{"max-height":"300px"},attrs:{slot:"modal-body"},slot:"modal-body"},[t("div",{staticClass:"form-group"},[t("input",{directives:[{name:"model",rawName:"v-model",value:s.newApp.name,expression:"newApp.name"}],staticClass:"form-control modal-input",attrs:{type:"text",maxlength:"25",placeholder:s.translate.createAppPlaceholder},domProps:{value:s.newApp.name},on:{input:function(e){e.target.composing||s.$set(s.newApp,"name",e.target.value)}}})]),s._v(" "),t("div",{staticClass:"type-div row"},s._l(s.appCats,function(e,i){return t("span",{key:i,staticClass:"type-span",class:s.newApp.settingType===e.settingType?"active":"",on:{click:function(t){s.newApp.settingType=e.settingType}}},[t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("done"))}}),s._v("\n            "+s._s(s.translate[e.name])+"\n          ")])}),0),s._v(" "),t("div",{staticClass:"type-div row"},[t("div",{staticClass:"app-type-text"},[s._v(s._s(s.translate.selectAppType))]),s._v(" "),t("div",{staticClass:"app-type-content"},s._l(s.typeList,function(e,i){return t("div",{key:i},s._l(e.types,function(e,i){return t("p",{key:i,staticClass:"type-p",class:s.newApp.appTypeId===e.id?"active":"",on:{click:function(t){s.newApp.appTypeId=e.id,s.addAppType=e}}},[t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("done"))}}),s._v("\n                "+s._s(e.name)+"\n              ")])}),0)}),0)])]),s._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){s.showAddModal=!1}}},[s._v(s._s(s.translate.cancel))]),s._v(" "),t("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){return s._editApp(null,s.addAppType)}}},[s._v(s._s(s.translate.sure))])])]),s._v(" "),t("v-modal",{attrs:{show:s.showTypeModal,width:"460"}},[t("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[s._v("\n          "+s._s(s.translate.createAppType)+"\n        ")])]),s._v(" "),t("div",{staticClass:"modal-body container-fluid",attrs:{slot:"modal-body"},slot:"modal-body"},[t("div",{staticClass:"form-group"},[t("input",{directives:[{name:"model",rawName:"v-model",value:s.newType.name,expression:"newType.name"}],staticClass:"form-control modal-input",attrs:{type:"text",maxlength:"16",placeholder:s.translate.createAppTypePlaceholder},domProps:{value:s.newType.name},on:{input:function(e){e.target.composing||s.$set(s.newType,"name",e.target.value)}}})]),s._v(" "),t("div",{staticClass:"type-div row"},s._l(s.typeList,function(e,i){return t("span",{key:i,staticClass:"type-span",class:s.newType.userType===e.userType?"active":"",on:{click:function(t){s.newType.userType=e.userType}}},[t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("done"))}}),s._v("\n            "+s._s(s.translate[e.bigType])+"\n          ")])}),0)]),s._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){s.showTypeModal=!1}}},[s._v(s._s(s.translate.cancel))]),s._v(" "),t("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:s._createAppType}},[s._v(s._s(s.translate.sure))])])]),s._v(" "),t("v-modal",{attrs:{show:s.showImportModal,width:"400"}},[t("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[s._v("\n          "+s._s(s.translate.importApp)+"\n        ")])]),s._v(" "),t("div",{staticClass:"modal-body container-fluid creat-app-body",staticStyle:{"max-height":"300px"},attrs:{slot:"modal-body"},slot:"modal-body"},[t("div",{staticClass:"button-group"},[t("button",{staticClass:"btn clearBtnBorder import-btn",attrs:{type:"button"}},[t("label",{staticClass:"upload-text",attrs:{for:"upload-file",title:s.selectFileName}},[s._v(s._s(s.selectFileName))])]),s._v(" "),s.clearInputShow?t("input",{staticClass:"upload-template",attrs:{type:"file",id:"upload-file"},on:{change:s.getFile}}):s._e()]),s._v(" "),t("div",{staticClass:"type-div row"},[t("div",{staticClass:"app-type-text"},[s._v(s._s(s.translate.selectAppType))]),s._v(" "),t("div",{staticClass:"app-type-content"},s._l(s.typeList,function(e,i){return t("div",{key:i},s._l(e.types,function(e,i){return t("p",{key:i,staticClass:"type-p",class:s.newApp.appTypeId===e.id?"active":"",on:{click:function(t){s.newApp.appTypeId=e.id,s.addAppType=e}}},[t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("done"))}}),s._v("\n                "+s._s(e.name)+"\n              ")])}),0)}),0)])]),s._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){s.showImportModal=!1}}},[s._v(s._s(s.translate.cancel))]),s._v(" "),t("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){return s._importApp(s.addAppType)}}},[s._v(s._s(s.translate.sure))])])])],1),s._v(" "),s.curApp&&"appInfo"===s.miniRoutes?t("app-info",{staticClass:"row",attrs:{departmentId:s.departmentId,appId:s.curApp?s.curApp.id:"",readonly:"manager"===s.role},on:{setForm:function(e){return s._setForm(e,"appInfo")},setFlow:s._setFlow,update:s._updateApp,back:function(e){s.miniRoutes="appManage"}}}):s._e(),s._v(" "),s.curApp&&s.miniRoutes===s.curCheckRoutes?t("FormEngineInfo",{staticClass:"row",attrs:{departmentId:s.departmentId,curCheckRoutes:s.curCheckRoutes,appId:s.curApp?s.curApp.id:"",readonly:"manager"===s.role},on:{setForm:function(e){return s._setForm(e,"formEngine")},setJoinRole:s._setJoinRole,update:s._updateApp,back:function(e){s.miniRoutes="appManage"}}}):s._e(),s._v(" "),"formSetManage"===s.miniRoutes&&s.curApp&&s.curApp.id?t("FormSetManage",{attrs:{student:s.studentBie,departmentId:s.departmentId,appId:s.curApp?s.curApp.id:"",app:s.curApp,readonly:"manager"===s.role,initWay:s.initWay,formId:s.modelId,businessId:s.businessId},on:{back:function(e){return s._backToPage(s.parentPage)},submit:s._saveFormInfo}}):s._e(),s._v(" "),"flowSetManage"===s.miniRoutes&&s.curApp&&s.curApp.id?t("FlowSetManage",{attrs:{departmentId:s.departmentId,userType:s.appUserType,appName:s.appName,appId:s.curApp?s.curApp.id:"",readonly:"manager"===s.role,flowId:s.modelId,businessId:s.businessId},on:{back:function(e){return s._backToPage("appInfo")},submit:s._saveFlowInfo}}):s._e(),s._v(" "),"joinRoleSet"===s.miniRoutes&&s.curApp&&s.curApp.id?t("JoinRoleSetManage",{attrs:{departmentId:s.departmentId,userType:s.appUserType,appName:s.appName,appId:s.curApp?s.curApp.id:"",readonly:"manager"===s.role,businessId:s.businessId},on:{back:function(e){return s._backToPage("formEngine")},submit:s._savePlayers}}):s._e()],1)},staticRenderFns:[]};var v=t("C7Lr")(m,b,!1,function(s){t("fi9f")},null,null);e.default=v.exports},XEGY:function(s,e){},fhnB:function(s,e,t){"use strict";var i=t("3cXf"),a=t.n(i),n=t("kV13"),o=t("qqHy"),r=t.n(o),c=t("C331"),u=t("iScu"),l=(u.a,{props:{departmentId:{default:"1"},appId:{required:!0,default:""},readonly:{default:!1},curCheckRoutes:{default:""}},created:function(){var s=this,e=localStorage.getItem("lang");Object(c.g)(e)&&(this.lang=e),Object(c.e)({url:"/api/system/dictTypes/1003/dicts?lang=",type:"get",async:!1,success:function(e){s.schoolStatus=e.data}}),Object(c.e)({url:"/api/system/dicts?dictType=培养层次",type:"get",async:!1,success:function(e){s.educationLevel=e.data}}),Object(c.e)({url:"/api/relationship/getSelectOptions",dataType:"json",type:"get",success:function(e){e.state&&(s.collegeOptions=e.data.colleges||[],s.gradeOptions=e.data.grades||[])}}),this._initCurApp(),"link"!==this.curRoute?this._initCache(function(){s._initBusinessList()}):this._initBusinessList(),this._initPlayersData(),this.curRoute=this.curCheckRoutes,this.nowTime=(new Date).getTime(),this.backgroundList=[{id:0,background:"linear-gradient(-135deg, #3F87E7 0%, #377EEB 100%)"},{id:1,background:"linear-gradient(-135deg, #F4A23F 0%, #F4A441 100%)"},{id:2,background:"linear-gradient(-135deg, #EF5E36 0%, #EF5E36 100%)"},{id:3,background:"linear-gradient(-135deg, #59CAAD 0%, #59C9AC 100%)"},{id:4,background:"linear-gradient(-135deg, #8489D8  0%, #888ACA 100%)"},{id:5,background:"linear-gradient(-135deg, #51B590 0%, #51B590 100%)"},{id:6,background:"linear-gradient(-135deg, #CEA44D 0%, #E0C37A 100%)"}],this.iconList=[{id:0,name:"school"},{id:1,name:"accessibility"},{id:2,name:"account_balance"},{id:3,name:"account_balance_wallet"},{id:4,name:"account_circle"},{id:5,name:"alarm"},{id:6,name:"assignment"},{id:7,name:"book"},{id:8,name:"build"},{id:9,name:"description"},{id:10,name:"explore"},{id:11,name:"extension"},{id:12,name:"face"},{id:13,name:"favorite"},{id:14,name:"flight_land"},{id:15,name:"flight_takeoff"},{id:16,name:"get_app"},{id:17,name:"grade"},{id:18,name:"language"},{id:19,name:"launch"},{id:20,name:"loyalty"},{id:21,name:"perm_contact_calendar"},{id:22,name:"receipt"},{id:23,name:"question_answer"},{id:24,name:"restore"},{id:25,name:"room"},{id:26,name:"schedule"},{id:27,name:"search"},{id:28,name:"shopping_cart"},{id:29,name:"swap_horiz"},{id:30,name:"theaters"},{id:31,name:"update"},{id:32,name:"verified_user"},{id:33,name:"work"},{id:34,name:"visibility"},{id:35,name:"equalizer"},{id:36,name:"business"},{id:37,name:"call"},{id:38,name:"chat"},{id:39,name:"email"},{id:40,name:"create"},{id:41,name:"flag"},{id:42,name:"save"},{id:43,name:"link"},{id:44,name:"send"},{id:45,name:"devices"},{id:46,name:"attach_file"},{id:47,name:"format_quote"},{id:48,name:"cloud"},{id:49,name:"folder"},{id:50,name:"computer"},{id:51,name:"headset"},{id:52,name:"security"},{id:53,name:"sim_card"},{id:54,name:"watch"},{id:55,name:"add_a_photo"},{id:56,name:"camera_alt"},{id:57,name:"directions_railway"},{id:58,name:"directions_bike"},{id:59,name:"local_activity"},{id:60,name:"directions_walk"},{id:61,name:"local_dining"},{id:62,name:"local_hospital"},{id:63,name:"local_library"},{id:64,name:"event_note"},{id:65,name:"map"},{id:66,name:"navigation"},{id:67,name:"wifi"},{id:68,name:"ac_unit"},{id:69,name:"fitness_center"},{id:70,name:"pool"},{id:71,name:"cake"},{id:72,name:"group"},{id:73,name:"location_city"},{id:74,name:"notifications"},{id:75,name:"person"},{id:76,name:"poll"},{id:77,name:"public"},{id:78,name:"share"},{id:79,name:"whatshot"}],this.appState.inSchoolOptions=[{id:0,label:this.translate.unlimited},{id:1,label:this.translate.inSchool},{id:2,label:this.translate.notAtSchool}],this.appState.infoTypes=[{id:"base",name:this.translate.baseInfo},{id:"faceTo",name:this.translate.facePeople},{id:"timeSet",name:this.translate.timeSet},{id:"description",name:this.translate.description}];for(var t=(new Date).getFullYear(),i=t+3;i>t-5;i--)this.appState.gradeOptions.push({id:i+"",label:i+"-"+(i+1)+this.translate.schoolYear});for(var a=t+3;a>t-5;a--)this.appState.gradeOptions2.push({id:a+"",label:a+this.translate.level});this.JiekouColumns=[{id:"name",title:"姓名",width:130,className:"text-left",hidden:!1},{id:"userNo",title:"学号",width:150,className:"text-left",hidden:!1,formatter:function(e,t){return"3"===s.curApp.appType.userType?e.account:e.userNo}},{id:"collegeName",title:"学院",width:150,className:"text-left",hidden:!1},{id:"grade",title:"年级",width:80,className:"text-left",hidden:!1},{id:"educetionLevel",title:"培养层次",width:100,className:"text-left",hidden:!0},{id:"createTime",title:"更新时间",width:100,className:"text-left",hidden:!1}]},data:function(){var s=this;return{valueTime:"",pickerOptionsValueTime:{disabledDate:function(e){return e.getTime()<new Date(s.curBusiness.business.beginTime).getTime()}},busType:"1",showBusSettingModal:!1,curBusinessIdx:-1,showAddModal:!1,showAddOnePersonModal:!1,isShowMemberTable:!0,addPersonParams:{},tempUserIdArr:[],unpublishCacheKey:"",publishedCacheKey:"",JiekouColumns:[],typeL:"",schoolStatus:[],educationLevel:[],notInSchoolStatus:[],inSchoolStatus:[],showTableModal:!1,iconList:[],saasIconList:["road","book","camera","idcard","tuition","bankcard","list","text","help","layer","package","cap","letter","calendar","menu","menu2","menu3","apply","info","rightcard","drippower","bulb","record","direction","person","envelope","reduce","socialist","star","assets","notebook","location","purse","remark","statisticsbar","building","geography","rotate","manlove","medal","pick","purse2","free","tag","menudone","travel","trophy","medal2","question","excellent","search"],formList:[],curApp:{name:"点击右侧按钮编辑应用名称",imgPath:"",remark:"应用说明"},editorConfig:{initialFrameHeight:520},nameChangeMsg:"",descChangeMsg:"",appState:{editPart:"",showFormModal:!1,showFlowModal:!1,infoType:"base",flowName:"",formName:"",modelId:"",infoTypes:[],columns:[],recordColumns:[],inSchoolOptions:[],gradeOptions:[],gradeOptions2:[],flowData:{id:"",chart:{}},background:"linear-gradient(-135deg, #5067D7 0%, #3F53B8 100%)"},businessList:[],leftIconShow:!1,rightIconShow:!1,curBusiness:null,timeSet:null,errorMsg:"",nowTime:"",defineSearch:{status:"",collegeCode:"",grade:""},collegeOptions:[],gradeOptions:[],preview:!1,previewObj:{formData:null,authorities:null,recordData:[],curBusinessId:"",appId:""},importParams:{parentPageTitle:"人员列表",downloadTemplateUrl:"/app/business/studentExcelTemplate",downloadErrorTemplateUrl:"/app/business/errorBusinessStudentExcel",checkTemplateUrl:"",templateName:"面向人员名单导入模板",importBtnType:null},onLoadingForm:!1,showImportModal:!1,overriteImport:"覆盖导入",incrementImport:"增量导入",timestamp:"",players:[],timeNodeId:"",timeType:"",curSelectedTime:"",timeSetData:[],releaseAppDisabled:!1,releaseBusinessDisabled:!1,annoreleaseBusinessText:"",formTimeName:"",newName:"",numberDesc:"",showIconModal:!1,backgroundList:[],reviseSetTimeOut:null,clickCount:0,canEditPublishedBusiness:!1,isReviseData:!1,curRoute:"",businessTimer:null,blankTemplateId:"",faceToPeopleType:["2","3","4"],lang:"zh-cn",checkedNum:0,needCheckCount:0,hadCheckCount:1}},computed:{isReviseBusiness:function(){return this.canEditPublishedBusiness&&this.curBusiness&&!this.curBusiness.business.isPublishing},host:function(){return window.location.host},translate:function(){return Object(c.g)(this.lang).formEngineInfo},businessIsOn:function(){var s=this,e=!1;return this.curBusiness&&this.businessList.forEach(function(t){t.business.id!==s.curBusiness.business.id&&t.business.isPublic&&t.business.isEnable&&(e=!0)}),e},peopleUrl:function(){return"/table-data/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/users/page?timestamp="+this.timestamp},isCache:function(){return"link"!==this.curRoute&&(!this.curBusiness.business.isPublic||this.isReviseBusiness)},cacheKey:function(){return"link"!==this.curRoute?this.curBusiness&&this.curBusiness.business.isPublic?this.publishedCacheKey:this.unpublishCacheKey:""},allPeopleUrl:function(){return"/table-data/app/"+this.appId+"/business/users/"+this.curBusiness.business.id+"/users/page?isCache="+this.isCache+"&key="+this.cacheKey+"&timestamp="+this.timestamp},peopleUrlJiekou:function(){return"/table-data/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/api/users/page?timestamp="+this.timestamp},inputStyleWidth:function(){return this.curApp.name.length<=20?34*this.curApp.name.length:27*this.curApp.name.length},rowsNumber:function(){return this.curApp.remark?this.curApp.remark.length>62&&this.curApp.remark.length<=124?2:this.curApp.remark.length>124&&this.curApp.remark.length<=186?3:this.curApp.remark.length>186?4:1:1}},watch:{appId:function(){this._initCurApp()},errorMsg:function(){var s=this;setTimeout(function(){s.errorMsg=""},1500)},curBusiness:function(){this.curBusiness&&(this._loadBusinessTime("clickBusiness"),this.getInstancesCode())},curApp:function(){var s=this,e="";this.curApp&&this.curApp.appType&&("1"===this.curApp.appType.userType?e=this.translate.userNo:"2"===this.curApp.appType.userType?e="教工号":"3"===this.curApp.appType.userType?e=this.translate.freshmanNo:"4"===this.curApp.appType.userType&&(e="学工号")),"4"!==this.curApp.appType.userType?this.appState&&this.appState.columns&&this.appState.columns[1]&&n.default.set(this.appState.columns[1],"title",e):this.appState.columns=[{id:"name",title:this.translate.name,width:130,className:"text-left",hidden:!1,search:{type:"input"}},{id:"userNo",title:this.translate.instructorNo,width:150,className:"text-left",hidden:!1,search:{type:"input"}},{id:"college",title:this.translate.college,width:150,className:"text-left",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code"}},formatter:function(s){return s.collegeName}},{id:"opt",title:"操作",className:"text-left",width:100,hidden:!1,formatter:function(e){return[{tag:"a",text:"删除",callback:function(e,t){if(!s.curBusiness.business.isPublic||s.isReviseBusiness){if(confirm("确定要删除吗？")){var i="/api/app/"+s.appId+"/business/"+s.curBusiness.business.id+"/"+e.userId;i+="?isCache="+s.isCache+"&key="+s.cacheKey,Object(c.e)({url:i,dataType:"json",type:"post",success:function(e){e.state?(s.$toast("删除成功"),s.timestamp=new Date):s.$toast(e.message)}})}}else s.$toast("非编辑状态不能操作！")}}]}}],this.appState&&this.appState.recordColumns&&this.appState.recordColumns[1]&&n.default.set(this.appState.recordColumns[1],"title",e),this.numberDesc=e}},beforeDestroy:function(){this._clearTimeOut()},methods:{_cancel:function(){var s=this;confirm("是否取消发布业务期？取消后，该业务期将不会发布！")&&Object(c.e)({url:"/api/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/publish/stop",dataType:"json",type:"post",success:function(e){e.state?(s.$toast("已取消发布本业务期"),s.$nextTick(function(){s.curBusiness.business.readyPublish=!1})):s.$toast(e.message)}})},showBus:function(){this.curBusiness.business.beginTime?(this.valueTime=this.curBusiness.business.beginTime,this.showBusSettingModal=!0):this.$toast("请设置业务期的开始时间和结束时间")},_saveRelease:function(){"1"==this.busType&&this._releaseBusiness("release",!0),"2"==this.busType&&(this.valueTime?this._releaseBusiness("release",!1,this.valueTime):this.$toast("定时发布时间未设置！"))},_clearTimeOut:function(){this.timeOutFun&&clearTimeout(this.timeOutFun)},_initTableColunm:function(){var s=this;this.appState.columns=[{id:"name",title:this.translate.name,width:130,className:"text-left",hidden:!1,search:{type:"input"}},{id:"userNo",title:this.numberDesc,width:150,className:"text-left",hidden:!1,search:{type:"input"}},{id:"college",title:this.translate.college,width:150,className:"text-left",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code"}},formatter:function(s){return s.collegeName}},{id:"grade",title:this.translate.grade,width:80,className:"text-left",hidden:!1,search:{type:"select",data:{optionsLabel:"label",optionsValue:"id",options:this.appState.gradeOptions2}}},{id:"studentType",title:this.translate.studentType,width:100,className:"text-left",hidden:!0},{id:"schoolStatus",title:this.translate.inSchoolStatus,width:100,className:"text-left",hidden:!1,search:{type:"select",data:{optionsLabel:"label",optionsValue:"value",options:this.schoolStatus}},formatter:function(s){return s.inSchoolValue}},{id:"educationLevel",title:this.translate.educationLevel,width:100,className:"text-left",hidden:!1,search:{type:"select",data:{optionsLabel:"label",optionsValue:"value",options:this.educationLevel}}},{id:"opt",title:"操作",className:"text-left",width:80,hidden:!1,formatter:function(e){return[{tag:"a",text:"删除",callback:function(e,t){if(!s.curBusiness.business.isPublic||s.isReviseBusiness){if(confirm("确定要删除吗？")){var i="/api/app/"+s.appId+"/business/"+s.curBusiness.business.id+"/"+e.userId;i+="?isCache="+s.isCache+"&key="+s.cacheKey,Object(c.e)({url:i,dataType:"json",type:"post",success:function(e){e.state?(s.$toast("删除成功"),s.timestamp=new Date):s.$toast(e.message)}})}}else s.$toast("非编辑状态不能操作！")}}]}}],"2"!=this.curApp.appType.userType&&"4"!=this.curApp.appType.userType||(this.appState.columns[3].hidden=!0,this.appState.columns[5].hidden=!0,this.appState.columns[6].hidden=!0)},_afterChecked:function(s){this.checkedNum=s.length,this.tempUserIdArr=s.map(function(s){return s.userId})},afterSelectAddPerson:function(s){this.addPersonParams.userId=s.userId,this.addPersonParams.userNo=s.userNo,this.addPersonParams.name=s.name},addPersonByOne:function(){this.showAddOnePersonModal=!0,this.showAddModal=!1},addOnePerson:function(){var s=this,e="/api/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/users?userId="+this.addPersonParams.userId+"&isCache="+this.isCache+"&key="+this.cacheKey;Object(c.d)(e,null,"post").then(function(e){e.state?(s.$toast("操作成功!"),s.showAddOnePersonModal=!1,s.timestamp=new Date):s.$toast(e.message)})},searchByCondition:function(){"link"!==this.curRoute&&this.cacheBusinessInfo("1"),this.isShowMemberTable=!0,this._initTableColunm()},batchDelete:function(){var s=this,e=this.tempUserIdArr,t="/api/app/batch/"+this.appId+"/business/"+this.curBusiness.business.id+"?isCache="+this.isCache+"&key="+this.cacheKey;confirm("确定批量删除选中人员")&&Object(c.e)({url:t,dataType:"json",type:"post",data:e,success:function(e){e.state?(s.$toast("删除成功!"),s.tempUserIdArr=[],s.timestamp=new Date,s.checkedNum=0):s.$toast(e.message)}})},updateHand:function(){var s=this;Object(c.e)({url:"/api/app/business/updateUserByApi/"+this.curBusiness.business.id,dataType:"json",type:"get",success:function(e){e.state&&(s.$toast("更新成功"),s.timestamp=new Date)}})},_saveTableSet:function(){var s=this;this.$refs.tableset.save().then(function(e){e.state?(s.showTableModal=!1,s.$toast("保存成功")):s.$toast("错误:"+e.message)}).catch(function(e){s.$toast("错误:"+e.message)})},_setTable:function(){this.showTableModal=!0,this.$refs.tableset.onShow()},_initImportTpl:function(){this.curApp&&this.curApp.appType&&"3"===this.curApp.appType.userType&&(this.importParams.downloadTemplateUrl="/app/business/freshmanExcelTemplate")},_changeBusinessGuide:function(s){this.curBusiness.business.guide=s,this.isReviseData=!0},_collegeSearch:function(s){this.defineSearch.collegeCode=s.val},_stateSearch:function(s){this.defineSearch.status=s.val},_tabClick:function(s){var e=this;this.appState.infoType=s.id,this.timeType="",this.showImportModal=!1,this.showAddModal=!1,this.showAddOnePersonModal=!1,this._loadBusinessTime(),this._initTableColunm(),this.importParams.checkTemplateUrl="/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/excel",this.importParams.importBtnType=[{name:this.incrementImport,url:"/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/updateExcel",method:"post",isShowBtn:!0,success:function(s){s.state&&(e.timestamp=new Date)}}]},_changeBusiness:function(s,e,t){this.typeL=e,this.curBusinessIdx=t,this._clearTimeOut(),this.$set(this,"curBusiness",JSON.parse(a()(s))),this.showImportModal=!1,this.showAddModal=!1,this.showAddOnePersonModal=!1,this.canEditPublishedBusiness=!1},_back:function(){this.$emit("back"),this.businessTimer&&clearInterval(this.businessTimer)},_initCache:function(s){var e=this;Object(c.e)({url:"/api/business/users/"+this.appId+"/init/cache",type:"post",success:function(t){t.state?t.data&&(e.unpublishCacheKey=t.data,"function"==typeof s&&s()):e.$toast(t.message)}})},_initPlayersData:function(){var s=this;Object(c.e)({url:"/api/apps/"+this.appId+"/settings/players",type:"get",success:function(e){e.state?e.data&&(s.players=e.data.players):s.$toast(e.message)}})},_initFormList:function(){var s=this;""!==this.appId?Object(c.e)({type:"get",url:"/api/departments/"+this.departmentId+"/apps/forms?userType="+this.curApp.appType.userType,success:function(e){e.state?s.formList=e.data:s.$toast(e.message)}}):this.formList=[]},_getFormName:function(s){var e=this;Object(c.e)({url:"/api/apps/"+this.appId+"/settings/forms",type:"get",success:function(s){s.state?s.data&&(e.appState.formName=s.data.name):e.$toast(s.message)}})},_initCurApp:function(){var s=this;Object(c.e)({type:"get",url:"/api/app/"+this.appId,success:function(e){e.state?(s.curApp=e.data,s.$set(s.appState,"imgType",s.curApp.imgType),s.curApp&&s.curApp.appType&&("4"===s.curApp.appType.userType||"2"===s.curApp.appType.userType?s.blankTemplateId="000000000000000000000002":s.blankTemplateId="000000000000000000000001"),s._initFormList(),"formEngine"===s.curRoute&&s._getFormName()):s.$toast(e.message)}})},_initCheckPublishResultSchedule:function(s){var e=this;s.publishAsync&&s.publishAsync.timer&&clearInterval(s.publishAsync.timer),s.publishAsync.timer=setInterval(function(){e.refreshImportProgress(s)},1e3)},endRefreshImportProgress:function(s){clearInterval(s.publishAsync.timer)},refreshImportProgress:function(s){var e=this;s.publishAsync.code?Object(c.e)({url:"/api/async/imports/importStatus/"+s.publishAsync.code,dataType:"json",success:function(t){t.state?"IMPORT_COMPLETE"===t.data.status?(s.publishAsync.processing=!1,s.publishAsync.code=null,s.publishAsync.done=0,s.publishAsync.total=0,e.endRefreshImportProgress(s),s.business.isPublic=!0,s.business.isPublishing=!1,e.$toast(s.business.name+"发布成功")):"IMPORT_ERROR"===t.data.status?(s.publishAsync.processing=!1,s.publishAsync.code=null,s.publishAsync.done=0,s.publishAsync.total=0,e.endRefreshImportProgress(s),e.$toast(t.data.message)):(s.publishAsync.total=t.data.count||0,s.publishAsync.done=t.data.hadCheckCount||0,s.business.id==e.curBusiness.business.id&&(e.curBusiness=s,e.$set(e,"curBusiness",s))):e.$toast(t.message)}}):this.endRefreshImportProgress(s)},_initBusinessList:function(){var s=this;Object(c.e)({type:"get",url:"/api/app/"+this.appId+"/business?key="+this.cacheKey,success:function(e){e.state?(e.data.forEach(function(s,e){s.publishAsync={processing:!1,code:"",timer:null,done:0,total:0}}),s.$set(s,"businessList",e.data),s.businessList.forEach(function(e,t){e.business.isPublic&&e.business.isEnable&&(s.curBusiness=e,s.curBusinessIdx=t,s.typeL=e.business.limitType,s._scrollToBusiness(t),s.businessTimer&&clearInterval(s.businessTimer)),e.business.isPublishing&&(e.publishAsync.code=e.business.publishCode,e.publishAsync.processing=!0,s._initCheckPublishResultSchedule(e))})):s.$toast(e.message)}})},_updataForm:function(){var s=this,e="api/formEngine/cache/business/"+this.curBusiness.business.id+"/formInstances";Object(c.d)(e).then(function(e){e.state&&(s.instanceCode=e.data,s.getInstances())})},getInstancesCode:function(){var s=this,e="api/formEngine/business/"+this.curBusiness.business.id+"/cache/key";Object(c.d)(e).then(function(e){if(e.state&&e.data)return s.instanceCode=e.data.code,void s.getInstances();s.onLoadingForm=!1,s.instanceCode=null})},getInstances:function(){var s=this;this.onLoadingForm=!0;var e=this.instanceCode;if(e){var t="api/async/imports/importStatus/"+e;Object(c.e)({url:t,type:"get",success:function(e){"IMPORT_COMPLETE"===e.data.status?(localStorage.removeItem("formCode"+s.curBusiness.business.id),s.onLoadingForm=!1,s.$toast("同步完成")):e.data.status&&("IMPORT_ERROR"===e.data.status?s.$toast(e.data.message):(s.needCheckCount=e.data.count,s.hadCheckCount=e.data.hadCheckCount,s.timeOutFun=setTimeout(function(){return s.getInstances()},2e3)))}})}else this.onLoadingForm=!1},_releaseBusiness:function(s,e,t){var i=this;if("release"===s){if(this.releaseBusinessDisabled)return;if(!confirm("确认发布本业务吗？业务期一旦开启，为保证申请的正常进行，系统将自动锁定该业务期所关联的流程及表单，业务期内将无法再对流程及表单进行编辑"))return;this.releaseBusinessDisabled=!0,this.annoreleaseBusinessText=this.translate.announcing;var a="1"==this.busType?"true":"false",n="2"==this.busType?t:"";this._save("business",function(){Object(c.e)({url:"/api/app/"+i.appId+"/business/"+i.curBusiness.business.id+"/publish?isImmediately="+a+"&publishTime="+n,type:"post",success:function(s){i.releaseBusinessDisabled=!1,i.annoreleaseBusinessText="",s.state?("2"==i.busType&&(i.showBusSettingModal=!1,i.$toast("业务期将于"+i.valueTime+"发布！"),i.$nextTick(function(){i.curBusiness.business.readyPublish=!0})),s.data.publishing&&!s.data.published&&(i.$toast("业务期发布中，请耐心等待"),i.showBusSettingModal=!1,i.curBusiness.business.isPublishing=!0,i.curBusiness.publishAsync.code=s.data.publishCode,i.curBusiness.publishAsync.processing=!0,i._initCheckPublishResultSchedule(i.curBusiness)),s.data.published&&(i.curBusiness.business.isPublic=!0,i.$toast(i.translate.releaseBusinessSuccess))):("31120"===s.code&&(i.$toast("业务期发布中，请耐心等待"),i.curBusiness.publishAsync.code=s.data.publishCode,i.curBusiness.publishAsync.processing=!0,i._initCheckPublishResultSchedule(i.curBusiness)),"31114"===s.code?(i.releaseBusinessDisabled=!0,i.annoreleaseBusinessText=i.translate.announcing,confirm("应用未发布情况下无法发布业务期，确定同时发布应用吗？")?Object(c.e)({url:"/api/app/"+i.appId+"/business/"+i.curBusiness.business.id+"/publish?publishApp=true",type:"post",success:function(s){i.releaseBusinessDisabled=!1,i.annoreleaseBusinessText="",s.state?(i.showBusSettingModal=!1,i.curApp.isPublished=!i.curApp.isPublished,i.releaseBusinessDisabled=!0,i.curBusiness.publishAsync.code=s.data.publishCode,i.curBusiness.business.isPublishing=!0,i.curBusiness.publishAsync.processing=!0,i._initCheckPublishResultSchedule(i.curBusiness),i.$toast("应用"+i.translate.release+i.translate.success)):i.$toast(s.message)}}):(i.releaseBusinessDisabled=!1,i.annoreleaseBusinessText="")):i.$toast(s.message))}})})}else confirm("确定要停止此业务期吗？停止后，此业务期的所有数据将作废且不可恢复")&&this._stopOrRemove("stop")},_removeBusiness:function(s){confirm(this.translate.removeBusinessConfirm)&&this._stopOrRemove("remove",s)},_stopOrRemove:function(s,e){var t=this,i="stop"===s?this.curBusiness.business.id:this.businessList[e].business.id;i?Object(c.e)({url:"/api/app/"+this.appId+"/business/"+i+"/delete",type:"post",success:function(a){t.$toast("操作成功"),a.state?"stop"===s?t.curBusiness.business.isEnable=!1:(t.businessList[e].publishAsync.timer&&clearInterval(t.businessList[e].publishAsync.timer),t.businessList.splice(e,1),t._testIconShow(),t.curBusiness.business.id===i&&(t.curBusiness=null,t.curBusinessIdx=-1)):t.$toast(a.message)}}):(this.businessList.splice(e,1),this.$toast(this.translate.removeSuccessTip))},_addNewBusiness:function(){if(this.typeL="",this.showImportModal=!1,"formEngine"!==this.curRoute||this.curApp.setting.formId&&this.curApp.setting.playerSettingId){var s,e,t=(new Date).getFullYear();(new Date).getMonth()>=8?(s=t+"-"+(t+1)+"学年"+this.curApp.name,e=t):(s=t-1+"-"+t+"学年"+this.curApp.name,e=t-1);var i=s;this.creatNewName(s,i),this.appState.infoType="base",this.curBusiness={business:{name:this.newName,year:e+"",linkUrl:"",guide:"",settingId:"",businessTimeList:[],limitType:null,beginTime:"",endTime:"",isEnable:!1,isLimit:!1,isPublishing:!1,readyPublish:!1,publishCode:""},publishAsync:{processing:!1,code:"",timer:null,done:0,total:0},businessLimit:{inSchool:0,grade:[],studentType:[],schoolStatus:[],educationLevel:[],url:"",updateType:"COVER",cron:""}},this.businessList.push(this.curBusiness),this.curBusinessIdx=this.businessList.length-1,this._scrollToBusiness(this.businessList.length-1),this.timeSetData=[],this._save("business",function(){})}else this.$toast(this.translate.addNewTip)},creatNewName:function(s,e){var t=!1;this.businessList.forEach(function(i){if(i.business.name===s){t=!0;var a=s.split(e);if(a[1]){var n=parseInt(a[1])+1;s=e+n}else s=e+1}}),t?this.creatNewName(s,e):this.newName=s},_editPart:function(s){this.showIconModal=!0,this.appState.editPart=s,this.$set(this.appState,s,this.curApp[s]),this.$set(this.appState,"imgPath",this.curApp.imgPath),this.curApp.background&&this.$set(this.appState,"background",this.curApp.background),this.$set(this.appState,"imgPath",this.curApp.imgPath)},_cancelPart:function(s){this.showIconModal=!1,this.appState.editPart="",this.appState[s]="",this.appState.background=""},_savePart:function(s){this.curApp[s]=this.appState[s],this.appState.editPart="",this.appState[s]=""},_selectIcon:function(s,e){this.appState.imgPath=s.name,this.appState.imgType=e||"1"},_selectBackground:function(s){this.appState.background=s.background},_saveAppIcon:function(){var s=this;Object(c.e)({url:"/api/app/"+this.curApp.id+"/style",type:"post",data:{imgPath:this.appState.imgPath,imgType:this.appState.imgType,background:this.appState.background},success:function(e){e.state?(s._savePart("imgPath"),s._savePart("imgType"),s._savePart("background"),s.$emit("update",s.curApp),s.showIconModal=!1):s.$toast(e.message)}})},_setAppForm:function(){this.curApp.setting.formId?this._initWithModel():(this.$set(this.appState,"form",this.curApp.form),this.appState.showFormModal=!0)},_setJoinRole:function(){this.$emit("setJoinRole",{businessId:""}),this._save("",function(){})},_initWithModel:function(){this.$emit("setForm",{modelId:this.appState.modelId,type:this.curApp.setting.formId?"edit":"create",businessId:""}),this._save("",function(){})},_scrollLeft:function(){r()("#businessDiv").animate({scrollLeft:r()("#businessDiv").scrollLeft()-500},100),this._testIconShow()},_scrollRight:function(){r()("#businessDiv").animate({scrollLeft:r()("#businessDiv").scrollLeft()+500},100),this._testIconShow()},_scrollToBusiness:function(s){var e=this;setTimeout(function(){r()("#businessDiv").animate({scrollLeft:r()("#businessDiv").scrollLeft()+200*s},100),e._testIconShow()},300)},_testIconShow:function(){var s=this;setTimeout(function(){s.leftIconShow=r()("#businessDiv").scrollLeft()>0,s.rightIconShow=r()(".business-scroll").width()-r()("#businessDiv").scrollLeft()>r()("#businessDiv").width()},300)},_compareTime:function(s,e){var t=new Date(s[e].start).getTime(),i=new Date(s[e].end).getTime();return this.nowTime<t?0===e?"left":this.nowTime>new Date(s[e-1].end).getTime()?"left":"":this.nowTime>t&&this.nowTime<i?"center":""},_changeLimitType:function(s){this.curBusiness.business.isPublic&&!this.isReviseBusiness||null!==this.curBusiness.business.limitType&&this.curBusiness.business.isPublic&&this.isReviseBusiness&&!confirm("若选择其他方式的面向人员名单设置，之前的操作将会被删除！")||(this.isShowMemberTable=!0,"1"===s&&(this.isShowMemberTable=!1),"3"!==s&&"link"!==this.curRoute&&this.cacheBusinessInfo(s),this.curBusiness.business.limitType=s)},cacheBusinessInfo:function(s){var e=this;this.changeBusinessLimit(),Object(c.e)({url:"/api/business/users/"+this.curBusiness.business.id+"/cache/"+s+"?key="+this.cacheKey,type:"post",data:{inSchool:this.curBusiness.businessLimit.inSchool,grade:this.curBusiness.businessLimit.grade,studentType:this.curBusiness.businessLimit.studentType,schoolStatus:this.curBusiness.businessLimit.schoolStatus,educationLevel:this.curBusiness.businessLimit.educationLevel,url:this.curBusiness.businessLimit.url,updateType:this.curBusiness.businessLimit.updateType,cron:this.curBusiness.businessLimit.cron},success:function(s){s.state?e.timestamp=new Date:e.$toast(s.message)}})},_afterSelectYear:function(s){this.curBusiness.business.year=s.value,this.isReviseData=!0},_afterSelectStuType:function(s){this.curBusiness.businessLimit||this.$set(this.curBusiness,"businessLimit",{}),this.$set(this.curBusiness.businessLimit,"studentType",s.value)},_afterSelectGrade:function(s){this.curBusiness.businessLimit||this.$set(this.curBusiness,"businessLimit",{}),this.$set(this.curBusiness.businessLimit,"grade",s.value)},_afterSelectSchoolStatus:function(s){this.curBusiness.businessLimit||this.$set(this.curBusiness,"businessLimit",{}),n.default.set(this.curBusiness.businessLimit,"schoolStatus",s.val)},_afterSelectEducationLevelStatus:function(s){this.curBusiness.businessLimit||this.$set(this.curBusiness,"businessLimit",{}),n.default.set(this.curBusiness.businessLimit,"educationLevel",s.val)},_afterSelectInSchool:function(s){this.curBusiness.businessLimit||this.$set(this.curBusiness,"businessLimit",{}),this.$set(this.curBusiness.businessLimit,"inSchool",s.value)},_changeLinkUseBusiness:function(s){var e=this;this.curApp.setting.useBusiness="use"===s,Object(c.e)({url:"/api/app/"+this.appId+"/useBusiness",type:"post",data:{useBusiness:this.curApp.setting.useBusiness},success:function(s){s.state?e.$toast(e.translate.modifySuccess):e.$toast(s.message)}})},_saveLink:function(){var s=this;Object(c.e)({url:"/api/app/"+this.appId+"/url",type:"post",data:{linkUrl:this.curApp.setting.linkUrl},success:function(e){e.state?s.$toast(s.translate.modifySuccess):s.$toast(e.message)}})},_linkBusinessTime:function(s){var e=this;if(!this.curBusiness.business.isPublic||this.isReviseBusiness){var t=window.event;this.timeType=s,this.isReviseData=!0,setTimeout(function(){e.$date({dateFormat:"yyyy-MM-dd hh:ii:ss",value:e.curSelectedTime||"",type:"init",event:t,onSelect:function(s){e._linkSelectBusinessTime({value:s})}})},100)}},_linkSelectBusinessTime:function(s){if(s.value){if("startTime"===this.timeType){if(this.curBusiness.business.endTime&&this.curBusiness.business.endTime<s.value)return this.errorMsg=this.translate.startTimeTip,this.curBusiness.business.beginTime="",!1;this.curBusiness.business.beginTime=s.value}if("endTime"===this.timeType){if(this.curBusiness.business.beginTime&&this.curBusiness.business.beginTime>s.value)return this.errorMsg=this.translate.endTimeTip,this.curBusiness.business.endTime="",!1;this.curBusiness.business.endTime=s.value}this.errorMsg=""}},_nodeSelected:function(s,e,t,i){var a=this;if(!this.curBusiness.business.isPublic||this.isReviseBusiness){var n=window.event||s;this.timeNodeId=e,this.timeType=t,this.formTimeName=i,this.timeSetData.forEach(function(s){a.timeNodeId===s.nodeId&&(a.curSelectedTime=s[a.timeType])}),this.isReviseData=!0,setTimeout(function(){a.$date({dateFormat:"yyyy-MM-dd hh:ii:ss",value:a.curSelectedTime||"",type:"init",event:n,onSelect:function(s){a._daySelectedOfValue({value:s})}})},100)}},_daySelectedOfValue:function(s){var e=this;s.value&&this.timeSetData.forEach(function(t){if(e.timeNodeId===t.nodeId){if("startDate"===e.timeType&&t.endDate&&t.endDate<s.value)return e.errorMsg=e.formTimeName+e.translate.startTimeTip,!1;if("endDate"===e.timeType&&t.startDate&&t.startDate>s.value)return e.errorMsg=e.formTimeName+e.translate.endTimeTip,!1;e.errorMsg="",t[e.timeType]=s.value}})},timeFormat:function(s,e){if(!s)return"";var t={"M+":s.getMonth()+1,"d+":s.getDate(),"h+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};for(var i in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e},_loadBusinessTime:function(s){var e=this;this.curBusiness.business.businessTimeList&&0!==this.curBusiness.business.businessTimeList.length?"formEngine"===this.curRoute&&(0!==this.timeSetData.length&&"clickBusiness"!==s||(this.timeSetData=JSON.parse(a()(this.curBusiness.business.businessTimeList))),this.timeSetData.forEach(function(s,t){e.players[t]&&s.nodeId===e.players[t].id&&(e.$set(s,"title",""),s.title=e.players[t].name)})):(this.curBusiness.business.businessTimeList=[],this.players.forEach(function(s){e.curBusiness.business.businessTimeList.push({nodeId:s.id,startDate:"",endDate:"",isLimit:!1})}))},_getDatetimeArr:function(s){var e=[];return s.forEach(function(s){e.push({id:s.nodeId,datetime:s.endDate})}),e},_getBusinessTime:function(){var s=this,e=[],t=[],i=[],n=[];this.timeSetData.forEach(function(o,r){if(s.curBusiness.business.businessTimeList[r].nodeId===o.nodeId){if(s.curBusiness.business.businessTimeList[r].startDate=JSON.parse(a()(o.startDate)),s.curBusiness.business.businessTimeList[r].endDate=JSON.parse(a()(o.endDate)),o.startDate){e.push(o.startDate);var c=new Date(o.startDate.replace(/-/g,"/"));i.push(Date.parse(c))}if(o.endDate){t.push(o.endDate);c=new Date(o.endDate.replace(/-/g,"/"));n.push(Date.parse(c))}}}),this.curBusiness.business.beginTime=this.curBusiness.business.beginTime?this.curBusiness.business.beginTime:"",this.curBusiness.business.endTime=this.curBusiness.business.endTime?this.curBusiness.business.endTime:""},changeBusinessLimit:function(){if(this.curBusiness&&this.curBusiness.businessLimit&&null!=this.curBusiness.businessLimit.schoolStatus&&!(this.curBusiness.businessLimit.schoolStatus instanceof Array))if(""==this.curBusiness.businessLimit.schoolStatus)this.curBusiness.businessLimit.schoolStatus=[];else if(""!==this.curBusiness.businessLimit.schoolStatus&&-1==this.curBusiness.businessLimit.schoolStatus.indexOf(",")){var s=[];s.push(this.curBusiness.businessLimit.schoolStatus),this.curBusiness.businessLimit.schoolStatus=s}else""!==this.curBusiness.businessLimit.schoolStatus&&this.curBusiness.businessLimit.schoolStatus.indexOf(",")>-1&&(this.curBusiness.businessLimit.schoolStatus=this.curBusiness.businessLimit.schoolStatus.split(","));if(this.curBusiness&&this.curBusiness.businessLimit&&null!=this.curBusiness.businessLimit.educationLevel&&!(this.curBusiness.businessLimit.educationLevel instanceof Array))if(""==this.curBusiness.businessLimit.educationLevel)this.curBusiness.businessLimit.educationLevel=[];else if(""!==this.curBusiness.businessLimit.educationLevel&&-1==this.curBusiness.businessLimit.educationLevel.indexOf(",")){var e=[];e.push(this.curBusiness.businessLimit.educationLevel),this.curBusiness.businessLimit.educationLevel=e}else""!==this.curBusiness.businessLimit.educationLevel&&this.curBusiness.businessLimit.educationLevel.indexOf(",")>-1&&(this.curBusiness.businessLimit.educationLevel=this.curBusiness.businessLimit.educationLevel.split(","));if(this.curBusiness&&this.curBusiness.businessLimit&&null!=this.curBusiness.businessLimit.studentType&&!(this.curBusiness.businessLimit.studentType instanceof Array))if(""==this.curBusiness.businessLimit.studentType)this.curBusiness.businessLimit.studentType=[];else if(""!==this.curBusiness.businessLimit.studentType&&-1==this.curBusiness.businessLimit.studentType.indexOf(",")){var t=[];t.push(this.curBusiness.businessLimit.studentType),this.curBusiness.businessLimit.studentType=t}else""!==this.curBusiness.businessLimit.studentType&&this.curBusiness.businessLimit.studentType.indexOf(",")>-1&&(this.curBusiness.businessLimit.studentType=this.curBusiness.businessLimit.studentType.split(","));if(this.curBusiness&&this.curBusiness.businessLimit&&null!=this.curBusiness.businessLimit.grade&&!(this.curBusiness.businessLimit.grade instanceof Array))if(""==this.curBusiness.businessLimit.grade)this.curBusiness.businessLimit.grade=[];else if(""!==this.curBusiness.businessLimit.grade&&-1==this.curBusiness.businessLimit.grade.indexOf(",")){var i=[];i.push(this.curBusiness.businessLimit.grade),this.curBusiness.businessLimit.grade=i}else""!==this.curBusiness.businessLimit.grade&&this.curBusiness.businessLimit.grade.indexOf(",")>-1&&(this.curBusiness.businessLimit.grade=this.curBusiness.businessLimit.grade.split(","))},_save:function(s,e){var t=this;if(this.changeBusinessLimit(),this.curBusiness&&this.curBusiness.business&&this.curBusiness.business.id&&null==this.curBusiness.business.limitType)return this.$toast("请设置面向人员选项"),void(this.releaseBusinessDisabled=!1);if("link"!==this.curRoute&&this.curBusiness&&this.curBusiness.business.id&&null!=this.curBusiness.business.limitType&&"1"==this.curBusiness.business.limitType&&!this.isShowMemberTable)return this.$toast("请搜索面向人员名单"),void(this.releaseBusinessDisabled=!1);if(this.curBusiness&&this.curBusiness.business.id&&null!=this.curBusiness.business.limitType&&"0"!=this.curBusiness.business.limitType&&"3"!=this.curBusiness.business.limitType&&("1"!=this.curBusiness.business.limitType||"link"!=this.curRoute)&&0==this.$refs.memberList.tableState.totalRecords)return this.$toast("请上传面向人员名单"),void(this.releaseBusinessDisabled=!1);if(this.curBusiness&&"3"==this.curBusiness.business.limitType&&(!new RegExp("(((^([0-9]|[0-5][0-9])(\\,|\\-|\\/){1}([0-9]|[0-5][0-9]) )|^([0-9]|[0-5][0-9]) |^(\\* ))((([0-9]|[0-5][0-9])(\\,|\\-|\\/){1}([0-9]|[0-5][0-9]) )|([0-9]|[0-5][0-9]) |(\\* ))((([0-9]|[01][0-9]|2[0-3])(\\,|\\-|\\/){1}([0-9]|[01][0-9]|2[0-3]) )|([0-9]|[01][0-9]|2[0-3]) |(\\* ))((([0-9]|[0-2][0-9]|3[01])(\\,|\\-|\\/){1}([0-9]|[0-2][0-9]|3[01]) )|(([0-9]|[0-2][0-9]|3[01]) )|(\\? )|(\\* )|(([1-9]|[0-2][0-9]|3[01])L )|([1-7]W )|(LW )|([1-7]\\#[1-4] ))((([1-9]|0[1-9]|1[0-2])(\\,|\\-|\\/){1}([1-9]|0[1-9]|1[0-2]) )|([1-9]|0[1-9]|1[0-2]) |(\\* ))(([1-7](\\,|\\-|\\/){1}[1-7])|([1-7])|(\\?)|(\\*)|(([1-7]L)|([1-7]\\#[1-4]))))|(((^([0-9]|[0-5][0-9])(\\,|\\-|\\/){1}([0-9]|[0-5][0-9]) )|^([0-9]|[0-5][0-9]) |^(\\* ))((([0-9]|[0-5][0-9])(\\,|\\-|\\/){1}([0-9]|[0-5][0-9]) )|([0-9]|[0-5][0-9]) |(\\* ))((([0-9]|[01][0-9]|2[0-3])(\\,|\\-|\\/){1}([0-9]|[01][0-9]|2[0-3]) )|([0-9]|[01][0-9]|2[0-3]) |(\\* ))((([0-9]|[0-2][0-9]|3[01])(\\,|\\-|\\/){1}([0-9]|[0-2][0-9]|3[01]) )|(([0-9]|[0-2][0-9]|3[01]) )|(\\? )|(\\* )|(([1-9]|[0-2][0-9]|3[01])L )|([1-7]W )|(LW )|([1-7]\\#[1-4] ))((([1-9]|0[1-9]|1[0-2])(\\,|\\-|\\/){1}([1-9]|0[1-9]|1[0-2]) )|([1-9]|0[1-9]|1[0-2]) |(\\* ))(([1-7](\\,|\\-|\\/){1}[1-7] )|([1-7] )|(\\? )|(\\* )|(([1-7]L )|([1-7]\\#[1-4]) ))((19[789][0-9]|20[0-9][0-9])\\-(19[789][0-9]|20[0-9][0-9])))").test(this.curBusiness.businessLimit.cron)||!this.curBusiness.businessLimit.url))return this.$toast("请正确输入接口信息!"),void(this.releaseBusinessDisabled=!1);if("business"===s){if(!this.curBusiness.business.name)return this.$toast(this.translate.nameError),this.releaseBusinessDisabled=!1,!1;var i=this.curBusiness.business.id?"put":"post",a="/api/app/"+this.appId+"/business"+(this.curBusiness.business.id?"/"+this.curBusiness.business.id:"");if("put"===i&&"formEngine"===this.curRoute&&(a+="?formId="+this.curBusiness.formId+"&playerSettingId="+this.curBusiness.playerSettingId+"&key="+this.cacheKey),"formEngine"===this.curRoute?this._getBusinessTime():(this.curBusiness.business.beginTime=this.curBusiness.business.beginTime?this.curBusiness.business.beginTime:"",this.curBusiness.business.endTime=this.curBusiness.business.endTime?this.curBusiness.business.endTime:""),this.curBusiness&&this.curBusiness.business.businessTimeList.length>0&&(!this.curBusiness.business.endTime||!this.curBusiness.business.beginTime))return this.$toast("请设置业务期的开始时间和结束时间"),this.releaseBusinessDisabled=!1,!1;Object(c.d)(a,this.curBusiness,"post").then(function(s){if(s.state){if(s.data.business.id&&!t.curBusiness.business.id)for(var i in s.data)t.$set(t.curBusiness,i,s.data[i]);t.businessList[t.curBusinessIdx]=t.curBusiness,t.$set(t.businessList,t.curBusinessIdx,t.curBusiness),e?e():(t.$toast(t.translate.saveBusinessSuccess),"3"==t.curBusiness.business.limitType&&(t.typeL=3))}else t.$toast(s.message)})}},showImportPage:function(){this._initImportTpl(),this.showImportModal=!0,this.showAddModal=!1},showImportPageTwo:function(){var s=this;this._initImportTpl(),this.showImportModal=!0,this.showAddModal=!1,this.importParams.importBtnType=[{name:this.incrementImport,url:"/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/updateExcel?isCover=false&isCache="+this.isCache+"&key="+this.cacheKey,method:"post",isShowBtn:!0,success:function(e){e.state&&(s.timestamp=new Date)}},{name:this.overriteImport,url:"/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/updateExcel?isCover=true&isCache="+this.isCache+"&key="+this.cacheKey,method:"post",isShowBtn:!0,success:function(e){e.state&&(s.timestamp=new Date)}}]},backParentPage:function(){this.showImportModal=!1},exportUserInfo:function(s){if(1==s){var e=this.$refs.memberList.tableSearchFields.userNo||"",t=this.$refs.memberList.tableSearchFields.name||"",i=this.$refs.memberList.tableSearchFields.grade||"",a=this.$refs.memberList.tableSearchFields.college||"",n=this.$refs.memberList.tableSearchFields.educationLevel||"",o=this.$refs.memberList.tableSearchFields.schoolStatus||"";window.location.href="/downloads/app/"+this.appId+"/business/users/"+this.curBusiness.business.id+"/excel?fileName="+this.curBusiness.business.name+".xlsx&isCache="+this.isCache+"&key="+this.cacheKey+"&name="+t+"&grade="+i+"&college="+a+"&educationLevel="+n+"&schoolStatus="+o+"&userNo="+e}else window.location.href="/downloads/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/excel?fileName="+this.curBusiness.business.name+".xlsx"},releaseApp:function(s){var e=this;if(this.releaseAppDisabled)return!1;this.releaseAppDisabled=!0;var t="",i="",a="/api/app/"+this.appId+"/public";"release"===s?(t=this.translate.releaseTip,i=this.translate.release):(t=this.translate.dropOffTip,i=this.translate.dropOff,"delete",a="/api/app/"+this.appId+"/deletePublic"),confirm(t)?Object(c.e)({url:a,type:"post",success:function(s){e.releaseAppDisabled=!1,s.state?(e.$toast(i+e.translate.success),e.curApp.isPublished=!e.curApp.isPublished):e.$toast(s.message)}}):this.releaseAppDisabled=!1},_limitLength:function(s){this.curApp.name=this._getStrByteLimit(s.target.value,50)},_saveAppName:function(){var s=this;if(!this.curApp.name)return this.nameChangeMsg=this.translate.nameError,!1;Object(c.e)({url:"/api/app/"+this.curApp.id+"/name",type:"post",data:{name:this.curApp.name},success:function(e){e.state?(s.$emit("update",s.curApp),s.nameChangeMsg=s.translate.modifySuccess,setTimeout(function(){s.nameChangeMsg=""},2e3)):s.nameChangeMsg=s.translate.error+"："+e.message}})},_saveAppDesc:function(){var s=this;Object(c.e)({url:"/api/app/"+this.curApp.id+"/remark",type:"post",data:{remark:this.curApp.remark},success:function(e){e.state?(s.$emit("update",s.curApp),s.descChangeMsg=s.translate.modifySuccess,setTimeout(function(){s.descChangeMsg=""},2e3)):s.descChangeMsg=s.translate.error+"："+e.message}})},_openReviseBusiness:function(){var s=this;confirm("您将对正在进行的业务期进行修改，请在技术人员协助下进行操作!")&&("link"!==this.curRoute?this.editLimitType(function(){s.canEditPublishedBusiness=!0}):this.canEditPublishedBusiness=!0)},editLimitType:function(s){var e=this;Object(c.e)({url:"/api/business/users/"+this.appId+"/business/"+this.curBusiness.business.id+"/init/cache",type:"post",success:function(t){t.state?(e.publishedCacheKey=t.data,"function"==typeof s&&s()):e.$toast(t.message)}})},_reviseBusinessData:function(s){this.isReviseBusiness&&(this.isReviseData&&confirm("是否保存修改的数据？不保存会丢失")&&this._reviseBusinessInfo(),"form"===s?this.$emit("setForm",{modelId:this.appState.modelId,type:this.curApp.setting.formId?"edit":"create",businessId:this.curBusiness.business.id}):this.$emit("setJoinRole",{businessId:this.curBusiness.business.id}))},_changeBusinessName:function(){this.isReviseData=!0},_reviseBusinessInfo:function(){var s=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this._getBusinessTime(),!this.curBusiness.business.endTime||!this.curBusiness.business.beginTime)return this.$toast("请设置业务期的开始时间和结束时间"),void(this.releaseBusinessDisabled=!1);if(this.changeBusinessLimit(),null!=this.curBusiness.business.limitType&&"0"!=this.curBusiness.business.limitType&&"3"!=this.curBusiness.business.limitType&&0==this.$refs.memberList.tableState.totalRecords)return this.$toast("请上传面向人员名单"),void(this.releaseBusinessDisabled=!1);if("public"!==e||confirm("本次修改仅会对本次业务期生效，不会影响业务本身，确定执行吗？")){var t={name:this.curBusiness.business.name,year:this.curBusiness.business.year,guide:this.curBusiness.business.guide,beginTime:this.curBusiness.business.beginTime,endTime:this.curBusiness.business.endTime,key:this.cacheKey,limitType:this.curBusiness.business.limitType,businessLimit:{id:this.curBusiness.businessLimit.id,inSchool:this.curBusiness.businessLimit.inSchool,grade:this.curBusiness.businessLimit.grade,studentType:this.curBusiness.businessLimit.studentType,schoolStatus:this.curBusiness.businessLimit.schoolStatus,educationLevel:this.curBusiness.businessLimit.educationLevel,url:this.curBusiness.businessLimit.url,updateType:this.curBusiness.businessLimit.updateType,cron:this.curBusiness.businessLimit.busincron},businessTimeList:[]};this.curBusiness.business.businessTimeList.forEach(function(s){t.businessTimeList.push({nodeId:s.nodeId,startDate:s.startDate,endDate:s.endDate})});var i="/api/app/"+this.appId+"/publishBusiness/"+this.curBusiness.business.id;Object(c.d)(i,t,"post").then(function(e){s.isReviseData=!1,e.state?(s.$toast("业务期保存成功"),s.businessList[s.curBusinessIdx]=s.curBusiness,"3"==s.curBusiness.business.limitType&&(s.typeL=3),s.canEditPublishedBusiness=!1):s.$toast(e.message)})}},_export:function(){window.location.href="/downloads/app/"+this.appId+"/export"}},destroyed:function(){this.businessList.forEach(function(s){s.publishAsync&&s.publishAsync.timer&&clearInterval(s.publishAsync.timer)})},components:{tableset:u.a}}),p={render:function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("GeminiScrollbar",{attrs:{scrollX:!1,id:"formEngineInfo"}},[t("div",{staticClass:"header"},[t("i",{staticClass:"maticon pull-left back-link",domProps:{innerHTML:s._s(s.icons("arrow_back"))},on:{click:s._back}},[s._v("arrow_back")]),s._v(" "),t("div",{staticClass:"pull-right release-app",on:{click:s._setTable}},[s._v("报表设置")]),s._v(" "),s.curApp.isPublished?t("div",{staticClass:"pull-right release-app",class:s.releaseAppDisabled?"release-app-disabled":"",on:{click:function(e){return s.releaseApp("delete")}}},[s._v(s._s(s.translate.dropOff))]):t("div",{staticClass:"pull-right release-app",class:s.releaseAppDisabled?"release-app-disabled":"",on:{click:function(e){return s.releaseApp("release")}}},[s._v(s._s(s.translate.release))]),s._v(" "),t("div",{staticClass:"pull-right release-app",on:{click:s._export}},[s._v(s._s(s.translate.export))]),s._v(" "),t("div",{staticClass:"title-div"},[t("div",{staticClass:"app-icon-div"},[t("i",{staticClass:"maticon edit-icon",domProps:{innerHTML:s._s(s.icons("edit"))},on:{click:function(e){return s._editPart("icon")}}},[s._v("edit")]),s._v(" "),t("div",{style:{"background-image":s.curApp.background}},[s.curApp.imgType&&"1"!==s.curApp.imgType?"2"===s.curApp.imgType?t("i",{staticClass:"app-icon"},[t("span",{staticClass:"saasicon-44px",class:["saasicon-44px-"+s.curApp.imgPath]})]):s._e():t("i",{staticClass:"maticon app-icon",domProps:{innerHTML:s._s(s.icons(s.curApp.imgPath))}},[s._v(s._s(s.curApp.imgPath))])])]),s._v(" "),t("div",{staticClass:"input-group app-name-div info-value",style:{width:s.inputStyleWidth+"px"}},[t("input",{directives:[{name:"model",rawName:"v-model",value:s.curApp.name,expression:"curApp.name"}],staticClass:"form-control",attrs:{type:"text",placeholder:s.translate.applyNamePlaceholder},domProps:{value:s.curApp.name},on:{input:[function(e){e.target.composing||s.$set(s.curApp,"name",e.target.value)},s._limitLength],change:s._saveAppName}}),s._v(" "),t("div",[t("a",{staticClass:"apartment-link",attrs:{href:"javascript:;"}},[s._v(s._s(s.curApp.department&&s.curApp.department.name))])])]),s._v(" "),s.nameChangeMsg?t("p",{staticClass:"save-tip text-center",class:s.nameChangeMsg.indexOf(s.translate.error)>=0?"error":""},[s._v(s._s(s.nameChangeMsg))]):s._e(),s._v(" "),"formEngine"===s.curRoute?t("div",{staticClass:"form-flow-set"},[t("span",{staticClass:"info-set",on:{click:s._setAppForm}},[s._v(s._s(s.translate.form)+"："+s._s(s.appState.formName||s.translate.pleaseSet))]),s._v(" "),s.appState.formName?t("span",{staticClass:"info-connect"}):s._e(),s._v(" "),s.appState.formName?t("span",{staticClass:"info-set",on:{click:s._setJoinRole}},[s._v(s._s(s.translate.playersSet))]):s._e()]):s._e(),s._v(" "),t("div",{staticClass:"app-desc info-value"},[t("span",{staticClass:"count-limit"},[s._v(s._s(s.curApp.remark?s.curApp.remark.length:0)+"/200")]),s._v(" "),t("textarea",{directives:[{name:"model",rawName:"v-model",value:s.curApp.remark,expression:"curApp.remark"}],staticClass:"desc-part",attrs:{rows:s.rowsNumber,maxlength:"200",placeholder:s.translate.remarkPlaceholder},domProps:{value:s.curApp.remark},on:{change:s._saveAppDesc,input:function(e){e.target.composing||s.$set(s.curApp,"remark",e.target.value)}}})]),s._v(" "),s.descChangeMsg?t("p",{staticClass:"save-tip text-center",class:s.descChangeMsg.indexOf(s.translate.error)>=0?"error":""},[s._v(s._s(s.descChangeMsg))]):s._e(),s._v(" "),t("div",[t("p",[t("strong",[s._v("应用直接访问地址：")]),s._v(" "),t("span",{staticStyle:{"user-select":"text"}},[s._v(s._s("http://"+s.host+"/"+s.$account.schoolId+"/app/"+s.curApp.id))])])])])]),s._v(" "),"link"===s.curRoute?t("div",{staticClass:"middle-link-info"},[t("div",{staticClass:"select-link-manner"},[t("div",{staticClass:"radio-item"},[t("span",{staticClass:"check",on:{click:function(e){return s._changeLinkUseBusiness("noUse")}}},[s.curApp&&s.curApp.setting&&!s.curApp.setting.useBusiness?t("i",{staticClass:"maticon active",domProps:{innerHTML:s._s(s.icons("radio_button_checked"))}},[s._v("radio_button_checked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_unchecked"))}},[s._v("radio_button_unchecked")])]),s._v(" "),t("label",{staticClass:"check-label",class:s.curApp&&s.curApp.setting&&!s.curApp.setting.useBusiness?"active":""},[s._v(s._s(s.translate.directJump))])]),s._v(" "),t("div",{staticClass:"radio-item"},[t("span",{staticClass:"check",on:{click:function(e){return s._changeLinkUseBusiness("use")}}},[s.curApp&&s.curApp.setting&&s.curApp.setting.useBusiness?t("i",{staticClass:"maticon active",domProps:{innerHTML:s._s(s.icons("radio_button_checked"))}},[s._v("radio_button_checked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_unchecked"))}},[s._v("radio_button_unchecked")])]),s._v(" "),t("label",{staticClass:"check-label",class:s.curApp&&s.curApp.setting&&s.curApp.setting.useBusiness?"active":""},[s._v(s._s(s.translate.useBusiness))])])]),s._v(" "),t("div",{staticClass:"set-link input-group info-value"},[t("input",{directives:[{name:"model",rawName:"v-model",value:s.curApp&&s.curApp.setting&&s.curApp.setting.linkUrl,expression:"curApp&&curApp.setting&&curApp.setting.linkUrl"}],staticClass:"form-control",attrs:{type:"text",placeholder:s.translate.linkUrlPlaceholder},domProps:{value:s.curApp&&s.curApp.setting&&s.curApp.setting.linkUrl},on:{change:s._saveLink,input:function(e){e.target.composing||s.$set(s.curApp&&s.curApp.setting&&s.curApp.setting,"linkUrl",e.target.value)}}})])]):s._e(),s._v(" "),s.curApp&&s.curApp.setting&&!1!==s.curApp.setting.useBusiness?t("div",{staticClass:"middle"},[t("label",{staticClass:"head-label pull-left"},[s._v(s._s(s.translate.businessPeriod))]),s._v(" "),t("a",{staticClass:"add-new pull-right",attrs:{href:"javascript:;"},on:{click:s._addNewBusiness}},[s._v(s._s(s.translate.addNew))]),s._v(" "),s.leftIconShow?t("i",{staticClass:"maticon scroll-left",domProps:{innerHTML:s._s(s.icons("chevron_left"))},on:{click:s._scrollLeft}},[s._v("chevron_left")]):s._e(),s._v(" "),s.rightIconShow?t("i",{staticClass:"maticon scroll-right",domProps:{innerHTML:s._s(s.icons("chevron_right"))},on:{click:s._scrollRight}},[s._v("chevron_right")]):s._e(),s._v(" "),t("GeminiScrollbar",{staticClass:"business-div",attrs:{id:"businessDiv",scrollY:!1}},[t("div",{staticClass:"business-scroll"},s._l(s.businessList,function(e,i){return t("div",{key:i,staticStyle:{display:"inline-block",position:"relative"}},[t("div",{staticClass:"mark-div",class:s._compareTime(s.businessList,i)},[t("span")]),s._v(" "),t("div",{staticClass:"business-tab",class:s.curBusiness&&e.business.name===s.curBusiness.business.name?"active":"",attrs:{title:e.business.name},on:{click:function(t){return s._changeBusiness(e,e.business.limitType,i)}}},[s._v("\n            "+s._s(e.business.name)+"\n            "),e.business.isPublic?s._e():t("i",{staticClass:"maticon remove-icon",domProps:{innerHTML:s._s(s.icons("cancel"))},on:{click:function(e){return e.stopPropagation(),s._removeBusiness(i)}}},[s._v("cancel")])])])}),0)]),s._v(" "),s.curBusiness?t("div",{staticClass:"info-type-tabs"},s._l(s.appState.infoTypes,function(e,i){return s.curBusiness&&s.curBusiness.business.id||"base"===e.id?t("div",{key:i,staticClass:"info-tab text-center",class:e.id===s.appState.infoType?"active":"",on:{click:function(t){return s._tabClick(e)}}},[s._v(s._s(e.name))]):s._e()}),0):s._e()],1):s._e(),s._v(" "),s.curBusiness&&s.curApp.setting&&!1!==s.curApp.setting.useBusiness?t("div",{staticClass:"bottom"},[t("span",[t("a",{staticClass:"release-business",attrs:{href:"javascript:;"}},[s.curBusiness.business.isPublic||s.curBusiness.business.isPublishing||s.curBusiness.business.readyPublish?s.curBusiness.business.isPublishing&&!s.curBusiness.business.readyPublish?t("span",{staticClass:"disabled"},[s._v("\n          发布中..."+s._s(s.curBusiness.publishAsync.total?(s.curBusiness.publishAsync.done/s.curBusiness.publishAsync.total*100).toFixed(2):"...")+"% ("+s._s(s.curBusiness.publishAsync.done)+"/"+s._s(s.curBusiness.publishAsync.total)+")\n        ")]):!s.curBusiness.business.isEnable||s.isReviseBusiness||s.curBusiness.business.readyPublish?s.curBusiness.business.isEnable||s.curBusiness.business.readyPublish?s.curBusiness.business.readyPublish?t("span",{staticClass:"disabled"},[s._v("即将发布")]):s._e():t("span",{staticClass:"disabled"},[s._v(s._s(s.translate.businessPeriodDisabled))]):t("span",{on:{click:function(e){return s._releaseBusiness("stop")}}},[s._v("停用本业务期")]):t("span",{on:{click:s.showBus}},[s._v("发布本业务期")])])]),s._v(" "),s.curBusiness.business.readyPublish?t("span",{staticClass:"save-business",on:{click:function(e){return s._cancel()}}},[s._v("取消发布")]):s._e(),s._v(" "),s.curBusiness.business.isPublic||s.curBusiness.business.isPublishing||s.curBusiness.business.readyPublish?"link"===s.curRoute||!s.curBusiness.business.isEnable||s.isReviseBusiness||s.curBusiness.business.isPublishing||s.curBusiness.business.readyPublish?s.isReviseBusiness&&!s.curBusiness.business.readyPublish?t("span",{staticClass:"save-business revise ml0",on:{click:function(e){return s._reviseBusinessInfo("public")}}},[s._v(s._s(s.translate.saveBusinessDeploy))]):s._e():t("span",{staticClass:"save-business",on:{click:s._openReviseBusiness}},[s._v(s._s(s.translate.editBusinessDeploy))]):t("span",{staticClass:"save-business",on:{click:function(e){return s._save("business")}}},[s._v(s._s(s.translate.saveBusinessDeploy))]),s._v(" "),t("span",{staticClass:"error-tip",class:s.errorMsg?"active":""},[s._v(s._s(s.errorMsg))]),s._v(" "),s.curBusiness.business&&s.curBusiness.business.id&&!s.curBusiness.business.readyPublish&&s.curBusiness.business.isPublic?t("span",{staticClass:"save-business",staticStyle:{"margin-left":"10px"}},[s.onLoadingForm?t("span",{staticStyle:{color:"gray"}},[s._v("数据同步中...("),t("span",[s._v(s._s(s.hadCheckCount))]),s._v("/"),t("span",[s._v(s._s(s.needCheckCount))]),s._v(")")]):t("span",{on:{click:function(e){return s._updataForm()}}},[s._v("数据同步")])]):s._e(),s._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:"base"===s.appState.infoType,expression:"appState.infoType === 'base'"}],staticClass:"info-body container-fluid"},[t("div",{staticClass:"col-sm-6 padding-right"},[t("div",{staticClass:"form-group base-item"},[t("label",[s._v(s._s(s.translate.businessName))]),s._v(" "),!s.curBusiness.business.isPublic||s.isReviseBusiness?t("input",{directives:[{name:"model",rawName:"v-model",value:s.curBusiness.business.name,expression:"curBusiness.business.name"}],staticClass:"form-control valid",attrs:{type:"text",placeholder:s.translate.businessNamePlaceholder,maxlength:"30"},domProps:{value:s.curBusiness.business.name},on:{change:s._changeBusinessName,input:function(e){e.target.composing||s.$set(s.curBusiness.business,"name",e.target.value)}}}):t("input",{staticClass:"form-control",attrs:{type:"text",readonly:""},domProps:{value:s.curBusiness.business.name}})])]),s._v(" "),t("div",{staticClass:"col-sm-6 padding-left"},[t("div",{staticClass:"form-group base-item"},[t("label",[s._v(s._s(s.translate.schoolYear))]),s._v(" "),t("v-select",{staticClass:"info-value btn-block",attrs:{options:s.appState.gradeOptions,value:s.curBusiness.business.year||(new Date).getFullYear()+"_0","options-value":"id","options-label":"label","close-on-select":"",disabled:!(!s.curBusiness.business.isPublic||s.isReviseBusiness),search:""},on:{afterSelected:s._afterSelectYear}})],1)]),s._v(" "),"formEngine"===s.curRoute?t("div",{staticClass:"col-sm-6 padding-right"},[t("div",{staticClass:"form-group base-item",class:s.isReviseBusiness?"active":"",on:{click:function(e){return s._reviseBusinessData("form")}}},[t("label",{class:s.isReviseBusiness?"active":""},[s._v(s._s(s.translate.form)+"("+s._s(s.translate.basicInfoTip)+")")]),s._v(" "),t("input",{staticClass:"form-control",class:s.isReviseBusiness?"active":"",attrs:{readonly:""},domProps:{value:s.appState.formName||s.translate.unboundForm}})])]):s._e(),s._v(" "),"formEngine"===s.curRoute?t("div",{staticClass:"col-sm-6 padding-left"},[t("div",{staticClass:"form-group base-item",class:s.isReviseBusiness?"active":"",on:{click:function(e){return s._reviseBusinessData("players")}}},[t("label",{class:s.isReviseBusiness?"active":""},[s._v(s._s(s.translate.playersSet)+"("+s._s(s.translate.basicInfoTip)+")")]),s._v(" "),t("input",{staticClass:"form-control",class:s.isReviseBusiness?"active":"",attrs:{readonly:""}})])]):s._e()]),s._v(" "),s.curBusiness.business.id?t("div",{directives:[{name:"show",rawName:"v-show",value:"faceTo"===s.appState.infoType,expression:"appState.infoType === 'faceTo'"}],staticClass:"info-body container-fluid outer-container",attrs:{id:"faceMember"}},[!s.showImportModal&&s.faceToPeopleType.indexOf(s.curApp&&s.curApp.appType&&s.curApp.appType.userType)<0?t("div",{staticClass:"limit-radios"},[t("div",{staticClass:"radio-item small-item",class:"0"===s.curBusiness.business.limitType?"active":""},[t("span",{staticClass:"check",class:s.curBusiness.business.isPublic&&!s.isReviseBusiness?"disable":"",on:{click:function(e){return s._changeLimitType("0")}}},["0"!==s.curBusiness.business.limitType?t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_unchecked"))}},[s._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_checked"))}},[s._v("radio_button_checked")])]),s._v(" "),t("label",{staticClass:"check-label"},[s._v(s._s(s.translate.unlimited))])]),s._v(" "),t("div",{staticClass:"radio-item large-item",class:"1"===s.curBusiness.business.limitType?"active":""},[t("div",{staticClass:"large-check-part"},[t("span",{staticClass:"check",class:s.curBusiness.business.isPublic&&!s.isReviseBusiness?"disable":"",on:{click:function(e){return s._changeLimitType("1")}}},["1"!==s.curBusiness.business.limitType?t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_unchecked"))}},[s._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_checked"))}},[s._v("radio_button_checked")])]),s._v(" "),t("label",{staticClass:"check-label"},[s._v(s._s(s.translate.filterByCondition))])]),s._v(" "),t("div",{staticClass:"large-select-part"},[t("div",{staticClass:"select-group"},[t("label",[s._v(s._s(s.translate.studentType))]),s._v(" "),t("v-select",{staticClass:"info-value btn-block",attrs:{url:"/api/system/dictTypes/1004/dicts",multiple:!0,value:s.curBusiness.businessLimit?s.curBusiness.businessLimit.studentType:"","options-value":"value","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==s.curBusiness.business.limitType||s.curBusiness.business.isPublic&&!s.isReviseBusiness},on:{afterSelected:s._afterSelectStuType}})],1)]),s._v(" "),t("div",{staticClass:"large-select-part"},[t("div",{staticClass:"select-group"},[t("label",[s._v(s._s(s.translate.studentGrade))]),s._v(" "),t("v-select",{staticClass:"info-value btn-block",attrs:{options:s.appState.gradeOptions2,multiple:!0,value:s.curBusiness.businessLimit?s.curBusiness.businessLimit.grade:"","options-value":"id","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==s.curBusiness.business.limitType||s.curBusiness.business.isPublic&&!s.isReviseBusiness},on:{afterSelected:s._afterSelectGrade}})],1)]),s._v(" "),t("div",{staticClass:"large-select-part"},[t("div",{staticClass:"select-group"},[t("label",[s._v(s._s(s.translate.inSchoolStatus))]),s._v(" "),t("v-select",{staticClass:"info-value btn-block",attrs:{options:s.appState.inSchoolOptions,value:s.curBusiness.businessLimit?parseInt(s.curBusiness.businessLimit.inSchool):"","options-value":"id","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==s.curBusiness.business.limitType||s.curBusiness.business.isPublic&&!s.isReviseBusiness},on:{afterSelected:s._afterSelectInSchool}})],1)]),s._v(" "),t("div",{staticClass:"large-select-part"},[t("div",{staticClass:"select-group"},[t("label",[s._v("当前状态")]),s._v(" "),t("v-select",{staticClass:"info-value btn-block",attrs:{options:s.schoolStatus,multiple:!0,value:s.curBusiness.businessLimit?s.curBusiness.businessLimit.schoolStatus:"","options-value":"value","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==s.curBusiness.business.limitType||s.curBusiness.business.isPublic&&!s.isReviseBusiness},on:{afterSelected:s._afterSelectSchoolStatus}})],1)]),s._v(" "),t("div",{staticClass:"large-select-part"},[t("div",{staticClass:"select-group"},[t("label",[s._v("培养层次")]),s._v(" "),t("v-select",{staticClass:"info-value btn-block",attrs:{options:s.educationLevel,multiple:!0,value:s.curBusiness.businessLimit?s.curBusiness.businessLimit.educationLevel:"","options-value":"value","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==s.curBusiness.business.limitType||s.curBusiness.business.isPublic&&!s.isReviseBusiness},on:{afterSelected:s._afterSelectEducationLevelStatus}})],1)]),s._v(" "),"link"!==s.curRoute?t("div",{staticClass:"large-select-part"},[t("div",{staticClass:"select-group",staticStyle:{"margin-right":"0"}},[t("button",{staticClass:"btn batch-add-btn btn-bgColor-style mt10 clearBtnBorder",attrs:{type:"button",disabled:"1"!==s.curBusiness.business.limitType||s.curBusiness.business.isPublic&&!s.isReviseBusiness},on:{click:s.searchByCondition}},[s._v("搜索")])])]):s._e()]),s._v(" "),t("div",{staticClass:"radio-item small-item",class:"2"===s.curBusiness.business.limitType?"active":""},[t("span",{staticClass:"check",class:s.curBusiness.business.isPublic&&!s.isReviseBusiness?"disable":"",on:{click:function(e){return s._changeLimitType("2")}}},["2"!==s.curBusiness.business.limitType?t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_unchecked"))}},[s._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_checked"))}},[s._v("radio_button_checked")])]),s._v(" "),t("label",{staticClass:"check-label"},[s._v(s._s(s.translate.uploadList))]),s._v(" "),"2"===s.curBusiness.business.limitType?t("div",{staticClass:"pull-right opt-div"}):s._e()]),s._v(" "),t("div",{staticClass:"radio-item large-item",class:"3"!==s.curBusiness.business.limitType||s.curBusiness.business.isPublic?"":"active",staticStyle:{height:"198px"}},[t("div",{staticClass:"large-check-part"},[t("span",{staticClass:"check",class:s.curBusiness.business.isPublic&&!s.isReviseBusiness?"disable":"",on:{click:function(e){return s._changeLimitType("3")}}},["3"!==s.curBusiness.business.limitType?t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_unchecked"))}},[s._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_checked"))}},[s._v("radio_button_checked")])]),s._v(" "),t("label",{staticClass:"check-label"},[s._v("接口对接")])]),s._v(" "),t("div",{staticClass:"large-select-part"},[t("div",{staticClass:"select-group",staticStyle:{width:"550px",padding:"20px 20px 5px 20px"}},[t("label",{staticStyle:{color:"#000"}},[s._v("接口地址：")]),s._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:s.curBusiness.businessLimit.url,expression:"curBusiness.businessLimit.url"}],staticClass:"form-control",staticStyle:{display:"inline-block",width:"400px"},attrs:{type:"text",disabled:"3"!==s.curBusiness.business.limitType,placeholder:"请提供接口地址",name:"",id:""},domProps:{value:s.curBusiness.businessLimit.url},on:{input:function(e){e.target.composing||s.$set(s.curBusiness.businessLimit,"url",e.target.value)}}})]),s._v(" "),t("div",{staticClass:"select-group",staticStyle:{width:"550px",padding:"5px 20px"}},[t("label",{staticStyle:{color:"#000"}},[s._v("更新频率：")]),s._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:s.curBusiness.businessLimit.cron,expression:"curBusiness.businessLimit.cron"}],staticClass:"form-control",staticStyle:{display:"inline-block",width:"400px"},attrs:{type:"text",disabled:"3"!==s.curBusiness.business.limitType,placeholder:"CRON表达式",name:"",id:""},domProps:{value:s.curBusiness.businessLimit.cron},on:{input:function(e){e.target.composing||s.$set(s.curBusiness.businessLimit,"cron",e.target.value)}}})]),s._v(" "),t("div",{staticClass:"select-group",staticStyle:{width:"550px",padding:"5px 20px"}},[t("label",{staticStyle:{color:"#000"}},[s._v("更新方式：")]),s._v(" "),t("p",{staticStyle:{display:"inline-block","vertical-align":"bottom",margin:"0","margin-top":"5px"}},[t("span",{staticClass:"check",on:{click:function(e){s.curBusiness.businessLimit.updateType="COVER"}}},["COVER"!==s.curBusiness.businessLimit.updateType||""===s.curBusiness.businessLimit.updateType?t("i",{staticClass:"maticon",staticStyle:{"line-height":"15px"},attrs:{disabled:"3"!==s.curBusiness.business.limitType},domProps:{innerHTML:s._s(s.icons("radio_button_unchecked"))}},[s._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",staticStyle:{"line-height":"15px"},attrs:{disabled:"3"!==s.curBusiness.business.limitType},domProps:{innerHTML:s._s(s.icons("radio_button_checked"))}},[s._v("radio_button_checked")])]),s._v(" "),t("label",{staticClass:"check-label",attrs:{disabled:"3"===s.curBusiness.business.limitType}},[s._v("增量")])]),s._v(" "),t("p",{staticStyle:{display:"inline-block","vertical-align":"bottom",margin:"0","margin-top":"5px"}},[t("span",{staticClass:"check",on:{click:function(e){s.curBusiness.businessLimit.updateType="INCREMENT"}}},["INCREMENT"!==s.curBusiness.businessLimit.updateType||""===s.curBusiness.businessLimit.updateType?t("i",{staticClass:"maticon",staticStyle:{"line-height":"15px"},domProps:{innerHTML:s._s(s.icons("radio_button_unchecked"))}},[s._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",staticStyle:{"line-height":"15px"},domProps:{innerHTML:s._s(s.icons("radio_button_checked"))}},[s._v("radio_button_checked")])]),s._v(" "),t("label",{staticClass:"check-label"},[s._v("覆盖")])])]),s._v(" "),"3"==s.typeL?t("div",{staticClass:"select-group",staticStyle:{width:"550px",padding:"10px 20px","text-align":"center"}},[t("button",{staticClass:"btn btn-default ",attrs:{disabled:"3"!==s.curBusiness.business.limitType},on:{click:function(e){return s.updateHand()}}},[s._v("手动更新")])]):s._e()])]),s._v(" "),"link"==s.curRoute&&"2"===s.curBusiness.business.limitType||"link"!==s.curRoute&&null!==s.curBusiness.business.limitType&&"3"!==s.curBusiness.business.limitType&&s.isShowMemberTable?t("div",{staticClass:"stus-list"},[s.curBusiness.business.id?t("v-table",{ref:"memberList",attrs:{title:"人员名单管理",url:s.allPeopleUrl,pagesize:"8",idField:"id",multiple:!s.curBusiness.business.isPublic||s.isReviseBusiness,order:!0,search:!1,columns:s.appState.columns},on:{afterChecked:s._afterChecked}},[t("div",{staticClass:"btn-group pull-right",attrs:{slot:"btn-group",role:"group"},slot:"btn-group"},[(!s.curBusiness.business.isPublic||s.isReviseBusiness)&&s.checkedNum>0?t("button",{staticClass:"btn batch-add-btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:s.batchDelete}},[s._v("批量删除")]):s._e(),s._v(" "),"link"===s.curRoute||s.curBusiness.business.isPublic&&!s.isReviseBusiness?"link"!=s.curRoute||s.curBusiness.business.isPublic&&!s.isReviseBusiness?s._e():t("button",{staticClass:"btn batch-add-btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:s.showImportPageTwo}},[s._v("批量新增")]):t("button",{staticClass:"btn batch-add-btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:function(e){s.showAddModal=!0}}},[s._v("新增")]),s._v(" "),t("button",{staticClass:"btn batch-add-btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:function(e){return s.exportUserInfo(1)}}},[s._v("导出")])])]):t("span",{staticClass:"table-tip"},[s._v(s._s(s.translate.noData))])],1):s._e(),s._v(" "),"3"==s.typeL?t("div",{staticClass:"stus-list"},[s.curBusiness.business.id?t("v-table",{attrs:{url:s.peopleUrlJiekou,pagesize:"8",idField:"id",columns:s.JiekouColumns,order:!0}}):t("span",{staticClass:"table-tip"},[s._v(s._s(s.translate.noData))])],1):s._e()]):s.showImportModal?s._e():t("div",{staticClass:"limit-radios"},[t("div",{staticClass:"radio-item small-item",class:"0"!==s.curBusiness.business.limitType||s.curBusiness.business.isPublic?"":"active"},[t("span",{staticClass:"check",class:s.curBusiness.business.isPublic&&!s.isReviseBusiness?"disable":"",on:{click:function(e){return s._changeLimitType("0")}}},["0"!==s.curBusiness.business.limitType?t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_unchecked"))}},[s._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_checked"))}},[s._v("radio_button_checked")])]),s._v(" "),s.curApp&&s.curApp.appType&&"3"===s.curApp.appType.userType?t("label",{staticClass:"check-label"},[s._v(s._s(s.translate.allFreshmen))]):s.curApp&&s.curApp.appType&&"2"===s.curApp.appType.userType?t("label",{staticClass:"check-label"},[s._v("所有教职工")]):t("label",{staticClass:"check-label"},[s._v(s._s(s.translate.allInstructor))])]),s._v(" "),t("div",{staticClass:"radio-item small-item",class:"2"===s.curBusiness.business.limitType?"active":""},[t("span",{staticClass:"check",class:s.curBusiness.business.isPublic&&!s.isReviseBusiness?"disable":"",on:{click:function(e){return s._changeLimitType("2")}}},["2"!==s.curBusiness.business.limitType?t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_unchecked"))}},[s._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_checked"))}},[s._v("radio_button_checked")])]),s._v(" "),t("label",{staticClass:"check-label"},[s._v(s._s(s.translate.uploadList))])]),s._v(" "),"link"==s.curRoute&&"2"===s.curBusiness.business.limitType||"link"!==s.curRoute&&null!==s.curBusiness.business.limitType&&"3"!==s.curBusiness.business.limitType&&s.isShowMemberTable?t("div",{staticClass:"stus-list"},[s.curBusiness.business.id?t("v-table",{ref:"memberList",attrs:{title:"人员名单管理",url:s.allPeopleUrl,pagesize:"8",idField:"id",multiple:!s.curBusiness.business.isPublic||s.isReviseBusiness,order:!0,search:!1,columns:s.appState.columns},on:{afterChecked:s._afterChecked}},[t("div",{staticClass:"btn-group pull-right",attrs:{slot:"btn-group",role:"group"},slot:"btn-group"},[(!s.curBusiness.business.isPublic||s.isReviseBusiness)&&s.checkedNum>0?t("button",{staticClass:"btn batch-add-btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:s.batchDelete}},[s._v("批量删除")]):s._e(),s._v(" "),"link"===s.curRoute||s.curBusiness.business.isPublic&&!s.isReviseBusiness?"link"!=s.curRoute||s.curBusiness.business.isPublic&&!s.isReviseBusiness?s._e():t("button",{staticClass:"btn batch-add-btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:s.showImportPageTwo}},[s._v("批量新增")]):t("button",{staticClass:"btn batch-add-btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:function(e){s.showAddModal=!0}}},[s._v("新增")]),s._v(" "),t("button",{staticClass:"btn batch-add-btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:function(e){return s.exportUserInfo(1)}}},[s._v("导出")])])]):t("span",{staticClass:"table-tip"},[s._v(s._s(s.translate.noData))])],1):s._e()]),s._v(" "),t("v-modal",{staticStyle:{position:"absolute",top:"100px"},attrs:{show:s.showAddModal,effect:"fade",width:"420"}},[t("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[s._v("\n            新增\n          ")])]),s._v(" "),t("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[t("button",{staticClass:"btn submit-btn clearBtnBorder",staticStyle:{width:"380px","text-align":"center","margin-left":"20px"},attrs:{type:"button"},on:{click:s.addPersonByOne}},[s._v("单条新增")]),s._v(" "),t("button",{staticClass:"btn submit-btn clearBtnBorder",staticStyle:{width:"380px","text-align":"center","margin-top":"20px","margin-left":"20px"},attrs:{type:"button"},on:{click:s.showImportPageTwo}},[s._v("批量新增")])]),s._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){s.showAddModal=!1}}},[s._v("取消")])])]),s._v(" "),t("v-modal",{staticStyle:{position:"absolute",top:"100px"},attrs:{show:s.showAddOnePersonModal,effect:"fade",width:"400"}},[t("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[s._v("\n            新增\n          ")])]),s._v(" "),t("div",{staticClass:"modal-body container-fluid",staticStyle:{overflow:"inherit"},attrs:{slot:"modal-body"},slot:"modal-body"},[t("div",{staticClass:"form-group",staticStyle:{display:"flex"}},[t("label",[s._v("添加用户")]),s._v(" "),t("detect",{attrs:{url:"/api/users/check/searchResults",placeholder:s.请输入学号或者姓名},on:{afterSelected:s.afterSelectAddPerson}})],1)]),s._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){s.showAddOnePersonModal=!1}}},[s._v("取消")]),s._v(" "),t("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:s.addOnePerson}},[s._v("确定")])])]),s._v(" "),s.showImportModal?t("div",{staticClass:"import-modal"},[t("v-import",s._b({on:{backParentPage:s.backParentPage}},"v-import",s.importParams,!1))],1):s._e()],1):s._e(),s._v(" "),s.curBusiness.business.id?t("div",{directives:[{name:"show",rawName:"v-show",value:"timeSet"===s.appState.infoType,expression:"appState.infoType === 'timeSet'"}],staticClass:"info-body"},["link"!==s.curRoute?t("div",{staticClass:"time-set-tip"},[s._v("在业务期内，学生的分流关系将会实时更新，业务期发布之后业务时间可修改")]):s._e(),s._v(" "),"formEngine"===s.curRoute?t("div",{staticClass:"time-set-info-top"},[t("div",{staticClass:"start-time-group mr12",class:"startTime"===s.timeType?"active":"",on:{click:function(e){return s._linkBusinessTime("startTime")}}},[t("label",{staticClass:"role-name"},[t("span",{staticClass:"role-title"},[s._v("业务期")]),s._v(" "),t("span",{staticClass:"time-tip"},[t("span",{staticClass:"time-required"},[s._v("*")]),s._v(s._s(s.translate.startTime))])]),s._v(" "),t("p",{staticClass:"time-info"},[s._v(s._s(s.curBusiness.business.beginTime||s.translate.noSet))])]),s._v(" "),t("div",{staticClass:"end-time-group mt0",class:"endTime"===s.timeType?"active":"",on:{click:function(e){return s._linkBusinessTime("endTime")}}},[t("label",{staticClass:"role-name"},[t("span",{staticClass:"role-title"},[s._v("业务期")]),s._v(" "),t("span",{staticClass:"time-tip"},[t("span",{staticClass:"time-required"},[s._v("*")]),s._v(s._s(s.translate.endTime))])]),s._v(" "),t("p",{staticClass:"time-info"},[s._v(s._s(s.curBusiness.business.endTime||s.translate.noSet))])])]):s._e(),s._v(" "),"formEngine"===s.curRoute?t("div",{staticClass:"time-set-info"},s._l(s.timeSetData,function(e,i){return t("div",{key:i,staticClass:"time-set-group"},[t("div",{staticClass:"start-time-group",class:s.timeNodeId===e.nodeId&&"startDate"===s.timeType?"active":"",on:{click:function(t){return s._nodeSelected(t,e.nodeId,"startDate",e.title)}}},[t("label",{staticClass:"role-name"},[t("span",{staticClass:"role-title"},[s._v(s._s(e.title))]),s._v(" "),t("span",{staticClass:"time-tip"},[s._v(s._s(s.translate.startTime))])]),s._v(" "),t("p",{staticClass:"time-info"},[s._v(s._s(e.startDate||s.translate.noSet))])]),s._v(" "),t("div",{staticClass:"end-time-group",class:s.timeNodeId===e.nodeId&&"endDate"===s.timeType?"active":"",on:{click:function(t){return s._nodeSelected(t,e.nodeId,"endDate",e.title)}}},[t("label",{staticClass:"role-name"},[t("span",{staticClass:"role-title"},[s._v(s._s(e.title))]),s._v(" "),t("span",{staticClass:"time-tip"},[s._v(s._s(s.translate.endTime))])]),s._v(" "),t("p",{staticClass:"time-info"},[s._v(s._s(e.endDate||s.translate.noSet))])])])}),0):t("div",{staticClass:"time-set-info"},[t("div",{staticClass:"start-time-group",class:"startTime"===s.timeType?"active":"",on:{click:function(e){return s._linkBusinessTime("startTime")}}},[t("label",{staticClass:"role-name"},[t("span",{staticClass:"time-tip"},[s._v(s._s(s.translate.startTime))])]),s._v(" "),t("p",{staticClass:"time-info"},[s._v(s._s(s.curBusiness.business.beginTime||s.translate.noSet))])]),s._v(" "),t("div",{staticClass:"end-time-group",class:"endTime"===s.timeType?"active":"",on:{click:function(e){return s._linkBusinessTime("endTime")}}},[t("label",{staticClass:"role-name"},[t("span",{staticClass:"time-tip"},[s._v(s._s(s.translate.endTime))])]),s._v(" "),t("p",{staticClass:"time-info"},[s._v(s._s(s.curBusiness.business.endTime||s.translate.noSet))])])])]):s._e(),s._v(" "),s.curBusiness.business.id&&"description"===s.appState.infoType?t("div",{staticClass:"info-body container-fluid"},[!s.curBusiness.business.isPublic||s.isReviseBusiness?t("u-editor",{ref:"description",attrs:{config:s.editorConfig},model:{value:s.curBusiness.business.guide,callback:function(e){s.$set(s.curBusiness.business,"guide",e)},expression:"curBusiness.business.guide"}}):t("div",{domProps:{innerHTML:s._s(s.curBusiness.business.guide)}})],1):s._e()]):s._e(),s._v(" "),s.readonly?s._e():t("v-modal",{attrs:{show:s.appState.showFormModal,effect:"fade",width:"374"}},[t("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[s._v(s._s(s.translate.selectModal))])]),s._v(" "),t("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[t("label",[s._v(s._s(s.translate.modalTip))]),s._v(" "),t("ul",{staticClass:"list-group"},[t("li",{staticClass:"list-group-item",class:"000000000000000000000000"===s.appState.modelId?"active":"",on:{click:function(e){s.appState.modelId="000000000000000000000000"}}},[s._v("\n          空白表单模板\n        ")]),s._v(" "),t("li",{staticClass:"list-group-item",class:s.appState.modelId===s.blankTemplateId?"active":"",on:{click:function(e){s.appState.modelId=s.blankTemplateId}}},[s._v("\n          系统预设模板\n        ")]),s._v(" "),s._l(s.formList,function(e,i){return t("li",{key:i,staticClass:"list-group-item",class:s.appState.modelId===e.id?"active":"",on:{click:function(t){s.appState.modelId=e.id}}},[s._v(s._s(e.name)+s._s(s.translate.modal))])})],2)]),s._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("a",{attrs:{href:"javascript:;"},on:{click:function(e){s.appState.showFormModal=!1}}},[s._v(s._s(s.translate.cancel))]),s._v(" "),t("a",{staticClass:"sure-btn",attrs:{href:"javascript:;"},on:{click:s._initWithModel}},[s._v(s._s(s.translate.confirm))])])]),s._v(" "),t("v-modal",{attrs:{show:s.showIconModal,effect:"fade",width:"446"}},[t("div",{staticClass:"modal-header iconModal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[s._v(s._s(s.translate.editIcon))])]),s._v(" "),t("div",{staticClass:"modal-body iconModal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[t("div",{staticClass:"background-container"},s._l(s.backgroundList,function(e,i){return t("span",{key:i,staticClass:"background",style:{background:e.background},on:{click:function(t){return s._selectBackground(e)}}},[s.appState.background===e.background?t("i",{staticClass:"maticon icon-done",domProps:{innerHTML:s._s(s.icons("done"))}},[s._v("done")]):s._e()])}),0),s._v(" "),t("div",{staticClass:"icon-list"},[s._l(s.iconList,function(e,i){return t("i",{key:i,staticClass:"maticon",class:{active:"1"===s.appState.imgType&&s.appState.imgPath===e.name},domProps:{innerHTML:s._s(s.icons(e.name))},on:{click:function(t){return s._selectIcon(e)}}},[s._v(s._s(e.name))])}),s._v(" "),s._l(s.saasIconList,function(e,i){return t("i",{key:i,class:{active:"2"===s.appState.imgType&&s.appState.imgPath===e},on:{click:function(t){return s._selectIcon({name:e},"2")}}},[t("span",{staticClass:"saasicon",class:["saasicon-"+e+"-black"]})])})],2)]),s._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){return s._cancelPart("icon")}}},[s._v(s._s(s.translate.cancel))]),s._v(" "),t("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:s._saveAppIcon}},[s._v(s._s(s.translate.confirm))])])]),s._v(" "),t("v-modal",{attrs:{show:s.showTableModal,effect:"fade",width:"748"}},[t("div",{staticClass:"modal-header iconModal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[s._v("报表设置")])]),s._v(" "),t("div",{staticClass:"modal-body iconModal-body",staticStyle:{padding:"0",height:"370px"},attrs:{slot:"modal-body"},slot:"modal-body"},[t("tableset",{ref:"tableset",attrs:{appId:s.appId}})],1),s._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){s.showTableModal=!1}}},[s._v("取消")]),s._v(" "),t("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:s._saveTableSet}},[s._v("确定")])])]),s._v(" "),t("v-modal",{attrs:{show:s.showBusSettingModal,effect:"fade",width:"748"}},[t("div",{staticClass:"modal-header iconModal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[s._v("发布业务期")])]),s._v(" "),t("div",{staticClass:"modal-body iconModal-body",staticStyle:{padding:"30px 60px"},attrs:{slot:"modal-body"},slot:"modal-body"},[t("el-radio",{staticStyle:{display:"block"},attrs:{label:"1"},model:{value:s.busType,callback:function(e){s.busType=e},expression:"busType"}},[s._v("立即发布")]),s._v(" "),t("el-radio",{attrs:{label:"2"},model:{value:s.busType,callback:function(e){s.busType=e},expression:"busType"}},[s._v("定时发布")]),s._v(" "),"2"==s.busType?t("div",{staticStyle:{padding:"0 23px"}},[t("span",{staticClass:"demonstration"},[s._v("发布时间")]),s._v(" "),t("el-date-picker",{attrs:{"picker-options":s.pickerOptionsValueTime,"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:"选择日期和时间"},model:{value:s.valueTime,callback:function(e){s.valueTime=e},expression:"valueTime"}})],1):s._e()],1),s._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){s.showBusSettingModal=!1}}},[s._v("取消")]),s._v(" "),t("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:s._saveRelease}},[s._v("确定")])])])],1)},staticRenderFns:[]};var d=t("C7Lr")(l,p,!1,function(s){t("Et2o")},null,null);e.a=d.exports},fi9f:function(s,e){},iScu:function(s,e,t){"use strict";var i=t("rVsN"),a=t.n(i),n=(t("kV13"),t("qqHy"),t("C331")),o=t("tjnL"),r=(o.a,{mixins:[o.a],data:function(){return{countWayList:[{label:"求和",value:"sum"},{label:"平均值",value:"avg"},{label:"最大值",value:"max"},{label:"最小值",value:"min"}],tableNameList:[],selectCtrl:"",editTable:{},editCom:"",nodeList:[],computedList:[{name:"计算1",value:1,noEdit:!1},{name:"计算2",value:2,noEdit:!1}],ctrlList:[],searchList:[]}},props:{appId:{required:!0,default:""}},mounted:function(){},methods:{getInOptionsTableSet:function(s){for(var e in this.nodeList)if(this.nodeList[e].name===s)return this.nodeList[e].properties.basic.options.map(function(s){return{label:s,value:s}})},nodeSelected:function(s){var e=this,t="/api/report/"+this.appId+"/formTable?component="+s.val;Object(n.d)(t).then(function(s){e.nodeList=s.data})},countSelected:function(){},addSearch:function(){0==this.searchList.length&&this.searchList.push({value:null,andOr:"a",advancedSearchParams:"",conditionVal:"",condition:[],province:null,city:null,area:null})},onShow:function(){this.getCtrlList(),this.getTableNameList()},editReport:function(s,e){if(this.editCom="",s.noEdit){this.advancedSearch.searchItems=[],this.titleName;var t=this.tableNameList.map(function(s){return s.appReportCountVO.forEach(function(s){s.noEdit=!0}),s.noEdit=!0,s});this.editTable=s,this.editTable.index=e,t[e].noEdit=!1,this.tableNameList=t}else s.noEdit=!0},deleteTable:function(s,e){this.tableNameList.splice(e,1)},deleteReport:function(s,e){this.editTable.appReportCountVO.splice(e,1)},editComputed:function(s,e){var t=this;if(s.noEdit){this.editTable.appReportCountVO.map(function(s){return s.noEdit=!0,s});this.advancedSearch.searchItems=[],this.editCom=s,s.appReportCountConditionVO&&s.appReportCountConditionVO.forEach(function(s){t.advancedSearch.searchItems.push({values:s.value,table:s.tableChildName,andOr:"AND"==s.relation?"a":"o",advancedSearchParams:"",conditionVal:s.type.toLowerCase(),condition:[],province:null,tableChild:"",city:null,area:null})}),this.editCom.index=e,this.editCom.noEdit=!1}else s.noEdit=!0},addTable:function(){this.tableNameList.push({reportName:"",appReportCountVO:[],value:"",noEdit:!0}),this.editReport(this.tableNameList[this.tableNameList.length-1],this.tableNameList.length-1)},addComputed:function(){(this.editTable.appReportCountVO||this.editTable.appReportCountVO==[])&&(this.editTable.appReportCountVO.push({component:"",countName:"",countResult:"",countValue:!1,countWay:"",noEdit:!0}),this.editComputed(this.editTable.appReportCountVO[this.editTable.appReportCountVO.length-1],this.editTable.appReportCountVO.length-1))},getCtrlList:function(){var s=this,e="api/report/"+this.appId+"/component";Object(n.d)(e).then(function(e){s.ctrlList=e.data}).catch(function(s){})},getTableNameList:function(){var s=this,e="api/report/"+this.appId+"/report/install ";Object(n.d)(e).then(function(e){e.data&&(s.tableNameList=e.data.map(function(s){return s.appReportCountVO=s.appReportCountVO.map(function(s){return s.noEdit=!0,s}),s.noEdit=!0,s}))}).catch(function(s){})},save:function(){var s=this;return new a.a(function(e,t){var i="api/report/"+s.appId+"/addReport ";Object(n.d)(i,s.tableNameList).then(function(s){e(s)}).catch(function(s){t(s)})})}}}),c={render:function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",{attrs:{id:"tableSet"}},[t("div",[s._l(s.tableNameList,function(e,i){return t("div",{key:i,staticClass:"row center"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.reportName,expression:"item.reportName"}],staticClass:"hideInput",attrs:{placeholder:"请输入"},domProps:{value:e.reportName},on:{input:function(t){t.target.composing||s.$set(e,"reportName",t.target.value)}}}),s._v(" "),t("i",{staticClass:"maticon pull-right",class:{active:!e.noEdit},attrs:{title:"编辑"},domProps:{innerHTML:s._s(s.icons("edit"))},on:{click:function(t){return s.editReport(e,i)}}}),s._v(" "),t("i",{staticClass:"maticon pull-right",attrs:{title:"删除"},domProps:{innerHTML:s._s(s.icons("delete"))},on:{click:function(t){return s.deleteTable(e,i)}}})])}),s._v(" "),t("div",{staticClass:"row center"},[t("i",{staticClass:"maticon pull-right add",attrs:{title:"新增报表"},domProps:{innerHTML:s._s(s.icons("add"))},on:{click:s.addTable}})])],2),s._v(" "),t("div",[s._l(s.editTable.appReportCountVO,function(e,i){return t("div",{key:i,staticClass:"row center"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.countName,expression:"item.countName"}],staticClass:"hideInput",attrs:{placeholder:"请输入"},domProps:{value:e.countName},on:{input:function(t){t.target.composing||s.$set(e,"countName",t.target.value)}}}),s._v(" "),t("i",{staticClass:"maticon pull-right",class:{active:!e.noEdit},attrs:{title:"编辑"},domProps:{innerHTML:s._s(s.icons("edit"))},on:{click:function(t){return s.editComputed(e,i)}}}),s._v(" "),t("i",{staticClass:"maticon pull-right",attrs:{title:"删除"},domProps:{innerHTML:s._s(s.icons("delete"))},on:{click:function(t){return s.deleteReport(e,i)}}})])}),s._v(" "),t("div",{staticClass:"row center"},[t("i",{staticClass:"maticon pull-right add",attrs:{title:"新增计算"},domProps:{innerHTML:s._s(s.icons("add"))},on:{click:s.addComputed}})])],2),s._v(" "),s.editCom?t("div",{staticClass:"editCom"},[t("div",{staticClass:"row box_flex box_between"},[t("div",{staticClass:"left"},[s._v("选择控件")]),s._v(" "),t("v-select",{attrs:{options:s.ctrlList,"options-value":"component","options-label":"label"},on:{afterSelected:s.nodeSelected},model:{value:s.editCom.component,callback:function(e){s.$set(s.editCom,"component",e)},expression:"editCom.component"}})],1),s._v(" "),t("div",{staticClass:"row box_flex box_between"},[t("div",{staticClass:"left"},[s._v("计算方式")]),s._v(" "),t("v-select",{attrs:{options:s.countWayList,"options-value":"value","options-label":"label"},model:{value:s.editCom.countWay,callback:function(e){s.$set(s.editCom,"countWay",e)},expression:"editCom.countWay"}})],1),s._v(" "),t("div",{staticClass:"row box_flex box_between"},[t("div",{staticClass:"left"},[s._v("是否计算空值")]),s._v(" "),t("div",{staticClass:"switch box_flex align_center",on:{click:function(e){s.editCom.countValue=!s.editCom.countValue}}},[t("div",{staticClass:"slider",class:s.editCom.countValue?"on":"off"},[t("div",{staticClass:"pipe",class:s.editCom.countValue?"right":""})])])]),s._v(" "),s._l(s.advancedSearch.searchItems,function(e,i){return t("div",{key:i,staticClass:"row box_flex box_between advanced"},[t("v-select",{attrs:{options:s.nodeList,search:!0,"options-value":"name","options-label":"title","data-index":i},on:{afterSelected:function(t){return s.advanceSelected("table",e)}},model:{value:e.table,callback:function(t){s.$set(e,"table",t)},expression:"searchItem.table"}}),s._v(" "),t("v-select",{attrs:{options:e.condition,search:!0},on:{afterSelected:s.advanceSelected},model:{value:e.conditionVal,callback:function(t){s.$set(e,"conditionVal",t)},expression:"searchItem.conditionVal"}}),s._v(" "),"empty"!==e.conditionVal&&"filled"!==e.conditionVal?t("div",{staticClass:"box_flex align_center"},[!(e.table&&-1!==e.table.indexOf("select")||e.table&&-1!==e.table.indexOf("radio"))||"eq"!==e.conditionVal&&"ne"!==e.conditionVal?"in"===e.conditionVal||"nin"===e.conditionVal||e.table&&-1!==e.table.indexOf("checkbox")&&("eq"===e.conditionVal||"ne"===e.conditionVal)?t("v-select",{attrs:{options:s.getInOptionsTableSet(e.table),search:!0,multiple:"true"},on:{afterSelected:s.advanceSelected},model:{value:e.values,callback:function(t){s.$set(e,"values",t)},expression:"searchItem.values"}}):e.table&&-1===e.table.indexOf("address")?t("input",{directives:[{name:"model",rawName:"v-model",value:e.values,expression:"searchItem.values"}],staticClass:"value-input",staticStyle:{"margin-left":"16px"},attrs:{type:"text"},domProps:{value:e.values},on:{change:s.advanceSelected,input:function(t){t.target.composing||s.$set(e,"values",t.target.value)}}}):s._e():t("v-select",{attrs:{options:s.getInOptionsTableSet(e.table),search:!0},on:{afterSelected:s.advanceSelected},model:{value:e.values,callback:function(t){s.$set(e,"values",t)},expression:"searchItem.values"}})],1):s._e()],1)}),s._v(" "),s.nodeList.length?t("button",{staticClass:"submit-btn btn",staticStyle:{"margin-left":"16px"},on:{click:function(e){return s.addSearchItem()}}},[s._v("新增")]):s._e()],2):s._e()])},staticRenderFns:[]};var u=t("C7Lr")(r,c,!1,function(s){t("w60d"),t("krpy"),t("EC1l")},"data-v-7d7835b8",null);e.a=u.exports},krpy:function(s,e){},ksuH:function(s,e,t){"use strict";var i=t("3cXf"),a=t.n(i),n=t("kV13"),o=t("qqHy"),r=t.n(o),c=t("C331"),u=t("iScu"),l=t("/LmD"),p=(l.a,u.a,{mixins:[l.a],props:{departmentId:{default:"1"},appId:{required:!0,default:""},readonly:{default:!1}},created:function(){var s=this,e=localStorage.getItem("lang");Object(c.g)(e)&&(this.lang=e),Object(c.e)({url:"/api/system/dictTypes/1003/dicts?lang=",type:"get",async:!1,success:function(e){s.schoolStatus=e.data}}),Object(c.e)({url:"/api/system/dicts?dictType=培养层次",type:"get",async:!1,success:function(e){s.educationLevel=e.data}}),this.nowTime=(new Date).getTime(),this.backgroundList=[{id:0,background:"linear-gradient(-135deg, #3F87E7 0%, #377EEB 100%)"},{id:1,background:"linear-gradient(-135deg, #F4A23F 0%, #F4A441 100%)"},{id:2,background:"linear-gradient(-135deg, #EF5E36 0%, #EF5E36 100%)"},{id:3,background:"linear-gradient(-135deg, #59CAAD 0%, #59C9AC 100%)"},{id:4,background:"linear-gradient(-135deg, #8489D8  0%, #888ACA 100%)"},{id:5,background:"linear-gradient(-135deg, #51B590 0%, #51B590 100%)"},{id:6,background:"linear-gradient(-135deg, #CEA44D 0%, #E0C37A 100%)"}],this.iconList=[{id:0,name:"school"},{id:1,name:"accessibility"},{id:2,name:"account_balance"},{id:3,name:"account_balance_wallet"},{id:4,name:"account_circle"},{id:5,name:"alarm"},{id:6,name:"assignment"},{id:7,name:"book"},{id:8,name:"build"},{id:9,name:"description"},{id:10,name:"explore"},{id:11,name:"extension"},{id:12,name:"face"},{id:13,name:"favorite"},{id:14,name:"flight_land"},{id:15,name:"flight_takeoff"},{id:16,name:"get_app"},{id:17,name:"grade"},{id:18,name:"language"},{id:19,name:"launch"},{id:20,name:"loyalty"},{id:21,name:"perm_contact_calendar"},{id:22,name:"receipt"},{id:23,name:"question_answer"},{id:24,name:"restore"},{id:25,name:"room"},{id:26,name:"schedule"},{id:27,name:"search"},{id:28,name:"shopping_cart"},{id:29,name:"swap_horiz"},{id:30,name:"theaters"},{id:31,name:"update"},{id:32,name:"verified_user"},{id:33,name:"work"},{id:34,name:"visibility"},{id:35,name:"equalizer"},{id:36,name:"business"},{id:37,name:"call"},{id:38,name:"chat"},{id:39,name:"email"},{id:40,name:"create"},{id:41,name:"flag"},{id:42,name:"save"},{id:43,name:"link"},{id:44,name:"send"},{id:45,name:"devices"},{id:46,name:"attach_file"},{id:47,name:"format_quote"},{id:48,name:"cloud"},{id:49,name:"folder"},{id:50,name:"computer"},{id:51,name:"headset"},{id:52,name:"security"},{id:53,name:"sim_card"},{id:54,name:"watch"},{id:55,name:"add_a_photo"},{id:56,name:"camera_alt"},{id:57,name:"directions_railway"},{id:58,name:"directions_bike"},{id:59,name:"local_activity"},{id:60,name:"directions_walk"},{id:61,name:"local_dining"},{id:62,name:"local_hospital"},{id:63,name:"local_library"},{id:64,name:"event_note"},{id:65,name:"map"},{id:66,name:"navigation"},{id:67,name:"wifi"},{id:68,name:"ac_unit"},{id:69,name:"fitness_center"},{id:70,name:"pool"},{id:71,name:"cake"},{id:72,name:"group"},{id:73,name:"location_city"},{id:74,name:"notifications"},{id:75,name:"person"},{id:76,name:"poll"},{id:77,name:"public"},{id:78,name:"share"},{id:79,name:"whatshot"}],this.JiekouColumns=[{id:"name",title:"姓名",width:130,className:"text-left",hidden:!1},{id:"userNo",title:"学号",width:150,className:"text-left",hidden:!1,formatter:function(e,t){return"3"===s.curApp.appType.userType?e.account:e.userNo}},{id:"collegeName",title:"学院",width:150,className:"text-left",hidden:!1},{id:"grade",title:"年级",width:80,className:"text-left",hidden:!1},{id:"educetionLevel",title:"培养层次",width:100,className:"text-left",hidden:!0},{id:"createTime",title:"更新时间",width:100,className:"text-left",hidden:!1}],this.advanceColumns=[{id:"limitName",title:"名称",width:250,className:"text-left",hidden:!1},{id:"conditions",title:"条件",width:350,className:"text-left",hidden:!1,formatter:function(s){return s.conditionInfos.map(function(s){return{tag:"p",text:s}})}},{id:"apply",title:"结果",width:150,className:"text-left",hidden:!1,formatter:function(s,e){return s.apply?"可申请":"不可申请"}},{id:"message",title:"不可申请提示语",width:250,className:"text-left",hidden:!1},{id:"opt",title:"操作",className:"text-left",width:180,hidden:!1,formatter:function(e){return[{tag:"a",text:"编辑",callback:function(e,t){var i="api/business/apply/limit/"+e.id;Object(c.d)(i).then(function(e){e.state&&(s.advancedSearch.searchItems=[],s.isEditAdvanced=!0,s.initApplySearchKeys().then(function(){s.advancedSearch.searchItems=e.data.conditions.map(function(s){return"Address"===s.columnType?{value:s.value,relation:s.judge,key:s.columnId,options:{relation:[],dictOptions:[],province:[],city:[],county:[]},isDict:!1,isAddress:!1,isSelectProvince:!1,isSelectCity:!1,isDate:!1,isInput:!1,province:s.listValue[0].split(",")[0],city:s.listValue[0].split(",")[1],county:s.listValue[0].split(",")[2]}:{value:s.value,relation:s.judge,key:s.columnId,options:{relation:[],dictOptions:[],province:[],city:[],county:[]},isDict:!1,isAddress:!1,isSelectProvince:!1,isSelectCity:!1,isDate:!1,isInput:!1,province:null,city:null,county:null}}),s.advanceParams.id=e.data.id,s.advanceParams.limitName=e.data.limitName,s.advanceParams.message=e.data.message,s.advanceParams.applyValue=e.data.apply?"1":"0"}))})}},{tag:"a",text:"删除",callback:function(e,t){confirm("确定要删除吗？")&&s.deleteAdvancedSearch(e.id)}}]}}],this.appState.inSchoolOptions=[{id:0,label:"不限制"},{id:1,label:"在校"},{id:2,label:"不在校"}],this.appState.infoTypes=[{id:"base",name:"基本信息"},{id:"faceTo",name:"面向人员"},{id:"timeSet",name:"时间设置"},{id:"description",name:"办理指南"},{id:"records",name:"办理记录"}];for(var t=(new Date).getFullYear(),i=t+3;i>t-5;i--)this.appState.gradeOptions.push({id:i+"",label:i+"-"+(i+1)+"学年"});for(var a=t+3;a>t-5;a--)this.appState.gradeOptions2.push({id:a+"",label:a+"级"});Object(c.e)({url:"/api/relationship/getSelectOptions",dataType:"json",type:"get",success:function(e){var t=e.data;e.state&&(s.collegeOptions=t.colleges||[],s.gradeOptions=t.grades||[])}}),this._initAppInfo()},data:function(){return{curBusinessIdx:-1,showAddModal:!1,showAddOnePersonModal:!1,isShowMemberTable:!0,addPersonParams:{},tempUserIdArr:[],unpublishCacheKey:"",publishedCacheKey:"",checkedNum:0,nodeSetting:{authorities:[],openMessage:!0,templates:""},typeList:["节点名称","提交申请","同意","取消","驳回","转交","抄送"],showStatusList:[],showStatus:!0,showInformModal:!1,applySearch:!0,JiekouColumns:[],advanceColumns:[],supportOptions:[{text:"可申请",value:"1"},{text:"不可申请",value:"0"}],advanceParams:{limitName:"",message:"",applyValue:"1"},isEditAdvanced:!1,typeL:"",schoolStatus:[],educationLevel:[],notInSchoolStatus:[],inSchoolStatus:[],iconList:["business","assignment","school","person_pin_circle","person_pin","people","local_library","tag_faces","favorite"],saasIconList:["road","book","camera","idcard","tuition","bankcard","list","text","help","layer","package","cap","letter","calendar","menu","menu2","menu3","apply","info","rightcard","drippower","bulb","record","direction","person","envelope","reduce","socialist","star","assets","notebook","location","purse","remark","statisticsbar","building","geography","rotate","manlove","medal","pick","purse2","free","tag","menudone","travel","trophy","medal2","question","excellent","search"],formList:[],curApp:{name:"点击右侧按钮编辑应用名称",imgPath:"",imgType:"1",remark:"应用说明"},nameChangeMsg:"",descChangeMsg:"",appState:{editPart:"",showFormModal:!1,showFlowModal:!1,infoType:"base",flowName:"",formName:"",modelId:"",infoTypes:[],columns:[],recordColumns:[],inSchoolOptions:[],gradeOptions:[],gradeOptions2:[],flowData:{id:"",chart:{}},background:"linear-gradient(-135deg, #5067D7 0%, #3F53B8 100%)"},editorConfig:{initialFrameHeight:520},businessList:[],leftIconShow:!1,rightIconShow:!1,curBusiness:null,curTimeNode:null,timeSet:null,errorMsg:"",nowTime:"",defineSearch:{userNo:"",name:"",status:"",collegeCode:"",grade:""},collegeOptions:[],gradeOptions:[],preview:!1,previewObj:{formData:null,authorities:null,recordData:[],log:null,curBusinessId:"",appId:""},importParams:{parentPageTitle:"人员列表",downloadTemplateUrl:"/app/business/studentExcelTemplate",downloadErrorTemplateUrl:"/app/business/errorBusinessStudentExcel",checkTemplateUrl:"",templateName:"面向人员名单导入模板",importBtnType:null},showImportModal:!1,overriteImport:"覆盖导入",incrementImport:"增量导入",resultMessageJson:{overtime:"申请在{{node}}节点超时",rescissory:"申请者取消申请",disable:"业务期停用，表单废弃",success:"申请已通过",fail:"申请在{{node}}节点不通过",end:"已结束",submit:"待{{node}}节点审核",agree:"待{{node}}节点审核",reject:"申请被驳回至{{node}}节点",countermand:"申请被撤回至{{node}}节点"},timestamp:"",advanceTimestamp:"",newName:"",releaseBusinessDisabled:!1,annoreleaseBusinessText:"",numberDesc:"",showTime:!1,showIconModal:!1,showTableModal:!1,backgroundList:[],outputList:[],exportFiledArr:[],notAllowOutput:["label","splitLine","attachment"],outputModalShow:!1,formFields:[],reviseSetTimeOut:null,clickCount:0,canEditPublishedBusiness:!1,isReviseData:!1,isChangeGuideInfo:!1,reviseMark:!1,businessTimer:null,blankTemplateId:"",faceToPeopleType:["2","3","4"],lang:"zh-cn"}},computed:{advanceSearchUrl:function(){return"/api/business/apply/limit/page/"+this.curBusiness.business.id+"?timestamp="+this.advanceTimestamp},isReviseBusiness:function(){return this.canEditPublishedBusiness&&this.curBusiness&&!this.curBusiness.business.isPublishing},host:function(){return window.location.host},initDataOfChart:function(){var s=null;return this.appState.flowData.chart&&this.appState.flowData.chart.nodes&&this.appState.flowData.chart.nodes.length>0&&(s={},this.appState.flowData.chart.nodes.forEach(function(e,t){s[e.id]=e})),s},businessIsOn:function(){var s=this,e=!1;return this.curBusiness&&this.businessList.forEach(function(t){t.business.id!==s.curBusiness.business.id&&t.business.isPublic&&t.business.isEnable&&(e=!0)}),e},peopleUrl:function(){return"/table-data/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/users/page?timestamp="+this.timestamp},peopleUrlJiekou:function(){return"/table-data/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/api/users/page?timestamp="+this.timestamp},isCache:function(){return!this.curBusiness.business.isPublic||this.isReviseBusiness},cacheKey:function(){return this.curBusiness&&this.curBusiness.business.isPublic?this.publishedCacheKey:this.unpublishCacheKey},allPeopleUrl:function(){return"/table-data/app/"+this.appId+"/business/users/"+this.curBusiness.business.id+"/users/page?isCache="+this.isCache+"&key="+this.cacheKey+"&timestamp="+this.timestamp},inputStyleWidth:function(){return this.curApp.name.length<=20?34*this.curApp.name.length:27*this.curApp.name.length},rowsNumber:function(){return this.curApp.remark?this.curApp.remark.length>62&&this.curApp.remark.length<=124?2:this.curApp.remark.length>124&&this.curApp.remark.length<=186?3:this.curApp.remark.length>186?4:1:1}},mounted:function(){},watch:{appId:function(){this._initAppInfo()},errorMsg:function(){var s=this;setTimeout(function(){s.errorMsg=""},1500)},curBusiness:function(){this.curBusiness&&this._loadBusinessTime()},curApp:function(){var s=this,e="学号";this.curApp&&this.curApp.appType&&("1"===this.curApp.appType.userType?e="学号":"2"===this.curApp.appType.userType?e="教工号":"3"===this.curApp.appType.userType?e="新生账号":"4"===this.curApp.appType.userType&&(e="学工号")),"4"!==this.curApp.appType.userType?this.appState&&this.appState.columns&&this.appState.columns[1]&&n.default.set(this.appState.columns[1],"title",e):this.appState.columns=[{id:"name",title:"姓名",width:150,className:"text-left",hidden:!1,search:{type:"input"}},{id:"userNo",title:"学工号",width:150,className:"text-left",hidden:!1,search:{type:"input"}},{id:"college",title:"学院",width:150,className:"text-left",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code"}},formatter:function(s){return s.collegeName}},{id:"opt",title:"操作",className:"text-left",width:100,hidden:!1,formatter:function(e){return[{tag:"a",text:"删除",callback:function(e,t){if(s.isCache){if(confirm("确定要删除吗？")){var i="/api/app/"+s.appId+"/business/"+s.curBusiness.business.id+"/"+e.userId;i+="?isCache="+s.isCache+"&key="+s.cacheKey,Object(c.e)({url:i,dataType:"json",type:"post",success:function(e){e.state?(s.$toast("删除成功"),s.timestamp=(new Date).getTime()):s.$toast(e.message)}})}}else s.$toast("非编辑状态不能操作！")}}]}}],this.appState&&this.appState.recordColumns&&this.appState.recordColumns[1]&&n.default.set(this.appState.recordColumns[1],"title",e),this.numberDesc=e}},methods:{_initTableColunm:function(){var s=this;this.appState.columns=[{id:"name",title:"姓名",width:130,className:"text-left",hidden:!1,search:{type:"input"}},{id:"userNo",title:"学号",width:150,className:"text-left",hidden:!1,formatter:function(e,t){return"3"===s.curApp.appType.userType?e.account:e.userNo},search:{type:"input"}},{id:"college",title:"学院",width:150,className:"text-left",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code"}},formatter:function(s){return s.collegeName}},{id:"grade",title:"年级",width:80,className:"text-left",hidden:!1,search:{type:"select",data:{optionsLabel:"label",optionsValue:"id",options:this.appState.gradeOptions2}}},{id:"studentType",title:"学生类型",width:100,className:"text-left",hidden:!0},{id:"schoolStatus",title:"在校状态",width:100,className:"text-left",hidden:!1,search:{type:"select",data:{optionsLabel:"label",optionsValue:"value",options:this.schoolStatus}},formatter:function(s){return s.inSchoolValue}},{id:"educationLevel",title:"培养层次",width:100,className:"text-left",hidden:!1,search:{type:"select",data:{optionsLabel:"label",optionsValue:"value",options:this.educationLevel}}},{id:"opt",title:"操作",className:"text-left",width:80,hidden:!1,formatter:function(e){return[{tag:"a",text:"删除",callback:function(e,t){if(s.isCache){if(confirm("确定要删除吗？")){var i="/api/app/"+s.appId+"/business/"+s.curBusiness.business.id+"/"+e.userId;i+="?isCache="+s.isCache+"&key="+s.cacheKey,Object(c.e)({url:i,dataType:"json",type:"post",success:function(e){e.state?(s.$toast("删除成功"),s.timestamp=(new Date).getTime()):s.$toast(e.message)}})}}else s.$toast("非编辑状态不能操作！")}}]}}],"2"!=this.curApp.appType.userType&&"4"!=this.curApp.appType.userType||(this.appState.columns[3].hidden=!0,this.appState.columns[5].hidden=!0,this.appState.columns[6].hidden=!0)},_afterChecked:function(s){this.checkedNum=s.length,this.tempUserIdArr=s.map(function(s){return s.userId})},afterSelectAddPerson:function(s){this.addPersonParams.userId=s.userId,this.addPersonParams.userNo=s.userNo,this.addPersonParams.name=s.name},addPersonByOne:function(){this.showAddOnePersonModal=!0,this.showAddModal=!1},addOnePerson:function(){var s=this,e="/api/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/users?userId="+this.addPersonParams.userId+"&isCache="+this.isCache+"&key="+this.cacheKey;Object(c.d)(e,null,"post").then(function(e){e.state?(s.$toast("操作成功!"),s.showAddOnePersonModal=!1,s.timestamp=new Date):s.$toast(e.message)})},searchByCondition:function(){this.cacheBusinessInfo("1"),this.isShowMemberTable=!0,this._initTableColunm()},batchDelete:function(){var s=this,e=this.tempUserIdArr,t="/api/app/batch/"+this.appId+"/business/"+this.curBusiness.business.id+"?isCache="+this.isCache+"&key="+this.cacheKey;confirm("确定批量删除选中人员")&&Object(c.e)({url:t,dataType:"json",type:"post",data:e,success:function(e){e.state?(s.$toast("删除成功!"),s.tempUserIdArr=[],s.timestamp=new Date,s.checkedNum=0):s.$toast(e.message)}})},_initCache:function(s){var e=this;Object(c.e)({url:"/api/business/users/"+this.appId+"/init/cache",type:"post",success:function(t){t.state?t.data&&(e.unpublishCacheKey=t.data,"function"==typeof s&&s()):e.$toast(t.message)}})},cacheBusinessInfo:function(s){var e=this;this.changeBusinessLimit(),Object(c.e)({url:"/api/business/users/"+this.curBusiness.business.id+"/cache/"+s+"?key="+this.cacheKey,type:"post",data:{inSchool:this.curBusiness.businessLimit.inSchool,grade:this.curBusiness.businessLimit.grade,studentType:this.curBusiness.businessLimit.studentType,schoolStatus:this.curBusiness.businessLimit.schoolStatus,educationLevel:this.curBusiness.businessLimit.educationLevel,url:this.curBusiness.businessLimit.url,updateType:this.curBusiness.businessLimit.updateType,cron:this.curBusiness.businessLimit.cron},success:function(s){s.state?e.timestamp=new Date:e.$toast(s.message)}})},showImportPage:function(){this._initImportTpl(),this.showImportModal=!0,this.showAddModal=!1},showImportPageTwo:function(){var s=this;this._initImportTpl(),this.showImportModal=!0,this.showAddModal=!1,this.importParams.importBtnType=[{name:this.incrementImport,url:"/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/updateExcel?isCover=false&isCache="+this.isCache+"&key="+this.cacheKey,method:"post",isShowBtn:!0,success:function(e){e.state&&(s.timestamp=new Date)}},{name:this.overriteImport,url:"/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/updateExcel?isCover=true&isCache="+this.isCache+"&key="+this.cacheKey,method:"post",isShowBtn:!0,success:function(e){e.state&&(s.timestamp=new Date)}}]},switchOpen:function(){this.nodeSetting.openMessage=!this.nodeSetting.openMessage,this.nodeSetting.openMessage?this.nodeSetting.authorities=this.nodeSetting.authorities.map(function(s){return s.submit=!0,s.agree=!0,s.cancelByUser=!0,s.reject=!0,s.deliverTo=!0,s.sendTo=!0,s}):this.nodeSetting.authorities=this.nodeSetting.authorities.map(function(s){return s.submit=!1,s.agree=!1,s.cancelByUser=!1,s.reject=!1,s.deliverTo=!1,s.sendTo=!1,s})},_saveNodeWX:function(){var s=this;if(this.nodeSetting.templates){var e={nodes:[]};e.nodes=this.nodeSetting.authorities.map(function(s,e){var t={};return t.id=s.id,t.authorities={},t.authorities.submit=s.submit,t.authorities.agree=s.agree,t.authorities.cancelByUser=s.cancelByUser,t.authorities.reject=s.reject,t.authorities.deliverTo=s.deliverTo,t.authorities.sendTo=s.sendTo,t}),e.openMessage=this.nodeSetting.openMessage,e.templates=this.nodeSetting.templates,Object(c.e)({url:"/api/apps/"+this.appId+"/settings/message",dataType:"json",type:"post",data:e,success:function(e){e.state?(s.$toast("设置成功"),s.showInformModal=!1):s.$toast(e.message)}})}else this.$toast("请选择模板标题")},addAdvanceSearch:function(){this.isEditAdvanced=!1,this.advanceParams={limitName:"",message:"",applyValue:"1"},this.advancedSearch={show:!1,initialized:!1,searchItems:[],tables:{},tableKeys:{},tableOptions:[],keys:{},typeOptions:[{value:"and",label:"且"},{value:"or",label:"或"}],defaultType:"and",optionKeys:{},columns:[]},this.initApplySearchKeys().then(function(){})},deleteAdvancedSearch:function(s){var e=this,t="api/business/apply/limit/"+s+"/deleteLimit";Object(c.d)(t,null,"post").then(function(s){s.state&&(e.$toast("操作成功!"),e.advanceTimestamp=(new Date).getTime(),e.advancedSearch.show=!1)})},_saveAddSearch:function(){var s=this,e="api/business/apply/limit/"+this.curBusiness.business.id,t="post";if(this.advanceParams.limitName)if(this.advanceParams.message)if(this.isEditAdvanced&&(e="api/business/apply/limit/update/"+this.advanceParams.id,t="post"),this.advancedSearch.searchItems.length){var i=0;this.advanceParams.conditions=this.advancedSearch.searchItems.map(function(s){var e=s.keyInfo+s.relationInfo;if(s.valueInfo?e+=s.valueInfo:e+=s.value,s.value||s.county){if(s.relation){if(s.isAddress){s.listValue=[];var t=s.province+","+s.city+","+s.county;return s.listValue.push(t),{conditionInfo:e,value:s.value,judge:s.relation,listValue:s.listValue,columnId:s.key}}return{conditionInfo:e,value:s.value,judge:s.relation,listValue:s.value.split(","),columnId:s.key}}i++}else i++}),i?this.$toast("条件与值不能为空!"):("1"===this.advanceParams.applyValue?this.advanceParams.apply=!0:this.advanceParams.apply=!1,Object(c.d)(e,this.advanceParams,t).then(function(e){e.state?(s.$toast("操作成功!"),s.advanceTimestamp=(new Date).getTime(),s.advancedSearch.show=!1):s.$toast(e.message)}))}else this.$toast("条件不能为空!");else this.$toast("提示语不能为空!");else this.$toast("名称不能为空!")},advancedSearchProvinceSelected:function(s){var e=parseInt(s.target.$attrs["data-index"]);this.advancedSearch.searchItems[e].province=s.val},advancedSearchCitySelected:function(s){var e=parseInt(s.target.$attrs["data-index"]);this.advancedSearch.searchItems[e].city=s.val},advancedSearchCountySelected:function(s){var e=parseInt(s.target.$attrs["data-index"]);this.advancedSearch.searchItems[e].county=s.val},updateHand:function(){var s=this;Object(c.e)({url:"/api/app/business/updateUserByApi/"+this.curBusiness.business.id,dataType:"json",type:"get",success:function(e){e.state&&(s.$toast("更新成功"),s.timestamp=(new Date).getTime())}})},_initAppInfo:function(){var s=this;this._initCurApp(function(){s._initCache(function(){s._initBusinessList()}),s._initFlowChart()})},_initColumns:function(){var s=this;"4"===this.curApp.appType.userType?this.appState.recordColumns=[{id:"userNo",title:this.numberDesc,width:150,className:"text-left",hidden:!1,search:{type:"input",data:{}},formatter:function(e,t){return"3"===s.curApp.appType.userType?(s.appState.recordColumns[0].id="account",e.applicant.account):e.applicant.userNo}},{id:"name",title:"姓名",width:100,className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:"请输入姓名"}},formatter:function(s,e){return s.applicant.name}},{id:"college",title:"学院",width:150,className:"text-left",hidden:!1,formatter:function(s,e){return s.applicant.collegeCode}},{id:"createTime",title:"发起时间",width:200,search:{type:"datetime",data:{dateFormat:"yyyy-MM-dd hh:ii:ss"}},className:"text-left",hidden:!1},{id:"status",title:"状态",width:150,className:"text-left",hidden:!1,formatter:function(e,t){var i="";return"pending"===e.status.toLowerCase()?i=s.resultMessageJson[e.lastAction]?s.resultMessageJson[e.lastAction].replace("{{node}}",e.currentNode.name):" ":"end"===e.status.toLowerCase()&&(i=s.resultMessageJson[e.result.toLowerCase()]?s.resultMessageJson[e.result.toLowerCase()].replace("{{node}}",e.currentNode.name):" "),i}},{title:"操作",width:50,className:"text-center",hidden:!1,formatter:function(e,t){return[{tag:"a",text:"查看",callback:function(e,t){s.previewObj.curBusinessId=e.businessId,s.previewObj.appId=e.appId,s._getLog(e.id,function(e){s.previewObj.log=e||null}),s._getAuthorityData(e.id,function(e){s.previewObj.authorities=e||[]}),s._getFormLayout(e.businessId,e.currentNode.id,function(t){s.previewObj.formData=t,s.previewObj.formData.components.forEach(function(s){n.default.set(s,"x",s.location.left),n.default.set(s,"y",s.location.top),n.default.set(s,"w",s.size.width),n.default.set(s,"h",s.size.height)}),s._getInitData(e.id,function(e){s.previewObj.recordData=e,s.preview=!0})})}}]}}]:this.appState.recordColumns=[{id:"userNo",title:this.numberDesc,width:150,className:"text-left",hidden:!1,search:{type:"input",data:{}},formatter:function(e,t){return"3"===s.curApp.appType.userType?(s.appState.recordColumns[0].id="account",e.applicant.account):e.applicant.userNo}},{id:"name",title:"姓名",width:150,className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:"请输入姓名"}},formatter:function(s,e){return s.applicant.name}},{id:"grade",title:"年级",width:80,className:"text-left",hidden:!1,search:{type:"input",data:{placeholder:"请输入年级"}},formatter:function(s,e){return s.applicant.grade}},{id:"createTime",title:"发起时间",width:200,search:{type:"datetime",data:{dateFormat:"yyyy-MM-dd hh:ii:ss"}},className:"text-left",hidden:!1},{id:"status",title:"状态",width:150,className:"text-left",hidden:!1,formatter:function(e,t){var i="";return"pending"===e.status.toLowerCase()?i=s.resultMessageJson[e.lastAction]?s.resultMessageJson[e.lastAction].replace("{{node}}",e.currentNode.name):" ":"end"===e.status.toLowerCase()&&(i=s.resultMessageJson[e.result.toLowerCase()]?s.resultMessageJson[e.result.toLowerCase()].replace("{{node}}",e.currentNode.name):" "),i}},{title:"操作",width:50,className:"text-center",hidden:!1,formatter:function(e,t){return[{tag:"a",text:"查看",callback:function(e,t){s.previewObj.curBusinessId=e.businessId,s.previewObj.appId=e.appId,s._getLog(e.id,function(e){s.previewObj.log=e||null}),s._getAuthorityData(e.id,function(e){s.previewObj.authorities=e||[]}),s._getFormLayout(e.businessId,e.currentNode.id,function(t){s.previewObj.formData=t,s.previewObj.formData.components.forEach(function(s){n.default.set(s,"x",s.location.left),n.default.set(s,"y",s.location.top),n.default.set(s,"w",s.size.width),n.default.set(s,"h",s.size.height)}),s._getInitData(e.id,function(e){s.previewObj.recordData=e,s.preview=!0})})}}]}}]},_initImportTpl:function(){this.curApp&&this.curApp.appType&&"3"===this.curApp.appType.userType&&(this.importParams.downloadTemplateUrl="/app/business/freshmanExcelTemplate")},_releaseApp:function(){var s=this,e="post",t="/api/app/"+this.curApp.id+"/public",i="应用发布后将对用户可见，确定发布吗？",a="发布成功";this.curApp.isPublished&&(e="post",t="/api/app/"+this.curApp.id+"/deletePublic",i="应用下架后将对用户不可见，确定下架吗？",a="下架成功"),confirm(i)&&Object(c.e)({url:t,type:e,success:function(e){e.state?(s.curApp.isPublished=!s.curApp.isPublished,s.$toast(a)):s.$toast(e.message)}})},_limitLength:function(s){this.curApp.name=this._getStrByteLimit(s.target.value,50)},_saveAppName:function(){var s=this;this.curApp.name?Object(c.e)({url:"/api/app/"+this.curApp.id+"/name",type:"post",data:{name:this.curApp.name},success:function(e){e.state?(s.$emit("update",s.curApp),s.nameChangeMsg="修改成功",setTimeout(function(){s.nameChangeMsg=""},2e3)):s.nameChangeMsg="出错啦："+e.message}}):this.nameChangeMsg="出错啦：名称不能为空"},_saveAppDesc:function(){var s=this;Object(c.e)({url:"/api/app/"+this.curApp.id+"/remark",type:"post",data:{remark:this.curApp.remark},success:function(e){e.state?(s.$emit("update",s.curApp),s.descChangeMsg="修改成功",setTimeout(function(){s.descChangeMsg=""},2e3)):s.descChangeMsg="出错啦："+e.message}})},_saveAppIcon:function(){var s=this;Object(c.e)({url:"/api/app/"+this.curApp.id+"/style",type:"post",data:{imgPath:this.appState.imgPath,imgType:this.appState.imgType,background:this.appState.background},success:function(e){e.state?(s._savePart("imgPath"),s._savePart("imgType"),s._savePart("background"),s.$emit("update",s.curApp),s.showIconModal=!1):s.$toast(e.message)}})},_saveTableSet:function(){var s=this;this.$refs.tableset.save().then(function(e){e.state?(s.showTableModal=!1,s.$toast("保存成功")):s.$toast("错误:"+e.message)}).catch(function(e){s.$toast("错误:"+e.message)})},_getLog:function(s,e){var t=this;Object(c.e)({url:"/api/processEngine/processInstances/"+s+"/handleLogs",type:"get",success:function(s){s.state?e(s.data):t.$toast(s.message)}})},_getInitData:function(s,e){var t=this;Object(c.e)({url:"/api/processEngine/processInstances/"+s,type:"get",success:function(s){s.state?e(s.data):t.$toast(s.message)}})},_getAuthorityData:function(s,e){var t=this;Object(c.e)({url:"/api/processEngine/processInstances/"+s+"/operations",type:"get",success:function(s){s.state?e(s.data):t.$toast(s.message)}})},_getFormLayout:function(s,e,t){var i=this;Object(c.e)({url:"/api/processEngine/business/"+s+"/formRenderData?nodeId="+e,type:"get",success:function(s){s.state?t(s.data):i.$toast(s.message)}})},_changeBusinessGuide:function(s){this.curBusiness.business.guide=s,this.isChangeGuideInfo=!0},_stateSearch:function(s){this.$refs.recordsTable.tableSearchFields.status=s.val},_tabClick:function(s){var e=this;this.isChangeGuideInfo&&(this.reviseMark?this.isReviseData=!1:this.isReviseData=!0),this.appState.infoType=s.id,this.timeType="",this.showImportModal=!1,this.showAddModal=!1,this.showAddOnePersonModal=!1,this._loadBusinessTime(),this._initTableColunm(),"timeSet"===s.id?setTimeout(function(){e.$refs.timeSet.refresh()},500):"records"===s.id&&this._initColumns(),this.importParams.checkTemplateUrl="/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/excel",this.importParams.importBtnType=[{name:this.overriteImport,url:"/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/updateExcel",method:"post",isShowBtn:!0,success:function(s){s.state&&(e.timestamp=(new Date).getTime())}}]},_changeBusiness:function(s,e,t){this.typeL=e,this.curBusinessIdx=t,this.$set(this,"curBusiness",JSON.parse(a()(s))),this.showAddModal=!1,this.showAddOnePersonModal=!1,this.canEditPublishedBusiness=!1,this._getFormFields(this.curBusiness.business.id)},_back:function(){this.$emit("back",this.curApp),this.businessTimer&&clearInterval(this.businessTimer)},_initFlowChart:function(){var s=this;Object(c.e)({url:"/api/apps/"+this.appId+"/settings/flows",type:"get",success:function(e){e.state?e.data&&(s.appState.flowData.id=e.data.id,s.appState.flowData.chart=e.data.chart):s.$toast(e.message)}})},_initFormList:function(){var s=this;""!==this.appId?Object(c.e)({type:"get",url:"/api/departments/"+this.departmentId+"/apps/forms?userType="+this.curApp.appType.userType,success:function(e){e.state?s.formList=e.data:s.$toast(e.message)}}):this.formList=[]},_getFormName:function(s){var e=this;Object(c.e)({url:"/api/apps/"+this.appId+"/settings/forms",type:"get",success:function(s){s.state?s.data&&(e.appState.formName=s.data.name):e.$toast(s.message)}})},_getFlowName:function(s){var e=this;Object(c.e)({url:"/api/apps/"+this.appId+"/settings/flows",type:"get",success:function(s){s.state?s.data&&s.data.settings&&(e.appState.flowName=s.data.settings.name,s.data.settings.nodes.shift(),s.data.settings.nodes.pop(),e.nodeSetting.authorities=s.data.settings.nodes.map(function(s,e){if(s.authorities){var t={};return t.submit=s.authorities.submit,t.agree=s.authorities.agree,t.cancelByUser=s.authorities.cancelByUser,t.reject=s.authorities.reject,t.deliverTo=s.authorities.deliverTo,t.sendTo=s.authorities.sendTo,t.id=s.id,t}var i={submit:!0,agree:!0,cancelByUser:!0,reject:!0,deliverTo:!0,sendTo:!0};return i.id=s.id,i}),e.nodeSetting.ables=s.data.settings.nodes.map(function(s,e){var t={};return 0==e?(t.submit=!0,t.agree=!1,t.cancelByUser=s.operations.cancelByUser.usable):(t.submit=!1,t.agree=!0,t.cancelByUser=!1),t.name=s.name,t.reject=s.operations.reject.usable,t.deliverTo=s.operations.deliverTo.usable,t.sendTo=s.operations.sendTo.usable,t}),e.nodeSetting.openMessage=!s.data.settings.openMessage||s.data.settings.openMessage,e.nodeSetting.templates=s.data.settings.templates?s.data.settings.templates:""):e.$toast(s.message)}})},_initCurApp:function(s){var e=this;Object(c.e)({type:"get",url:"/api/app/"+this.appId,success:function(t){t.state?(e.curApp=t.data,e.$set(e.appState,"imgType",e.curApp.imgType),e._initFormList(),e._getFormName(),e._getFlowName(),e.curApp&&e.curApp.appType&&("4"===e.curApp.appType.userType||"2"===e.curApp.appType.userType?e.blankTemplateId="000000000000000000000002":e.blankTemplateId="000000000000000000000001"),s&&s()):e.$toast(t.message)}})},_initCheckPublishResultSchedule:function(s){var e=this;s.publishAsync&&s.publishAsync.timer&&clearInterval(s.publishAsync.timer),s.publishAsync.timer=setInterval(function(){e.refreshImportProgress(s)},1e3)},endRefreshImportProgress:function(s){clearInterval(s.publishAsync.timer)},refreshImportProgress:function(s){var e=this;s.publishAsync.code?Object(c.e)({url:"/api/async/imports/importStatus/"+s.publishAsync.code,dataType:"json",success:function(t){t.state?"IMPORT_COMPLETE"===t.data.status?(s.publishAsync.processing=!1,s.publishAsync.code=null,s.publishAsync.done=0,s.publishAsync.total=0,e.endRefreshImportProgress(s),s.business.isPublic=!0,s.business.isPublishing=!1,e.$toast(s.business.name+"发布成功")):"IMPORT_ERROR"===t.data.status?(s.publishAsync.processing=!1,s.publishAsync.code=null,s.publishAsync.done=0,s.publishAsync.total=0,e.endRefreshImportProgress(s),e.$toast(t.data.message)):(s.publishAsync.total=t.data.count||0,s.publishAsync.done=t.data.hadCheckCount||0,e.$forceUpdate()):e.$toast(t.message)}}):this.endRefreshImportProgress(s)},_initBusinessList:function(){var s=this;Object(c.e)({type:"get",url:"/api/app/"+this.appId+"/business?key="+this.cacheKey,success:function(e){e.state?(e.data.forEach(function(s,e){s.publishAsync={processing:!1,code:"",timer:null,done:0,total:0}}),s.$set(s,"businessList",e.data),s.businessList.forEach(function(e,t){e.publishAsync={processing:!1,code:"",timer:null,done:0,total:0},e.business.isPublic&&e.business.isEnable&&(s.curBusiness=e,s.curBusinessIdx=t,s.typeL=e.business.limitType,s._scrollToBusiness(t),s._getFormFields(s.curBusiness.business.id),s.businessTimer&&clearInterval(s.businessTimer)),e.business.isPublishing&&(e.publishAsync.code=e.business.publishCode,e.publishAsync.processing=!0,s._initCheckPublishResultSchedule(e))})):s.$toast(e.message)}})},_releaseBusiness:function(s){var e=this;if("release"===s){if(this.releaseBusinessDisabled)return;if(!confirm("确认发布本业务吗？业务期一旦开启，为保证申请的正常进行，系统将自动锁定该业务期所关联的流程及表单，业务期内将无法再对流程及表单进行编辑"))return;this.releaseBusinessDisabled=!0,this.annoreleaseBusinessText="发布中...",this._save("business",function(){Object(c.e)({url:"/api/app/"+e.appId+"/business/"+e.curBusiness.business.id+"/publish",type:"post",success:function(s){e.releaseBusinessDisabled=!1,e.annoreleaseBusinessText="",s.state?(s.data.publishing&&!s.data.published&&(e.$toast("业务期发布中，请耐心等待"),e.curBusiness.business.isPublishing=!0,e.curBusiness.publishAsync.code=s.data.publishCode,e.curBusiness.publishAsync.processing=!0,e._initCheckPublishResultSchedule(e.curBusiness)),s.data.published&&(e.curBusiness.business.isPublic=!0,e.$toast("业务期发布成功"),"3"==e.curBusiness.business.limitType&&(e.typeL=3))):("31120"===s.code&&(e.$toast("业务期发布中，请耐心等待"),e.curBusiness.publishAsync.code=s.data.publishCode,e.curBusiness.publishAsync.processing=!0,e._initCheckPublishResultSchedule(e.curBusiness)),"31114"===s.code?(e.releaseBusinessDisabled=!0,e.annoreleaseBusinessText="发布中...",confirm("应用未发布情况下无法发布业务期，确定同时发布应用吗？")?Object(c.e)({url:"/api/app/"+e.appId+"/business/"+e.curBusiness.business.id+"/publish?publishApp=true",type:"post",success:function(s){e.releaseBusinessDisabled=!1,e.annoreleaseBusinessText="",s.state?(e.curBusiness.business.isPublic=!0,e.curApp.isPublished=!e.curApp.isPublished,e.$toast("应用发布成功")):e.$toast(s.message)}}):(e.releaseBusinessDisabled=!1,e.annoreleaseBusinessText="")):e.$toast(s.message))}})})}else confirm("确定要停止此业务期吗？停止后，此业务期的所有数据将作废且不可恢复")&&this._stopOrRemove("stop")},_removeBusiness:function(s){confirm("确定删除该业务期？")&&this._stopOrRemove("remove",s)},_stopOrRemove:function(s,e){var t=this,i="stop"===s?this.curBusiness.business.id:this.businessList[e].business.id;i?Object(c.e)({url:"/api/app/"+this.appId+"/business/"+i+"/delete",type:"post",success:function(a){a.state?(t.$toast("操作成功"),"stop"===s?t.curBusiness.business.isEnable=!1:(t.businessList[e].publishAsync.timer&&clearInterval(t.businessList[e].publishAsync.timer),t.businessList.splice(e,1),t._testIconShow(),t.curBusiness.business.id===i&&(t.curBusiness=null,t.curBusinessIdx=-1))):t.$toast(a.message)}}):this.businessList.splice(e,1)},_addNewBusiness:function(){if(this.typeL="",this.curApp.setting.formId&&this.curApp.setting.flowId){var s,e,t=(new Date).getFullYear();(new Date).getMonth()>=8?(s=t+"-"+(t+1)+"学年"+this.curApp.name,e=t):(s=t-1+"-"+t+"学年"+this.curApp.name,e=t-1);var i=s;this.creatNewName(s,i),this.appState.infoType="base",this.curBusiness={business:{name:this.newName,year:e+"",linkUrl:"",guide:"",settingId:"",businessTimeList:[],limitType:null,beginTime:"",endTime:"",isEnable:!1,isLimit:!1,isPublic:!1,isPublishing:!1,publishCode:""},publishAsync:{processing:!1,code:"",timer:null,done:0,total:0},flowSetting:null,formSetting:null,businessLimit:{id:"",inSchool:0,grade:[],studentType:[],schoolStatus:[],educationLevel:[],url:"",updateType:"COVER",cron:""}},this.businessList.push(this.curBusiness),this.curBusinessIdx=this.businessList.length-1,this._scrollToBusiness(this.businessList.length-1),this._save("business",function(){})}else this.$toast("请先设置该应用的表单和流程哟~")},creatNewName:function(s,e){var t=!1;this.businessList.forEach(function(i){if(i.business.name===s){t=!0;var a=s.split(e);if(a[1]){var n=parseInt(a[1])+1;s=e+n}else s=e+1}}),t?this.creatNewName(s,e):this.newName=s},_editPart:function(s){this.showIconModal=!0,this.appState.editPart=s,this.$set(this.appState,s,this.curApp[s]),this.$set(this.appState,"imgPath",this.curApp.imgPath),this.curApp.background&&this.$set(this.appState,"background",this.curApp.background),this.$set(this.appState,"imgPath",this.curApp.imgPath),this.$set(this.appState,"imgType",this.curApp.imgType)},_cancelPart:function(s){this.showIconModal=!1,this.appState.editPart="",this.appState[s]="",this.appState.background=""},_savePart:function(s,e){this.curApp[s]=this.appState[s],this.appState.editPart="",this.appState[s]=""},_setAppForm:function(){this.curApp.setting.formId?this._initWithModel():(n.default.set(this.appState,"form",this.curApp.form),this.appState.showFormModal=!0)},_setAppFlow:function(){this.$emit("setFlow",{modelId:this.curApp.setting.flowId,businessId:""}),this._save("",function(){})},_selectIcon:function(s,e){this.appState.imgPath=s.name,this.appState.imgType=e||"1"},_selectBackground:function(s){this.appState.background=s.background},_initWithModel:function(){this.$emit("setForm",{modelId:this.appState.modelId,type:this.curApp.setting.formId?"edit":"create",businessId:""}),this._save("",function(){})},_scrollLeft:function(){r()("#businessDiv").animate({scrollLeft:r()("#businessDiv").scrollLeft()-500},100),this._testIconShow()},_scrollRight:function(){r()("#businessDiv").animate({scrollLeft:r()("#businessDiv").scrollLeft()+500},100),this._testIconShow()},_scrollToBusiness:function(s){var e=this;setTimeout(function(){r()("#businessDiv").animate({scrollLeft:r()("#businessDiv").scrollLeft()+200*s},100),e._testIconShow()},300)},_testIconShow:function(){var s=this;setTimeout(function(){s.leftIconShow=r()("#businessDiv").scrollLeft()>0,s.rightIconShow=r()(".business-scroll").width()-r()("#businessDiv").scrollLeft()>r()("#businessDiv").width()},300)},_compareTime:function(s,e){var t=new Date(s[e].start).getTime(),i=new Date(s[e].end).getTime();return this.nowTime<t?0===e?"left":this.nowTime>new Date(s[e-1].end).getTime()?"left":"":this.nowTime>t&&this.nowTime<i?"center":""},_changeLimitType:function(s){this.curBusiness.business.isPublic&&!this.isReviseBusiness||null!==this.curBusiness.business.limitType&&this.curBusiness.business.isPublic&&this.isReviseBusiness&&!confirm("若选择其他方式的面向人员名单设置，之前的操作将会被删除！")||(this.isShowMemberTable=!0,"1"===s&&(this.isShowMemberTable=!1),"3"!==s&&this.cacheBusinessInfo(s),this.curBusiness.business.limitType=s)},_afterSelectYear:function(s){this.curBusiness.business.year=s.val,this.isReviseData=!0},_afterSelectSchoolStatus:function(s){this.curBusiness.businessLimit||n.default.set(this.curBusiness,"businessLimit",{}),n.default.set(this.curBusiness.businessLimit,"schoolStatus",s.val)},_afterSelectEducationLevelStatus:function(s){this.curBusiness.businessLimit||n.default.set(this.curBusiness,"businessLimit",{}),n.default.set(this.curBusiness.businessLimit,"educationLevel",s.val)},_afterSelectStuType:function(s){this.curBusiness.businessLimit||n.default.set(this.curBusiness,"businessLimit",{}),n.default.set(this.curBusiness.businessLimit,"studentType",s.val)},_afterSelectGrade:function(s){this.curBusiness.businessLimit||n.default.set(this.curBusiness,"businessLimit",{}),n.default.set(this.curBusiness.businessLimit,"grade",s.val)},_afterSelectInSchool:function(s){this.curBusiness.businessLimit||n.default.set(this.curBusiness,"businessLimit",{}),n.default.set(this.curBusiness.businessLimit,"inSchool",s.val)},_nodeSelected:function(s){var e=this;if(!this.curBusiness.business.isPublic||this.isReviseBusiness){var t=window.event||s.event;for(var i in this.curTimeNode={},s.target)n.default.set(this.curTimeNode,i,s.target[i]);if(this.showTime=!0,this.isReviseData=!0,this.curTimeNode.datetime)var a=new Date(this.curTimeNode.datetime).format("yyyy-MM-dd HH:mm:ss");else a=(new Date).format("yyyy-MM-dd HH:mm:ss");setTimeout(function(){e.$date({dateFormat:"yyyy-MM-dd hh:ii:ss",value:a||"",type:"init",event:t,onSelect:function(s){e._daySelectedOfValue({value:s})}})},100)}},_daySelectedOfValue:function(s){var e=this,t=this.$refs.timeSet.setDatetime(this.curTimeNode.id,s.value);t.success?this.curTimeNode=null:this.errorMsg=t.message,this.curBusiness.business.businessTimeList=[],this.$refs.timeSet.export().forEach(function(s){e.curBusiness.business.businessTimeList.push({nodeId:s.id,endDate:e.timeFormat(s.datetime,"yyyy-MM-dd hh:ii:ss"),businessId:e.curBusiness.business.id,isLimit:!1})})},timeFormat:function(s,e){if(!s)return"";var t={"M+":s.getMonth()+1,"d+":s.getDate(),"h+":s.getHours(),"i+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};for(var i in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e},_loadBusinessTime:function(){var s=this;if(!this.curBusiness.business.businessTimeList||0===this.curBusiness.business.businessTimeList.length){if(this.curBusiness.business.businessTimeList=[],!this.appState.flowData.chart.nodes)return!1;this.appState.flowData.chart.nodes.forEach(function(e){"start"!==e.type&&"process"!==e.type||s.curBusiness.business.businessTimeList.push({nodeId:e.id,endDate:"",businessId:s.curBusiness.business.id,isLimit:!1})})}setTimeout(function(){s.$refs.timeSet&&s.$refs.timeSet.load(s._getDatetimeArr(s.curBusiness.business.businessTimeList))},500)},_getDatetimeArr:function(s){var e=[];return s.forEach(function(s){e.push({id:s.nodeId,datetime:s.endDate})}),e},changeBusinessLimit:function(){if(this.curBusiness&&this.curBusiness.businessLimit&&null!=this.curBusiness.businessLimit.schoolStatus&&!(this.curBusiness.businessLimit.schoolStatus instanceof Array))if(""==this.curBusiness.businessLimit.schoolStatus)this.curBusiness.businessLimit.schoolStatus=[];else if(""!==this.curBusiness.businessLimit.schoolStatus&&-1==this.curBusiness.businessLimit.schoolStatus.indexOf(",")){var s=[];s.push(this.curBusiness.businessLimit.schoolStatus),this.curBusiness.businessLimit.schoolStatus=s}else""!==this.curBusiness.businessLimit.schoolStatus&&this.curBusiness.businessLimit.schoolStatus.indexOf(",")>-1&&(this.curBusiness.businessLimit.schoolStatus=this.curBusiness.businessLimit.schoolStatus.split(","));if(this.curBusiness&&this.curBusiness.businessLimit&&null!=this.curBusiness.businessLimit.educationLevel&&!(this.curBusiness.businessLimit.educationLevel instanceof Array))if(""==this.curBusiness.businessLimit.educationLevel)this.curBusiness.businessLimit.educationLevel=[];else if(""!==this.curBusiness.businessLimit.educationLevel&&-1==this.curBusiness.businessLimit.educationLevel.indexOf(",")){var e=[];e.push(this.curBusiness.businessLimit.educationLevel),this.curBusiness.businessLimit.educationLevel=e}else""!==this.curBusiness.businessLimit.educationLevel&&this.curBusiness.businessLimit.educationLevel.indexOf(",")>-1&&(this.curBusiness.businessLimit.educationLevel=this.curBusiness.businessLimit.educationLevel.split(","));if(this.curBusiness&&this.curBusiness.businessLimit&&null!=this.curBusiness.businessLimit.studentType&&!(this.curBusiness.businessLimit.studentType instanceof Array))if(""==this.curBusiness.businessLimit.studentType)this.curBusiness.businessLimit.studentType=[];else if(""!==this.curBusiness.businessLimit.studentType&&-1==this.curBusiness.businessLimit.studentType.indexOf(",")){var t=[];t.push(this.curBusiness.businessLimit.studentType),this.curBusiness.businessLimit.studentType=t}else""!==this.curBusiness.businessLimit.studentType&&this.curBusiness.businessLimit.studentType.indexOf(",")>-1&&(this.curBusiness.businessLimit.studentType=this.curBusiness.businessLimit.studentType.split(","));if(this.curBusiness&&this.curBusiness.businessLimit&&null!=this.curBusiness.businessLimit.grade&&!(this.curBusiness.businessLimit.grade instanceof Array))if(""==this.curBusiness.businessLimit.grade)this.curBusiness.businessLimit.grade=[];else if(""!==this.curBusiness.businessLimit.grade&&-1==this.curBusiness.businessLimit.grade.indexOf(",")){var i=[];i.push(this.curBusiness.businessLimit.grade),this.curBusiness.businessLimit.grade=i}else""!==this.curBusiness.businessLimit.grade&&this.curBusiness.businessLimit.grade.indexOf(",")>-1&&(this.curBusiness.businessLimit.grade=this.curBusiness.businessLimit.grade.split(","))},_save:function(s,e){var t=this;if(this.changeBusinessLimit(),this.curBusiness&&this.curBusiness.business&&this.curBusiness.business.id&&null==this.curBusiness.business.limitType)return this.$toast("请设置面向人员选项"),void(this.releaseBusinessDisabled=!1);if(this.curBusiness&&this.curBusiness.business.id&&null!=this.curBusiness.business.limitType&&"1"==this.curBusiness.business.limitType&&!this.isShowMemberTable)return this.$toast("请搜索面向人员名单"),void(this.releaseBusinessDisabled=!1);if(this.curBusiness&&this.curBusiness.business.id&&null!=this.curBusiness.business.limitType&&"0"!=this.curBusiness.business.limitType&&"3"!=this.curBusiness.business.limitType&&"4"!=this.curBusiness.business.limitType&&0==this.$refs.memberList.tableState.totalRecords)return this.$toast("请上传面向人员名单"),void(this.releaseBusinessDisabled=!1);if(this.curBusiness&&this.curBusiness.business&&"3"==this.curBusiness.business.limitType&&(!new RegExp("(((^([0-9]|[0-5][0-9])(\\,|\\-|\\/){1}([0-9]|[0-5][0-9]) )|^([0-9]|[0-5][0-9]) |^(\\* ))((([0-9]|[0-5][0-9])(\\,|\\-|\\/){1}([0-9]|[0-5][0-9]) )|([0-9]|[0-5][0-9]) |(\\* ))((([0-9]|[01][0-9]|2[0-3])(\\,|\\-|\\/){1}([0-9]|[01][0-9]|2[0-3]) )|([0-9]|[01][0-9]|2[0-3]) |(\\* ))((([0-9]|[0-2][0-9]|3[01])(\\,|\\-|\\/){1}([0-9]|[0-2][0-9]|3[01]) )|(([0-9]|[0-2][0-9]|3[01]) )|(\\? )|(\\* )|(([1-9]|[0-2][0-9]|3[01])L )|([1-7]W )|(LW )|([1-7]\\#[1-4] ))((([1-9]|0[1-9]|1[0-2])(\\,|\\-|\\/){1}([1-9]|0[1-9]|1[0-2]) )|([1-9]|0[1-9]|1[0-2]) |(\\* ))(([1-7](\\,|\\-|\\/){1}[1-7])|([1-7])|(\\?)|(\\*)|(([1-7]L)|([1-7]\\#[1-4]))))|(((^([0-9]|[0-5][0-9])(\\,|\\-|\\/){1}([0-9]|[0-5][0-9]) )|^([0-9]|[0-5][0-9]) |^(\\* ))((([0-9]|[0-5][0-9])(\\,|\\-|\\/){1}([0-9]|[0-5][0-9]) )|([0-9]|[0-5][0-9]) |(\\* ))((([0-9]|[01][0-9]|2[0-3])(\\,|\\-|\\/){1}([0-9]|[01][0-9]|2[0-3]) )|([0-9]|[01][0-9]|2[0-3]) |(\\* ))((([0-9]|[0-2][0-9]|3[01])(\\,|\\-|\\/){1}([0-9]|[0-2][0-9]|3[01]) )|(([0-9]|[0-2][0-9]|3[01]) )|(\\? )|(\\* )|(([1-9]|[0-2][0-9]|3[01])L )|([1-7]W )|(LW )|([1-7]\\#[1-4] ))((([1-9]|0[1-9]|1[0-2])(\\,|\\-|\\/){1}([1-9]|0[1-9]|1[0-2]) )|([1-9]|0[1-9]|1[0-2]) |(\\* ))(([1-7](\\,|\\-|\\/){1}[1-7] )|([1-7] )|(\\? )|(\\* )|(([1-7]L )|([1-7]\\#[1-4]) ))((19[789][0-9]|20[0-9][0-9])\\-(19[789][0-9]|20[0-9][0-9])))").test(this.curBusiness.businessLimit.cron)||!this.curBusiness.businessLimit.url))return void this.$toast("请正确输入接口信息!");if("business"===s){var i=this.curBusiness.business.id?this.$refs.timeSet.exportBeginEndTime():{},a=this.curBusiness.business.id?"put":"post",n="/api/app/"+this.appId+"/business"+(this.curBusiness.business.id?"/"+this.curBusiness.business.id:"");this.curBusiness.business.beginTime=i.beginTime?this.timeFormat(i.beginTime,"yyyy-MM-dd hh:ii:ss"):"",this.curBusiness.business.endTime=i.endTime?this.timeFormat(i.endTime,"yyyy-MM-dd hh:ii:ss"):"","put"===a&&(n+="?formId="+this.curBusiness.formId+"&flowId="+this.curBusiness.flowId+"&key="+this.cacheKey),Object(c.d)(n,this.curBusiness,"post").then(function(s){if(s.state){if(s.data.business.id&&!t.curBusiness.business.id)for(var i in s.data)t.$set(t.curBusiness,i,s.data[i]);t.businessList[t.curBusinessIdx]=t.curBusiness,t.$set(t.businessList,t.curBusinessIdx,t.curBusiness),e?e():(t.$toast("业务期保存成功"),"3"==t.curBusiness.business.limitType&&(t.typeL=3))}else t.$toast(s.message)})}},backParentPage:function(){this.showImportModal=!1},exportUserInfo:function(s){if(1==s){var e=this.$refs.memberList.tableSearchFields.userNo||"",t=this.$refs.memberList.tableSearchFields.name||"",i=this.$refs.memberList.tableSearchFields.grade||"",a=this.$refs.memberList.tableSearchFields.college||"",n=this.$refs.memberList.tableSearchFields.educationLevel||"",o=this.$refs.memberList.tableSearchFields.schoolStatus||"";window.location.href="/downloads/app/"+this.appId+"/business/users/"+this.curBusiness.business.id+"/excel?fileName="+this.curBusiness.business.name+".xlsx&isCache="+this.isCache+"&key="+this.cacheKey+"&name="+t+"&grade="+i+"&college="+a+"&educationLevel="+n+"&schoolStatus="+o+"&userNo="+e}else window.location.href="/downloads/app/"+this.appId+"/business/"+this.curBusiness.business.id+"/excel?fileName="+this.curBusiness.business.name+".xlsx"},_changeOutputList:function(s){var e=this,t=this.outputList.indexOf(s.name);t>=0?(this.outputList.splice(t,1),"signature"!==s.componentType&&"image"!==s.componentType||this.exportFiledArr.forEach(function(t,i){t.name===s.name&&e.exportFiledArr.splice(i,1)})):(this.outputList.push(s.name),"signature"!==s.componentType&&"image"!==s.componentType||this.exportFiledArr.push({name:s.name,title:s.title}))},_showOutPutModal:function(){this.outputModalShow=!0},_getFormFields:function(s){var e=this;Object(c.e)({url:"/api/processEngine/business/"+s+"/formSetting/fields",type:"get",success:function(s){s.state?e.formFields=s.data:e.$toast(s.message)}})},_sureToOutput:function(){var s=this,e=[],t=[];(e=JSON.parse(a()(this.outputList))).forEach(function(s,t){(s.indexOf("image")>=0||s.indexOf("signature")>=0)&&e.splice(t,1)}),this.exportFiledArr.forEach(function(s){(s.name.indexOf("image")>=0||s.name.indexOf("signature")>=0)&&t.push(s)});var i=[];if(e.length>0){var n="";this.curApp&&this.curApp.appType&&(n="3"===this.curApp.appType.userType?"/downloads/processEngine/business/"+this.curBusiness.business.id+"/processInstances/excel?fileName="+this.curBusiness.business.name+".xlsx&userNo=&account="+(this.$refs.recordsTable.tableSearchFields.userNo||"")+"&name="+(this.$refs.recordsTable.tableSearchFields.name||"")+"&grade="+(this.$refs.recordsTable.tableSearchFields.grade||"")+"&status="+(this.$refs.recordsTable.tableSearchFields.status||"")+"&exportFields="+this.outputList:"/downloads/processEngine/business/"+this.curBusiness.business.id+"/processInstances/excel?fileName="+this.curBusiness.business.name+".xlsx&userNo="+(this.$refs.recordsTable.tableSearchFields.userNo||"")+"&account=&name="+(this.$refs.recordsTable.tableSearchFields.name||"")+"&grade="+(this.$refs.recordsTable.tableSearchFields.grade||"")+"&status="+(this.$refs.recordsTable.tableSearchFields.status||"")+"&exportFields="+this.outputList),i.push(n)}t.forEach(function(e){var t="";s.curApp&&s.curApp.appType&&(t="3"===s.curApp.appType.userType?"/downloads/processEngine/business/"+s.curBusiness.business.id+"/processInstances/images?fileName="+e.title+".zip&userNo=&account="+(s.$refs.recordsTable.tableSearchFields.userNo||"")+"&name="+(s.$refs.recordsTable.tableSearchFields.name||"")+"&grade="+(s.$refs.recordsTable.tableSearchFields.grade||"")+"&status="+(s.$refs.recordsTable.tableSearchFields.status||"")+"&imageComponentName="+e.name:"/downloads/processEngine/business/"+s.curBusiness.business.id+"/processInstances/images?fileName="+e.title+".zip&userNo="+(s.$refs.recordsTable.tableSearchFields.userNo||"")+"&account=&name="+(s.$refs.recordsTable.tableSearchFields.name||"")+"&grade="+(s.$refs.recordsTable.tableSearchFields.grade||"")+"&status="+(s.$refs.recordsTable.tableSearchFields.status||"")+"&imageComponentName="+e.name),i.push(t)}),i.forEach(function(e,t){s._createIFrame(e,100*t,1e3)})},_createIFrame:function(s,e,t){setTimeout(function(){var e=r()('<iframe style="display: none;" class="multi-download"></iframe>');e.attr("src",s),r()(document.body).after(e)},e)},_openReviseBusiness:function(){var s=this;confirm("您将对正在进行的业务期进行修改，请在技术人员协助下进行操作!")&&this.editLimitType(function(){s.canEditPublishedBusiness=!0})},editLimitType:function(s){var e=this;Object(c.e)({url:"/api/business/users/"+this.appId+"/business/"+this.curBusiness.business.id+"/init/cache",type:"post",success:function(t){t.state?(e.publishedCacheKey=t.data,"function"==typeof s&&s()):e.$toast(t.message)}})},_reviseBusinessData:function(s){this.isReviseBusiness&&(this.isReviseData&&confirm("是否保存修改的数据？不保存会丢失")&&this._reviseBusinessInfo(),"form"===s?this.$emit("setForm",{modelId:this.appState.modelId,type:this.curApp.setting.formId?"edit":"create",businessId:this.curBusiness.business.id}):this.$emit("setFlow",{modelId:this.curApp.setting.flowId,businessId:this.curBusiness.business.id}))},_changeBusinessName:function(){this.isReviseData=!0},_reviseBusinessInfo:function(){var s=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.changeBusinessLimit(),null!=this.curBusiness.business.limitType&&"0"!=this.curBusiness.business.limitType&&"3"!=this.curBusiness.business.limitType&&"4"!=this.curBusiness.business.limitType&&0==this.$refs.memberList.tableState.totalRecords)return this.$toast("请上传面向人员名单"),void(this.releaseBusinessDisabled=!1);if("public"!==e||confirm("本次修改仅会对本次业务期生效，不会影响业务本身，确定执行吗？")){var t={name:this.curBusiness.business.name,year:this.curBusiness.business.year,guide:this.curBusiness.business.guide,key:this.cacheKey,limitType:this.curBusiness.business.limitType,businessLimit:{id:this.curBusiness.businessLimit.id,inSchool:this.curBusiness.businessLimit.inSchool,grade:this.curBusiness.businessLimit.grade,studentType:this.curBusiness.businessLimit.studentType,schoolStatus:this.curBusiness.businessLimit.schoolStatus,educationLevel:this.curBusiness.businessLimit.educationLevel,url:this.curBusiness.businessLimit.url,updateType:this.curBusiness.businessLimit.updateType,cron:this.curBusiness.businessLimit.busincron},businessTimeList:[]},i=this.curBusiness.business.id?this.$refs.timeSet.exportBeginEndTime():{};this.curBusiness.business.beginTime=i.beginTime?this.timeFormat(i.beginTime,"yyyy-MM-dd hh:ii:ss"):"",this.curBusiness.business.endTime=i.endTime?this.timeFormat(i.endTime,"yyyy-MM-dd hh:ii:ss"):"",this.curBusiness.business.businessTimeList.forEach(function(s){t.businessTimeList.push({nodeId:s.nodeId,startDate:null,endDate:s.endDate})});var a="/api/app/"+this.appId+"/publishBusiness/"+this.curBusiness.business.id;Object(c.d)(a,t,"post").then(function(e){s.isReviseData=!1,e.state?(s.$toast("业务期保存成功"),s.businessList[s.curBusinessIdx]=s.curBusiness,"3"==s.curBusiness.business.limitType&&(s.typeL=3),s.canEditPublishedBusiness=!1):s.$toast(e.message)})}},_export:function(){window.location.href="/downloads/app/"+this.appId+"/export"},_setTable:function(){this.showTableModal=!0,this.$refs.tableset.onShow()},_setInform:function(){var s=this;this.appState.flowName?(Object(c.e)({url:"/api/wechat/message/template/list",type:"get",async:!1,success:function(e){e.state?s.showStatusList=e.data:s.$toast(e.message)}}).always(function(){}),this.showInformModal=!0):this.$toast("请先设置表单和流程")}},destroyed:function(){this.businessList.forEach(function(s){s.publishAsync&&s.publishAsync.timer&&clearInterval(s.publishAsync.timer)})},components:{tableset:u.a}}),d={render:function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("GeminiScrollbar",{attrs:{scrollX:!1,id:"appInfo"}},[t("div",{staticClass:"header"},[t("i",{staticClass:"maticon pull-left back-link",domProps:{innerHTML:s._s(s.icons("arrow_back"))},on:{click:s._back}},[s._v("arrow_back")]),s._v(" "),t("a",{staticClass:"pull-right app-release",attrs:{href:"javascript:;"},on:{click:s._releaseApp}},[s.curApp.isPublished?t("span",[s._v("下架")]):t("span",[s._v("发布")])]),s._v(" "),t("div",{staticClass:"pull-right release-app",on:{click:s._export}},[s._v("导出")]),s._v(" "),t("div",{staticClass:"pull-right release-app",on:{click:s._setTable}},[s._v("报表设置")]),s._v(" "),t("div",{staticClass:"pull-right release-app",on:{click:s._setInform}},[s._v("节点通知设置")]),s._v(" "),t("div",{staticClass:"title-div"},[t("div",{staticClass:"app-icon-div"},[t("i",{staticClass:"maticon edit-icon",domProps:{innerHTML:s._s(s.icons("edit"))},on:{click:function(e){return s._editPart("icon")}}},[s._v("edit")]),s._v(" "),t("div",{style:{"background-image":s.curApp.background}},[s.curApp.imgType&&"1"!==s.curApp.imgType?"2"===s.curApp.imgType?t("i",{staticClass:"app-icon"},[t("span",{staticClass:"saasicon-44px",class:["saasicon-44px-"+s.curApp.imgPath]})]):s._e():t("i",{staticClass:"maticon app-icon",domProps:{innerHTML:s._s(s.icons(s.curApp.imgPath))}},[s._v(s._s(s.curApp.imgPath))])])]),s._v(" "),t("div",{staticClass:"input-group app-name-div info-value",style:{width:s.inputStyleWidth+"px"}},[t("input",{directives:[{name:"model",rawName:"v-model",value:s.curApp.name,expression:"curApp.name"}],staticClass:"form-control",attrs:{type:"text",placeholder:"设置应用名称(25字以内)"},domProps:{value:s.curApp.name},on:{input:[function(e){e.target.composing||s.$set(s.curApp,"name",e.target.value)},s._limitLength],change:s._saveAppName}}),s._v(" "),t("div",[t("a",{staticClass:"apartment-link",attrs:{href:"javascript:;"}},[s._v(s._s(s.curApp.department&&s.curApp.department.name))])])]),s._v(" "),s.nameChangeMsg?t("p",{staticClass:"save-tip text-center",class:s.nameChangeMsg.indexOf("出错啦")>=0?"error":""},[s._v(s._s(s.nameChangeMsg))]):s._e(),s._v(" "),t("div",{staticClass:"form-flow-set"},[t("span",{staticClass:"info-set",on:{click:s._setAppForm}},[s._v("表单："+s._s(s.appState.formName||"请设置"))]),s._v(" "),s.appState.formName?t("span",{staticClass:"info-connect"}):s._e(),s._v(" "),s.appState.formName?t("span",{staticClass:"info-set",on:{click:s._setAppFlow}},[s._v("流程："+s._s(s.appState.flowName||"请设置"))]):s._e()]),s._v(" "),t("div",{staticClass:"app-desc info-value"},[t("span",{staticClass:"count-limit"},[s._v(s._s(s.curApp.remark?s.curApp.remark.length:0)+"/200")]),s._v(" "),t("textarea",{directives:[{name:"model",rawName:"v-model",value:s.curApp.remark,expression:"curApp.remark"}],staticClass:"desc-part",attrs:{id:"textarea",rows:s.rowsNumber,maxlength:"200",placeholder:"可以输入对该应用的简单说明，仅管理员可看到此说明"},domProps:{value:s.curApp.remark},on:{change:s._saveAppDesc,input:function(e){e.target.composing||s.$set(s.curApp,"remark",e.target.value)}}})]),s._v(" "),s.descChangeMsg?t("p",{staticClass:"save-tip text-center",class:s.descChangeMsg.indexOf("出错啦")>=0?"error":""},[s._v(s._s(s.descChangeMsg))]):s._e(),s._v(" "),t("div",[t("p",[t("strong",[s._v("应用直接访问地址：")]),s._v(" "),t("span",{staticStyle:{"user-select":"text"}},[s._v(s._s("http://"+s.host+"/"+s.$account.schoolId+"/app/"+s.curApp.id))])])])])]),s._v(" "),t("div",{staticClass:"middle"},[t("label",{staticClass:"head-label pull-left"},[s._v("业务期")]),s._v(" "),t("a",{staticClass:"add-new pull-right",attrs:{href:"javascript:;"},on:{click:s._addNewBusiness}},[s._v("新增")]),s._v(" "),s.leftIconShow?t("i",{staticClass:"maticon scroll-left",domProps:{innerHTML:s._s(s.icons("chevron_left"))},on:{click:s._scrollLeft}},[s._v("chevron_left")]):s._e(),s._v(" "),s.rightIconShow?t("i",{staticClass:"maticon scroll-right",domProps:{innerHTML:s._s(s.icons("chevron_right"))},on:{click:s._scrollRight}},[s._v("chevron_right")]):s._e(),s._v(" "),t("GeminiScrollbar",{staticClass:"business-div",attrs:{scrollY:!1,id:"businessDiv"}},[t("div",{staticClass:"business-scroll"},s._l(s.businessList,function(e,i){return t("div",{key:i,staticStyle:{display:"inline-block",position:"relative"}},[t("div",{staticClass:"mark-div",class:s._compareTime(s.businessList,i)},[t("span")]),s._v(" "),t("div",{staticClass:"business-tab",class:s.curBusiness&&e.business.name===s.curBusiness.business.name?"active":"",attrs:{title:e.business.name},on:{click:function(t){return s._changeBusiness(e,e.business.limitType,i)}}},[s._v("\n            "+s._s(e.business.name)+" "),e.business.isPublic?s._e():t("i",{staticClass:"maticon remove-icon",domProps:{innerHTML:s._s(s.icons("cancel"))},on:{click:function(e){return e.stopPropagation(),s._removeBusiness(i)}}},[s._v("cancel")])])])}),0)]),s._v(" "),s.curBusiness?t("div",{staticClass:"info-type-tabs"},s._l(s.appState.infoTypes,function(e,i){return s.curBusiness&&s.curBusiness.business.id||"base"===e.id?t("div",{key:i,staticClass:"info-tab text-center",class:e.id===s.appState.infoType?"active":"",on:{click:function(t){return s._tabClick(e)}}},[s._v("\n        "+s._s(e.name)+"\n      ")]):s._e()}),0):s._e()],1),s._v(" "),s.curBusiness?t("div",{staticClass:"bottom"},[t("span",[t("a",{staticClass:"release-business",attrs:{href:"javascript:;"}},[s.curBusiness.business.isPublic||s.curBusiness.business.isPublishing?s.curBusiness.business.isPublishing?t("span",{staticClass:"disabled"},[s._v("\n          发布中..."+s._s(s.curBusiness.publishAsync.total?(s.curBusiness.publishAsync.done/s.curBusiness.publishAsync.total*100).toFixed(2):"...")+"% ("+s._s(s.curBusiness.publishAsync.done)+"/"+s._s(s.curBusiness.publishAsync.total)+")\n        ")]):s.curBusiness.business.isEnable&&!s.isReviseBusiness?t("span",{on:{click:function(e){return s._releaseBusiness("stop")}}},[s._v("停用本业务期")]):s.curBusiness.business.isEnable?s._e():t("span",{staticClass:"disabled"},[s._v("本业务期已停用")]):t("span",{on:{click:function(e){return s._releaseBusiness("release")}}},[s._v("发布本业务期")])])]),s._v(" "),s.curBusiness.business.isPublic?s.curBusiness.business.isEnable&&!s.isReviseBusiness?t("span",{staticClass:"save-business",on:{click:s._openReviseBusiness}},[s._v("编辑本业务期")]):s.isReviseBusiness?t("span",{staticClass:"save-business revise ml0",on:{click:function(e){return s._reviseBusinessInfo("public")}}},[s._v("保存本业务期配置")]):s._e():t("span",{staticClass:"save-business",class:s.isReviseBusiness?"revise":"",on:{click:function(e){return s._save("business")}}},[s._v("保存本业务期配置")]),s._v(" "),t("span",{staticClass:"error-tip",class:s.errorMsg?"active":""},[s._v(s._s(s.errorMsg))]),s._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:"base"===s.appState.infoType,expression:"appState.infoType === 'base'"}],staticClass:"info-body container-fluid"},[t("div",{staticClass:"col-sm-6 padding-right"},[t("div",{staticClass:"form-group base-item"},[t("label",[s._v("名称")]),s._v(" "),!s.curBusiness.business.isPublic||s.isReviseBusiness?t("input",{directives:[{name:"model",rawName:"v-model",value:s.curBusiness.business.name,expression:"curBusiness.business.name"}],staticClass:"form-control valid",attrs:{type:"text",placeholder:"请输入业务起名称(30字以内)",maxlength:"30"},domProps:{value:s.curBusiness.business.name},on:{change:s._changeBusinessName,input:function(e){e.target.composing||s.$set(s.curBusiness.business,"name",e.target.value)}}}):t("input",{staticClass:"form-control",attrs:{type:"text",readonly:""},domProps:{value:s.curBusiness.business.name}})])]),s._v(" "),t("div",{staticClass:"col-sm-6 padding-left"},[t("div",{staticClass:"form-group base-item"},[t("label",[s._v("学年")]),s._v(" "),t("v-select",{staticClass:"info-value btn-block",attrs:{options:s.appState.gradeOptions,value:s.curBusiness.business.year||(new Date).getFullYear()+"_0","options-value":"id","options-label":"label","close-on-select":"",disabled:!(!s.curBusiness.business.isPublic||s.isReviseBusiness)},on:{afterSelected:s._afterSelectYear}})],1)]),s._v(" "),t("div",{staticClass:"col-sm-6 padding-right"},[t("div",{staticClass:"form-group base-item",class:s.isReviseBusiness?"active":"",on:{click:function(e){return s._reviseBusinessData("form")}}},[t("label",{class:s.isReviseBusiness?"active":""},[s._v("表单(来自应用同步)")]),s._v(" "),t("input",{staticClass:"form-control",class:s.isReviseBusiness?"active":"",attrs:{readonly:""},domProps:{value:s.appState.formName||"未绑定表单"}})])]),s._v(" "),t("div",{staticClass:"col-sm-6 padding-left"},[t("div",{staticClass:"form-group base-item",class:s.isReviseBusiness?"active":"",on:{click:function(e){return s._reviseBusinessData("flow")}}},[t("label",{class:s.isReviseBusiness?"active":""},[s._v("流程(来自应用同步)")]),s._v(" "),t("input",{staticClass:"form-control",class:s.isReviseBusiness?"active":"",attrs:{readonly:""},domProps:{value:s.appState.flowName||"未绑定流程"}})])])]),s._v(" "),s.curBusiness.business.id?t("div",{directives:[{name:"show",rawName:"v-show",value:"faceTo"===s.appState.infoType,expression:"appState.infoType === 'faceTo'"}],staticClass:"info-body container-fluid outer-container",attrs:{id:"faceMember"}},[!s.showImportModal&&s.faceToPeopleType.indexOf(s.curApp&&s.curApp.appType&&s.curApp.appType.userType)<0?t("div",{staticClass:"limit-radios"},[t("div",{staticClass:"radio-item small-item",class:"0"===s.curBusiness.business.limitType?"active":""},[t("span",{staticClass:"check",class:s.curBusiness.business.isPublic&&!s.isReviseBusiness?"disable":"",on:{click:function(e){return s._changeLimitType("0")}}},["0"!==s.curBusiness.business.limitType?t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_unchecked"))}},[s._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_checked"))}},[s._v("radio_button_checked")])]),s._v(" "),t("label",{staticClass:"check-label"},[s._v("无限制")])]),s._v(" "),t("div",{staticClass:"radio-item large-item",class:"1"===s.curBusiness.business.limitType?"active":""},[t("div",{staticClass:"large-check-part"},[t("span",{staticClass:"check",class:s.curBusiness.business.isPublic&&!s.isReviseBusiness?"disable":"",on:{click:function(e){return s._changeLimitType("1")}}},["1"!==s.curBusiness.business.limitType?t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_unchecked"))}},[s._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_checked"))}},[s._v("radio_button_checked")])]),s._v(" "),t("label",{staticClass:"check-label"},[s._v("按条件筛选")])]),s._v(" "),t("div",{staticClass:"large-select-part"},[t("div",{staticClass:"select-group"},[t("label",[s._v("学生类型")]),s._v(" "),t("v-select",{staticClass:"info-value btn-block",attrs:{url:"/api/system/dictTypes/1004/dicts",multiple:!0,value:s.curBusiness.businessLimit?s.curBusiness.businessLimit.studentType:"","options-value":"value","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==s.curBusiness.business.limitType||s.curBusiness.business.isPublic&&!s.isReviseBusiness},on:{afterSelected:s._afterSelectStuType}})],1)]),s._v(" "),t("div",{staticClass:"large-select-part"},[t("div",{staticClass:"select-group"},[t("label",[s._v("学生年级")]),s._v(" "),t("v-select",{staticClass:"info-value btn-block",attrs:{options:s.appState.gradeOptions2,multiple:!0,value:s.curBusiness.businessLimit?s.curBusiness.businessLimit.grade:"","options-value":"id","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==s.curBusiness.business.limitType||s.curBusiness.business.isPublic&&!s.isReviseBusiness},on:{afterSelected:s._afterSelectGrade}})],1)]),s._v(" "),t("div",{staticClass:"large-select-part"},[t("div",{staticClass:"select-group"},[t("label",[s._v("在校状态")]),s._v(" "),t("v-select",{staticClass:"info-value btn-block",attrs:{options:s.appState.inSchoolOptions,value:s.curBusiness.businessLimit?s.curBusiness.businessLimit.inSchool:"","options-value":"id","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==s.curBusiness.business.limitType||s.curBusiness.business.isPublic&&!s.isReviseBusiness},on:{afterSelected:s._afterSelectInSchool}})],1)]),s._v(" "),t("div",{staticClass:"large-select-part"},[t("div",{staticClass:"select-group"},[t("label",[s._v("当前状态")]),s._v(" "),t("v-select",{staticClass:"info-value btn-block",attrs:{options:s.schoolStatus,multiple:!0,value:s.curBusiness.businessLimit?s.curBusiness.businessLimit.schoolStatus:"","options-value":"value","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==s.curBusiness.business.limitType||s.curBusiness.business.isPublic&&!s.isReviseBusiness},on:{afterSelected:s._afterSelectSchoolStatus}})],1)]),s._v(" "),t("div",{staticClass:"large-select-part"},[t("div",{staticClass:"select-group"},[t("label",[s._v("培养层次")]),s._v(" "),t("v-select",{staticClass:"info-value btn-block",attrs:{options:s.educationLevel,multiple:!0,value:s.curBusiness.businessLimit?s.curBusiness.businessLimit.educationLevel:"","options-value":"value","options-label":"label","close-on-select":"",justified:"",disabled:"1"!==s.curBusiness.business.limitType||s.curBusiness.business.isPublic&&!s.isReviseBusiness},on:{afterSelected:s._afterSelectEducationLevelStatus}})],1)]),s._v(" "),t("div",{staticClass:"large-select-part"},[t("div",{staticClass:"select-group",staticStyle:{"margin-right":"0"}},[t("button",{staticClass:"btn batch-add-btn btn-bgColor-style mt10 clearBtnBorder",attrs:{type:"button",disabled:"1"!==s.curBusiness.business.limitType||s.curBusiness.business.isPublic&&!s.isReviseBusiness},on:{click:s.searchByCondition}},[s._v("搜索")])])])]),s._v(" "),t("div",{staticClass:"radio-item small-item",class:"2"===s.curBusiness.business.limitType?"active":""},[t("span",{staticClass:"check",class:s.curBusiness.business.isPublic&&!s.isReviseBusiness?"disable":"",on:{click:function(e){return s._changeLimitType("2")}}},["2"!==s.curBusiness.business.limitType?t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_unchecked"))}},[s._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_checked"))}},[s._v("radio_button_checked")])]),s._v(" "),t("label",{staticClass:"check-label"},[s._v("上传名单")]),s._v(" "),"2"===s.curBusiness.business.limitType?t("div",{staticClass:"pull-right opt-div"}):s._e()]),s._v(" "),t("div",{staticClass:"radio-item large-item",class:"3"===s.curBusiness.business.limitType?"active":"",staticStyle:{height:"198px"}},[t("div",{staticClass:"large-check-part"},[t("span",{staticClass:"check",class:s.curBusiness.business.isPublic&&!s.isReviseBusiness?"disable":"",on:{click:function(e){return s._changeLimitType("3")}}},["3"!==s.curBusiness.business.limitType?t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_unchecked"))}},[s._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_checked"))}},[s._v("radio_button_checked")])]),s._v(" "),t("label",{staticClass:"check-label"},[s._v("接口对接")])]),s._v(" "),t("div",{staticClass:"large-select-part"},[t("div",{staticClass:"select-group",staticStyle:{width:"550px",padding:"20px 20px 5px 20px"}},[t("label",{staticStyle:{color:"#000"}},[s._v("接口地址：")]),s._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:s.curBusiness.businessLimit.url,expression:"curBusiness.businessLimit.url"}],staticClass:"form-control",staticStyle:{display:"inline-block",width:"400px"},attrs:{type:"text",disabled:"3"!==s.curBusiness.business.limitType,placeholder:"请提供接口地址",name:"",id:""},domProps:{value:s.curBusiness.businessLimit.url},on:{input:function(e){e.target.composing||s.$set(s.curBusiness.businessLimit,"url",e.target.value)}}})]),s._v(" "),t("div",{staticClass:"select-group",staticStyle:{width:"550px",padding:"5px 20px"}},[t("label",{staticStyle:{color:"#000"}},[s._v("更新频率：")]),s._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:s.curBusiness.businessLimit.cron,expression:"curBusiness.businessLimit.cron"}],staticClass:"form-control",staticStyle:{display:"inline-block",width:"400px"},attrs:{type:"text",disabled:"3"!==s.curBusiness.business.limitType,placeholder:"CRON表达式",name:"",id:""},domProps:{value:s.curBusiness.businessLimit.cron},on:{input:function(e){e.target.composing||s.$set(s.curBusiness.businessLimit,"cron",e.target.value)}}})]),s._v(" "),t("div",{staticClass:"select-group",staticStyle:{width:"550px",padding:"5px 20px"}},[t("label",{staticStyle:{color:"#000"}},[s._v("更新方式：")]),s._v(" "),t("p",{staticStyle:{display:"inline-block","vertical-align":"bottom",margin:"0","margin-top":"5px"}},[t("span",{staticClass:"check",on:{click:function(e){s.curBusiness.businessLimit.updateType="COVER"}}},["COVER"!==s.curBusiness.businessLimit.updateType||""===s.curBusiness.businessLimit.updateType?t("i",{staticClass:"maticon",staticStyle:{"line-height":"15px"},attrs:{disabled:"3"!==s.curBusiness.business.limitType},domProps:{innerHTML:s._s(s.icons("radio_button_unchecked"))}},[s._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",staticStyle:{"line-height":"15px"},attrs:{disabled:"3"!==s.curBusiness.business.limitType},domProps:{innerHTML:s._s(s.icons("radio_button_checked"))}},[s._v("radio_button_checked")])]),s._v(" "),t("label",{staticClass:"check-label",attrs:{disabled:"3"===s.curBusiness.business.limitType}},[s._v("增量")])]),s._v(" "),t("p",{staticStyle:{display:"inline-block","vertical-align":"bottom",margin:"0","margin-top":"5px"}},[t("span",{staticClass:"check",on:{click:function(e){s.curBusiness.businessLimit.updateType="INCREMENT"}}},["INCREMENT"!==s.curBusiness.businessLimit.updateType||""===s.curBusiness.businessLimit.updateType?t("i",{staticClass:"maticon",staticStyle:{"line-height":"15px"},domProps:{innerHTML:s._s(s.icons("radio_button_unchecked"))}},[s._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",staticStyle:{"line-height":"15px"},domProps:{innerHTML:s._s(s.icons("radio_button_checked"))}},[s._v("radio_button_checked")])]),s._v(" "),t("label",{staticClass:"check-label"},[s._v("覆盖")])])]),s._v(" "),"3"==s.typeL?t("div",{staticClass:"select-group",staticStyle:{width:"550px",padding:"10px 20px","text-align":"center"}},[t("button",{staticClass:"btn btn-default ",attrs:{disabled:"3"!==s.curBusiness.business.limitType},on:{click:function(e){return s.updateHand()}}},[s._v("手动更新")])]):s._e()])]),s._v(" "),t("div",{staticClass:"radio-item small-item",class:"4"===s.curBusiness.business.limitType?"active":""},[t("span",{staticClass:"check",class:s.curBusiness.business.isPublic&&!s.isReviseBusiness?"disable":"",on:{click:function(e){return s._changeLimitType("4")}}},["4"!==s.curBusiness.business.limitType?t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_unchecked"))}},[s._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_checked"))}},[s._v("radio_button_checked")])]),s._v(" "),t("label",{staticClass:"check-label"},[s._v("高级筛选")]),s._v(" "),"4"===s.curBusiness.business.limitType?t("div",{staticClass:"pull-right opt-div"},[t("a",{staticClass:"opt-btn",attrs:{href:"javascript:;"},on:{click:function(e){return s.addAdvanceSearch()}}},[t("span",[s._v("新增")])])]):s._e()]),s._v(" "),"4"===s.curBusiness.business.limitType?t("div",{staticClass:"stus-list"},[t("v-table",{attrs:{url:s.advanceSearchUrl,paginationShow:!1,idField:"id",columns:s.advanceColumns,order:!0}})],1):s._e(),s._v(" "),null!==s.curBusiness.business.limitType&&"3"!==s.curBusiness.business.limitType&&"4"!==s.curBusiness.business.limitType&&s.isShowMemberTable?t("div",{staticClass:"stus-list"},[s.curBusiness.business.id?t("v-table",{ref:"memberList",attrs:{title:"人员名单管理",url:s.allPeopleUrl,pagesize:"8",idField:"id",multiple:s.isCache,order:!0,search:!1,columns:s.appState.columns},on:{afterChecked:s._afterChecked}},[t("div",{staticClass:"btn-group pull-left",staticStyle:{"margin-left":"10px","margin-top":"5px",color:"#999"},attrs:{slot:"btn-group"},slot:"btn-group"},[t("i",{staticClass:"el-icon-info"}),s._v("接口对接、高级筛选不支持人员名单管理\n            ")]),s._v(" "),t("div",{staticClass:"btn-group pull-right",attrs:{slot:"btn-group",role:"group"},slot:"btn-group"},[s.isCache&&s.checkedNum>0?t("button",{staticClass:"btn batch-add-btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:s.batchDelete}},[s._v("批量删除")]):s._e(),s._v(" "),s.isCache?t("button",{staticClass:"btn batch-add-btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:function(e){s.showAddModal=!0}}},[s._v("新增")]):s._e(),s._v(" "),t("button",{staticClass:"btn batch-add-btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:function(e){return s.exportUserInfo(1)}}},[s._v("导出")])])]):t("span",{staticClass:"table-tip"},[s._v("暂无数据")])],1):s._e(),s._v(" "),"3"==s.typeL?t("div",{staticClass:"stus-list"},[s.curBusiness.business.id?t("v-table",{attrs:{url:s.peopleUrlJiekou,pagesize:"8",idField:"id",columns:s.JiekouColumns,order:!0}}):t("span",{staticClass:"table-tip"},[s._v("暂无数据")])],1):s._e()]):s.showImportModal?s._e():t("div",{staticClass:"limit-radios"},[t("div",{staticClass:"radio-item small-item",class:"0"===s.curBusiness.business.limitType?"active":""},[t("span",{staticClass:"check",class:s.curBusiness.business.isPublic&&!s.isReviseBusiness?"disable":"",on:{click:function(e){return s._changeLimitType("0")}}},["0"!==s.curBusiness.business.limitType?t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_unchecked"))}},[s._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_checked"))}},[s._v("radio_button_checked")])]),s._v(" "),s.curApp&&s.curApp.appType&&"3"===s.curApp.appType.userType?t("label",{staticClass:"check-label"},[s._v("所有新生")]):s.curApp&&s.curApp.appType&&"2"===s.curApp.appType.userType?t("label",{staticClass:"check-label"},[s._v("所有教职工")]):t("label",{staticClass:"check-label"},[s._v("所有辅导员")])]),s._v(" "),t("div",{staticClass:"radio-item small-item",class:"2"===s.curBusiness.business.limitType?"active":""},[t("span",{staticClass:"check",class:s.curBusiness.business.isPublic&&!s.isReviseBusiness?"disable":"",on:{click:function(e){return s._changeLimitType("2")}}},["2"!==s.curBusiness.business.limitType?t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_unchecked"))}},[s._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_checked"))}},[s._v("radio_button_checked")])]),s._v(" "),t("label",{staticClass:"check-label"},[s._v("上传名单")]),s._v(" "),"2"===s.curBusiness.business.limitType?t("div",{staticClass:"pull-right opt-div"}):s._e()]),s._v(" "),null!==s.curBusiness.business.limitType&&"3"!==s.curBusiness.business.limitType&&s.isShowMemberTable?t("div",{staticClass:"stus-list"},[s.curBusiness.business.id?t("v-table",{ref:"memberList",attrs:{title:"人员名单管理",url:s.allPeopleUrl,pagesize:"8",idField:"id",multiple:s.isCache,order:!0,search:!1,columns:s.appState.columns},on:{afterChecked:s._afterChecked}},[t("div",{staticClass:"btn-group pull-right",attrs:{slot:"btn-group",role:"group"},slot:"btn-group"},[s.isCache&&s.checkedNum>0?t("button",{staticClass:"btn batch-add-btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:s.batchDelete}},[s._v("批量删除")]):s._e(),s._v(" "),s.isCache?t("button",{staticClass:"btn batch-add-btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:function(e){s.showAddModal=!0}}},[s._v("新增")]):s._e(),s._v(" "),t("button",{staticClass:"btn batch-add-btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:function(e){return s.exportUserInfo(1)}}},[s._v("导出")])])]):t("span",{staticClass:"table-tip"},[s._v("暂无数据")])],1):s._e()]),s._v(" "),t("v-modal",{staticStyle:{position:"absolute",top:"100px"},attrs:{show:s.showAddModal,effect:"fade",width:"420"}},[t("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[s._v("\n            新增\n          ")])]),s._v(" "),t("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[t("button",{staticClass:"btn submit-btn clearBtnBorder",staticStyle:{width:"380px","text-align":"center","margin-left":"20px"},attrs:{type:"button"},on:{click:s.addPersonByOne}},[s._v("单条新增")]),s._v(" "),t("button",{staticClass:"btn submit-btn clearBtnBorder",staticStyle:{width:"380px","text-align":"center","margin-top":"20px","margin-left":"20px"},attrs:{type:"button"},on:{click:s.showImportPageTwo}},[s._v("批量新增")])]),s._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){s.showAddModal=!1}}},[s._v("取消")])])]),s._v(" "),t("v-modal",{staticStyle:{position:"absolute",top:"100px"},attrs:{show:s.showAddOnePersonModal,effect:"fade",width:"400"}},[t("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[s._v("\n            新增\n          ")])]),s._v(" "),t("div",{staticClass:"modal-body container-fluid",staticStyle:{overflow:"inherit"},attrs:{slot:"modal-body"},slot:"modal-body"},[t("div",{staticClass:"form-group",staticStyle:{display:"flex"}},[t("label",[s._v("添加用户")]),s._v(" "),t("detect",{attrs:{url:"/api/users/check/searchResults",placeholder:s.请输入学号或者姓名},on:{afterSelected:s.afterSelectAddPerson}})],1)]),s._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){s.showAddOnePersonModal=!1}}},[s._v("取消")]),s._v(" "),t("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:s.addOnePerson}},[s._v("确定")])])]),s._v(" "),s.showImportModal?t("div",{staticClass:"import-modal"},[t("v-import",s._b({on:{backParentPage:s.backParentPage}},"v-import",s.importParams,!1))],1):s._e()],1):s._e(),s._v(" "),s.curBusiness.business.id?t("div",{directives:[{name:"show",rawName:"v-show",value:"timeSet"===s.appState.infoType,expression:"appState.infoType === 'timeSet'"}],staticClass:"info-body"},[t("time-set",{ref:"timeSet",attrs:{data:s.initDataOfChart,height:"300px"},on:{nodeSelected:s._nodeSelected}})],1):s._e(),s._v(" "),s.curBusiness.business.id&&"description"===s.appState.infoType?t("div",{staticClass:"info-body container-fluid"},[!s.curBusiness.business.isPublic||s.isReviseBusiness?t("u-editor",{ref:"description",attrs:{config:s.editorConfig},model:{value:s.curBusiness.business.guide,callback:function(e){s.$set(s.curBusiness.business,"guide",e)},expression:"curBusiness.business.guide"}}):t("div",{domProps:{innerHTML:s._s(s.curBusiness.business.guide)}})],1):s._e(),s._v(" "),s.curBusiness.business.id?t("div",{directives:[{name:"show",rawName:"v-show",value:"records"===s.appState.infoType,expression:"appState.infoType === 'records'"}],staticClass:"info-body"},[t("div",{staticClass:"stus-list"},[t("v-table",{ref:"recordsTable",attrs:{pagesize:"5",idField:"id",url:"/table-data/processEngine/business/"+s.curBusiness.business.id+"/processInstances/pages",columns:s.appState.recordColumns,order:!0,search:!0}},[t("div",{staticClass:"btn-group pull-right",attrs:{slot:"btn-group"},slot:"btn-group"},[t("button",{staticClass:"btn output-btn",attrs:{type:"button"},on:{click:s._showOutPutModal}},[s._v("导出")])])])],1)]):s._e()]):s._e(),s._v(" "),t("v-modal",{attrs:{show:s.outputModalShow,effect:"fade",width:"450"}},[t("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[s._v("\n        导出——字段选择\n      ")])]),s._v(" "),t("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[t("ul",{staticClass:"list-group"},s._l(s.formFields,function(e,i){return s.notAllowOutput.indexOf(e.componentType)<0?t("li",{staticClass:"list-group-item field-item",class:s.outputList.indexOf(e.name)<0?"":"output-active",on:{click:function(t){return s._changeOutputList(e)}}},[s.outputList.indexOf(e.name)<0?t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_unchecked"))}},[s._v("radio_button_unchecked")]):t("i",{staticClass:"maticon",domProps:{innerHTML:s._s(s.icons("radio_button_checked"))}},[s._v("radio_button_checked")]),s._v(" "),t("span",[s._v(s._s(e.title))])]):s._e()}),0)]),s._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){s.outputModalShow=!1}}},[s._v("取消")]),s._v(" "),t("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:s._sureToOutput}},[s._v("确定")])])]),s._v(" "),s.readonly?s._e():t("v-modal",{attrs:{show:s.appState.showFormModal,effect:"fade",width:"374"}},[t("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[s._v("\n        选择模板\n      ")])]),s._v(" "),t("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[t("label",[s._v("请选择对应模板初始化表单")]),s._v(" "),t("ul",{staticClass:"list-group"},[t("li",{staticClass:"list-group-item",class:"000000000000000000000000"===s.appState.modelId?"active":"",on:{click:function(e){s.appState.modelId="000000000000000000000000"}}},[s._v("\n          空白表单模板\n        ")]),s._v(" "),t("li",{staticClass:"list-group-item",class:s.appState.modelId===s.blankTemplateId?"active":"",on:{click:function(e){s.appState.modelId=s.blankTemplateId}}},[s._v("\n          系统预设模板\n        ")]),s._v(" "),s._l(s.formList,function(e,i){return t("li",{key:i,staticClass:"list-group-item",class:s.appState.modelId===e.id?"active":"",on:{click:function(t){s.appState.modelId=e.id}}},[s._v("\n          "+s._s(e.name)+"模板\n        ")])})],2)]),s._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("a",{attrs:{href:"javascript:;"},on:{click:function(e){s.appState.showFormModal=!1}}},[s._v("取消")]),s._v(" "),t("a",{staticClass:"sure-btn",attrs:{href:"javascript:;"},on:{click:s._initWithModel}},[s._v("确定")])])]),s._v(" "),t("v-modal",{attrs:{show:s.showIconModal,effect:"fade",width:"446"}},[t("div",{staticClass:"modal-header iconModal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[s._v("\n        修改图标\n      ")])]),s._v(" "),t("div",{staticClass:"modal-body iconModal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[t("div",{staticClass:"background-container"},s._l(s.backgroundList,function(e,i){return t("span",{key:i,staticClass:"background",style:{background:e.background},on:{click:function(t){return s._selectBackground(e)}}},[s.appState.background===e.background?t("i",{staticClass:"maticon icon-done",domProps:{innerHTML:s._s(s.icons("done"))}},[s._v("done")]):s._e()])}),0),s._v(" "),t("div",{staticClass:"icon-list"},[s._l(s.iconList,function(e,i){return t("i",{key:i,staticClass:"maticon",class:{active:"1"===s.appState.imgType&&s.appState.imgPath===e.name},domProps:{innerHTML:s._s(s.icons(e.name))},on:{click:function(t){return s._selectIcon(e)}}},[s._v(s._s(e.name))])}),s._v(" "),s._l(s.saasIconList,function(e,i){return t("i",{key:i,class:{active:"2"===s.appState.imgType&&s.appState.imgPath===e},on:{click:function(t){return s._selectIcon({name:e},"2")}}},[t("span",{staticClass:"saasicon",class:["saasicon-"+e+"-black"]})])})],2)]),s._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){return s._cancelPart("icon")}}},[s._v("取消")]),s._v(" "),t("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:s._saveAppIcon}},[s._v("确定")])])]),s._v(" "),t("v-modal",{attrs:{show:s.showTableModal,effect:"fade",width:"748"}},[t("div",{staticClass:"modal-header iconModal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[s._v("\n        报表设置\n      ")])]),s._v(" "),t("div",{staticClass:"modal-body iconModal-body",staticStyle:{padding:"0",height:"370px"},attrs:{slot:"modal-body"},slot:"modal-body"},[t("tableset",{ref:"tableset",attrs:{appId:s.appId}})],1),s._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){s.showTableModal=!1}}},[s._v("取消")]),s._v(" "),t("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:s._saveTableSet}},[s._v("确定")])])]),s._v(" "),t("v-modal",{attrs:{show:s.showInformModal,effect:"fade",width:"800"}},[t("div",{staticClass:"modal-header iconModal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[s._v("\n        节点通知设置\n      ")])]),s._v(" "),t("div",{staticClass:"modal-body iconModal-body",staticStyle:{padding:"0",height:"370px"},attrs:{slot:"modal-body"},slot:"modal-body"},[t("div",{staticStyle:{padding:"10px 0 0 0","border-bottom":"solid 1px #e5e5e5"}},[t("label",{staticStyle:{display:"inline-block","line-height":"26px",position:"relative",top:"-7px"}},[s._v("状态")]),s._v(" "),t("div",{staticClass:"bool-div",class:s.nodeSetting.openMessage?"active":"",staticStyle:{display:"inline-block"},on:{click:function(e){return s.switchOpen()}}},[t("span",[s._v(s._s(s.nodeSetting.openMessage?"启用":"禁用"))])]),s._v(" "),t("label",{staticStyle:{display:"inline-block","line-height":"26px",position:"relative",top:"-7px"}},[s._v("模板标题")]),s._v(" "),t("v-select",{staticStyle:{width:"140px",position:"relative",top:"-7px"},attrs:{options:s.showStatusList,optionsLabel:"title",optionsValue:"templateId"},model:{value:s.nodeSetting.templates,callback:function(e){s.$set(s.nodeSetting,"templates",e)},expression:"nodeSetting.templates"}})],1),s._v(" "),t("div",{staticClass:"switch_status",staticStyle:{display:"flex","flex-wrap":"nowrap","margin-top":"15px"}},[t("div",{staticClass:"node_lan"},s._l(s.typeList,function(e,i){return t("div",{staticClass:"switch-item-menu",staticStyle:{margin:"0",height:"40px"}},[t("label",[s._v(s._s(e))])])}),0),s._v(" "),s._l(s.nodeSetting.ables,function(e,i){return t("div",{staticClass:"node_lan",staticStyle:{padding:"0 15px"}},[t("div",{staticClass:"switch-item-menu",staticStyle:{margin:"0",height:"40px","text-align":"left"}},[t("label",{staticStyle:{"padding-left":"7px"}},[s._v(s._s(e.name))])]),s._v(" "),t("div",{staticClass:"switch-item-menu",staticStyle:{margin:"0",height:"40px"}},[e.submit?t("div",{staticClass:"bool-div",class:s.nodeSetting.authorities[i].submit?"active":"",staticStyle:{display:"inline-block",top:"7px"},on:{click:function(e){s.nodeSetting.authorities[i].submit=!s.nodeSetting.authorities[i].submit}}},[t("span",[s._v(s._s(s.nodeSetting.authorities[i].submit?"启用":"禁用"))])]):s._e()]),s._v(" "),t("div",{staticClass:"switch-item-menu",staticStyle:{margin:"0",height:"40px"}},[e.agree?t("div",{staticClass:"bool-div",class:s.nodeSetting.authorities[i].agree?"active":"",staticStyle:{display:"inline-block",top:"7px"},on:{click:function(e){s.nodeSetting.authorities[i].agree=!s.nodeSetting.authorities[i].agree}}},[t("span",[s._v(s._s(s.nodeSetting.authorities[i].agree?"启用":"禁用"))])]):s._e()]),s._v(" "),t("div",{staticClass:"switch-item-menu",staticStyle:{margin:"0",height:"40px"}},[e.cancelByUser?t("div",{staticClass:"bool-div",class:s.nodeSetting.authorities[i].cancelByUser?"active":"",staticStyle:{display:"inline-block",top:"7px"},on:{click:function(e){s.nodeSetting.authorities[i].cancelByUser=!s.nodeSetting.authorities[i].cancelByUser}}},[t("span",[s._v(s._s(s.nodeSetting.authorities[i].cancelByUser?"启用":"禁用"))])]):s._e()]),s._v(" "),t("div",{staticClass:"switch-item-menu",staticStyle:{margin:"0",height:"40px"}},[e.reject?t("div",{staticClass:"bool-div",class:s.nodeSetting.authorities[i].reject?"active":"",staticStyle:{display:"inline-block",top:"7px"},on:{click:function(e){s.nodeSetting.authorities[i].reject=!s.nodeSetting.authorities[i].reject}}},[t("span",[s._v(s._s(s.nodeSetting.authorities[i].reject?"启用":"禁用"))])]):s._e()]),s._v(" "),t("div",{staticClass:"switch-item-menu",staticStyle:{margin:"0",height:"40px"}},[e.deliverTo?t("div",{staticClass:"bool-div",class:s.nodeSetting.authorities[i].deliverTo?"active":"",staticStyle:{display:"inline-block",top:"7px"},on:{click:function(e){s.nodeSetting.authorities[i].deliverTo=!s.nodeSetting.authorities[i].deliverTo}}},[t("span",[s._v(s._s(s.nodeSetting.authorities[i].deliverTo?"启用":"禁用"))])]):s._e()]),s._v(" "),t("div",{staticClass:"switch-item-menu",staticStyle:{margin:"0",height:"40px"}},[e.sendTo?t("div",{staticClass:"bool-div",class:s.nodeSetting.authorities[i].sendTo?"active":"",staticStyle:{display:"inline-block",top:"7px"},on:{click:function(e){s.nodeSetting.authorities[i].sendTo=!s.nodeSetting.authorities[i].sendTo}}},[t("span",[s._v(s._s(s.nodeSetting.authorities[i].sendTo?"启用":"禁用"))])]):s._e()])])})],2)]),s._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){s.showInformModal=!1}}},[s._v("取消")]),s._v(" "),t("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:s._saveNodeWX}},[s._v("确定")])])]),s._v(" "),t("v-modal",{staticStyle:{height:"100%","margin-top":"500px",transition:"none"},attrs:{show:s.advancedSearch.show,effect:"fade",width:"720"}},[t("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[t("h5",{staticClass:"modal-title"},[s._v(s._s(s.isEditAdvanced?"编辑":"新增"))])]),s._v(" "),t("div",{staticClass:"modal-body",staticStyle:{padding:"20px 20px"},attrs:{slot:"modal-body"},slot:"modal-body"},[t("div",{staticClass:"modal-form-group"},[t("div",{staticClass:"group_name require"},[s._v("\n          请输入名称\n        ")]),s._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:s.advanceParams.limitName,expression:"advanceParams.limitName"}],staticClass:"value-input",attrs:{type:"text"},domProps:{value:s.advanceParams.limitName},on:{input:function(e){e.target.composing||s.$set(s.advanceParams,"limitName",e.target.value)}}})]),s._v(" "),t("div",{staticClass:"modal-form-group",staticStyle:{"margin-bottom":"0"}},[t("div",{staticClass:"group_name"},[s._v("\n          条件\n        ")])]),s._v(" "),s._l(s.advancedSearch.searchItems,function(e,i){return t("div",{key:"search-item-"+i,staticClass:"form-group advancedSearch-group box_flex flex_between"},[t("v-select",{attrs:{options:s.advancedSearch.columns,value:e.key,search:!0,"data-index":i},on:{afterSelected:s.advancedSearchKeySelected}}),s._v(" "),t("v-select",{attrs:{options:e.options.relation,value:e.relation,search:!0,"data-index":i},on:{afterSelected:s.advancedSearchRelationSelected}}),s._v(" "),e.isDict?t("v-select",{attrs:{options:e.options.dictOptions,value:e.value,optionsLabel:"text",optionsValue:"id",search:!0,multiple:!0,"data-index":i},on:{afterSelected:s.advancedSearchValueSelected}}):s._e(),s._v(" "),e.isAddress?t("v-select",{attrs:{options:s.getAddressOptions("province"),value:e.province,optionsLabel:"name",optionsValue:"name",search:!0,"data-index":i},on:{afterSelected:s.advancedSearchProvinceSelected}}):s._e(),s._v(" "),e.isAddress&&e.province?t("v-select",{attrs:{options:s.getAddressOptions("city",e.province),value:e.city,optionsLabel:"name",optionsValue:"name",search:!0,"data-index":i},on:{afterSelected:s.advancedSearchCitySelected}}):s._e(),s._v(" "),e.isAddress&&e.city?t("v-select",{attrs:{options:s.getAddressOptions("area",e.city,e.province),value:e.county,optionsLabel:"name",optionsValue:"name",search:!0,"data-index":i},on:{afterSelected:s.advancedSearchCountySelected}}):s._e(),s._v(" "),e.isDate?t("v-datepicker",{ref:"datepicker",refInFor:!0,staticClass:"time-picker value-datepicker",attrs:{value:e.value,clearButton:!1,showTime:!1,"data-index":i},on:{daySelected:s.advancedSearchDateValue}}):s._e(),s._v(" "),e.isInput?t("input",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"searchItem.value"}],staticClass:"value-input",attrs:{type:"text"},domProps:{value:e.value},on:{input:function(t){t.target.composing||s.$set(e,"value",t.target.value)}}}):s._e(),s._v(" "),t("button",{staticClass:"btn deleteBtn clearBtnBorder",attrs:{type:"button","data-index":i},on:{click:function(e){return s.deleteSearchItem(i)}}},[s._v("删除")])],1)}),s._v(" "),t("button",{staticClass:"btn addBtn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){return s.addSearchItem()}}},[s._v("新增")]),s._v(" "),t("div",{staticClass:"modal-form-group"},[t("div",{staticClass:"group_name "},[s._v("\n          结果\n        ")]),s._v(" "),t("v-select",{attrs:{options:s.supportOptions,optionsLabel:"text",optionsValue:"value"},model:{value:s.advanceParams.applyValue,callback:function(e){s.$set(s.advanceParams,"applyValue",e)},expression:"advanceParams.applyValue"}})],1),s._v(" "),t("div",{staticClass:"modal-form-group"},[t("div",{staticClass:"group_name require"},[s._v("\n          请输入不可操作提示语\n        ")]),s._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:s.advanceParams.message,expression:"advanceParams.message"}],staticClass:"value-input",attrs:{type:"text"},domProps:{value:s.advanceParams.message},on:{input:function(e){e.target.composing||s.$set(s.advanceParams,"message",e.target.value)}}})])],2),s._v(" "),t("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){return s.resetSearchItem()}}},[s._v("重置")]),s._v(" "),t("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){s.advancedSearch.show=!1}}},[s._v("取消")]),s._v(" "),t("button",{staticClass:"btn submit-btn clearBtnBorder",class:{disabled:s.isDisabled},attrs:{type:"button"},on:{click:function(e){return s._saveAddSearch()}}},[s._v("存储")])])]),s._v(" "),s.preview?t("div",{staticClass:"preview-container"},[t("preview",{attrs:{data:s.previewObj.formData.components,title:s.previewObj.formData.name,script:s.previewObj.formData.property.script,authorities:s.previewObj.authorities,defaultData:s.previewObj.recordData,log:s.previewObj.log,previewType:"flow",fileServer:s.uploadFile},on:{back:function(e){s.preview=!1}}})],1):s._e()],1)},staticRenderFns:[]};var h=t("C7Lr")(p,d,!1,function(s){t("XEGY")},null,null);e.a=h.exports},w60d:function(s,e){}});