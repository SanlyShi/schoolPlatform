webpackJsonp([87],{"6Ot6":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("C331"),c=a("3Chf"),i=a("/LmD"),n=(i.a,{mixins:[i.a],props:{placeholder:{default:"输入学号或姓名进行搜索"},collegeList:{default:function(){return[]}},type:{default:""}},data:function(){return{showSearchBox:{main:!1,college:!1,advanced:!1},inputW:"60%",collegeKey:"",searchInfo:{keyword:"",college:{type:"popup-r",name:"学院",key:"college",tempList:[],list:[],tempVal:[],value:[]},educationLevel:{type:"cell",name:"培养层次",key:"educationLevel",list:[],value:[]},grade:{type:"cell",name:"年级",key:"grade",list:[],value:[]},advancedSearch:{type:"popup-b",name:"高级搜索",list:[],value:[]}}}},computed:{keyword:function(){return this.searchInfo.keyword}},watch:{type:function(e){this.initCollege(),this._resetSearchInfo()}},created:function(){this.initYear(),this.initEducationLevel(),this.initAdvancedSearchTableKeys()},mounted:function(){},methods:{initYear:function(){for(var e=(new Date).getFullYear(),t=[],a=0;a<6;a++)t.push({key:e-a,value:e-a+"级",checked:!1});this.searchInfo.grade.list=t},initEducationLevel:function(){var e=this;Object(s.e)({url:"/api/system/dicts?dictType=培养层次",type:"get",success:function(t){t.state&&(t.data.forEach(function(e){e.key=e.value,e.value=e.label,e.checked=!1}),e.$set(e.searchInfo.educationLevel,"list",t.data))}})},initCollege:function(){var e=this;Object(s.e)({url:"/api/student/manage/getSelectOptions?type="+this.type,type:"get",success:function(t){t.state?(e.searchInfo.college.list=[],t.data.colleges.map(function(t){e.searchInfo.college.list.push({key:t.id,value:t.text}),e.searchInfo.college.tempList=e.searchInfo.college.list})):e._toast(t.message)}})},showSearch:function(){this.advancedSearch.show=!0,this.addSearchItem()},_selectItem:function(e,t){this.searchInfo[e].list[t].checked=!this.searchInfo[e].list[t].checked},_resetSearchInfo:function(){this.searchInfo.educationLevel.list.forEach(function(e){e.checked=!1}),this.searchInfo.grade.list.forEach(function(e){e.checked=!1}),this.searchInfo.advancedSearch.value=[],this.searchInfo.college.value=[],this.resetCollege()},changeInputWidth:function(){this.inputW="100%"},isShowSearchMain:function(){this.showSearchBox.main=!this.showSearchBox.main},cancelAdvancedSearch:function(){this.advancedSearch.show=!1,this.advancedSearch.searchItems=[]},confirmAdvanced:function(){this.searchInfo.advancedSearch.value.push(this.advancedSearch.searchItems[0]),this.cancelAdvancedSearch()},deleteAdvancedSearch:function(e){this.searchInfo.advancedSearch.value.splice(e,1)},searchCollege:function(e){""!=e?(this.searchInfo.college.tempList=this.searchInfo.college.list.filter(function(t){return t.value.indexOf(e)>-1}),this.$set(this.searchInfo.college,"tempList",this.searchInfo.college.tempList)):this.searchInfo.college.tempList=this.searchInfo.college.list},cancelCollege:function(){this.showSearchBox.college=!1,this.searchInfo.college.tempVal=this.searchInfo.college.value},resetCollege:function(){this.searchInfo.college.tempList=this.searchInfo.college.list,this.searchInfo.college.tempVal=[],this.collegeKey=""},confirmCollege:function(){this.searchInfo.college.value=this.searchInfo.college.tempVal,this.showSearchBox.college=!1},formatCollegeVal:function(e){return e.length==this.searchInfo.college.list.length?"全部":1==e.length?this.searchInfo.college.list.find(function(t){return t.key==e[0]}).value:e.length>1?this.searchInfo.college.list.find(function(t){return t.key==e[0]}).value+"等"+e.length+"个学院":"请选择"},_confirmSearchInfo:function(){var e=this,t=this.searchInfo,a={};a.searchDTOS=t.advancedSearch.value.map(function(t){return{key:t.key,relation:t.relation,value:t.value,tableName:e.advancedSearch.optionKeys[t.key].tableName,listValues:t.value?t.value.split(","):[],provinces:t.province?t.province.split(","):[],cities:t.city?t.city.split(","):[],counties:t.county?t.county.split(","):[]}}),a.college=this.arrayToString(t.college.value);var s=[];t.grade.list.map(function(e){e.checked&&s.push(e.key)}),a.grade=this.arrayToString(s);var c=[];t.educationLevel.list.map(function(e){e.checked&&c.push(e.key)}),a.educationLevel=this.arrayToString(c),a.keyword=t.keyword,this.$emit("search",a),this.showSearchBox.main=!1},arrayToString:function(e){return 0==e.length?"":e.join(",")}}}),o={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"c-search-info"},[s("div",{staticClass:"c-search-wrap"},[s("div",{staticClass:"c-search-box"},[s("img",{staticClass:"icon-search",attrs:{src:a("YCLj"),alt:""}}),e._v(" "),s("x-input",{style:"width:"+e.inputW,attrs:{"show-clear":!1,placeholder:e.placeholder,min:e.min,max:e.max,"placeholder-align":e.textAlign},on:{"on-focus":e.changeInputWidth,"on-change":e._confirmSearchInfo},model:{value:e.searchInfo.keyword,callback:function(t){e.$set(e.searchInfo,"keyword",t)},expression:"searchInfo.keyword"}})],1)]),e._v(" "),s("div",{staticClass:"c-search-btn",on:{click:function(t){e.showSearchBox.main=!e.showSearchBox.main}}},[s("img",{attrs:{src:a("42f/"),alt:""}})])]),e._v(" "),e.showSearchBox.main?s("div",{staticClass:"c-search-body"},[s("div",{staticClass:"c-search-mask",on:{click:function(t){e.showSearchBox.main=!e.showSearchBox.main}}}),e._v(" "),s("div",{staticClass:"c-search-main"},[s("cell",{attrs:{title:"学院","is-link":"","border-intent":!1,value:e.formatCollegeVal(e.searchInfo.college.value)},nativeOn:{click:function(t){e.showSearchBox.college=!e.showSearchBox.college}}}),e._v(" "),e._l(e.searchInfo,function(t,a){return"cell"==t.type?s("div",{key:a},[s("cell",{attrs:{title:t.name,"border-intent":!1}}),e._v(" "),s("div",{staticClass:"c-select"},e._l(t.list,function(a,c){return s("div",{key:c,staticClass:"c-select-item",class:{on:a.checked},on:{click:function(a){return e._selectItem(t.key,c)}}},[e._v(e._s(a.value))])}),0)],1):e._e()}),e._v(" "),s("cell",{attrs:{title:"高级搜索","border-intent":!1},nativeOn:{click:function(t){return e.showSearch(t)}}},[s("div",{staticClass:"c-advanced-add",attrs:{slot:""},slot:"default"},[s("img",{attrs:{src:a("rayN"),alt:""}})])]),e._v(" "),s("div",{staticClass:"c-advanced-cnt"},e._l(e.searchInfo.advancedSearch.value,function(t,c){return s("div",{key:c,staticClass:"c-advanced-item"},[e._v("\n          "+e._s(e.advancedSearch.optionKeys[t.key].keyName)+"\n          "),s("div",{staticClass:"c-advanced-item-delete",on:{click:function(t){return e.deleteAdvancedSearch(c)}}},[s("img",{attrs:{src:a("tC08"),alt:""}})])])}),0),e._v(" "),s("footer",[s("x-button",{staticClass:"c-ft-btn-reset",nativeOn:{click:function(t){return e._resetSearchInfo(t)}}},[e._v("重置")]),e._v(" "),s("x-button",{staticClass:"c-ft-btn-sub",nativeOn:{click:function(t){return e._confirmSearchInfo(t)}}},[e._v("确定")])],1)],2)]):e._e(),e._v(" "),e.showSearchBox.college?s("div",{staticClass:"c-search-body"},[s("div",{staticClass:"c-search-mask",on:{click:e.cancelCollege}}),e._v(" "),s("div",{staticClass:"c-search-main"},[s("div",{staticClass:"c-search-info"},[s("div",{staticClass:"c-search-wrap no-line"},[s("div",{staticClass:"c-search-box"},[s("i",{staticClass:"maticon back-icon",domProps:{innerHTML:e._s(e.icons("search"))}}),e._v(" "),s("x-input",{staticStyle:{width:"100%"},attrs:{placeholder:"搜索学院","placeholder-align":e.textAlign,"show-clear":!1},on:{"on-change":e.searchCollege},model:{value:e.collegeKey,callback:function(t){e.collegeKey=t},expression:"collegeKey"}})],1)])]),e._v(" "),s("div",{staticClass:"c-college-list"},[s("checklist",{attrs:{options:e.searchInfo.college.tempList},on:{"on-change":e.change},model:{value:e.searchInfo.college.tempVal,callback:function(t){e.$set(e.searchInfo.college,"tempVal",t)},expression:"searchInfo.college.tempVal"}})],1),e._v(" "),s("footer",[s("x-button",{staticClass:"c-ft-btn-reset",nativeOn:{click:function(t){return e.resetCollege(t)}}},[e._v("重置")]),e._v(" "),s("x-button",{staticClass:"c-ft-btn-sub",nativeOn:{click:function(t){return e.confirmCollege(t)}}},[e._v("确定(共"+e._s(e.searchInfo.college.tempVal.length)+"个学院)")])],1)])]):e._e(),e._v(" "),e.advancedSearch.show?s("div",{staticClass:"c-search-body"},[s("div",{staticClass:"c-search-mask",on:{click:e.cancelAdvancedSearch}}),e._v(" "),s("div",{staticClass:"c-search-ad"},[s("div",{staticClass:"c-search-ad-t"},[s("div",{staticClass:"c-search-ad-t-btn",on:{click:e.cancelAdvancedSearch}},[e._v("取消")]),e._v(" "),s("div",{staticClass:"c-search-ad-title"},[e._v("高级搜索")]),e._v(" "),s("div",{staticClass:"c-search-ad-t-btn",on:{click:e.confirmAdvanced}},[e._v("完成")])]),e._v(" "),s("div",{staticClass:"c-search-ad-body"},[s("div",{staticClass:"c-search-ad-row"},[s("v-select",{staticClass:"c-ad-box flex2",attrs:{options:e.advancedSearch.columns,value:e.advancedSearch.searchItems[0].key,search:!0,"data-index":0},on:{afterSelected:e.advancedSearchKeySelected}}),e._v(" "),s("v-select",{staticClass:"c-ad-box flex1",attrs:{options:e.advancedSearch.searchItems[0].options.relation,value:e.advancedSearch.searchItems[0].relation,search:!0,"data-index":0},on:{afterSelected:e.advancedSearchRelationSelected}})],1),e._v(" "),s("div",{staticClass:"c-search-ad-row"},[e.advancedSearch.searchItems[0].isDict?s("v-select",{attrs:{options:e.advancedSearch.searchItems[0].options.dictOptions,value:e.advancedSearch.searchItems[0].value,optionsLabel:"text",optionsValue:"id",search:!0,multiple:!0,"data-index":0},on:{afterSelected:e.advancedSearchValueSelected}}):e._e(),e._v(" "),e.advancedSearch.searchItems[0].isAddress?s("v-select",{attrs:{options:e.advancedSearch.searchItems[0].options.province,value:e.advancedSearch.searchItems[0].province,optionsLabel:"text",optionsValue:"id",search:!0,multiple:!0,"data-index":0},on:{afterSelected:e.advancedSearchProvinceSelected}}):e._e(),e._v(" "),e.advancedSearch.searchItems[0].isSelectProvince?s("v-select",{attrs:{options:e.advancedSearch.searchItems[0].options.city,value:e.advancedSearch.searchItems[0].city,optionsLabel:"text",optionsValue:"id",search:!0,multiple:!0,"data-index":0},on:{afterSelected:e.advancedSearchCitySelected}}):e._e(),e._v(" "),e.advancedSearch.searchItems[0].isSelectCity?s("v-select",{attrs:{options:e.advancedSearch.searchItems[0].options.county,value:e.advancedSearch.searchItems[0].county,optionsLabel:"text",optionsValue:"id",search:!0,multiple:!0,"data-index":0},on:{afterSelected:e.advancedSearchCountySelected}}):e._e(),e._v(" "),e.advancedSearch.searchItems[0].isDate?s("v-datepicker",{ref:"datepicker",staticClass:"btn-block time-picker value-datepicker",attrs:{value:e.advancedSearch.searchItems[0].value,clearButton:!1,showTime:!1,"data-index":0},on:{daySelected:e.advancedSearchDateValue}}):e._e(),e._v(" "),e.advancedSearch.searchItems[0].isInput?s("input",{directives:[{name:"model",rawName:"v-model",value:e.advancedSearch.searchItems[0].value,expression:"advancedSearch.searchItems[0].value"}],staticClass:"c-ipt-wrap flex1",attrs:{type:"text",placeholder:"请输入搜索内容"},domProps:{value:e.advancedSearch.searchItems[0].value},on:{input:function(t){t.target.composing||e.$set(e.advancedSearch.searchItems[0],"value",t.target.value)}}}):e._e()],1)])])]):e._e()])},staticRenderFns:[]};var l=a("C7Lr")(n,o,!1,function(e){a("RU1f"),a("jIZ4")},"data-v-64c436ca",null).exports,r=(c.a,{props:{data:{default:""}},data:function(){return{isInitData:!1,permissionInfo:{list:[],value:""},collegeInfo:{list:[],value:[]},tabbarList:[{title:"在校生",value:!0},{title:"非在校生",value:!1}],currentTabIdx:0,total:0,stuInfoList:[],isLoadMoreData:!1,loadingText:!1,noDataTips:"",searchInfo:{searchDTOS:[],college:"",grade:"",educationLevel:"",pageIndex:0,pageSize:10,type:"",inSchool:!0,keyword:""}}},components:{MList:c.a,MSearchInfo:l},created:function(){this.getStuPermissions()},mounted:function(){var e=this;this.$pullUpToLoad({container:"#studentInfo .info-list",down:{height:200,callback:function(){e.initList()}},up:{callback:function(){e.isLoadMoreData&&(e.searchInfo.pageIndex++,e.getStuInfo())}}})},computed:{},watch:{},methods:{getStuInfo:function(){var e=this;this.searchInfo.type=this.permissionInfo.value,this.searchInfo.inSchool=this.tabbarList[this.currentTabIdx].value,Object(s.e)({url:"/api/student/manage/advancedSearch",type:"post",data:this.searchInfo,success:function(t){t.state?(e.loadingText=!1,t.data.content.length>0?e.noDataTips="":e.noDataTips="暂无相关数据",e.total=t.data.totalElements,t.data.content.forEach(function(t){e.stuInfoList.push(t)}),e.stuInfoList.length>=e.total?(e.isLoadMoreData=!1,e.isShowNoMoreDataTips=!0):(e.isLoadMoreData=!0,e.isShowNoMoreDataTips=!1)):e.$toast(t.message)}})},searchStuInfo:function(e){this.searchInfo.searchDTOS=e.searchDTOS,this.searchInfo.college=e.college,this.searchInfo.grade=e.grade,this.searchInfo.educationLevel=e.educationLevel,this.searchInfo.keyword=e.keyword,this.initList()},getCollegeByPermission:function(){var e=this;Object(s.e)({url:"/api/student/manage/getSelectOptions?type="+this.permissionInfo.value,type:"get",success:function(t){t.state?t.data.colleges.map(function(t){e.collegeInfo.list.push({key:t.id,value:t.text})}):e.$toast(t.message)}})},getStuPermissions:function(){var e=this;Object(s.e)({url:"/api/student/manage/my/permissions",type:"get",success:function(t){t.state?(t.data.map(function(t){e.permissionInfo.list.push({key:t.id,value:t.text})}),e.permissionInfo.value=e.permissionInfo.list.length&&e.permissionInfo.list[0].key,e.getStuInfo(),e.getCollegeByPermission()):e.$toast(t.message)}})},_switchTab:function(e){this.currentTabIdx=e,this.initList(),this.getCollegeByPermission()},_switchType:function(){this.initList()},initList:function(){this.searchInfo.pageIndex=0,this.total=0,this.stuInfoList=[],this.getStuInfo()},_toast:function(e){this.$vux.toast.show({text:e,position:"bottom",type:"text"})},_back:function(){this.data.isUpdateLastPage=!0,this.$emit("removeBread",this.data)},_toDetail:function(e){this.$emit("addBread",{route:"/form/MFormLayout",title:"",data:{userId:e,type:"STUDENT"}})}}}),h={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"studentInfo"}},[s("view-box",[s("x-header",{staticClass:"studentInfo-header"},[s("i",{staticClass:"maticon back-icon",attrs:{slot:"overwrite-left"},domProps:{innerHTML:e._s(e.icons("navigate_before"))},on:{click:e._back},slot:"overwrite-left"},[e._v("navigate_before")]),e._v(" "),s("div",{staticClass:"overwrite-title-demo",attrs:{slot:"overwrite-title"},slot:"overwrite-title"},[s("div",{staticClass:"apply-title"},[e._v("学生信息")]),e._v(" "),s("popup-radio",{staticClass:"stu-type",attrs:{title:"",options:e.permissionInfo.list},on:{"on-hide":e._switchType},model:{value:e.permissionInfo.value,callback:function(t){e.$set(e.permissionInfo,"value",t)},expression:"permissionInfo.value"}})],1)]),e._v(" "),s("m-search-info",{attrs:{"college-list":e.collegeInfo.list,type:e.permissionInfo.value},on:{search:e.searchStuInfo}}),e._v(" "),s("div",{staticClass:"search-tabbar"},e._l(e.tabbarList,function(t,a){return s("div",{key:a,staticClass:"search-tabbar-item",class:e.currentTabIdx==a?"active":"",on:{click:function(t){return e._switchTab(a)}}},[e._v(e._s(t.title))])}),0),e._v(" "),s("div",{staticClass:"info-list"},[e._l(e.stuInfoList,function(t,a){return s("m-list",{key:a,attrs:{student:t},nativeOn:{click:function(a){return e._toDetail(t.userId)}}})}),e._v(" "),e.loadingText?s("div",{staticClass:"no-more"},[s("span",{staticClass:"line"}),e._v(" "),s("span",[e._v("加载中")]),e._v(" "),s("span",{staticClass:"line"})]):e._e(),e._v(" "),""!=e.noDataTips?s("div",{staticClass:"no-data"},[s("img",{attrs:{src:a("QOW3"),alt:""}}),e._v(" "),s("span",[e._v(e._s(e.noDataTips))])]):!e.isLoadMoreData&&e.isShowNoMoreDataTips?s("div",{staticClass:"no-more"},[s("span",{staticClass:"line"}),e._v(" "),s("span",[e._v("暂无更多数据")]),e._v(" "),s("span",{staticClass:"line"})]):e._e()],2),e._v(" "),s("div",{staticClass:"bottom-info-num"},[s("span",[e._v("共")]),e._v(" "),s("span",{staticClass:"highlight"},[e._v(e._s(e.total))]),e._v(" "),s("span",[e._v("条信息")])])],1)],1)},staticRenderFns:[]};var d=a("C7Lr")(r,h,!1,function(e){a("Wi1r")},null,null);t.default=d.exports},RU1f:function(e,t){},Wi1r:function(e,t){},jIZ4:function(e,t){}});