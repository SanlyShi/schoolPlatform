webpackJsonp([263],{"+5sQ":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("C331"),s={props:{data:{default:""}},data:function(){return{haveFeedback:!0,feedbackImages:[],starNumber:4,feedbackContent:"",userStarList:[],info:{},feedbackObj:{},statusDesc:{NOT_REVIEW:"活动反馈审核中",PASS:"活动反馈已通过",NOT_PASS:"活动反馈不通过",WAIT_SUBMIT:"提交反馈"}}},computed:{isParticipant:function(){return["PARTICIPANT"].indexOf(this.data.data.userType)>=0}},created:function(){var t=this;this.info=this.data.data,this.isParticipant?Object(i.e)({url:"/api/sc/activitySocializations/activities/"+this.info.id+"/evaluate",type:"get",success:function(e){e.state?(t.haveFeedback=!(!e.data||!e.data.content),t.feedbackContent=e.data?e.data.content:"",t.starNumber=e.data?e.data.point:5):t._toast(e.message)}}):Object(i.e)({url:"/api/sc/activityProcesses/activityFeedback/"+this.info.id,type:"get",success:function(e){e.state?(e.data?t.feedbackObj=e.data:t.feedbackObj={status:"WAIT_SUBMIT"},["PASS","NOT_PASS","NOT_REVIEW"].indexOf(t.feedbackObj.status)>=0?t.haveFeedback=!0:t.haveFeedback=!1,t.feedbackContent=e.data?e.data.activitySituation:"",t.feedbackImages=e.data?e.data.images:[]):t._toast(e.message)}})},methods:{_back:function(){this.$emit("removeBread",this.data)},_removeImage:function(t){var e=this;this.haveFeedback||this.$vux.confirm.show({title:"确定删除该图片吗？",onConfirm:function(){e.feedbackImages.splice(t,1)}})},_uploadImages:function(t){var e=this;if(this.feedbackImages&&this.feedbackImages.length>5)return this._toast("最多选择六张图片");var a,s={};(s=new FormData).append("file",t.target.files[0]),t.target.value="",a=this.uploadImage,Object(i.e)({url:a,type:"post",data:s,processData:!1,contentType:!1,success:function(t){"88888"===t.code||t.state?e.feedbackImages.push(t.data.hash):e._toast(t.message)}})},_participantStar:function(){this.$emit("addBread",{route:"/activity/MActivityUserStar",title:"",data:{activityId:this.info.id,haveFeedback:this.haveFeedback,newUserAndPoints:this.userStarList,lastPage:this}})},_submit:function(){var t=this;if(!this.haveFeedback){if(!this.feedbackContent)return this._toast("请输入20到150字的意见反馈");if(this.isParticipant)Object(i.e)({url:"/api/sc/activitySocializations/createEvaluate",type:"post",data:{activityId:this.info.id,point:this.starNumber,content:this.feedbackContent},success:function(e){"88888"===e.code||e.state?t.feedbackImages.push(e.data.hash):t._toast(e.message)}});else{if(0===this.feedbackImages.length)return this._toast("请添加1到6张图片");Object(i.e)({url:"/api/sc/activityProcesses/createActivityFeedback",type:"post",data:{activityId:this.info.id,activitySituation:this.feedbackContent,userAndPoints:this.userStarList,images:this.feedbackImages,activityFeedbackId:this.feedbackObj&&this.feedbackObj.activityFeedbackId},success:function(e){var a="";e.state?(a="提交成功，请等待审核",t._back()):a=e.message,t._toast(a)}})}}},_toast:function(t){this.$vux.toast.show({text:t,position:"bottom",type:"text"})}}},c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"activityFeedback"}},[a("view-box",[a("x-header",{staticClass:"activityFeedback-header"},[a("i",{staticClass:"maticon back-icon",attrs:{slot:"overwrite-left"},domProps:{innerHTML:t._s(t.icons("navigate_before"))},on:{click:t._back},slot:"overwrite-left"},[t._v("navigate_before")])]),t._v(" "),a("div",{staticClass:"activityFeedback-content"},[t.isParticipant?a("div",{staticClass:"star-div"},[a("rater",{attrs:{"active-color":"rgb(255,145,2)",disabled:t.haveFeedback,"font-size":17,margin:16,min:1,max:5},model:{value:t.starNumber,callback:function(e){t.starNumber=e},expression:"starNumber"}})],1):a("div",{staticClass:"select-img"},[a("flexbox",[a("flexbox-item",{attrs:{span:11}},[a("div",{staticClass:"flex-demo img-div"},t._l(t.feedbackImages,function(e,i){return a("x-img",{key:i,staticClass:"img-item",attrs:{src:t.imageUrlPrefix+e},nativeOn:{click:function(e){return e.stopPropagation(),t._removeImage(i)}}})}),1)]),t._v(" "),a("flexbox-item",{staticClass:"img-select-btn-item",attrs:{span:1}},[a("div",{staticClass:"flex-demo img-select-btn"},[a("span",{staticClass:"img-control"},[a("i",{staticClass:"maticon",domProps:{innerHTML:t._s(t.icons("add_a_photo"))}}),t._v(" "),t.haveFeedback?t._e():a("input",{attrs:{type:"file"},on:{change:function(e){return t._uploadImages(e)}}})])])])],1)],1),t._v(" "),a("group",{staticClass:"content-group"},[t.isParticipant?a("div",{staticClass:"content-title"},[t._v("活动评价")]):a("div",{staticClass:"content-title"},[t._v("活动反馈")]),t._v(" "),a("x-textarea",{staticClass:"content",attrs:{max:500,name:"detail",placeholder:"请输入内容(字数在500内)",height:110,"show-counter":!1,readonly:t.haveFeedback},model:{value:t.feedbackContent,callback:function(e){t.feedbackContent=e},expression:"feedbackContent"}})],1),t._v(" "),t.isParticipant?t._e():a("div",{staticClass:"participant-star-btn",on:{click:t._participantStar}},[t._v(t._s(t.haveFeedback?"查看评星情况":"给参与者评星"))]),t._v(" "),a("box",{staticClass:"submit-box"},[a("x-button",{staticClass:"custom-primary-blue",class:{disabled:t.haveFeedback},attrs:{plain:"",type:"primary",disabled:t.haveFeedback},nativeOn:{click:function(e){return t._submit(e)}}},[t._v(t._s(t.isParticipant?t.haveFeedback?"已评价":"提交":t.feedbackObj?t.statusDesc[t.feedbackObj.status]:""))])],1)],1)],1)],1)},staticRenderFns:[]};var n=a("C7Lr")(s,c,!1,function(t){a("QC1z")},null,null);e.default=n.exports},QC1z:function(t,e){}});