webpackJsonp([137],{B8lZ:function(e,t){},xH2M:function(e,t){},xxE6:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("aA9S"),o=s.n(a),n=s("3cXf"),r=s.n(n),l=(s("kV13"),s("C331")),i={created:function(){var e=localStorage.getItem("lang"),t=this;Object(l.g)(e)&&(this.lang=e),this.roleColumns=[{id:"name",title:this.translate.roleName,className:"text-left",hidden:!1},{id:"remark",title:this.translate.roleDescription,className:"text-left",hidden:!1},{title:this.translate.user,className:"text-left",hidden:!1,hover:!1,formatter:function(e){if(!e.users)return"";var t="";return e.users.forEach(function(e){t+="<span title="+e.userNo+">"+e.name+"</span>,"}),t.substring(0,t.length-1)}},{id:"opt",title:this.translate.operation,className:"text-center",width:"130px",hidden:!1,formatter:function(e){var s=[{tag:"a",text:"授权",className:"opt-btn",callback:function(e,s){t.userInfoArr.splice(0,t.userInfoArr.length),e.users&&e.users.forEach(function(e,s){t.userInfoArr.push({userId:e.userId,userName:e.name})}),t.newRoleUser.roleId=e.id,t.newRoleUser.userNo="",t.newRoleUser.name="",t.showUserModal=!0,t.isCheck=!1,t.timestamp=new Date}}];return"customDefined"===e.source&&s.unshift({tag:"a",text:"编辑",className:"opt-btn",callback:function(e,s){t.getCustomRole(e.id,function(){t._showAddRoleModal()})}}),s}}],this.userColumns=[{id:"userNo",title:this.translate.userNo,className:"text-left",hidden:!1},{id:"name",title:this.translate.username,className:"text-left",hidden:!1},{title:this.translate.role,className:"text-left",hidden:!1,formatter:function(e){if(!e.roles)return"";var t="";return e.roles.forEach(function(e){t+=e.name+","}),t.substring(0,t.length-1)}}],this.columns=this.roleColumns,this.url=this.roleUrl,this.getCustomRole()},data:function(){return{expandedList:[],timestamp:"",activeName:"core",defaultProps:{children:"subMenus",label:"name"},modalState:"add",showNewRoleBox:!1,columns:[],roleColumns:[],userColumns:[],url:"",roleUrl:"/table-data/authorities/schoolRoles/list?timestamp=",userUrl:"/table-data/authorities/schoolRoles/users/pages?timestamp=",showUserModal:!1,roleDimension:!0,newCustomRole:{id:null,name:"",remark:"",systems:[]},newRoleUser:{roleId:0,userId:"",name:"",userNo:""},errorMessage:"",userInfoArr:[],isCheck:!1,lang:"zh-cn",tabList:[],role:[{admin:!0},{normal:!1}]}},computed:{translate:function(){return Object(l.g)(this.lang).schoolRoleManage},buttonText:function(){return this.roleDimension?this.translate.exchangeDimensionLabel1:this.translate.exchangeDimensionLabel2}},methods:{filterSys:function(e){return"ixuexi"!==e&&"appointment"!==e&&"warning"!==e&&"portrayal"!==e},_showAddRoleModal:function(e){var t=this;this.activeName="core","add"===e&&(this.newCustomRole={id:null,name:"",remark:"",systems:JSON.parse(r()(this.tabList))}),this.expandedList=[],this.newCustomRole.systems.forEach(function(e){e.checkedList=[],e.menus&&e.menus.forEach(function(s){s.hasAuthority&&e.checkedList.push(s.id),s.subMenus.length>0&&t.expandedList.push(s.id),s.subMenus.forEach(function(t){t.hasAuthority&&e.checkedList.push(t.id)})})}),this.modalState=e,this.showNewRoleBox=!0},addRole:function(){var e=this;if(this.newCustomRole.name){var t=o()({},this.newCustomRole);t.systems.forEach(function(e){delete e.checkedList,e.menus&&e.menus.forEach(function(e){e.hasAuthority&&e.subMenus.length>0&&(e.hasAuthority=!1)})}),Object(l.d)("/api/authorities/schoolRoles/customRole",t,"post").then(function(t){t.state?(e.$toast(("add"===e.modalState?"新增":"编辑")+"成功"),e.timestamp=new Date,e.showNewRoleBox=!1):e.$toast(t.message)})}else this.$toast("请填写角色名称")},radioClick:function(e,t){if(!this.filterSys(t.name))return t.isAdmin=!t.isAdmin,void(t.isAdmin?t.role="admin":t.role="normal");t.role=e,t.isAdmin="admin"===e},radioChange:function(e,t){t.isAdmin="admin"===e},handleTreeCheck:function(e){e.hasAuthority=!e.hasAuthority,e.subMenus.length>0&&e.subMenus.forEach(function(t){t.hasAuthority=e.hasAuthority})},getCustomRole:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,s=arguments[1],a="/api/authorities/schoolRoles/customRole"+(t?"?roleId="+t:"");Object(l.d)(a).then(function(a){a.state?(a.data.systems.forEach(function(e){!0===e.isAdmin?e.role="admin":!1===e.isAdmin?e.role="normal":e.role="",e.menus&&e.menus.forEach(function(e){var t=0;e.subMenus.map(function(e){e.hasAuthority&&t++}),e.subMenus.length>0&&t===e.subMenus.length&&(e.hasAuthority=!0)})}),t?e.newCustomRole=JSON.parse(r()(a.data)):e.tabList=JSON.parse(r()(a.data.systems)),"function"==typeof s&&s()):e.$toast(a.message)})},handleClick:function(e,t){},exchangeDimension:function(){this.roleDimension?(this.columns=this.userColumns,this.url="/table-data/authorities/schoolRoles/users/pages?pageIndex=0&timestamp="):(this.columns=this.roleColumns,this.url="/table-data/authorities/schoolRoles/list?pageIndex=0&timestamp="),this.roleDimension=!this.roleDimension},cancelAddUser:function(){this.newRoleUser={roleId:0,userId:"",name:"",userNo:""},this.showUserModal=!1},checkUser:function(){var e=this;this.newRoleUser.userNo?Object(l.e)({url:"/api/users/"+this.newRoleUser.userNo,dataType:"json",data:{},type:"GET",success:function(t){t.state?(e.newRoleUser.userId=t.data.userId,e.newRoleUser.name=t.data.name,e.errorMessage="",e.isCheck=!0):(e.errorMessage=e.translate.userNoExistedTip,e.isCheck=!1)}}):e.errorMessage=this.translate.checkUserTip},addNewUser:function(){if(!this.isCheck)return this.$toast("请先检测学工号！");this.userInfoArr.push({userId:this.newRoleUser.userId,userName:this.newRoleUser.name})},addUser:function(){var e=this;Object(l.e)({url:"/api/authorities/schoolRoles/"+this.newRoleUser.roleId+"/users",dataType:"json",data:{users:this.userInfoArr},type:"post",success:function(t){t.state?(e.showUserModal=!1,e.url=(e.roleDimension?e.roleUrl:e.userUrl)+"?time="+(new Date).getTime(),e.$toast("提交成功")):e.$toast(t.message)}})},removeUser:function(e){var t=this;this.userInfoArr.forEach(function(s,a){s.userId===e&&t.userInfoArr.splice(a,1)})}}},u={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container-fluid",attrs:{id:"schoolRole-page"}},[s("div",{staticClass:"row text-center"},[s("v-table",{attrs:{title:e.translate.tableTitle,url:e.url+e.timestamp,pagesize:"10",idField:"id",order:!0,columns:e.columns}},[s("div",{staticClass:"btn-group pull-right",attrs:{slot:"btn-group",role:"group"},slot:"btn-group"},[s("button",{staticClass:"btn batch-add-btn btn-bgColor-style clearBtnBorder",attrs:{type:"button"},on:{click:function(t){return e._showAddRoleModal("add")}}},[e._v("新增角色")]),e._v(" "),s("button",{staticClass:"btn clearBtnBorder",attrs:{type:"button"},on:{click:function(t){return e.exchangeDimension()}}},[e._v(e._s(e.buttonText))])])])],1),e._v(" "),s("v-modal",{attrs:{show:e.showNewRoleBox,effect:"fade",width:"850"}},[s("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[s("h5",{staticClass:"modal-title"},[e._v("\n        自定义角色\n      ")])]),e._v(" "),s("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[s("div",{staticClass:"form-group"},[s("label",{staticClass:"input-label"},[e._v("角色名称：")]),e._v(" "),s("el-input",{staticClass:"w400",attrs:{maxlength:"40",placeholder:"请输入角色名称"},model:{value:e.newCustomRole.name,callback:function(t){e.$set(e.newCustomRole,"name",t)},expression:"newCustomRole.name"}})],1),e._v(" "),s("div",{staticClass:"form-group"},[s("div",{staticClass:"form-group"},[s("label",{staticClass:"input-label"},[e._v("角色说明：")]),e._v(" "),s("el-input",{staticClass:"w400",attrs:{maxlength:"40",placeholder:"请输入角色说明"},model:{value:e.newCustomRole.remark,callback:function(t){e.$set(e.newCustomRole,"remark",t)},expression:"newCustomRole.remark"}})],1)]),e._v(" "),s("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.newCustomRole.systems,function(t,a){return s("el-tab-pane",{key:a,attrs:{label:t.title,name:t.name}},[s("el-radio-group",{staticStyle:{"padding-left":"10px"},on:{change:function(s){return e.radioChange(s,t)}},model:{value:t.role,callback:function(s){e.$set(t,"role",s)},expression:"tab.role"}},[s("el-radio",{attrs:{label:"admin"},nativeOn:{click:function(s){return s.preventDefault(),e.radioClick("admin",t)}}},[e._v("系统管理员")]),e._v(" "),e.filterSys(t.name)?s("el-radio",{attrs:{label:"normal"},nativeOn:{click:function(s){return s.preventDefault(),e.radioClick("normal",t)}}},[e._v("普通用户")]):e._e(),e._v(" "),"normal"===t.role&&t.menus&&t.menus.length>0?s("el-tree",{attrs:{data:t.menus,"show-checkbox":"","node-key":"id","default-expanded-keys":e.expandedList,"default-checked-keys":t.checkedList,props:e.defaultProps},on:{check:e.handleTreeCheck}}):e._e()],1)],1)}),1)],1),e._v(" "),s("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[s("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(t){e.showNewRoleBox=!1}}},[e._v(e._s(e.translate.cancel))]),e._v(" "),s("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:e.addRole}},[e._v("确定")])])]),e._v(" "),s("v-modal",{attrs:{show:e.showUserModal,effect:"fade",width:"420"}},[s("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[s("h5",{staticClass:"modal-title"},[e._v("\n        "+e._s(e.translate.user)+"\n      ")])]),e._v(" "),s("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.newRoleUser.roleId,expression:"newRoleUser.roleId"}],attrs:{type:"hidden",id:"role-id"},domProps:{value:e.newRoleUser.roleId},on:{input:function(t){t.target.composing||e.$set(e.newRoleUser,"roleId",t.target.value)}}}),e._v(" "),s("div",{staticClass:"form-group"},[s("label",{staticClass:"input-label"},[e._v(e._s(e.translate.userNo))]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.newRoleUser.userNo,expression:"newRoleUser.userNo"}],staticClass:"form-control search-input modal-form-style",attrs:{id:"user-no",type:"text",placeholder:e.translate.checkUserTip},domProps:{value:e.newRoleUser.userNo},on:{change:e.checkUser,input:function(t){t.target.composing||e.$set(e.newRoleUser,"userNo",t.target.value)}}}),e._v(" "),s("button",{staticClass:"btn check-btn clearBtnBorder",attrs:{type:"button"},on:{click:e.checkUser}},[e._v(e._s(e.translate.check))]),e._v(" "),s("p",{staticClass:"error-message"},[e._v(e._s(e.errorMessage))])]),e._v(" "),s("div",{staticClass:"form-group"},[s("div",{staticClass:"form-group"},[s("label",{staticClass:"input-label"},[e._v(e._s(e.translate.username))]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.newRoleUser.name,expression:"newRoleUser.name"}],staticClass:"form-control name-input modal-form-style",attrs:{type:"text",readonly:"readonly"},domProps:{value:e.newRoleUser.name},on:{input:function(t){t.target.composing||e.$set(e.newRoleUser,"name",t.target.value)}}}),e._v(" "),s("button",{staticClass:"btn check-btn clearBtnBorder",attrs:{type:"button"},on:{click:e.addNewUser}},[e._v(e._s(e.translate.add))])])]),e._v(" "),s("div",{staticClass:"user-list"},e._l(e.userInfoArr,function(t,a){return s("p",{key:a},[s("span",{staticClass:"user-name"},[e._v(e._s(t.userName))]),e._v(" "),s("i",{staticClass:"maticon pull-right remove-icon",domProps:{innerHTML:e._s(e.icons("cancel"))},on:{click:function(s){return e.removeUser(t.userId)}}},[e._v("cancel")])])}),0)]),e._v(" "),s("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[s("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:e.cancelAddUser}},[e._v(e._s(e.translate.cancel))]),e._v(" "),s("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:e.addUser}},[e._v(e._s(e.translate.submit))])])])],1)},staticRenderFns:[]};var c=s("C7Lr")(i,u,!1,function(e){s("B8lZ"),s("xH2M")},null,null);t.default=c.exports}});