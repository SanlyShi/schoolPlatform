webpackJsonp([33],{B6Gn:function(t,e,a){"use strict";var i=a("C331");e.a={getManagerAuthority:function(t){var e={},a={};if(Object(i.e)({async:!1,url:"/api/currentUser/roles/41/authorities",success:function(t){e=t},error:t}),Object(i.e)({async:!1,url:"/api/currentUser/roles/24/authorities",success:function(t){a=t},error:t}),e.state&&a.state){t(null,e.data||a.data?{data:!0,state:!0}:{data:!1,state:!0})}},getProjectCategories:function(t,e,a){Object(i.e)({url:"/api/iSignIn/projects/projectTypes/list/"+s.changeTabToInterface(t)+"?keyWord="+(e||""),success:function(t){t.state&&(t.data=t.data.map(function(t){return{id:t.id,name:t.typeName}})),a(null,t)},error:a})},getProjectById:function(t,e){Object(i.e)({url:"/api/iSignIn/projects?projectId="+t,success:function(t){t.state&&(t.data=s.getProject(t.data)),e(null,t)},error:e})},getProjectsByCategoryId:function(t,e,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5,r=arguments[5];Object(i.e)({url:"/api/iSignIn/projects/"+t+"/"+e+"?page="+n+"&size="+o+"&keyWord="+(a||""),success:function(t){t.state&&(t.list=(t.data.content||[]).map(s.getProject),t.count=t.data.totalElements,t.totalPages=t.data.totalPages),r(null,t)},error:r})},getProjectPeopleCountByProjectId:function(t,e){Object(i.e)({url:"/api/iSignIn/projects/projectPeoplesCount/"+t,success:function(t){e(null,t)},error:e})},getSignsByProjectId:function(t,e){Object(i.e)({url:"/api/signIns/list/"+t,success:function(t){t.state&&(t.data=t.data.map(s.getSign)),e(null,t)},error:e})},getSignById:function(t,e){Object(i.e)({url:"/api/signIns/"+t,success:function(t){t.state&&(t.data=s.getSign(t.data)),e(null,t)},error:e})},getMySignsByProjectId:function(t,e){Object(i.e)({url:"/api/signIns/my/"+t,success:function(t){t.state&&(t.data=t.data.map(s.getSign)),e(null,t)},error:e})},addCategory:function(t,e){Object(i.e)({url:"/api/iSignIn/projects/projectTypes",type:"post",data:{typeName:t},success:function(t){t.state&&(t.data={id:t.data.id,name:t.data.typeName}),e(null,t)},error:e})},addProject:function(t,e){Object(i.e)({url:"/api/iSignIn/projects",type:"post",data:t,success:function(t){t.state&&(t.data=s.getProject(t.data)),e(null,t)},error:e})},editProject:function(t,e){Object(i.e)({url:"/api/iSignIn/projects/update",type:"post",data:{projectId:t.id,projectName:t.name,projectTypeId:t.categoryId},success:function(t){return e(null,t)},error:e})},editCategory:function(t,e){Object(i.e)({url:"/api/iSignIn/projects/projectTypes/"+t.id,type:"post",data:{typeName:t.name},success:function(t){return e(null,t)},error:e})},setProjectProxy:function(t,e,a){Object(i.e)({url:"/api/iSignIn/projects/projectAgents/"+t,type:"post",data:e,success:function(t){return a(null,t)},error:a})},editSign:function(t,e){var a="SCAN";t.signWay===t.signWays.location&&(a="LOCATION"),t.signWay===t.signWays.outside&&(a="OUTSIDE");var s={signInId:t.signId,projectId:t.projectId,checkInType:t.checkInType,frequency:t.selectType,hourStart:t.startTimeToHours,hourEnd:t.endTimeToHours,signInName:t.name,timeStart:t.startTime,timeEnd:t.endTime,weekDay:t.weekDay,useDynamicCode:t.useDynamicCode,signInType:a,isLocation:t.scanQrcodeWithLocation,signInRange:(t.signWay===t.signWays.qrcode?t.qrcodeLocations:t.locations).map(function(t){return{address:t.address,distance:t.radius,longitude:t.lng,latitude:t.lat}})};"single"===s.checkInType&&(s.frequency=null),Object(i.e)({url:"/api/signIns/update",type:"post",data:s,success:function(t){return e(null,t)},error:e})},getLimitConditions:function(t){Object(i.e)({url:"/api/iSignIn/projects/peopleLimit/conditions",success:function(e){return t(null,e)},error:t})},setLimitType:function(t,e,a,s){(a=a||{}).studentStatus=a.inSchoolStatus,"0"!==a.grade&&0!=a.grade||(a.grade=null),"0"!==a.educationLevel&&0!=a.educationLevel||(a.educationLevel=null),"0"!==a.currentSchoolStatus&&0!=a.currentSchoolStatus||(a.currentSchoolStatus=null),"0"!==a.inSchoolStatus&&0!=a.inSchoolStatus||(a.inSchoolStatus=null),"0"!==a.studentStatus&&0!=a.studentStatus||(a.studentStatus=null),Object(i.e)({url:"/api/iSignIn/projects/peopleLimit/"+t+"/"+e,type:"post",data:a,success:function(t){return s(null,t)},error:s})},addSign:function(t,e){var a="SCAN";t.signWay===t.signWays.location&&(a="LOCATION"),t.signWay===t.signWays.outside&&(a="OUTSIDE");var n={projectId:t.projectId,signInName:t.name,timeStart:t.startTime,timeEnd:t.endTime,useDynamicCode:t.useDynamicCode,signInType:a,isLocation:t.scanQrcodeWithLocation,signInRange:(t.signWay===t.signWays.qrcode?t.qrcodeLocations:t.locations).map(function(t){return{address:t.address,distance:t.radius,longitude:t.lng,latitude:t.lat}})};("single"==t.checkInType||"loop"==t.checkInType&&"day"==t.selectType)&&(n.hourStart=t.startTimeToHours+":00",n.hourEnd=t.endTimeToHours+":00"),"loop"==t.checkInType&&(n.weekDay=t.weekDay,n.frequency=t.selectType),Object(i.e)({url:"/api/signIns",type:"post",data:n,success:function(t){t.state&&(t.data=s.getSign(t.data)),e(null,t)},error:e})},addSignPeople:function(t,e,a,s){Object(i.e)({url:"/api/signIns/peoples",type:"post",data:{signInId:e,projectId:t,userId:a},success:function(t){return s(null,t)},error:s})},checkUserNo:function(t,e){Object(i.e)({url:"/api/users/"+t,type:"get",success:function(t){return e(null,t)},error:e})},deleteSign:function(t,e){Object(i.e)({url:"/api/signIns/"+t,type:"post",success:function(t){return e(null,t)},error:e})},signManual:function(t){Object(i.e)({url:"/api/signIns/signInStatus",type:"post",data:{signInId:t.signId,userId:t.userId,remark:t.remark,createDate:t.createDate},success:function(e){return t.callback(null,e)},error:t.callback})},removePersonFromSign:function(t,e,a,s){var n="";n=a?"/api/signIns/peoples/"+t+"/"+e+"?createDate="+a:"/api/signIns/peoples/"+t+"/"+e,Object(i.e)({url:n,type:"post",success:function(t){return s(null,t)},error:s})},getMyProxies:function(t,e){Object(i.e)({url:"/api/signIns/"+t+"/agents",type:"get",success:function(t){e(null,t)},error:e})},getBaseSearchOptions:function(t){Object(i.e)({url:"/api/colleges",type:"get",success:function(e){t(null,e)},error:t})},getProxySettings:function(t,e){Object(i.e)({url:"/api/iSignIn/projects/list/agents/"+t,type:"get",success:function(t){e(null,t)},error:e})},createSignUrl:function(t,e,a,s,n,o){Object(i.e)({url:"/api/signIns/"+t+"/signInUrl",type:"post",data:{distribution:e,collegeCode:a,classId:s,expireTime:n},success:function(t){o(null,t)},error:o})},getGeneralSignStat:function(t,e,a,s){Object(i.e)({url:"/api/signInStatistics/overviews/"+t+"?startTime="+e+"&endTime="+a,type:"get",success:function(t){return s(null,t)},error:s})},getSignStatByType:function(t,e,a,s,n){Object(i.e)({url:"/api/signInStatistics/statistics/"+t+"/"+e+"?startTime="+a+"&endTime="+s,type:"get",success:function(t){return n(null,t)},error:n})},exportSignsOfManage:function(t,e,a,i,s,n){window.location.href="/downloads/signIns/peoples/excel/MANAGE?signInId="+t+"&name="+(e||"")+"&userNo="+(a||"")+"&college="+(i||"")+"&signInStatus="+(s||"")+"&classId="+(n||"")},exportSignsOfProxy:function(t,e,a,i,s,n,o,r,l){window.location.href="/downloads/signIns/"+t+"/people/excel?signInId="+t+"&startTime="+(l?l[0]:"")+"&endTime="+(l?l[1]:"")+"&agentId="+e+"&name="+(a||"")+"&userNo="+(i||"")+"&collegeCode="+(s||"")+"&classId="+(n||"")+"&status="+(o||"")+"&filename="+r}};var s={getProject:function(t){return{classIds:t.classIds,colleges:t.colleges,classNames:t.classNames,collegeNames:t.collegeNames,checkInType:t.checkInType,id:t.projectId,name:t.projectName,categoryId:t.projectTypeId,categoryName:t.projectTypeName,limitListOfPeople:t.limitListOfPeople,peopleCount:t.projectPeopleCount,educationLevel:t.educationLevel,educationLevelLabel:t.educationLevelName,grade:t.grade,level:t.level,inSchoolStatus:t.studentStatus,currentSchoolStatus:t.currentSchoolStatus,peopleLoading:!0,signs:{init:!1,loading:!1,list:[]}}},getSign:function(t){var e="qrcode";"LOCATION"===t.signInType&&(e="location"),"OUTSIDE"===t.signInType&&(e="outside");var a={id:t.signInId,name:t.signInName,projectId:t.projectId,startTime:t.timeStart,endTime:t.timeEnd,useDynamicCode:t.useDynamicCode,signInStatus:t.signInStatus,signWay:e,scanQrcodeWithLocation:t.isLocation,qrcodeLocations:[],locations:[],frequency:t.frequency,checkInType:t.checkInType,weekDay:t.weekDay,hourEnd:t.hourEnd,hourStart:t.hourStart},i=t.signInRange.map(function(t){return{address:t.address,radius:t.distance,lng:t.longitude,lat:t.latitude,init:!0,showMap:!1}});return"SCAN"===t.signInType?a.qrcodeLocations=i:a.locations=i,a},changeTabToInterface:function(t){return{ALL:"ALL",MANAGE:"MANAGE",PROXY:"AGENT",MINE:"MY"}[t]}}},FSXf:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("kV13"),s=a("HzJ8"),n=a.n(s),o=a("qqHy"),r=a.n(o),l=a("C331"),c=a("B6Gn"),d=a("gvMr"),u=(Number,String,String,{props:{projectId:Number,projectName:String,projectLevel:String},data:function(){return{loader:d.a,departmentId:1,positionLeft:null,players:[],distributaryData:[{id:"bySchool",name:"全校统一管理"},{id:"byClass",name:"以班级分配"},{id:"byTeacher",name:"以带生关系分配"},{id:"byCollege",name:"以学院关系分配"}],scrollAreaHeight:"",noRoleSetAfaterHeight:"",newAuthorityMaxHeight:"",roleSetContentHeight:"",hasError:!0,loading:!0,roleList:[],batchCheck:"",roleEditing:!1,curNode:{distributary:"",operators:[],dataAuthorities:[{authority:null}]},curLink:{},otherLink:{nextNodeId:""},curForm:{formSettingId:"",formSettingName:""},isApplyNode:!1,isChange:!1,isSelectBatchSet:!1,nameIsNull:!0,ownerContentHeight:0,lang:"zh-cn"}},computed:{translate:function(){return Object(l.g)(this.lang).joinRoleSetManage},setColStyle:function(){return this.players.length<=1?{"text-align":"center","padding-left":"105px"}:{"text-align":"left","padding-left":"0"}}},watch:{},created:function(){var t=this;if(!this.projectId)return this.$toast("sorry, something went wrong! [110]");"SCHOOL"==this.projectLevel?this.distributaryData=[{id:"bySchool",name:"全校统一管理"},{id:"byClass",name:"以班级分配"},{id:"byTeacher",name:"以带生关系分配"},{id:"byCollege",name:"以学院关系分配"}]:"COLLEGE"==this.projectLevel&&(this.distributaryData=[{id:"byClass",name:"以班级分配"},{id:"byTeacher",name:"以带生关系分配"}]);var e=localStorage.getItem("lang");Object(l.g)(e)&&(this.lang=e),this.distributaryData.forEach(function(e,a){e.name=t.translate.distributaryData[e.id]}),c.a.getProxySettings(this.projectId,function(e,a){if(e)return t.$toast("网络错误");if(!a.state)return t.$toast(a.message);var i={SCHOOL:"bySchool",COLLEGE:"byCollege",RELATIONSHIP:"byTeacher",CLASS:"byClass"};t.players=a.data.map(function(e){var a=t.getNewPlayerTemplate();return a.id=e.projectAgentId,a.name=e.agentName,a.distributary=i[e.powerModeOfDistribution],a.roles=e.agentRoleId,a.roleCount=a.roles.length,a});var s=!0,o=!1,r=void 0;try{for(var l,c=n()(t.players);!(s=(l=c.next()).done);s=!0){var d=l.value;t._initRoleList(d)}}catch(e){o=!0,r=e}finally{try{!s&&c.return&&c.return()}finally{if(o)throw r}}t.players.length||t._addPlayer(),t.loading=!1})},mounted:function(){},methods:{getNewPlayerTemplate:function(){return{id:null,name:null,distributary:"bySchool",selectDistributary:"bySchool",roles:[],roleEditing:!1,newRoleName:null,roleAddErrorMsg:null,nameErrorMsg:null,roleCount:0,roleSetData:[],_id:"player_"+(new Date).getTime()}},_addPlayer:function(){if(4==this.players.length)return this.$toast("设置的代理已经包括所有的代理权分配方式，不可再新增");var t=this.getNewPlayerTemplate(),e={bySchool:!1,byCollege:!1,byTeacher:!1,byClass:!1},a=!0,i=!1,s=void 0;try{for(var o,r=n()(this.players);!(a=(o=r.next()).done);a=!0){e[o.value.distributary]=!0}}catch(t){i=!0,s=t}finally{try{!a&&r.return&&r.return()}finally{if(i)throw s}}var l=null;for(var c in e)if(!e[c]){l=c;break}t.distributary=l,t.selectDistributary=l,this.players.push(t),this._initRoleList(t,this.players.length-1)},_changePlayerName:function(t){var e=!1,a=!0,i=!1,s=void 0;try{for(var o,r=n()(this.players);!(a=(o=r.next()).done);a=!0){var l=o.value;l._id!==t._id&&(l.name===t.name&&(t.nameErrorMsg="该代理名称已存在",e=!0))}}catch(t){i=!0,s=t}finally{try{!a&&r.return&&r.return()}finally{if(i)throw s}}e||(t.nameErrorMsg=null)},_afterSelectedDistributary:function(t){var e=parseInt(t.target.$attrs["data-index"]),a=this.players[e];if(a.distributary!=t.val){var i=!1,s=null,o=!0,r=!1,l=void 0;try{for(var c,d=n()(this.players);!(o=(c=d.next()).done);o=!0){var u=c.value;u.distributary==t.val&&(i=!0,s=u)}}catch(t){r=!0,l=t}finally{try{!o&&d.return&&d.return()}finally{if(r)throw l}}if(i)return this.$toast("该代理分配方式已被代理("+(s.name||"该代理未设置名称")+")占用"),void(a.selectDistributary=a.distributary);a.roleEditing=!1,t.val?(a.distributary=t.val,a.roles=[],a.roleCount=0,this._initRoleList(a,e)):a.distributary=""}},_initRoleList:function(t,e){var a=this;"bySchool"===t.distributary||"byCollege"===t.distributary?Object(l.e)({url:"/api/approveRoles",type:"get",data:{level:"bySchool"===t.distributary?"SCHOOL":"COLLEGE",departmentId:this.departmentId},success:function(e){if(e.state){t.roleSetData=e.data.reverse();var i=null;i&&clearTimeout(i),i=setTimeout(function(){var t=r()(".col").height().toFixed(1);a.roleSetContentHeight=t-268,a.scrollAreaHeight=t-218,a.noRoleSetAfaterHeight=t-170,a.newAuthorityMaxHeight=t-83},300)}else a.$toast(e.message)}}):"byClass"===t.distributary&&Object(l.e)({url:"/api/relClass/classCommittees",type:"get",success:function(e){if(e.state){e.data.forEach(function(t){t.name=t.text}),t.roleSetData=e.data.reverse();var i=null;i&&clearTimeout(i),i=setTimeout(function(){var t=r()(".col").height().toFixed(1);a.roleSetContentHeight=t-268,a.scrollAreaHeight=t-218,a.noRoleSetAfaterHeight=t-170,a.newAuthorityMaxHeight=t-83},300)}else alert(e.message)}})},_addOrDeleteRoleToPlayer:function(t,e){var a=e.roles.indexOf(parseInt(t.id));a>=0?e.roles.splice(a,1):e.roles.push(parseInt(t.id)),this.countSelectedRoles(e)},_batchChangeSelectedRoles:function(t){if(t.roleCount==t.roleSetData.length)return t.roleCount=0,void(t.roles=[]);t.roles=t.roleSetData.map(function(t){return parseInt(t.id)}),t.roleCount=t.roleSetData.length},countSelectedRoles:function(t){return t.roleCount=0,t.roleSetData.forEach(function(e){t.roles.indexOf(parseInt(e.id))>=0&&t.roleCount++}),t.roleCount},_creatNewRole:function(t,e){t.roleEditing=!0,t.newRoleName=this.projectName+("bySchool"===t.distributary?"校级":"院级")+"管理员",r()("#roleContent"+e).animate({scrollTop:"0px"},300)},_saveNewRole:function(t){var e=this,a=t.newRoleName;t.roleAddErrorMsg="",a&&""!==a.replace(/\s/g,"")?t.roleSetData.forEach(function(e){a===e.name&&(t.roleAddErrorMsg&&(t.roleAddErrorMsg+=","),t.roleAddErrorMsg+="该角色已存在")}):t.roleAddErrorMsg="角色名不能为空",t.roleAddErrorMsg?setTimeout(function(){t.roleAddErrorMsg=""},1500):Object(l.e)({url:"/api/approveRoles",type:"post",data:{name:a,level:"bySchool"===t.distributary?"SCHOOL":"COLLEGE",departmentId:this.departmentId},success:function(i){i.state?(t.roleSetData.unshift({id:i.data,name:a}),t.roles.push(parseInt(i.data)),t.roleEditing=!1):e.$toast(i.message)}})},_back:function(){if(!this.nameIsNull)return!1;this.$emit("back")},_saveJoinSet:function(){var t=this,e=[],a=!0,i="",s={bySchool:"SCHOOL",byCollege:"COLLEGE",byTeacher:"RELATIONSHIP",byClass:"CLASS"},o=!0,r=!1,l=void 0;try{for(var d,u=n()(this.players);!(o=(d=u.next()).done);o=!0){var h=d.value;h.name||(i+="您还有代理名称还未填写; ",a=!1),"bySchool"!=h.distributary&&"byCollege"!=h.distributary||h.roles.length||(i+=(h.name||"[未设置名称]")+"未选择角色; "),e.push({projectAgentId:h.id,projectId:this.projectId,powerModeOfDistribution:s[h.distributary],agentName:h.name,agentRoleId:h.roles})}}catch(t){r=!0,l=t}finally{try{!o&&u.return&&u.return()}finally{if(r)throw l}}if(!a)return this.$toast(i);c.a.setProjectProxy(this.projectId,e,function(e,a){return e?t.$toast("网络错误"):a.state?(t.$toast("设置代理成功"),void t.$emit("back")):t.$toast(a.message)})},_deletePlayers:function(t){this.players.splice(t,1)},_newRowInputFocus:function(t){this.players[t].newRoleName=this.appName+this.players[t].palyerForm.name+"管理员"}},destroyed:function(){}}),h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container-fluid",attrs:{id:"proxy-settings"}},[a("div",{staticClass:"head text-center"},[a("div",{staticClass:"pull-left back-div"},[a("i",{staticClass:"maticon",domProps:{innerHTML:t._s(t.icons("arrow_back"))},on:{click:t._back}},[t._v("arrow_back")])]),t._v(" "),a("div",{staticClass:"pull-right opt-div"},[a("a",{staticClass:"opt-btn",attrs:{href:"javascript:;"},on:{click:t._back}},[t._v("取消")]),t._v(" "),a("button",{staticClass:"btn save",on:{click:t._saveJoinSet}},[t._v("保存")])])]),t._v(" "),t.loading?a("div",{staticClass:"loading-players loader",domProps:{innerHTML:t._s(t.loader.icon+"正在加载代理设置...")}}):a("div",{staticClass:"joinSet-content"},[a("div",{staticClass:"info-container",style:t.setColStyle},[t._l(t.players,function(e,i){return a("div",{key:i,staticClass:"col other-col"},[a("div",{staticClass:"form-group"},[a("i",{staticClass:"maticon pull-left app-icon black-color",domProps:{innerHTML:t._s(t.icons("label"))}},[t._v("label")]),t._v(" "),a("div",{staticClass:"form-group-input pull-left "},[a("label",{staticClass:"name-label light-black-color"},[t._v("名称")]),t._v(" "),a("i",{staticClass:"maticon pull-right more-icon black-color dropdown-toggle",attrs:{"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"true"},domProps:{innerHTML:t._s(t.icons("more_vert"))}},[t._v("more_vert")]),t._v(" "),a("ul",{staticClass:"dropdown-menu more-opt-menu"},[a("li",{on:{click:function(e){return t._deletePlayers(i)}}},[a("a",{attrs:{href:"#"}},[t._v("删除")])])]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"player.name"}],staticClass:"form-control name-input border-bottom-blue black-color",attrs:{type:"text",placeholder:"请输入代理者名称",maxlength:"15"},domProps:{value:e.name},on:{change:function(a){return t._changePlayerName(e)},input:function(a){a.target.composing||t.$set(e,"name",a.target.value)}}}),t._v(" "),e.nameErrorMsg?a("p",{staticClass:"name-error-tip text-center"},[t._v(t._s(e.nameErrorMsg))]):t._e()])]),t._v(" "),a("div",{staticClass:"form-group"},[a("i",{staticClass:"maticon pull-left app-icon black-color",domProps:{innerHTML:t._s(t.icons("call_split"))}},[t._v("call_split")]),t._v(" "),a("div",{staticClass:"form-group-input pull-left "},[a("label",{staticClass:"name-label light-black-color"},[t._v("代理权分配方式")]),t._v(" "),a("div",{staticClass:"distribution-select"},[a("v-select",{key:i,ref:"distributarySelect",refInFor:!0,attrs:{options:t.distributaryData,"options-value":"id","options-label":"name","data-index":i,required:!0},on:{afterSelected:t._afterSelectedDistributary},model:{value:e.selectDistributary,callback:function(a){t.$set(e,"selectDistributary",a)},expression:"player.selectDistributary"}})],1)])]),t._v(" "),"byTeacher"!==e.distributary&&""!=e.distributary?a("div",{staticClass:"form-group clear-padding-bottom clear-bord-bottom"},[a("div",{staticClass:"role-set-head"},[a("i",{staticClass:"maticon pull-left app-icon black-color",domProps:{innerHTML:t._s(t.icons("people"))}},[t._v("people")]),t._v(" "),a("div",{staticClass:"form-group-input pull-left ",staticStyle:{height:"35px"}},[a("label",{staticClass:"name-label light-black-color"},[t._v("角色设置")]),t._v(" "),"byClass"===e.distributary||e.roleEditing?t._e():a("span",{staticClass:"creat-new-role blue-color",on:{click:function(a){return t._creatNewRole(e,i)}}},[t._v("创建新的角色")])])])]):t._e(),t._v(" "),a("div",{staticClass:"scroll-area",style:{height:"byTeacher"!==e.distributary&&""!=e.distributary?t.scrollAreaHeight+"px":t.noRoleSetAfaterHeight+"px"},attrs:{id:"scrollArea"+i,"data-id":i}},["byTeacher"!==e.distributary&&""!=e.distributary?a("div",{staticClass:"form-group clear-padding-bottom"},[a("div",{staticClass:"role-set-content",style:"max-height:"+t.roleSetContentHeight+"px",attrs:{id:"roleContent"+i}},[e.roleEditing?a("div",{staticClass:"creat-role-input"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.newRoleName,expression:"player.newRoleName"},{name:"focus",rawName:"v-focus"}],staticClass:"form-control name-input border-bottom-blue black-color padding-right-70px",attrs:{type:"text",maxlength:"20",placeholder:"请输入角色名称"},domProps:{value:e.newRoleName},on:{input:function(a){a.target.composing||t.$set(e,"newRoleName",a.target.value)}}}),t._v(" "),a("div",{staticClass:"pull-right creat-btn-group"},[a("button",{staticClass:"btn creat-cancle clearBtnBorder",on:{click:function(t){e.roleEditing=!1}}},[t._v("取消")]),t._v(" "),a("button",{staticClass:"btn creat-sure blue-color clearBtnBorder",on:{click:function(a){return t._saveNewRole(e)}}},[t._v("确定")])]),t._v(" "),e.roleEditing?a("p",{staticClass:"errorMsg",class:{show:e.roleAddErrorMsg}},[t._v(t._s(e.roleAddErrorMsg))]):t._e()]):t._e(),t._v(" "),a("div",{staticClass:"role-list",attrs:{id:"roleList"+i}},[a("div",{staticClass:"role-list-item margin-bottom-5px"},[a("div",{staticClass:"margin-left-70px"},[a("div",{staticClass:"input-group"},[a("span",{on:{click:function(a){return t._batchChangeSelectedRoles(e)}}},[0===e.roleCount?a("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:t._s(t.icons("check_box_outline_blank"))}},[t._v("check_box_outline_blank")]):e.roleCount===e.roleSetData.length?a("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:t._s(t.icons("check_box"))}},[t._v("check_box")]):a("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:t._s(t.icons("indeterminate_check_box"))}},[t._v("indeterminate_check_box")])]),t._v(" "),a("span",{staticClass:"role-name light-black-color"},[t._v("全选")])])])]),t._v(" "),t._l(e.roleSetData,function(i,s){return a("div",{key:s,staticClass:"role-list-item"},[a("div",{staticClass:"margin-left-70px"},[a("div",{staticClass:"input-group"},[a("span",{on:{click:function(a){return t._addOrDeleteRoleToPlayer(i,e)}}},[e.roles.indexOf(parseInt(i.id))>=0?a("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:t._s(t.icons("check_box"))}},[t._v("check_box")]):a("i",{staticClass:"maticon role-icon light-black-color",domProps:{innerHTML:t._s(t.icons("check_box_outline_blank"))}},[t._v("check_box_outline_blank")])]),t._v(" "),a("span",{staticClass:"role-name",class:e.roles.indexOf(parseInt(i.id))>=0?"black-color":"light-black-color",attrs:{title:i.name}},[t._v(t._s(i.name))])])])])})],2)])]):t._e()])])}),t._v(" "),a("div",{staticClass:"add-role"},[a("button",{staticClass:"add-btn clearBtnBorder",on:{click:t._addPlayer}},[t._v("添加代理者")])])],2)])])},staticRenderFns:[]};var g=a("C7Lr")(u,h,!1,function(t){a("y74z")},null,null).exports,p=a("KH7x"),m=a.n(p),f=a("aA9S"),v=a.n(f),y=a("HJbL"),b=a("3cXf"),S=a.n(b),_=(Boolean,Array,String,Number,{name:"ElCollapse",componentName:"ElCollapse",props:{accordion:Boolean,value:{type:[Array,String,Number],default:function(){return[]}}},data:function(){return{activeNames:[].concat(this.value)}},provide:function(){return{collapse:this}},watch:{value:function(t){this.activeNames=[].concat(t)}},methods:{setActiveNames:function(t){t=[].concat(t);var e=this.accordion?t[0]:t;this.activeNames=t,this.$emit("input",e),this.$emit("change",e)},handleItemClick:function(t){if(this.accordion)this.setActiveNames(!this.activeNames[0]&&0!==this.activeNames[0]||this.activeNames[0]!==t.name?t.name:"");else{var e=this.activeNames.slice(0),a=e.indexOf(t.name);a>-1?e.splice(a,1):e.push(t.name),this.setActiveNames(e)}}},created:function(){this.$on("item-click",this.handleItemClick)}}),I={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"el-collapse",attrs:{role:"tablist","aria-multiselectable":"true"}},[this._t("default")],2)},staticRenderFns:[]},w=a("C7Lr")(_,I,!1,null,null,null).exports;var C={methods:{dispatch:function(t,e,a){for(var i=this.$parent||this.$root,s=i.$options.componentName;i&&(!s||s!==t);)(i=i.$parent)&&(s=i.$options.componentName);i&&i.$emit.apply(i,[e].concat(a))},broadcast:function(t,e,a){(function t(e,a,i){this.$children.forEach(function(s){s.$options.componentName===e?s.$emit.apply(s,[a].concat(i)):t.apply(s,[e,a].concat([i]))})}).call(this,t,e,a)}}},T=(a("hRKE"),i.default.prototype.$isServer),M=(T||Number(document.documentMode),function(t){return(t||"").replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,"")});!T&&document.addEventListener,!T&&document.removeEventListener;function x(t,e){if(!t||!e)return!1;if(-1!==e.indexOf(" "))throw new Error("className should not contain space.");return t.classList?t.classList.contains(e):(" "+t.className+" ").indexOf(" "+e+" ")>-1}function N(t,e){if(t){for(var a=t.className,i=(e||"").split(" "),s=0,n=i.length;s<n;s++){var o=i[s];o&&(t.classList?t.classList.add(o):x(t,o)||(a+=" "+o))}t.classList||(t.className=a)}}function k(t,e){if(t&&e){for(var a=e.split(" "),i=" "+t.className+" ",s=0,n=a.length;s<n;s++){var o=a[s];o&&(t.classList?t.classList.remove(o):x(t,o)&&(i=i.replace(" "+o+" "," ")))}t.classList||(t.className=M(i))}}String,String,Number,Number;var L={name:"ElCollapseItem",componentName:"ElCollapseItem",mixins:[C],data:function(){return{contentWrapStyle:{height:"auto",display:"block"},contentHeight:0,focusing:!1,isClick:!1}},inject:["collapse"],props:{title:String,name:{type:[String,Number],default:function(){return this._uid}},itemWrapCorrectionHeight:{type:Number,default:function(){return 0}}},computed:{isActive:function(){return this.collapse.activeNames.indexOf(this.name)>-1},id:function(){return+new Date}},methods:{handleFocus:function(){var t=this;setTimeout(function(){t.isClick?t.isClick=!1:t.focusing=!0},50)},handleHeaderClick:function(){this.dispatch("ElCollapse","item-click",this),this.focusing=!1,this.isClick=!0},handleEnterClick:function(){this.dispatch("ElCollapse","item-click",this)},beforeEnter:function(t){N(t,"collapse-transition"),t.dataset||(t.dataset={}),t.dataset.oldPaddingTop=t.style.paddingTop,t.dataset.oldPaddingBottom=t.style.paddingBottom,t.style.height=0+this.itemWrapCorrectionHeight+"px",t.style.paddingTop=0,t.style.paddingBottom=0},enter:function(t){t.dataset.oldOverflow=t.style.overflow,0!==t.scrollHeight?(t.style.height=t.scrollHeight+"px",t.style.paddingTop=t.dataset.oldPaddingTop,t.style.paddingBottom=t.dataset.oldPaddingBottom):(t.style.height="",t.style.paddingTop=t.dataset.oldPaddingTop,t.style.paddingBottom=t.dataset.oldPaddingBottom),t.style.overflow="hidden"},afterEnter:function(t){k(t,"collapse-transition"),t.style.height="",t.style.overflow=t.dataset.oldOverflow},beforeLeave:function(t){t.dataset||(t.dataset={}),t.dataset.oldPaddingTop=t.style.paddingTop,t.dataset.oldPaddingBottom=t.style.paddingBottom,t.dataset.oldOverflow=t.style.overflow,t.style.height=t.scrollHeight+"px",t.style.overflow="hidden"},leave:function(t){0!==t.scrollHeight&&(N(t,"collapse-transition"),t.style.height=0+this.itemWrapCorrectionHeight+"px",t.style.paddingTop=0,t.style.paddingBottom=0)},afterLeave:function(t){k(t,"collapse-transition"),t.style.height="",t.style.overflow=t.dataset.oldOverflow,t.style.paddingTop=t.dataset.oldPaddingTop,t.style.paddingBottom=t.dataset.oldPaddingBottom}}},D={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"el-collapse-item",class:{"is-active":t.isActive}},[a("div",{attrs:{role:"tab","aria-expanded":t.isActive,"aria-controls":"el-collapse-content-"+t.id,"aria-describedby":"el-collapse-content-"+t.id}},[a("div",{staticClass:"el-collapse-item__header sign_title",class:{focusing:t.focusing,"is-active":t.isActive},attrs:{role:"button",id:"el-collapse-head-"+t.id,tabindex:"0"},on:{click:t.handleHeaderClick,focus:t.handleFocus,keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"space",32,e.key,[" ","Spacebar"])&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.stopPropagation(),t.handleEnterClick(e))},blur:function(e){t.focusing=!1}}},[a("i",{staticClass:"el-collapse-item__arrow maticon",class:{"is-active":t.isActive}},[t._v("expand_more")]),t._v(" "),t._t("title",[t._v(t._s(t.title))])],2)]),t._v(" "),a("transition",{on:{beforeEnter:t.beforeEnter,enter:t.enter,"after-enter":t.afterEnter,"before-leave":t.beforeLeave,leave:t.leave,"after-leave":t.afterLeave}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.isActive,expression:"isActive"}],staticClass:"el-collapse-item__wrap",attrs:{role:"tabpanel","aria-hidden":!t.isActive,"aria-labelledby":"el-collapse-head-"+t.id,id:"el-collapse-content-"+t.id}},[a("div",{staticClass:"el-collapse-item__content"},[t._t("content")],2)])])],1)},staticRenderFns:[]};var A=a("C7Lr")(L,D,!1,function(t){a("vgHG")},null,null).exports,P=a("/LmD"),O=(P.a,y.a,Array,Object,String,Number,Number,Array,Array,Array,Array,Array,Object,Boolean,Object,Boolean,{mixins:[P.a],components:{"el-collapse":w,"el-collapse-item":A,VIcon:y.a},props:{proxyArr:{type:Array,default:function(){return[]}},tabs:Object,curTab:String,activeCategoryId:Number,activeProjectId:Number,categories:{type:Array,default:function(){return[]}},collegeList:{type:Array,default:function(){return[]}},classList:{type:Array,default:function(){return[]}},currentSchoolStatusOptions:{type:Array,default:function(){return[]}},schoolStatusArr:{type:Array,default:function(){return[]}},projects:Object,loading:{type:Boolean,default:!1},limitOptions:Object,hasAuthority:Boolean},data:function(){return{lang:"zh-cn",loader:d.a,peopleConditionsModal:{show:!1,title:"选择条件",grade:"",educationLevel:"",educationLevelLabel:"",inSchoolStatus:"",inSchoolStatusLabel:"",currentSchoolStatus:"",grades:[],gradesMax:10,inSchoolStatusOptions:[{id:"IN_SCHOOL",text:"在校"},{id:"NOT_IN_SCHOOL",text:"不在校"}]},selectLimitOptions:{educationLevel:"",grade:"",inSchoolStatus:"",currentSchoolStatus:"",classIds:"",colleges:""}}},created:function(){var t=window.localStorage.getItem("lang");t&&Object(l.g)(t)&&(this.lang=t);for(var e=(new Date).getFullYear()+1,a=0;a<this.peopleConditionsModal.gradesMax;++a){var i=e--+"";this.peopleConditionsModal.grades.push({id:i,text:i})}},computed:{i18n:function(){return Object(l.g)(this.lang).iSign},isManager:function(){return this.curTab===this.tabs.MANAGE},isMine:function(){return this.curTab===this.tabs.MINE},isProxy:function(){return this.curTab===this.tabs.PROXY},translate:function(){return Object(l.g)(this.lang).infoManage}},methods:{formatterSignWay:function(t){return"outside"===t?"外勤":"location"===t?"定位":"扫码"},execAdvancedSearch:function(){var t=this,e=this.advancedSearch.searchItems.map(function(e){return{key:e.key,relation:e.relation,value:e.value,tableName:t.advancedSearch.optionKeys[e.key].tableName,listValues:e.value?e.value.split(","):[],provinces:e.province?e.province.split(","):[],cities:e.city?e.city.split(","):[],counties:e.county?e.county.split(","):[]}});if(this.searchProject){var a="api/iSignIn/projects/peopleListByAdvancedSearch/"+this.searchProject.id;if(0===e.length)return a="api/iSignIn/projects/peopleLimit/"+this.searchProject.id+"/NOT_LIMIT",Object(l.d)(a,null,"post").then(function(e){e.state&&(t.advancedSearch.show=!1,t.$parent.selectTab(t.curTab))}),!1;Object(l.d)(a,{searchDTOS:e}).then(function(e){e.state&&(t.advancedSearch.show=!1,t.$parent.selectTab(t.curTab))})}},getProjectCollapseItemId:function(t,e){return t.id+"-"+e.id},toEditCategoryName:function(t){this.$emit("to-edit-category-name",t)},toEditProjectName:function(t){this.$emit("to-edit-project-name",t)},toAddSign:function(t){if(!t.limitListOfPeople)return this.$toast("请先设置人员限制");this.$emit("to-add-sign",t)},toProxySettings:function(t){this.$emit("to-proxy-settings",t)},toSignInfo:function(t,e){this.isMine||this.$emit("to-sign-info",{project:t,sign:e})},selectCategory:function(t){t&&this.$emit("select-category",t)},selectProject:function(t){t&&this.$emit("select-project",t)},setLimitType:function(t,e){this.$emit("set-limit-type",{project:t,type:e})},toSelectCondition:function(t){"BY_CONDITIONS"===t.limitListOfPeople?(this.selectLimitOptions=JSON.parse(S()(t)),this.peopleConditionsModal.educationLevel=t.educationLevel?t.educationLevel:0,this.peopleConditionsModal.grade=t.grade?t.grade:0,this.peopleConditionsModal.inSchoolStatus=t.inSchoolStatus?t.inSchoolStatus:0,this.peopleConditionsModal.currentSchoolStatus=t.currentSchoolStatus?t.currentSchoolStatus:0):(this.selectLimitOptions.educationLevel="",this.selectLimitOptions.grade="",this.selectLimitOptions.inSchoolStatus="",this.selectLimitOptions.currentSchoolStatus="",this.selectLimitOptions.colleges="",this.peopleConditionsModal.educationLevel="",this.peopleConditionsModal.grade="",this.peopleConditionsModal.inSchoolStatus="",this.peopleConditionsModal.currentSchoolStatus="",this.peopleConditionsModal.colleges=""),this.peopleConditionsModal.show=!0,this.peopleConditionsModal.project=t},setConditionLimit:function(){this.$emit("set-limit-type",{project:this.peopleConditionsModal.project,type:"BY_CONDITIONS",conditions:{educationLevel:this.peopleConditionsModal.educationLevel,grade:this.peopleConditionsModal.grade,inSchoolStatus:this.peopleConditionsModal.inSchoolStatus,currentSchoolStatus:this.peopleConditionsModal.currentSchoolStatus,educationLevelLabel:this.peopleConditionsModal.educationLevelLabel,inSchoolStatusLabel:this.peopleConditionsModal.inSchoolStatusLabel,classIds:this.selectLimitOptions.classIds,colleges:this.selectLimitOptions.colleges}}),this.peopleConditionsModal.show=!1},selectEducationLevel:function(t){this.peopleConditionsModal.educationLevel=t.val||"",this.$nextTick(function(){this.peopleConditionsModal.educationLevelLabel=t.target&&t.target.selected||"obj.target.selected is null"})},selectGrade:function(t){this.peopleConditionsModal.grade=t.val||""},selectInSchoolStatus:function(t){this.peopleConditionsModal.inSchoolStatus=t.val||"",this.$nextTick(function(){this.peopleConditionsModal.inSchoolStatusLabel=t.target&&t.target.selected||"obj.target.selected is null"})},selectCurrentSchoolStatus:function(t){this.peopleConditionsModal.currentSchoolStatus=t.val||""},deleteSign:function(t,e){window.confirm("确定要删除"+e.name+"吗?")&&this.$emit("delete-sign",{project:t,sign:e})},toImport:function(t){this.$emit("to-import",t)},toImportBai:function(t){this.$emit("to-importBai",t)},getLimitPeopleDesc:function(t){var e=this;if(!t.limitListOfPeople)return this.i18n.peopleRestrition;switch(t.limitListOfPeople){case"NOT_LIMIT":return"无限制";case"BY_CONDITIONS":var a=[];t.educationLevel&&a.push(t.educationLevelLabel),t.colleges&&a.push(t.collegeNames),t.classIds&&a.push(t.classNames),t.grade&&a.push(t.grade+"级"),t.inSchoolStatus&&a.push("IN_SCHOOL"==t.inSchoolStatus?"在校":"不在校"),t.currentSchoolStatus&&t.currentSchoolStatus.split(",").forEach(function(t){e.currentSchoolStatusOptions.forEach(function(e){e.value==t&&a.push(e.label)})}),a.length||a.push("无条件限制");return(a.length>=2?a.join(","):a[0])+"("+t.peopleCount+"人)";case"ALL_SCHOOL":return"全校在校生("+t.peopleCount+"人)";case"ADVANCED_SEARCH":return"高级搜索("+t.peopleCount+"人)";default:return"自定义名单("+t.peopleCount+"人)"}},showMore:function(t){this.$emit("show-more-projects",t)}}}),E={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t.loading?i("div",{staticClass:"empty-categories loader",domProps:{innerHTML:t._s(t.loader.iconWithText)}}):t.hasAuthority?t.categories.length?i("el-collapse",{attrs:{value:t.activeCategoryId,accordion:""},on:{change:t.selectCategory}},t._l(t.categories,function(e,s){return i("el-collapse-item",{key:s,staticClass:"i-sign-category-item",attrs:{name:e.id,itemWrapCorrectionHeight:48}},[i("template",{slot:"title"},[t.isManager?i("div",{staticClass:"category-item-title",on:{click:function(a){return a.stopPropagation(),t.toEditCategoryName(e)}}},[t._v("\n          "+t._s(e.name)+"\n          "),i("span",{staticClass:"edit-mask"},[t._v(".")]),t._v(" "),i("v-icon",{attrs:{name:"edit",title:t.i18n.editName}})],1):i("div",{staticClass:"category-item-title"},[t._v(t._s(e.name))])]),t._v(" "),i("template",{slot:"content"},[t.projects[e.id]?t.projects[e.id].loading?i("div",{staticClass:"empty-projects loader",domProps:{innerHTML:t._s(t.loader.iconWithText)}}):t.projects[e.id].list.length?i("el-collapse",{attrs:{value:t.activeProjectId,accordion:""},on:{change:t.selectProject}},[t._l(t.projects[e.id].list,function(s,n){return i("el-collapse-item",{key:n,staticClass:"i-sign-project-item",attrs:{name:t.getProjectCollapseItemId(e,s)}},[i("template",{slot:"title"},[i("div",{staticClass:"project-name-container box_flex align_center"},[i("div",{staticClass:"project-name"},[t._v(t._s(s.name))]),t._v(" "),t.isManager?i("div",{staticClass:"project-edit",on:{click:function(e){return e.stopPropagation(),t.toEditProjectName(s)}}},[i("v-icon",{attrs:{name:"edit",title:t.i18n.editName}})],1):t._e(),t._v(" "),"single"===s.checkInType?i("div",{staticClass:"check_type single"},[t._v("单次")]):t._e(),t._v(" "),"loop"===s.checkInType?i("div",{staticClass:"check_type loop"},[t._v("考勤")]):t._e()]),t._v(" "),t.isManager?i("div",{staticClass:"project-actions box_flex flex_between"},[i("div",{staticClass:"people-restration"},[i("button",{staticClass:"btn btn-primary clearBtnBorder",attrs:{type:"button"},on:{click:function(t){t.stopPropagation()}}},[i("span",{domProps:{innerHTML:t._s(s.peopleLoading?t.loader.small:t.getLimitPeopleDesc(s))}})]),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("ul",{staticClass:"list-popper"},[i("li",{on:{click:function(e){return e.stopPropagation(),t.setLimitType(s,"NOT_LIMIT")}}},[t._v("无限制")]),t._v(" "),i("li",{on:{click:function(e){return e.stopPropagation(),t.toSelectCondition(s)}}},[t._v("按条件筛选")]),t._v(" "),t.proxyArr[n]&&t.proxyArr[n].level&&"SCHOOL"==t.proxyArr[n].level?i("li",{on:{click:function(e){return e.stopPropagation(),t.setLimitType(s,"ALL_SCHOOL")}}},[t._v("全校在校生")]):t._e(),t._v(" "),i("li",{on:{click:function(e){return e.stopPropagation(),t.toImport(s)}}},[t._v("自定义名单导入")]),t._v(" "),t.proxyArr[n]&&t.proxyArr[n].level&&"SCHOOL"==t.proxyArr[n].level?i("li",{on:{click:function(e){return e.stopPropagation(),t.toImportBai(s)}}},[t._v("排除人员名单")]):t._e(),t._v(" "),i("li",{on:{click:function(e){return e.stopPropagation(),t.showSearch(s)}}},[t._v("高级搜索")])])])],1),t._v(" "),i("button",{staticClass:"btn btn-primary clearBtnBorder",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),t.toProxySettings(s)}}},[t._v("\n                  "+t._s(t.i18n.proxySettings)+"\n                ")]),t._v(" "),i("button",{staticClass:"btn btn-primary clearBtnBorder",attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),t.toAddSign(s)}}},[t._v("\n                  "+t._s(t.i18n.addSign)+"\n                ")])]):t._e()]),t._v(" "),i("template",{slot:"content"},[i("div",{staticClass:"signs"},[s.signs?s.signs.loading?i("div",{staticClass:"empty-signs loader",domProps:{innerHTML:t._s(t.loader.iconWithText)}}):s.signs.list.length?t._l(s.signs.list,function(e,n){return i("div",{key:n,staticClass:"sign box_flex align_center",class:{"sign-hover":!t.isMine,"sign-success":"SIGN"==e.signInStatus||"MANUAL_ENTRY"==e.signInStatus,"sign-failed":"TIME_OUT_NOT_SIGN"==e.signInStatus,"sign-without-icon":t.isProxy},on:{click:function(a){return t.toSignInfo(s,e)}}},[t._v("\n                  "+t._s(e.name)+"\n                  "),i("div",{staticClass:"status_wrap box_flex flex_center",class:e.signWay},["location"===e.signWay?i("img",{attrs:{src:a("G9CJ"),alt:""}}):t._e(),t._v(" "),"qrcode"===e.signWay?i("img",{attrs:{src:a("m+ur"),alt:""}}):t._e(),t._v(" "),"outside"===e.signWay?i("img",{attrs:{src:a("zDMS"),alt:""}}):t._e(),t._v("\n                    "+t._s(t.formatterSignWay(e.signWay))+"\n                  ")]),t._v(" "),t.isManager?i("v-icon",{staticClass:"sign-status-icon delete-sign",attrs:{name:"delete"},nativeOn:{click:function(a){return a.stopPropagation(),t.deleteSign(s,e)}}}):t._e(),t._v(" "),!t.isMine||"SIGN"!=e.signInStatus&&"MANUAL_ENTRY"!=e.signInStatus?t.isMine&&"TIME_OUT_NOT_SIGN"==e.signInStatus?i("v-icon",{staticClass:"sign-status-icon",attrs:{name:"clear"}}):t._e():i("v-icon",{staticClass:"sign-status-icon",attrs:{name:"done"}})],1)}):i("div",{staticClass:"empty-signs"},[t._v(t._s(t.isManager?"该项目下没有签到":"暂无签到"))]):i("div",[t._v("nothing here")])],2)])],2)}),t._v(" "),t.projects[e.id].hasMore&&!t.projects[e.id].pageLoading?i("div",{staticClass:"show-more",on:{click:function(a){return t.showMore(e)}}},[t._v("查看更多")]):t._e(),t._v(" "),t.projects[e.id].pageLoading?i("div",{staticClass:"page-loading loader",domProps:{innerHTML:t._s(t.loader.iconWithText)}}):t._e(),t._v(" "),t.projects[e.id].showNoMoreTip?i("div",{staticClass:"page-loading"},[t._v("已经到底了~")]):t._e()],2):i("div",{staticClass:"empty-projects"},[t._v("暂无签到项目")]):i("div",{staticClass:"empty-projects"},[t._v("nothing here")])],1)],2)}),1):i("div",{staticClass:"empty-categories"},[t._v(t._s("暂无项目分类"))]):i("div",{staticClass:"empty-categories loader"},[t._v("您无管理签到项目的权限")]),t._v(" "),i("v-modal",{attrs:{show:t.advancedSearch.show,effect:"fade",width:"720"}},[i("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[i("h5",{staticClass:"modal-title"},[t._v(t._s(t.translate.advancedSearch))])]),t._v(" "),i("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[t._l(t.advancedSearch.searchItems,function(e,a){return i("div",{key:"search-item-"+a,staticClass:"form-group advancedSearch-group"},[i("v-select",{attrs:{options:t.advancedSearch.columns,value:e.key,search:!0,"data-index":a},on:{afterSelected:t.advancedSearchKeySelected}}),t._v(" "),i("v-select",{attrs:{options:e.options.relation,value:e.relation,search:!0,"data-index":a},on:{afterSelected:t.advancedSearchRelationSelected}}),t._v(" "),e.isDict?i("v-select",{attrs:{options:e.options.dictOptions,value:e.value,optionsLabel:"text",optionsValue:"id",search:!0,multiple:!0,"data-index":a},on:{afterSelected:t.advancedSearchValueSelected}}):t._e(),t._v(" "),e.isAddress?i("v-select",{attrs:{options:e.options.province,value:e.province,optionsLabel:"text",optionsValue:"id",search:!0,multiple:!0,"data-index":a},on:{afterSelected:t.advancedSearchProvinceSelected}}):t._e(),t._v(" "),e.isSelectProvince?i("v-select",{attrs:{options:e.options.city,value:e.city,optionsLabel:"text",optionsValue:"id",search:!0,multiple:!0,"data-index":a},on:{afterSelected:t.advancedSearchCitySelected}}):t._e(),t._v(" "),e.isSelectCity?i("v-select",{attrs:{options:e.options.county,value:e.county,optionsLabel:"text",optionsValue:"id",search:!0,multiple:!0,"data-index":a},on:{afterSelected:t.advancedSearchCountySelected}}):t._e(),t._v(" "),e.isDate?i("v-datepicker",{ref:"datepicker",refInFor:!0,staticClass:"btn-block time-picker value-datepicker",attrs:{value:e.value,clearButton:!1,showTime:!1,"data-index":a},on:{daySelected:t.advancedSearchDateValue}}):t._e(),t._v(" "),e.isInput?i("input",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"searchItem.value"}],staticClass:"value-input",attrs:{type:"text"},domProps:{value:e.value},on:{input:function(a){a.target.composing||t.$set(e,"value",a.target.value)}}}):t._e(),t._v(" "),i("button",{staticClass:"btn deleteBtn clearBtnBorder",attrs:{type:"button","data-index":a},on:{click:function(e){return t.deleteSearchItem(a)}}},[t._v(t._s(t.translate.remove))])],1)}),t._v(" "),i("button",{staticClass:"btn addBtn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){return t.addSearchItem()}}},[t._v(t._s(t.translate.addNew))])],2),t._v(" "),i("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[i("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){return t.resetSearchItem()}}},[t._v(t._s(t.translate.reset))]),t._v(" "),i("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.advancedSearch.show=!1}}},[t._v(t._s(t.translate.cancel))]),t._v(" "),i("button",{staticClass:"btn submit-btn clearBtnBorder",class:{disabled:t.isDisabled},attrs:{type:"button"},on:{click:function(e){return t.execAdvancedSearch()}}},[t._v(t._s(t.translate.search))])])]),t._v(" "),i("v-modal",{attrs:{show:t.peopleConditionsModal.show,effect:"fade",width:"900"}},[i("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[i("h5",{staticClass:"modal-title"},[t._v(t._s(t.peopleConditionsModal.title))])]),t._v(" "),i("div",{staticClass:"modal-body container-fluid",attrs:{slot:"modal-body"},slot:"modal-body"},[i("div",{staticClass:"conditions"},[i("ul",[i("li",[i("label",[t._v("培养层次")]),t._v(" "),i("v-select",{ref:"educationLevel",attrs:{options:t.limitOptions.educationLevel,"options-value":"id","options-label":"text",multiple:!0},on:{afterSelected:t.selectEducationLevel},model:{value:t.selectLimitOptions.educationLevel,callback:function(e){t.$set(t.selectLimitOptions,"educationLevel",e)},expression:"selectLimitOptions.educationLevel"}})],1),t._v(" "),i("li",[i("label",[t._v("学院")]),t._v(" "),i("v-select",{ref:"inSchoolStatus",attrs:{multiple:!0,options:t.collegeList,"options-value":"code","options-label":"name"},model:{value:t.selectLimitOptions.colleges,callback:function(e){t.$set(t.selectLimitOptions,"colleges",e)},expression:"selectLimitOptions.colleges"}})],1),t._v(" "),i("li",[i("label",[t._v("年级")]),t._v(" "),i("v-select",{ref:"grade",attrs:{multiple:!0,options:t.peopleConditionsModal.grades,"options-value":"id","options-label":"text"},on:{afterSelected:t.selectGrade},model:{value:t.selectLimitOptions.grade,callback:function(e){t.$set(t.selectLimitOptions,"grade",e)},expression:"selectLimitOptions.grade"}})],1),t._v(" "),i("li",[i("label",[t._v("班级")]),t._v(" "),i("v-select",{ref:"inSchoolStatus",attrs:{multiple:!0,options:t.classList,"options-value":"id","options-label":"text"},model:{value:t.selectLimitOptions.classIds,callback:function(e){t.$set(t.selectLimitOptions,"classIds",e)},expression:"selectLimitOptions.classIds"}})],1),t._v(" "),i("li",[i("label",[t._v("在校状态")]),t._v(" "),i("v-select",{ref:"inSchoolStatus",attrs:{options:t.schoolStatusArr,"options-value":"value","options-label":"label"},on:{afterSelected:t.selectInSchoolStatus},model:{value:t.selectLimitOptions.inSchoolStatus,callback:function(e){t.$set(t.selectLimitOptions,"inSchoolStatus",e)},expression:"selectLimitOptions.inSchoolStatus"}})],1),t._v(" "),i("li",[i("label",[t._v("学生当前状态")]),t._v(" "),i("v-select",{attrs:{multiple:!0,options:t.currentSchoolStatusOptions,"options-value":"value","options-label":"label"},on:{afterSelected:t.selectCurrentSchoolStatus},model:{value:t.selectLimitOptions.currentSchoolStatus,callback:function(e){t.$set(t.selectLimitOptions,"currentSchoolStatus",e)},expression:"selectLimitOptions.currentSchoolStatus"}})],1)])])]),t._v(" "),i("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[i("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.peopleConditionsModal.show=!1}}},[t._v(t._s(t.i18n.cancel))]),t._v(" "),i("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){return t.setConditionLimit(t.peopleConditionsModal.project)}}},[t._v(t._s(t.i18n.sure))])])])],1)},staticRenderFns:[]};var j=a("C7Lr")(O,E,!1,function(t){a("jCSy")},null,null).exports,B=a("FEOm"),$=a("zKJS"),H=a("7Adc"),q=(y.a,B.a,$.a,Object(l.b)(function(){this.tabsData[this.curTab].init=!1,this.selectTab(this.curTab)},400),{components:{VIcon:y.a,CategoryProjectList:j,Locations:B.a,SignInfoModal:$.a},data:function(){return{proxyArr:[],schoolStatusArr:[{label:"在校",value:"IN_SCHOOL"},{label:"不在校",value:"NOT_IN_SCHOOL"}],lang:"zh-cn",tabs:{ALL:"ALL",MANAGE:"MANAGE",PROXY:"PROXY",MINE:"MINE"},roleList:[],seleced_role:"",collegeList:[],seleced_college:"",keyword:null,curTab:"MANAGE",currentSchoolStatusOptions:[],tabsData:{ALL:{text:null,name:null,loading:!0,init:!1,activeCategoryId:null,activeProjectId:null,categories:[],projects:{},hasAuthority:!1},MANAGE:{text:null,name:null,loading:!0,init:!1,activeCategoryId:null,activeProjectId:null,categories:[],projects:{},hasAuthority:!1},PROXY:{text:null,name:null,loading:!0,init:!1,activeCategoryId:null,activeProjectId:null,categories:[],projects:{},hasAuthority:!1},MINE:{text:null,name:null,loading:!0,init:!1,activeCategoryId:null,activeProjectId:null,categories:[],projects:{},hasAuthority:!1}},userTypes:{ALL:"ALL",MANAGE:"MANAGE",PROXY:"AGENT",MINE:"MY"},newProjectModal:{show:!1,name:null,categoryId:null,projectNameMaxLength:30,categoryNameMaxLength:15,categories:[],showAddCategoryForm:!1,newCategoryName:null},editNameModal:{show:!1,title:null,placeholder:null,maxLength:null,i18n:null,id:null,type:null,name:null,focusInput:!0,category:null,project:null},newSignModal:{show:!1,name:null,startTime:"",endTime:"",startTimeToHours:"",endTimeToHours:"",signWays:{qrcode:"qrcode",location:"location"},signWay:"qrcode",useDynamicCode:!1,scanQrcodeWithLocation:!1,locations:[],qrcodeLocations:[],activeLocationIndex:0,project:null,projectId:null,maxLength:20,dateFormat:"yyyy-MM-dd hh:ii:ss"},importPeople:{show:!1,parentPageTitle:null,downloadTemplateUrl:"/iSignIn/projects/downloadTemplate",downloadErrorTemplateUrl:"/iSignIn/projects/excels/error",checkTemplateUrl:"",importBtnType:null,templateName:"自定义名单模板",project:null},allCollegeList:[],classList:[],importPeopleBai:{show:!1,parentPageTitle:null,downloadTemplateUrl:"/iSignIn/projects/excludeListTemplate",downloadErrorTemplateUrl:"/iSignIn/projects/excludeList/excels/error",checkTemplateUrl:"",importBtnType:null,templateName:"自定义白名单模板",project:null},limitOptions:{educationLevel:[]},seleced_type:"single",typeList:[{text:"单次签单",id:"single"},{text:"考勤签到",id:"loop"}]}},created:function(){var t=window.localStorage.getItem("lang");t&&Object(l.g)(t)&&(this.lang=t),this.editNameModal.i18n=this.i18n,this.tabsData.MANAGE.name=this.tabsData.MANAGE.text=this.i18n.listTypeManage,this.tabsData.ALL.name=this.tabsData.ALL.text=this.i18n.listAll,this.tabsData.PROXY.name=this.tabsData.PROXY.text=this.i18n.listTypeProxy,this.tabsData.MINE.name=this.tabsData.MINE.text=this.i18n.listTypeMine,this.selectTab(this.tabs.MANAGE),this.initLimitConditions(),this.getCurrentSchoolStatusList(),this.getClassList(),this.getCollegeList()},computed:{i18n:function(){return Object(l.g)(this.lang).iSign}},methods:{getClassList:function(){var t=this;Object(l.d)("api/relClass/classes/list").then(function(e){e.state&&(t.classList=e.data)})},getCollegeList:function(){var t=this;Object(l.d)("api/colleges").then(function(e){e.state&&(t.allCollegeList=e.data)})},getCurrentSchoolStatusList:function(){var t=this;Object(l.d)("api/system/dicts?dictType=当前在校状态").then(function(e){e.state&&(t.currentSchoolStatusOptions=e.data)})},isCurrentTab:function(t){return this.curTab===t},selectTab:function(t){var e=this;this.proxyArr=[];var a=this.tabsData[t];this.curTab===t&&(a.init=!1,a.loading=!0,a.projects={},a.activeCategoryId=null,a.activeProjectId=null),this.curTab=t,a.init?a.loading=!1:(a.loading=!0,c.a.getManagerAuthority(function(i,s){return i?e.$toast(e.i18n.error.networkError):s.state?(a.hasAuthority=!0,t!=e.tabs.MANAGE||s.data?void c.a.getProjectCategories(e.curTab,e.keyword,function(i,s){if(i)return e.$toast(e.i18n.error.networkError);if(!s.state)return e.$toast(s.message);if(a.init=!0,a.categories=s.data,a.loading=!1,a.categories.length){var o=a.categories[0];a.activeCategoryId=o.id;var r=e.getProjectDefaultViewSettings();e.$set(a.projects,o.id,r),c.a.getProjectsByCategoryId(e.userTypes[t],o.id,e.keyword,r.page,r.size,function(t,i){if(t)return e.$toast(e.i18n.error.networkError);if(!i.state)return e.$toast(i.message);e.proxyArr=i.list,r.init=!0,r.list=i.list,r.loading=!1,r.hasMore=i.totalPages>r.page+1,r.list.length&&(a.activeProjectId=a.activeCategoryId+"-"+r.list[0].id,e.selectProject(a.activeProjectId));var s=!0,o=!1,l=void 0;try{for(var c,d=n()(i.list);!(s=(c=d.next()).done);s=!0){var u=c.value;e.setProjectPeopleCount(u)}}catch(t){o=!0,l=t}finally{try{!s&&d.return&&d.return()}finally{if(o)throw l}}})}}):(a.hasAuthority=!1,a.init=!0,void(a.loading=!1))):e.$toast(s.message)}))},initLimitConditions:function(){var t=this;c.a.getLimitConditions(function(e,a){if(e)return t.$toast(t.i18n.error.networkError);if(!a.state)return t.$toast(a.message);if(a.data)for(var i in a.data)t.limitOptions.educationLevel.push({id:i,text:a.data[i]})})},showMoreProjects:function(t){var e=this,a=this.tabsData[this.curTab].projects[t.id];a.page+=1,a.pageLoading=!0,c.a.getProjectsByCategoryId(this.userTypes[this.curTab],t.id,this.keyword,a.page,a.size,function(t,i){if(t)return e.$toast(e.i18n.error.networkError);if(!i.state)return e.$toast(i.message);a.pageLoading=!1,a.list=a.list.concat(i.list),a.hasMore=i.totalPages>a.size+1,a.hasMore||(a.showNoMoreTip=!0,Object(H.setTimeout)(function(){a.showNoMoreTip=!1},2e3));var s=!0,o=!1,r=void 0;try{for(var l,c=n()(i.list);!(s=(l=c.next()).done);s=!0){var d=l.value;e.setProjectPeopleCount(d)}}catch(t){o=!0,r=t}finally{try{!s&&c.return&&c.return()}finally{if(o)throw r}}})},mouseoverTab:function(t){t===this.curTab&&(this.tabsData[t].text=this.i18n.refresh)},mouseoutTab:function(t){this.tabsData[t].text=this.tabsData[t].name},toAddProjectModal:function(){var t=this;c.a.getProjectCategories(this.curTab,this.keyword,function(e,a){if(e)return t.$toast(t.i18n.error.networkError);a.state?(t.getRole(),t.newProjectModal.categories=[],!t.collegeList.length&&t.getCollege()&&(t.newProjectModal.categories=[]),a.data.map(function(e){t.newProjectModal.categories.push(e)}),t.newProjectModal.categoryId=null,t.newProjectModal.newCategoryName=null,t.newProjectModal.show=!0):t.$toast(a.message)})},getRole:function(){var t=this;Object(l.e)({type:"get",url:"/api/iSignIn/projects/userSignInManageRole",success:function(e){e.state&&e.data.length&&(1==e.data.length?(t.roleList=[{label:"SCHOOL"==e.data[0]?"校级":"院级",value:e.data[0]}],t.seleced_role=e.data[0]):(t.roleList=[{label:"校级",value:"SCHOOL"},{label:"院级",value:"COLLEGE"}],t.seleced_role="SCHOOL"))}})},getCollege:function(){var t=this;Object(l.e)({type:"get",url:"/api/iSignIn/projects/manageSignInColleges",success:function(e){e.state&&e.data.length&&(t.collegeList=e.data)}})},afterSelectedRole:function(t){},addCategory:function(){var t=this;if(!this.newProjectModal.newCategoryName)return this.$toast(this.i18n.error.pleaseFillInCategoryName);c.a.addCategory(this.newProjectModal.newCategoryName,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.newProjectModal.categories.unshift(a.data),t.newProjectModal.categoryId=a.data.id,t.unshiftCategoryToTabs(a.data),t.$toast(t.i18n.tip.addCategorySuccess),void(t.newProjectModal.showAddCategoryForm=!1)):"50003"==a.code?t.$toast(t.i18n.error.categoryNameIsExisted):t.$toast(a.message)})},unshiftCategoryToTabs:function(t){for(var e in this.tabsData)this.tabsData[e].categories.unshift(t),this.$set(this.tabsData[e].projects,t.id,this.getProjectDefaultViewSettings())},addProject:function(){var t=this;if(!this.newProjectModal.name)return this.$toast(this.i18n.error.pleaseFillInProjectName);if(!this.seleced_role)return this.$toast("请选择所属级别");if("COLLEGE"==this.seleced_role&&!this.seleced_college)return this.$toast("请选择分管学院");var e=this.newProjectModal.categoryId;if(!e&&!this.newProjectModal.newCategoryName)return this.$toast(this.i18n.error.pleaseChooseCategoryOrAddCategory);c.a.addProject({projectName:this.newProjectModal.name,projectTypeId:e,projectTypeName:this.newProjectModal.newCategoryName,level:this.seleced_role,checkInType:this.seleced_type,college:this.seleced_college},function(a,i){if(a)return t.$toast(t.i18n.error.networkError);if(!i.state)return t.$toast(i.message);var s=t.tabsData[t.curTab].projects;s[e]||t.$set(s,e,t.getProjectDefaultViewSettings()),i.data.peopleLoading=!1,i.data.peopleCount=0,s[e].init=!1,s[e].loading=!1,s[e].list.unshift(i.data),t.newProjectModal.show=!1,t.tabsData[t.curTab].activeCategoryId=e,t.selectProject(e+"-"+i.data.id),alert("项目创建成功，请继续设置人员限制、代理设置、签到");var n=t.tabsData[t.curTab].categories,o=-1;for(var r in n)if(n[r].id==e){o=parseInt(r);break}-1!=o&&0!=o&&n.unshift(n.splice(o,1)[0])})},toEditCategoryName:function(t){this.editNameModal.show=!0,this.editNameModal.title=this.i18n.editCategoryName,this.editNameModal.placeholder=this.i18n.addCategoryPlaceholder,this.editNameModal.maxLength=this.newProjectModal.categoryNameMaxLength,this.editNameModal.focusInput=!0,this.editNameModal.id=t.id,this.editNameModal.name=t.name,this.editNameModal.type="category",this.editNameModal.category=t,this.editNameModal.project=null},toEditProjectName:function(t){this.editNameModal.show=!0,this.editNameModal.title=this.i18n.editProjectName,this.editNameModal.placeholder=this.i18n.addProjectPlaceholder,this.editNameModal.maxLength=this.newProjectModal.projectNameMaxLength,this.editNameModal.focusInput=!0,this.editNameModal.id=t.id,this.editNameModal.name=t.name,this.editNameModal.type="project",this.editNameModal.category=null,this.editNameModal.project=t},toAddSign:function(t){this.newSignModal.show=!0,this.newSignModal.projectId=t.id,this.newSignModal.project=t,this.newSignModal.name="",this.newSignModal.startTime=null,this.newSignModal.endTime=null,this.newSignModal.useDynamicCode=!1,this.newSignModal.weeklyDate=[],this.newSignModal.startTimeToHours="",this.newSignModal.endTimeToHours="",this.newSignModal.signWay="qrcode";for(var e=0;e<7;e++)this.newSignModal.weeklyDate.push({index:e,isChecked:!0,startHours:"",endHours:""})},toSignInfo:function(t){var e=this;c.a.getSignById(t.sign.id,function(a,i){return a?e.$toast(e.i18n.error.networkError):i.state?(v()(t.sign,i.data),void e.$emit("to-sign-info",v()(t,{tab:e.curTab}))):e.$toast(i.message)})},toProxySettings:function(t){this.$emit("to-proxy-settings",t)},toImport:function(t){var e=this;this.importPeople.parentPageTitle=t.name+"/ 自定义名单导入",this.importPeople.checkTemplateUrl="/iSignIn/projects/peopleLimit/excels/"+t.id,this.importPeople.importBtnType=[{url:"/iSignIn/projects/peopleLimit/"+t.id+"/LIMIT_BY_LIST",method:"post",isShowBtn:!0,name:"覆盖导入",success:function(t){t.state&&e.importSuccess()}}],this.importPeople.show=!0,this.importPeople.project=t},toimportBai:function(t){var e=this;this.importPeopleBai.parentPageTitle=t.name+"/ 白名单导入",this.importPeopleBai.checkTemplateUrl="/iSignIn/projects/checkExcludeList/excels/"+t.id,this.importPeopleBai.importBtnType=[{url:"/iSignIn/projects/createExcludePeoples",method:"post",isShowBtn:!0,name:"覆盖导入",success:function(t){t.state&&e.importSuccess()}}],this.importPeopleBai.show=!0,this.importPeopleBai.project=t},setSignWay:function(t){this.newSignModal.signWay=t},addSign:function(){var t=this;this.saveing||(this.saveing=!0,c.a.addSign(this.newSignModal,function(e,a){return t.saveing=!1,e?t.$toast(t.i18n.error.networkError):a.state?(t.newSignModal.project.signs.init=!1,t.$toast(t.i18n.tip.addSignSuccess),t.newSignModal.show=!1,t.newSignModal.project.signs.list.push(a.data),void t.selectProject(t.newSignModal.project.categoryId+"-"+t.newSignModal.projectId)):t.$toast(a.message)}))},deleteSign:function(t){var e=this,a=t.project,i=t.sign;c.a.deleteSign(i.id,function(t,s){if(t)return e.$toast(e.i18n.error.networkError);if(!s.state)return"50001"===s.code?e.$toast("该签到已经被删除，请刷新页面查看最新数据"):e.$toast(s.message);e.$toast(e.i18n.tip.deleteSuccess);var n=-1;a.signs.list.forEach(function(t,e){i.id==t.id&&(n=e)}),-1!==n&&a.signs.list.splice(n,1)})},submitEditName:function(){var t=this;if(!this.editNameModal.name)return this.$toast(this.i18n.error.pleaseFillInName);var e={id:this.editNameModal.id,name:this.editNameModal.name};"category"==this.editNameModal.type?c.a.editCategory(e,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast(t.i18n.tip.modifySuccess),t.editNameModal.category.name=t.editNameModal.name,void(t.editNameModal.show=!1)):"50003"===a.code?t.$toast("该分类名称已经存在"):t.$toast(a.message)}):(e.categoryId=this.editNameModal.project.categoryId,c.a.editProject(e,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast(t.i18n.tip.modifySuccess),t.editNameModal.project.name=t.editNameModal.name,void(t.editNameModal.show=!1)):"50003"===a.code?t.$toast("该项目名称已经存在"):t.$toast(a.message)}))},getProjectDefaultViewSettings:function(){return{init:!1,page:0,size:5,list:[],loading:!0,end:!1,hasMore:!1,pageLoading:!1,showNoMoreTip:!1}},selectCategory:function(t){var e=this;this.proxyArr=[];var a=this.tabsData[this.curTab],i=a.projects[t]||this.getProjectDefaultViewSettings();this.$set(a.projects,t,i),c.a.getProjectsByCategoryId(this.userTypes[this.curTab],t,this.keyword,i.page,i.size,function(s,o){if(s)return e.$toast(e.i18n.error.networkError);if(!o.state)return e.$toast(o.message);i.init=!0,i.list=o.list,e.proxyArr=o.list,i.loading=!1,i.hasMore=o.totalPages>i.page+1,i.list.length&&(a.activeProjectId=t+"-"+i.list[0].id,e.selectProject(a.activeProjectId));var r=!0,l=!1,c=void 0;try{for(var d,u=n()(o.list);!(r=(d=u.next()).done);r=!0){var h=d.value;e.setProjectPeopleCount(h)}}catch(s){l=!0,c=s}finally{try{!r&&u.return&&u.return()}finally{if(l)throw c}}})},selectProject:function(t){var e=this,a=this.tabsData[this.curTab];a.activeProjectId=t;var i=t.split("-"),s=m()(i,2),o=s[0],r=s[1],l=a.projects[o].list,d=void 0,u=!0,h=!1,g=void 0;try{for(var p,f=n()(l);!(u=(p=f.next()).done);u=!0){var v=p.value;if(v.id==r){d=v;break}}}catch(t){h=!0,g=t}finally{try{!u&&f.return&&f.return()}finally{if(h)throw g}}if(!d)return this.$toast(this.i18n.error.dataError);if(!d.signs.init){var y=c.a.getSignsByProjectId;this.curTab==this.tabs.MINE&&(y=c.a.getMySignsByProjectId),d.signs.loading=!0,y(d.id,function(t,a){return t?e.$toast(e.i18n.error.networkError):a.state?(d.signs.init=!0,d.signs.loading=!1,void(a.data.length&&(d.signs.list=a.data))):e.$toast(a.message)})}},setLimitType:function(t){var e=this,a=t.project,i=t.type,s=t.conditions;a.peopleLoading=!0,a.peopleCount="",s=s||{},c.a.setLimitType(a.id,i,s,function(t,a){return t?e.$toast(e.i18n.error.networkError):a.state?(e.$toast(e.i18n.tip.setSuccess),void e.selectTab(e.tabs.MANAGE)):e.$toast(a.message)})},setProjectPeopleCount:function(t){var e=this;c.a.getProjectPeopleCountByProjectId(t.id,function(a,i){return a?e.$toast(e.i18n.error.networkError):i.state?(t.peopleLoading=!1,void(t.peopleCount=i.data)):e.$toast(i.message)})},importSuccess:function(){var t=this;this.$toast("设置成功"),this.importPeople.show=!1,this.importPeople.project.peopleLoading=!0,c.a.getProjectById(this.importPeople.project.id,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.importPeople.project.peopleLoading=!1,t.importPeople.project.limitListOfPeople=a.data.limitListOfPeople,void(t.importPeople.project.peopleCount=a.data.peopleCount)):t.$toast(a.message)})},closeImportPeople:function(){this.importPeople.show=!1},closeImportPeopleBai:function(){this.importPeopleBai.show=!1},searchCategoriesAndProjects:Object(l.b)(function(){this.tabsData[this.curTab].init=!1,this.selectTab(this.curTab)},400)}}),W={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.importPeople.show||t.importPeopleBai.show?t.importPeople.show&&!t.importPeopleBai.show?a("v-import",t._b({on:{backParentPage:t.closeImportPeople}},"v-import",t.importPeople,!1)):a("v-import",t._b({on:{backParentPage:t.closeImportPeopleBai}},"v-import",t.importPeopleBai,!1)):a("div",{attrs:{id:"i-sign"}},[a("div",{staticClass:"i-sign-header"},[a("ul",{staticClass:"tabs"},t._l(t.tabs,function(e){return a("li",{key:e,class:{active:t.isCurrentTab(e)},on:{click:function(a){return t.selectTab(e)},mouseover:function(a){return t.mouseoverTab(e)},mouseout:function(a){return t.mouseoutTab(e)}}},[t._v(t._s(t.tabsData[e].text))])}),0),t._v(" "),a("div",{staticClass:"search"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.keyword,expression:"keyword"}],attrs:{type:"text"},domProps:{value:t.keyword},on:{input:[function(e){e.target.composing||(t.keyword=e.target.value)},t.searchCategoriesAndProjects]}}),t._v(" "),a("v-icon",{attrs:{name:"search"}})],1),t._v(" "),t.isCurrentTab(t.tabs.MANAGE)?a("div",{staticClass:"actions"},[a("button",{staticClass:"btn",attrs:{type:"button"},on:{click:t.toAddProjectModal}},[a("v-icon",{staticClass:"pull-left",attrs:{name:"add"}}),t._v("\n        "+t._s(t.i18n.addProject)+"\n      ")],1)]):t._e()]),t._v(" "),a("div",{staticClass:"i-sign-projects"},t._l(t.tabs,function(e){return a("div",{key:e},[a("category-project-list",{directives:[{name:"show",rawName:"v-show",value:t.isCurrentTab(e),expression:"isCurrentTab(tab)"}],key:e,attrs:{tabs:t.tabs,"cur-tab":e,loading:t.tabsData[e].loading,categories:t.tabsData[e].categories,projects:t.tabsData[e].projects,activeCategoryId:t.tabsData[e].activeCategoryId,activeProjectId:t.tabsData[e].activeProjectId,hasAuthority:t.tabsData[e].hasAuthority,limitOptions:t.limitOptions,proxyArr:t.proxyArr,schoolStatusArr:t.schoolStatusArr,currentSchoolStatusOptions:t.currentSchoolStatusOptions,collegeList:t.allCollegeList,classList:t.classList},on:{"to-edit-category-name":t.toEditCategoryName,"to-edit-project-name":t.toEditProjectName,"to-add-sign":t.toAddSign,"to-proxy-settings":t.toProxySettings,"to-sign-info":t.toSignInfo,"to-import":t.toImport,"to-importBai":t.toimportBai,"select-category":t.selectCategory,"select-project":t.selectProject,"set-limit-type":t.setLimitType,"delete-sign":t.deleteSign,"show-more-projects":t.showMoreProjects}})],1)}),0),t._v(" "),a("v-modal",{attrs:{show:t.newProjectModal.show,effect:"fade",width:"400"}},[a("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[a("h5",{staticClass:"modal-title"},[t._v(t._s(t.i18n.addProject))])]),t._v(" "),a("div",{staticClass:"modal-body container-fluid new-sign-modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[a("div",{staticClass:"form-group"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.newProjectModal.name,expression:"newProjectModal.name"}],staticClass:"form-control modal-input",attrs:{type:"text",maxlength:t.newProjectModal.projectNameMaxLength,placeholder:t.i18n.addProjectPlaceholder},domProps:{value:t.newProjectModal.name},on:{input:function(e){e.target.composing||t.$set(t.newProjectModal,"name",e.target.value)}}}),t._v(" "),a("v-select",{staticClass:"seleced_role",attrs:{options:t.roleList,optionsLabel:"label",optionsValue:"value"},on:{afterSelected:function(e){return t.afterSelectedRole(e)}},model:{value:t.seleced_role,callback:function(e){t.seleced_role=e},expression:"seleced_role"}}),t._v(" "),"COLLEGE"==t.seleced_role?a("v-select",{staticClass:"seleced_role",attrs:{options:t.collegeList,optionsLabel:"text",optionsValue:"id",placeholder:"请选择学院"},model:{value:t.seleced_college,callback:function(e){t.seleced_college=e},expression:"seleced_college"}}):t._e(),t._v(" "),a("v-select",{staticClass:"seleced_role",attrs:{options:t.typeList,optionsLabel:"text",optionsValue:"id",placeholder:"请选择签到类型"},model:{value:t.seleced_type,callback:function(e){t.seleced_type=e},expression:"seleced_type"}})],1),t._v(" "),a("div",{staticClass:"row type-div"},[a("div",{staticClass:"app-type-text"},[t._v("\n          "+t._s(t.i18n.selectCategory)+"\n          "),a("span",{staticClass:"add-category",on:{click:function(e){t.newProjectModal.showAddCategoryForm=!0}}},[t._v(t._s(t.i18n.new))])]),t._v(" "),a("div",{staticClass:"app-type-content"},[t.newProjectModal.showAddCategoryForm?a("div",{staticClass:"creat-category-input"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.newProjectModal.newCategoryName,expression:"newProjectModal.newCategoryName"},{name:"focus",rawName:"v-focus"}],staticClass:"form-control",attrs:{type:"text",maxlength:t.newProjectModal.categoryNameMaxLength,placeholder:t.i18n.addCategoryPlaceholder},domProps:{value:t.newProjectModal.newCategoryName},on:{input:function(e){e.target.composing||t.$set(t.newProjectModal,"newCategoryName",e.target.value)}}}),t._v(" "),a("div",{staticClass:"pull-right create-btn-group"},[a("button",{staticClass:"btn create-cancel clearBtnBorder",on:{click:function(e){t.newProjectModal.showAddCategoryForm=!1}}},[t._v(t._s(t.i18n.cancel))]),t._v(" "),a("button",{staticClass:"btn create-sure clearBtnBorder",on:{click:t.addCategory}},[t._v(t._s(t.i18n.sure))])]),t._v(" "),a("p",{staticClass:"error-msg"})]):t._e(),t._v(" "),t._l(t.newProjectModal.categories,function(e,i){return a("p",{key:i,staticClass:"type-p",class:{active:t.newProjectModal.categoryId===e.id},on:{click:function(a){t.newProjectModal.categoryId=e.id}}},[a("v-icon",{attrs:{name:"done"}}),t._v("\n            "+t._s(e.name)+"\n          ")],1)})],2)])]),t._v(" "),a("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.newProjectModal.show=!1}}},[t._v(t._s(t.i18n.cancel))]),t._v(" "),a("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.addProject}},[t._v(t._s(t.i18n.sure))])])]),t._v(" "),a("v-modal",{attrs:{show:t.editNameModal.show,effect:"fade",width:"400"}},[a("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[a("h5",{staticClass:"modal-title"},[t._v(t._s(t.editNameModal.title))])]),t._v(" "),a("div",{staticClass:"modal-body container-fluid",attrs:{slot:"modal-body"},slot:"modal-body"},[a("div",{staticClass:"form-group"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.editNameModal.name,expression:"editNameModal.name"},{name:"focus",rawName:"v-focus",value:t.editNameModal.focusInput,expression:"editNameModal.focusInput"}],staticClass:"form-control modal-input",attrs:{type:"text",maxlength:t.editNameModal.maxLength,placeholder:t.editNameModal.placeholder},domProps:{value:t.editNameModal.name},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submitEditName(e)},input:function(e){e.target.composing||t.$set(t.editNameModal,"name",e.target.value)}}})])]),t._v(" "),a("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.editNameModal.show=!1}}},[t._v(t._s(t.i18n.cancel))]),t._v(" "),a("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.submitEditName}},[t._v(t._s(t.i18n.sure))])])]),t._v(" "),a("sign-info-modal",{attrs:{title:"新增签到",checkInType:t.newSignModal.project?t.newSignModal.project.checkInType:"",signInfo:t.newSignModal,i18n:t.i18n},on:{confirm:t.addSign}})],1)},staticRenderFns:[]};var R=a("C7Lr")(q,W,!1,function(t){a("vmbB")},null,null).exports,G=a("yFgL"),V=(G.a,{components:{ProjectManage:R,ProxySettings:g,SignInfo:G.a},data:function(){return{pages:{PROJECT_MANAGE:"PROJECT_MANAGE",PROXY_SETTINGS:"PROXY_SETTINGS",SIGN_INFO:"SIGN_INFO"},curPage:"PROJECT_MANAGE",proxySettings:{projectId:null,projectName:null},signInfo:{project:null,sign:null,userType:null}}},created:function(){},computed:{},methods:{isCurrentPage:function(t){return this.curPage===t},toProxySettings:function(t){this.proxySettings.projectId=t.id,this.proxySettings.projectName=t.name,this.proxySettings.projectLevel=t.level,this.jumpTo(this.pages.PROXY_SETTINGS)},toSignInfo:function(t){var e=t.project,a=t.sign,i=t.tab;this.signInfo.project=e,this.signInfo.sign=a,this.signInfo.userType=i,this.jumpTo(this.pages.SIGN_INFO)},toProjectManage:function(){this.jumpTo(this.pages.PROJECT_MANAGE)},jumpTo:function(t){this.curPage=t}}}),U={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{height:"100%"}},[a("project-manage",{directives:[{name:"show",rawName:"v-show",value:t.isCurrentPage(t.pages.PROJECT_MANAGE),expression:"isCurrentPage(pages.PROJECT_MANAGE)"}],on:{"to-proxy-settings":t.toProxySettings,"to-sign-info":t.toSignInfo}}),t._v(" "),t.isCurrentPage(t.pages.PROXY_SETTINGS)?a("proxy-settings",t._b({key:t.proxySettings.projectId,on:{back:t.toProjectManage}},"proxy-settings",t.proxySettings,!1)):t._e(),t._v(" "),t.isCurrentPage(t.pages.SIGN_INFO)?a("sign-info",t._b({key:t.signInfo.sign.id,on:{back:t.toProjectManage}},"sign-info",t.signInfo,!1)):t._e()],1)},staticRenderFns:[]};var F=a("C7Lr")(V,U,!1,function(t){a("juqe")},null,null);e.default=F.exports},G9CJ:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACZklEQVRYR+2WTYhOYRTHf3+ZlEIjsvCxkNhgMStJPqKsbCj5qNFYGAlLatSURJGNWBgxJso0WSkrUWMzMytCKRaUjwWKokg+jo7uq9cz997nufddzGbO8j7n/M/vnnPuea6YYNME52cSoHIFzGw9sBNYB8zPWvgWuA8MShqu0tZkADNbCFwFNkYS3AO6JL1OAUkCMLOVwF1gbooo8AHYJOlxzD8KYGae9AGwICYWnL8BOiQ5TKGlAFwEuismb7j3SdpfG8DM2oF3QFsg8gs4B9yCv5/yVuAgMCXw+wHMk/SpCKK0Ambm034jJ3i3pP+em1kX0J/ju0vSYF2AXuB4EPxQUkeeoJk9Anxgm61X0om6AKeBI0HwgCR/23FmZgPAnuDgjKSjdQH2AX1B8LCkDQUAvozWBmfdki7VBfBN9yoYrt/AGkmjzaJm5ol9CzbPlfsukuSbMtdSPsMhYHsQ/RHwst7O4LYA3q5Zgd+QpB21P0MPNLOlgG+0aWVCOWfffSAlPW8JIIPoAU5WBDgm6VQsJtqCDMAXzJ2Ei6iRz++NzZJ8BkotCSCD8DthDFgc0XwBrIrdAQ2NZIAMYhkwAswugPDhXC3pWezNSwHMzKf5LDA9R8iT+z9BeD/43vd/AYcI7RvQI+l9eJBbATPzy+VwyVvMBFYAUzOfn8AT4HNJzBVJ11MBzmcJyio5o8nHk3+JzYakvVEAM5sD3Aw2WpF2o0VfE3veKck36z8b1wIz2wYcShSs6tYv6VoM4AKwvKpyov/L8CbNq8BlYEmiYFW3p5IOlFagqmKr/pUWUavJ8uInAf4A/NytIadyq7UAAAAASUVORK5CYII="},LqYc:function(t,e,a){var i,s;s=function(){function t(t){this.mode=a.MODE_8BIT_BYTE,this.data=t,this.parsedData=[];for(var e=0,i=this.data.length;e<i;e++){var s=[],n=this.data.charCodeAt(e);n>65536?(s[0]=240|(1835008&n)>>>18,s[1]=128|(258048&n)>>>12,s[2]=128|(4032&n)>>>6,s[3]=128|63&n):n>2048?(s[0]=224|(61440&n)>>>12,s[1]=128|(4032&n)>>>6,s[2]=128|63&n):n>128?(s[0]=192|(1984&n)>>>6,s[1]=128|63&n):s[0]=n,this.parsedData.push(s)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function e(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}t.prototype={getLength:function(t){return this.parsedData.length},write:function(t){for(var e=0,a=this.parsedData.length;e<a;e++)t.put(this.parsedData[e],8)}},e.prototype={addData:function(e){var a=new t(e);this.dataList.push(a),this.dataCache=null},isDark:function(t,e){if(t<0||this.moduleCount<=t||e<0||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(t,a){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++){this.modules[i]=new Array(this.moduleCount);for(var s=0;s<this.moduleCount;s++)this.modules[i][s]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,a),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,a)},setupPositionProbePattern:function(t,e){for(var a=-1;a<=7;a++)if(!(t+a<=-1||this.moduleCount<=t+a))for(var i=-1;i<=7;i++)e+i<=-1||this.moduleCount<=e+i||(this.modules[t+a][e+i]=0<=a&&a<=6&&(0==i||6==i)||0<=i&&i<=6&&(0==a||6==a)||2<=a&&a<=4&&2<=i&&i<=4)},getBestMaskPattern:function(){for(var t=0,e=0,a=0;a<8;a++){this.makeImpl(!0,a);var i=g.getLostPoint(this);(0==a||t>i)&&(t=i,e=a)}return e},createMovieClip:function(t,e,a){var i=t.createEmptyMovieClip(e,a);this.make();for(var s=0;s<this.modules.length;s++)for(var n=1*s,o=0;o<this.modules[s].length;o++){var r=1*o;this.modules[s][o]&&(i.beginFill(0,100),i.moveTo(r,n),i.lineTo(r+1,n),i.lineTo(r+1,n+1),i.lineTo(r,n+1),i.endFill())}return i},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},setupPositionAdjustPattern:function(){for(var t=g.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var a=0;a<t.length;a++){var i=t[e],s=t[a];if(null==this.modules[i][s])for(var n=-2;n<=2;n++)for(var o=-2;o<=2;o++)this.modules[i+n][s+o]=-2==n||2==n||-2==o||2==o||0==n&&0==o}},setupTypeNumber:function(t){for(var e=g.getBCHTypeNumber(this.typeNumber),a=0;a<18;a++){var i=!t&&1==(e>>a&1);this.modules[Math.floor(a/3)][a%3+this.moduleCount-8-3]=i}for(a=0;a<18;a++){i=!t&&1==(e>>a&1);this.modules[a%3+this.moduleCount-8-3][Math.floor(a/3)]=i}},setupTypeInfo:function(t,e){for(var a=this.errorCorrectLevel<<3|e,i=g.getBCHTypeInfo(a),s=0;s<15;s++){var n=!t&&1==(i>>s&1);s<6?this.modules[s][8]=n:s<8?this.modules[s+1][8]=n:this.modules[this.moduleCount-15+s][8]=n}for(s=0;s<15;s++){n=!t&&1==(i>>s&1);s<8?this.modules[8][this.moduleCount-s-1]=n:s<9?this.modules[8][15-s-1+1]=n:this.modules[8][15-s-1]=n}this.modules[this.moduleCount-8][8]=!t},mapData:function(t,e){for(var a=-1,i=this.moduleCount-1,s=7,n=0,o=this.moduleCount-1;o>0;o-=2)for(6==o&&o--;;){for(var r=0;r<2;r++)if(null==this.modules[i][o-r]){var l=!1;n<t.length&&(l=1==(t[n]>>>s&1)),g.getMask(e,i,o-r)&&(l=!l),this.modules[i][o-r]=l,-1==--s&&(n++,s=7)}if((i+=a)<0||this.moduleCount<=i){i-=a,a=-a;break}}}},e.PAD0=236,e.PAD1=17,e.createData=function(t,a,i){for(var s=v.getRSBlocks(t,a),n=new y,o=0;o<i.length;o++){var r=i[o];n.put(r.mode,4),n.put(r.getLength(),g.getLengthInBits(r.mode,t)),r.write(n)}var l=0;for(o=0;o<s.length;o++)l+=s[o].dataCount;if(n.getLengthInBits()>8*l)throw new Error("code length overflow. ("+n.getLengthInBits()+">"+8*l+")");for(n.getLengthInBits()+4<=8*l&&n.put(0,4);n.getLengthInBits()%8!=0;)n.putBit(!1);for(;!(n.getLengthInBits()>=8*l||(n.put(e.PAD0,8),n.getLengthInBits()>=8*l));)n.put(e.PAD1,8);return e.createBytes(n,s)},e.createBytes=function(t,e){for(var a=0,i=0,s=0,n=new Array(e.length),o=new Array(e.length),r=0;r<e.length;r++){var l=e[r].dataCount,c=e[r].totalCount-l;i=Math.max(i,l),s=Math.max(s,c),n[r]=new Array(l);for(var d=0;d<n[r].length;d++)n[r][d]=255&t.buffer[d+a];a+=l;var u=g.getErrorCorrectPolynomial(c),h=new f(n[r],u.getLength()-1).mod(u);o[r]=new Array(u.getLength()-1);for(d=0;d<o[r].length;d++){var p=d+h.getLength()-o[r].length;o[r][d]=p>=0?h.get(p):0}}var m=0;for(d=0;d<e.length;d++)m+=e[d].totalCount;var v=new Array(m),y=0;for(d=0;d<i;d++)for(r=0;r<e.length;r++)d<n[r].length&&(v[y++]=n[r][d]);for(d=0;d<s;d++)for(r=0;r<e.length;r++)d<o[r].length&&(v[y++]=o[r][d]);return v};for(var a={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},s={L:1,M:0,Q:3,H:2},n=0,o=1,r=2,l=3,c=4,d=5,u=6,h=7,g={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(t){for(var e=t<<10;g.getBCHDigit(e)-g.getBCHDigit(g.G15)>=0;)e^=g.G15<<g.getBCHDigit(e)-g.getBCHDigit(g.G15);return(t<<10|e)^g.G15_MASK},getBCHTypeNumber:function(t){for(var e=t<<12;g.getBCHDigit(e)-g.getBCHDigit(g.G18)>=0;)e^=g.G18<<g.getBCHDigit(e)-g.getBCHDigit(g.G18);return t<<12|e},getBCHDigit:function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},getPatternPosition:function(t){return g.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,a){switch(t){case n:return(e+a)%2==0;case o:return e%2==0;case r:return a%3==0;case l:return(e+a)%3==0;case c:return(Math.floor(e/2)+Math.floor(a/3))%2==0;case d:return e*a%2+e*a%3==0;case u:return(e*a%2+e*a%3)%2==0;case h:return(e*a%3+(e+a)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){for(var e=new f([1],0),a=0;a<t;a++)e=e.multiply(new f([1,p.gexp(a)],0));return e},getLengthInBits:function(t,e){if(1<=e&&e<10)switch(t){case a.MODE_NUMBER:return 10;case a.MODE_ALPHA_NUM:return 9;case a.MODE_8BIT_BYTE:case a.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(e<27)switch(t){case a.MODE_NUMBER:return 12;case a.MODE_ALPHA_NUM:return 11;case a.MODE_8BIT_BYTE:return 16;case a.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(e<41))throw new Error("type:"+e);switch(t){case a.MODE_NUMBER:return 14;case a.MODE_ALPHA_NUM:return 13;case a.MODE_8BIT_BYTE:return 16;case a.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},getLostPoint:function(t){for(var e=t.getModuleCount(),a=0,i=0;i<e;i++)for(var s=0;s<e;s++){for(var n=0,o=t.isDark(i,s),r=-1;r<=1;r++)if(!(i+r<0||e<=i+r))for(var l=-1;l<=1;l++)s+l<0||e<=s+l||0==r&&0==l||o==t.isDark(i+r,s+l)&&n++;n>5&&(a+=3+n-5)}for(i=0;i<e-1;i++)for(s=0;s<e-1;s++){var c=0;t.isDark(i,s)&&c++,t.isDark(i+1,s)&&c++,t.isDark(i,s+1)&&c++,t.isDark(i+1,s+1)&&c++,0!=c&&4!=c||(a+=3)}for(i=0;i<e;i++)for(s=0;s<e-6;s++)t.isDark(i,s)&&!t.isDark(i,s+1)&&t.isDark(i,s+2)&&t.isDark(i,s+3)&&t.isDark(i,s+4)&&!t.isDark(i,s+5)&&t.isDark(i,s+6)&&(a+=40);for(s=0;s<e;s++)for(i=0;i<e-6;i++)t.isDark(i,s)&&!t.isDark(i+1,s)&&t.isDark(i+2,s)&&t.isDark(i+3,s)&&t.isDark(i+4,s)&&!t.isDark(i+5,s)&&t.isDark(i+6,s)&&(a+=40);var d=0;for(s=0;s<e;s++)for(i=0;i<e;i++)t.isDark(i,s)&&d++;return a+=10*(Math.abs(100*d/e/e-50)/5)}},p={glog:function(t){if(t<1)throw new Error("glog("+t+")");return p.LOG_TABLE[t]},gexp:function(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return p.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},m=0;m<8;m++)p.EXP_TABLE[m]=1<<m;for(m=8;m<256;m++)p.EXP_TABLE[m]=p.EXP_TABLE[m-4]^p.EXP_TABLE[m-5]^p.EXP_TABLE[m-6]^p.EXP_TABLE[m-8];for(m=0;m<255;m++)p.LOG_TABLE[p.EXP_TABLE[m]]=m;function f(t,e){if(void 0==t.length)throw new Error(t.length+"/"+e);for(var a=0;a<t.length&&0==t[a];)a++;this.num=new Array(t.length-a+e);for(var i=0;i<t.length-a;i++)this.num[i]=t[i+a]}function v(t,e){this.totalCount=t,this.dataCount=e}function y(){this.buffer=[],this.length=0}f.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var e=new Array(this.getLength()+t.getLength()-1),a=0;a<this.getLength();a++)for(var i=0;i<t.getLength();i++)e[a+i]^=p.gexp(p.glog(this.get(a))+p.glog(t.get(i)));return new f(e,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var e=p.glog(this.get(0))-p.glog(t.get(0)),a=new Array(this.getLength()),i=0;i<this.getLength();i++)a[i]=this.get(i);for(i=0;i<t.getLength();i++)a[i]^=p.gexp(p.glog(t.get(i))+e);return new f(a,0).mod(t)}},v.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],v.getRSBlocks=function(t,e){var a=v.getRsBlockTable(t,e);if(void 0==a)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e);for(var i=a.length/3,s=[],n=0;n<i;n++)for(var o=a[3*n+0],r=a[3*n+1],l=a[3*n+2],c=0;c<o;c++)s.push(new v(r,l));return s},v.getRsBlockTable=function(t,e){switch(e){case s.L:return v.RS_BLOCK_TABLE[4*(t-1)+0];case s.M:return v.RS_BLOCK_TABLE[4*(t-1)+1];case s.Q:return v.RS_BLOCK_TABLE[4*(t-1)+2];case s.H:return v.RS_BLOCK_TABLE[4*(t-1)+3];default:return}},y.prototype={get:function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},put:function(t,e){for(var a=0;a<e;a++)this.putBit(1==(t>>>e-a-1&1))},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var b=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]];function S(){var t=!1,e=navigator.userAgent;if(/android/i.test(e)){t=!0;var a=e.toString().match(/android ([0-9]\.[0-9])/i);a&&a[1]&&(t=parseFloat(a[1]))}return t}var _=function(){var t=function(t,e){this._el=t,this._htOption=e};return t.prototype.draw=function(t){var e=this._htOption,a=this._el,i=t.getModuleCount();Math.floor(e.width/i),Math.floor(e.height/i);function s(t,e){var a=document.createElementNS("http://www.w3.org/2000/svg",t);for(var i in e)e.hasOwnProperty(i)&&a.setAttribute(i,e[i]);return a}this.clear();var n=s("svg",{viewBox:"0 0 "+String(i)+" "+String(i),width:"100%",height:"100%",fill:e.colorLight});n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),a.appendChild(n),n.appendChild(s("rect",{fill:e.colorLight,width:"100%",height:"100%"})),n.appendChild(s("rect",{fill:e.colorDark,width:"1",height:"1",id:"template"}));for(var o=0;o<i;o++)for(var r=0;r<i;r++)if(t.isDark(o,r)){var l=s("use",{x:String(r),y:String(o)});l.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),n.appendChild(l)}},t.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},t}(),I="svg"===document.documentElement.tagName.toLowerCase()?_:"undefined"==typeof CanvasRenderingContext2D?function(){var t=function(t,e){this._el=t,this._htOption=e};return t.prototype.draw=function(t){for(var e=this._htOption,a=this._el,i=t.getModuleCount(),s=Math.floor(e.width/i),n=Math.floor(e.height/i),o=['<table style="border:0;border-collapse:collapse;">'],r=0;r<i;r++){o.push("<tr>");for(var l=0;l<i;l++)o.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+s+"px;height:"+n+"px;background-color:"+(t.isDark(r,l)?e.colorDark:e.colorLight)+';"></td>');o.push("</tr>")}o.push("</table>"),a.innerHTML=o.join("");var c=a.childNodes[0],d=(e.width-c.offsetWidth)/2,u=(e.height-c.offsetHeight)/2;d>0&&u>0&&(c.style.margin=u+"px "+d+"px")},t.prototype.clear=function(){this._el.innerHTML=""},t}():function(){function t(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}if(this._android&&this._android<=2.1){var e=1/window.devicePixelRatio,a=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(t,i,s,n,o,r,l,c,d){if("nodeName"in t&&/img/i.test(t.nodeName))for(var u=arguments.length-1;u>=1;u--)arguments[u]=arguments[u]*e;else void 0===c&&(arguments[1]*=e,arguments[2]*=e,arguments[3]*=e,arguments[4]*=e);a.apply(this,arguments)}}var i=function(t,e){this._bIsPainted=!1,this._android=S(),this._htOption=e,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=e.width,this._elCanvas.height=e.height,t.appendChild(this._elCanvas),this._el=t,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.alt="Scan me!",this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return i.prototype.draw=function(t){var e=this._elImage,a=this._oContext,i=this._htOption,s=t.getModuleCount(),n=i.width/s,o=i.height/s,r=Math.round(n),l=Math.round(o);e.style.display="none",this.clear();for(var c=0;c<s;c++)for(var d=0;d<s;d++){var u=t.isDark(c,d),h=d*n,g=c*o;a.strokeStyle=u?i.colorDark:i.colorLight,a.lineWidth=1,a.fillStyle=u?i.colorDark:i.colorLight,a.fillRect(h,g,n,o),a.strokeRect(Math.floor(h)+.5,Math.floor(g)+.5,r,l),a.strokeRect(Math.ceil(h)-.5,Math.ceil(g)-.5,r,l)}this._bIsPainted=!0},i.prototype.makeImage=function(){this._bIsPainted&&function(t,e){var a=this;if(a._fFail=e,a._fSuccess=t,null===a._bSupportDataURI){var i=document.createElement("img"),s=function(){a._bSupportDataURI=!1,a._fFail&&a._fFail.call(a)};return i.onabort=s,i.onerror=s,i.onload=function(){a._bSupportDataURI=!0,a._fSuccess&&a._fSuccess.call(a)},void(i.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}!0===a._bSupportDataURI&&a._fSuccess?a._fSuccess.call(a):!1===a._bSupportDataURI&&a._fFail&&a._fFail.call(a)}.call(this,t)},i.prototype.isPainted=function(){return this._bIsPainted},i.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},i.prototype.round=function(t){return t?Math.floor(1e3*t)/1e3:t},i}();function w(t,e){for(var a=1,i=function(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)}(t),n=0,o=b.length;n<=o;n++){var r=0;switch(e){case s.L:r=b[n][0];break;case s.M:r=b[n][1];break;case s.Q:r=b[n][2];break;case s.H:r=b[n][3]}if(i<=r)break;a++}if(a>b.length)throw new Error("Too long data");return a}return(i=function(t,e){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:s.H},"string"==typeof e&&(e={text:e}),e)for(var a in e)this._htOption[a]=e[a];"string"==typeof t&&(t=document.getElementById(t)),this._htOption.useSVG&&(I=_),this._android=S(),this._el=t,this._oQRCode=null,this._oDrawing=new I(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)}).prototype.makeCode=function(t){this._oQRCode=new e(w(t,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(t),this._oQRCode.make(),this._el.title=t,this._oDrawing.draw(this._oQRCode),this.makeImage()},i.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},i.prototype.clear=function(){this._oDrawing.clear()},i.CorrectLevel=s,i},t.exports=s()},PuR5:function(t,e){},gvMr:function(t,e,a){"use strict";var i='<svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50;" xml:space="preserve">\n                  <path fill="rgba(0, 0, 0, 0.54)" d="M43.935,25.145c0-10.318-8.364-18.683-18.683-18.683c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615c8.072,0,14.615,6.543,14.615,14.615H43.935z" transform="rotate(30.0001 25 25)">\n                    <animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform>\n                  </path>\n                </svg>';e.a={icon:i,small:'<svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="18px" height="18px" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50;" xml:space="preserve">\n                <path fill="rgba(0, 0, 0, 0.54)" d="M43.935,25.145c0-10.318-8.364-18.683-18.683-18.683c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615c8.072,0,14.615,6.543,14.615,14.615H43.935z" transform="rotate(30.0001 25 25)">\n                  <animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform>\n                </path>\n              </svg>',iconWithText:i+"加载中"}},hBSA:function(t,e,a){(function(t){function a(t,e){for(var a=0,i=t.length-1;i>=0;i--){var s=t[i];"."===s?t.splice(i,1):".."===s?(t.splice(i,1),a++):a&&(t.splice(i,1),a--)}if(e)for(;a--;a)t.unshift("..");return t}function i(t,e){if(t.filter)return t.filter(e);for(var a=[],i=0;i<t.length;i++)e(t[i],i,t)&&a.push(t[i]);return a}e.resolve=function(){for(var e="",s=!1,n=arguments.length-1;n>=-1&&!s;n--){var o=n>=0?arguments[n]:t.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(e=o+"/"+e,s="/"===o.charAt(0))}return e=a(i(e.split("/"),function(t){return!!t}),!s).join("/"),(s?"/":"")+e||"."},e.normalize=function(t){var n=e.isAbsolute(t),o="/"===s(t,-1);return(t=a(i(t.split("/"),function(t){return!!t}),!n).join("/"))||n||(t="."),t&&o&&(t+="/"),(n?"/":"")+t},e.isAbsolute=function(t){return"/"===t.charAt(0)},e.join=function(){var t=Array.prototype.slice.call(arguments,0);return e.normalize(i(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},e.relative=function(t,a){function i(t){for(var e=0;e<t.length&&""===t[e];e++);for(var a=t.length-1;a>=0&&""===t[a];a--);return e>a?[]:t.slice(e,a-e+1)}t=e.resolve(t).substr(1),a=e.resolve(a).substr(1);for(var s=i(t.split("/")),n=i(a.split("/")),o=Math.min(s.length,n.length),r=o,l=0;l<o;l++)if(s[l]!==n[l]){r=l;break}var c=[];for(l=r;l<s.length;l++)c.push("..");return(c=c.concat(n.slice(r))).join("/")},e.sep="/",e.delimiter=":",e.dirname=function(t){if("string"!=typeof t&&(t+=""),0===t.length)return".";for(var e=t.charCodeAt(0),a=47===e,i=-1,s=!0,n=t.length-1;n>=1;--n)if(47===(e=t.charCodeAt(n))){if(!s){i=n;break}}else s=!1;return-1===i?a?"/":".":a&&1===i?"/":t.slice(0,i)},e.basename=function(t,e){var a=function(t){"string"!=typeof t&&(t+="");var e,a=0,i=-1,s=!0;for(e=t.length-1;e>=0;--e)if(47===t.charCodeAt(e)){if(!s){a=e+1;break}}else-1===i&&(s=!1,i=e+1);return-1===i?"":t.slice(a,i)}(t);return e&&a.substr(-1*e.length)===e&&(a=a.substr(0,a.length-e.length)),a},e.extname=function(t){"string"!=typeof t&&(t+="");for(var e=-1,a=0,i=-1,s=!0,n=0,o=t.length-1;o>=0;--o){var r=t.charCodeAt(o);if(47!==r)-1===i&&(s=!1,i=o+1),46===r?-1===e?e=o:1!==n&&(n=1):-1!==e&&(n=-1);else if(!s){a=o+1;break}}return-1===e||-1===i||0===n||1===n&&e===i-1&&e===a+1?"":t.slice(e,i)};var s="b"==="ab".substr(-1)?function(t,e,a){return t.substr(e,a)}:function(t,e,a){return e<0&&(e=t.length+e),t.substr(e,a)}}).call(e,a("V0EG"))},hazC:function(t,e){},jCSy:function(t,e){},juqe:function(t,e){},"m+ur":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAB10lEQVRYR+2WO4xNURSGv880RCVRSLwaCi06pUoEkQiineSqdCMqGRqvRKFRSCg0Xo2hUNCamWoylWgkk5kxlVJQMEu23JNcx7nnnHvtyc2I05619/qy1+P/ZcSfI87Pf4A/XiAiOsBRYEOf8nwEJtTPvf8jYiNwG9hVU9Y36p3e/1UAj4HNDb1xXl0pAWwF7teAp/Dv6skmgKfAJuAZ8K4CZKWcvIiJiG3Ajooze4FzwKp6oi3ADfVtjimJiIPA5CgBDgBX2gKkp08NdV2dzvQC+4GrQKjHm0pQAFxTZzIDoB5rAngIbAEuq/OZAPYBt4Av6pkmgNQwe9IUqD8yAaRxPwUsqbO1ADkSDnJHoxZExBHgXp/5rsu1DHTUV3VBbQCWhkhe5FxWd657gNGWYJCGGia2Sg0PAaluT9QY5tLymYhIec4Ci2V9qQIoNuFF9X0mgGIRfVVPNy2il92ASXUuE0ChBa1W8VoCtBKjtQAYSI5fwC+3nLMEAxmSqa6vewR8qOiBJCi/+cEeS7a9O0HlY0nckgq2smTPgbGa5lsFxtVPvTERkUzpg+7r9TveypReAA7XXLQAXFK/lQCSi7oJ7O6TPe2U1+rd9SXHOfbAX6nhPw/wEzvN0CEpJzgoAAAAAElFTkSuQmCC"},qvNH:function(t,e){},tgYt:function(t,e){},vgHG:function(t,e){},vmbB:function(t,e){},y74z:function(t,e){},yFgL:function(t,e,a){"use strict";var i=a("a3Yh"),s=a.n(i),n=a("3cXf"),o=a.n(n),r=a("HzJ8"),l=a.n(r),c=(a("kV13"),a("HJbL")),d=a("zKJS"),u=a("C331"),h=a("B6Gn"),g=a("WCPx"),p=a.n(g),m=a("LqYc"),f=a.n(m),v=a("gvMr"),y=(a("hBSA"),a("Y/Kc"),{NOT_SIGN:"未签到",SIGN:"已签到",MANUAL_ENTRY:"手工签到",TIME_OUT_NOT_SIGN:"超时未签到"}),b={SIGN_IN:" 已签到",NOT_SIGN_IN:" 未签到",MANUAL_SIGN_IN:"手动签到",SIGN_OUT:" 已签退",NOT_SIGN_OUT:" 未签退",MANUAL_SIGN_OUT:"手动签退",ASK_FOR_LEAVE:"请假"},S="SCHOOL",_="COLLEGE",I="CLASS",w="RELATIONSHIP",C=(s()({components:{VIcon:c.a,SignInfoModal:d.a},props:{project:Object,sign:Object,userType:String},data:function(){return{signWayText:{location:"定位签到",qrcode:"扫码签到",outside:"外勤打卡"},searchVal:"",statType:"",statDate:[],eduList:[],gradeYear:[],formFields:[],unitList:[],tableUrl:"",dateArea:"",outputModalShow:!1,outputList:[],downLoadDate:"",classArr:[],loader:v.a,lang:"zh-cn",datePickerStartTime:"",datePickerEndTime:"",showAdviceModal:!1,adviceParams:{sendTimeType:"IMMEDIATELY",sendTime:"",content:"",messageToTarget:"ALL_STUDENT"},sendTimeTypeList:[{label:"立即发送",value:"IMMEDIATELY"},{label:"定时发送",value:"TIMING"}],tableParams:{pagesize:10,idField:"id",columns:[],multi:!1,order:!0,search:!1,ts:+new Date},showAddModal:!1,signTabVal:"signIn",searchOptions:{colleges:[],status:[{id:"NOT_SIGN",text:"未签到"},{id:"SIGN",text:"已签到"},{id:"MANUAL_ENTRY",text:"手工签到"}],newSignInStatus:[{id:"SIGN_IN",text:"已签到"},{id:"NOT_SIGN_IN",text:"未签到"},{id:"MANUAL_SIGN_IN",text:"手动签到"},{id:"ASK_FOR_LEAVE",text:"请假"}],newSignOutStatus:[{id:"SIGN_OUT",text:"已签退"},{id:"NOT_SIGN_OUT",text:"未签退"},{id:"MANUAL_SIGN_OUT",text:"手动签退"},{id:"ASK_FOR_LEAVE",text:"请假"}],managedColleges:[]},addPersonModal:{show:!1,userNo:null,userName:null,userId:null,tip:null},signManualModal:{show:!1,remark:null,signId:null,userId:null,userNo:null},editSignModal:{hourStart:"",hourEnd:"",weekDay:"",weekDayList:[],show:!1,name:null,startTime:"",isSignOut:!1,startTimeToHours:"",endTimeToHours:"",endTime:"",signWays:{qrcode:"qrcode",location:"location",outside:"outside"},signWay:"qrcode",useDynamicCode:!1,scanQrcodeWithLocation:!1,locations:[],qrcodeLocations:[],activeLocationIndex:0,project:null,projectId:null,maxLength:20,dateFormat:"yyyy-MM-dd hh:ii:ss"},qrcode:{fullscreen:!1,oldInstance:null,url:"",instance:null,timer:null},statModal:{show:!1,syncTime:"",totalWidth:550,minWidth:10,loading:!1,noStat:!1,generalChart:{init:!1,instance:null,options:{tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},color:["rgba(92, 107, 192, 1)","rgba(92, 107, 192, .75)","rgba(92, 107, 192, .5)"],series:[{name:"统计",type:"pie",radius:"60%",center:["49%","41%"],data:[],label:{normal:{show:!0}},labelLine:{normal:{show:!0}},itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},legend:{done:{color:"rgba(92, 107, 192, 1)",text:"已签到",num:0},todo:{color:"rgba(92, 107, 192, 0.5)",text:"未签到",num:0}}},currentControl:"general",control:{general:{text:"总览",show:!0,checked:!0,loading:!1},college:{text:"各学院对比",show:!0,checked:!1,type:"COLLEGE",data:[],loading:!1},instructor:{text:"各辅导员对比",show:!0,checked:!1,type:"INSTRUCTOR",data:[],loading:!1},clazz:{text:"各班级对比",show:!0,checked:!1,type:"CLAZZ",data:[],loading:!1}}},proxy:{proxies:[],id:null,distributary:S,proxyId:null,name:"",classId:"",collegeCode:""},exporting:!1,showImgDetailStatus:!1,showAddressModal:!1,addressRecord:{},deleteImgWidth:1,imgDetailSrc:""}},beforeDestroy:function(){this.setInterFun&&(clearInterval(this.setInterFun),this.setInterFun=null,this.oldHasSignList=null)},created:function(){var t=this;if(this.setUrl(),this.getUnitList(),this.setGrade(),this.getEdu(),"loop"==this.sign.checkInType&&"week"==this.sign.frequency){this.editSignModal.weekDay=this.sign.weekDay,this.editSignModal.weekDayList=[];for(var e=this.sign.weekDay.split("&"),a=0;a<e.length;a++){var i=e[a].split(",");this.editSignModal.weekDayList.push({date:this.dateToCn(a),startTime:i[1],endTime:i[2]})}}var s=window.localStorage.getItem("lang");s&&Object(u.g)(s)&&(this.lang=s),this.datePickerStartTime=this.sign.startTime,this.datePickerEndTime=this.sign.endTime,Object(u.e)({url:"/api/relClass/classes/list",dataType:"json",type:"get",async:!1,success:function(e){e.state&&(t.classArr=e.data)}}),this.isProxy&&this.initProxies(),this.initEditSignModal(),this.sign.needOut?this.initTable():this.initManagedColleges(function(){t.initTable()}),this.stopQrcodeTimer()},mounted:function(){this.isProxy||"qrcode"===this.editSignModal.signWay&&this.initQrcode()},computed:{messageToTargetList:function(){return this.editSignModal.isSignOut?[{label:"所有人",value:"ALL_STUDENT"},{label:"未签到",value:"NOT_SIGN"},{label:"请假",value:"ASK_FOR_LEAVE"}]:[{label:"所有人",value:"ALL_STUDENT"},{label:"未签到",value:"NOT_SIGN"}]},tabList:function(){return this.editSignModal.isSignOut?[{id:"signIn",name:"签到"},{id:"signOut",name:"签退"}]:[{id:"signIn",name:"签到"}]},i18n:function(){return Object(u.g)(this.lang).iSign},isManager:function(){return"MANAGE"===this.userType},isALL:function(){return"ALL"===this.userType},isProxy:function(){return"PROXY"===this.userType},qrCodeExpireTime:function(){return this.sign.useDynamicCode?15:0}},watch:{signTabVal:function(){this.initTable(),this.refreshQrcode()},"tableParams.ts":function(){this.setUrl()}},methods:{goToSendMessage:function(){sessionStorage.setItem("signIdSend",this.sign.id),sessionStorage.setItem("fromOutSedMessage",!0),this.$addBread({route:"/messageBox/messageManage",title:"消息盒子"})},showImgDetail:function(t){this.showImgDetailStatus=!0,this.imgDetailSrc="/downloads/storage/images/"+t,window.onmousewheel=document.onmousewheel=this.scrollImg},showAddressDetail:function(t){this.showAddressModal=!0,this.addressRecord={lat:t.latitude,lng:t.longitude}},scrollImg:function(t){this.showImgDetailStatus&&(t.deltaY>0?this.deleteImgWidth<2&&(this.deleteImgWidth+=.1):this.deleteImgWidth>.2&&(this.deleteImgWidth-=.1))},statDateChange:function(t){t&&("general"!=this.statModal.currentControl?this.changeStatType(this.statModal.currentControl):this.showStat())},getUnitList:function(){var t=this;Object(u.e)({type:"get",url:"/api/colleges/units",success:function(e){e.state?t.unitList=e.data:t.unitList=[]}})},_sureToOutput:function(){if(!this.outputList.length)return this.$toast("请选择导出的字段");var t="/downloads/signIns/peoples/excel/"+this.userType+"?signInId="+this.sign.id+"&fields="+this.outputList.join(","),e=this.$refs["sign-table"].tableSearchFields||{};for(var a in this.dateArea.length&&(t+="&startTime="+this.dateArea[0]+"&endTime="+this.dateArea[1]+"&"),e)t+=a+"="+e[a]+"&";window.location.href=t},setUrl:function(){this.sign.needOut?(this.sign.isAgent&&(this.tableUrl="/table-data/ca/signIn/agent/person/page/"+this.signTabVal+"/"+this.sign.id+"?ts="+this.tableParams.ts),this.tableUrl="/table-data/ca/signIn/person/page/"+this.signTabVal+"/"+this.sign.id+"?ts="+this.tableParams.ts):this.isManager||this.isALL?this.tableUrl="/table-data/signIns/peoples/MANAGE?signInId="+this.sign.id+"&ts="+this.tableParams.ts:this.isProxy&&(this.proxy.proxyId?this.tableUrl="/table-data/signIns/"+this.sign.id+"/people/pages?ts="+this.tableParams.ts+"&agentId="+this.proxy.proxyId+"&classId="+(this.proxy.classId||"")+"&collegeCode="+(this.proxy.collegeCode||""):this.tableUrl="")},dateChange:function(t){var e=this;this.isALL=!0,this.isManager=!1,this.$nextTick(function(){e.isProxy?e.proxy.proxyId?e.tableUrl="/table-data/signIns/"+e.sign.id+"/people/pages?ts="+e.tableParams.ts+"&startTime="+t[0]+"&endTime="+t[1]+"&agentId="+e.proxy.proxyId+"&classId="+(e.proxy.classId||"")+"&collegeCode="+(e.proxy.collegeCode||""):e.tableUrl="":e.tableUrl="/table-data/signIns/peoples/MANAGE?signInId="+e.sign.id+"&startTime="+t[0]+"&endTime="+t[1]+"&ts="+(new Date).getTime()})},editMethod:function(t){var e=this;setTimeout(function(){if("day"==t.selectType)e.$set(e.editSignModal,"hourStart",e.editSignModal.startTimeToHours),e.$set(e.editSignModal,"hourEnd",e.editSignModal.endTimeToHours);else{var a=e.editSignModal.weekDay,i=[];e.editSignModal.weekDayList=[];for(var s=a.split("&"),n=0;n<s.length;n++){var o=s[n].split(",");i.push({date:e.dateToCn(n),startTime:o[1],endTime:o[2]})}e.$set(e.editSignModal,"weekDayList",i)}},300)},dateToCn:function(t){switch(t){case 0:return"星期一";case 1:return"星期二";case 2:return"星期三";case 3:return"星期四";case 4:return"星期五";case 5:return"星期六";case 6:return"星期日"}},setGrade:function(){for(var t=(new Date).getFullYear(),e=[],a=[],i=0;i<6;i++)e.push({label:t-i+"",value:t-i});for(var s=1;s<11;s++)a.push({label:t+s+"",value:t+s});this.gradeYear=e.reverse().concat(a)},getEdu:function(){var t=this;Object(u.e)({url:"/api/system/dicts?dictType=培养层次",type:"get",success:function(e){e.state?t.eduList=e.data:t.eduList=[]}})},_changeOutputList:function(t){var e=this.outputList.indexOf(t.fieldName);if(e>=0){this.outputList.splice(e,1);var a=this.outputList.indexOf("allChoice");a>=0&&this.outputList.splice(a,1)}else this.outputList.push(t.fieldName)},sendMessage:function(){var t=this,e="api/ca/signIn/person/message/"+this.signTabVal+"/"+this.sign.id;this.sign.isAgent&&(e="api/ca/signIn/agent/person/message/"+this.signTabVal+"/"+this.sign.id),this.adviceParams.sendTimeType?"TIMING"!==this.adviceParams.sendTimeType||this.adviceParams.sendTime?this.adviceParams.content?this.adviceParams.messageToTarget?Object(u.d)(e,this.adviceParams).then(function(e){e.state&&(t.showAdviceModal=!1,t.$toast("操作成功!"))}):this.$toast("请选择发送对象!"):this.$toast("请输入发送内容!"):this.$toast("发送时间不能为空!"):this.$toast("请选择发送!")},sendTimeSelected:function(t){t.value&&new Date(t.value)<new Date&&(this.$toast("发送时间已过期!"),this.adviceParams.sendTime="")},addPersonByOne:function(){this.addPersonModal.show=!0,this.showAddModal=!1},batchAddPerson:function(){var t=this;this.$parent.importParams={parentPageTitle:"",downloadTemplateUrl:"/ca/signIn/batch/template",downloadErrorTemplateUrl:"/ca/courses/batch/error",checkTemplateUrl:"/ca/signIn/batch/excel/"+this.sign.id,templateName:"批量导入模板",importBtnType:[{url:"/ca/signIn/batch/update",method:"post",isShowBtn:!0,name:"增量导入",success:function(e){t.$parent.timestamp="?timestamp="+(new Date).getTime(),t.$parent.curRoute="signInfo"}}]},this.sign.isAgent&&(this.$parent.importParams.checkTemplateUrl="/ca/signIn/agent/batch/excel/"+this.sign.id),this.$parent.quickAddRecord()},back:function(){this.$emit("back")},initEditSignModal:function(){this.editSignModal.signId=this.sign.id,this.editSignModal.projectId=this.sign.projectId,this.editSignModal.hourStart=this.sign.hourStart,this.editSignModal.hourEnd=this.sign.hourEnd,this.editSignModal.name=this.sign.name,this.editSignModal.startTime=this.sign.startTime,this.editSignModal.endTime=this.sign.endTime,this.editSignModal.useDynamicCode=this.sign.useDynamicCode,this.editSignModal.signWay=this.sign.signWay,this.editSignModal.scanQrcodeWithLocation=this.sign.scanQrcodeWithLocation,this.editSignModal.qrcodeLocations=this.sign.qrcodeLocations,this.editSignModal.locations=this.sign.locations.map(function(t){return t.init=!0,t}),this.editSignModal.signOutTimeEnd=this.sign.signOutTimeEnd,this.editSignModal.signOutTimeStart=this.sign.signOutTimeStart,this.editSignModal.isSignOut=this.sign.isSignOut,this.editSignModal.needOut=this.sign.needOut},initTable:function(){var t=this;if(this.sign.needOut){var e=this;this.tableParams.columns=[{id:"userNo",title:this.i18n.signInfo.userNo,className:"text-left",width:"120px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"name",title:this.i18n.signInfo.userName,className:"text-left",width:"55px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"college",title:this.i18n.signInfo.college,className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code",placeholder:""}},formatter:function(t){return t.college}},{id:"classId",title:"行政班级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.classArr,optionsLabel:"text",optionsValue:"id",placeholder:""}},formatter:function(t){return t.className}},{id:"signInStatus",title:"签到状态",className:"text-left",width:"80px",hidden:"signIn"!==e.signTabVal,formatter:function(t){return b[t.signInStatus]},search:{type:"select",data:{options:this.searchOptions.newSignInStatus,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signInTime",title:this.i18n.signInfo.signTime,className:"text-left",width:"150px",hidden:"signIn"!==e.signTabVal},{id:"signOutStatus",title:"签退状态",className:"text-left",width:"60px",hidden:"signIn"===e.signTabVal,formatter:function(t){return"请假"===b[t.signInStatus]?b[t.signInStatus]:b[t.signOutStatus]},search:{type:"select",data:{options:this.searchOptions.newSignOutStatus,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signOutTime",title:"签退时间",className:"text-left",width:"150px",hidden:"signIn"===e.signTabVal},{id:"opt",title:"操作",className:"text-right",hidden:!1,formatter:function(t){var a={signInStatus:{in:"SIGN_IN",not:"NOT_SIGN_IN",manual:"MANUAL_SIGN_IN"},signOutStatus:{in:"SIGN_OUT",not:"NOT_SIGN_OUT",manual:"MANUAL_SIGN_OUT"}},i=[],s="",n="";return"signIn"===e.signTabVal?(s="signInStatus",n="签到"):(s="signOutStatus",n="签退"),"ASK_FOR_LEAVE"==t.signInStatus?"signIn"===e.signTabVal&&i.push({tag:"a",text:"取消请假",className:"opt-btn",callback:function(t,a){var i="api/ca/signIn/cancel/askForLeave/"+e.signTabVal+"/"+t.userId+"/"+t.signInId;Object(u.d)(i,{},"post").then(function(t){e.tableParams.ts=+new Date})}}):"ASK_FOR_LEAVE"===t.signOutStatus?"signIn"!==e.signTabVal&&i.push({tag:"a",text:"取消请假",className:"opt-btn",callback:function(t,a){var i="api/ca/signIn/cancel/askForLeave/"+e.signTabVal+"/"+t.userId+"/"+t.signInId;Object(u.d)(i,{},"post").then(function(t){e.tableParams.ts=+new Date})}}):t[s]==a[s].not?(i.push({tag:"a",text:"手动"+n,className:"opt-btn",callback:function(t,a){var i="api/ca/signIn/manualSign/"+e.signTabVal+"/"+t.userId+"/"+t.signInId;Object(u.d)(i,{},"post").then(function(t){e.tableParams.ts=+new Date})}}),i.push({tag:"a",text:"请假",className:"opt-btn",callback:function(t,a){var i="api/ca/signIn/askForLeave/"+e.signTabVal+"/"+t.userId+"/"+t.signInId;Object(u.d)(i,{},"post").then(function(t){e.tableParams.ts=new Date})}})):t[s]==a[s].manual&&i.push({tag:"a",text:"取消手动"+n,className:"opt-btn",callback:function(t,a){var i="api/ca/signIn/cancel/manualSign/"+e.signTabVal+"/"+t.userId+"/"+t.signInId;Object(u.d)(i,{},"post").then(function(t){e.tableParams.ts=+new Date})}}),i.push({tag:"a",text:"删除",className:"opt-btn",callback:function(t,a){if(confirm("是否删除?")){var i="api/ca/signIn/delete/"+t.userId+"/"+t.signInId;Object(u.d)(i,{},"post").then(function(t){e.tableParams.ts=new Date})}}}),i}}]}else"outside"!==this.editSignModal.signWay?"PROXY"===this.userType?this.tableParams.columns=[{id:"name",title:this.i18n.signInfo.userName,className:"text-left",width:"55px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"userNo",title:this.i18n.signInfo.userNo,className:"text-left",width:"120px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"collegeCode",title:this.i18n.signInfo.college,className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code",placeholder:""}},formatter:function(t){return t.college}},{id:"classId",title:"班级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.classArr,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"status",title:this.i18n.signInfo.signStatus,className:"text-left",width:"60px",hidden:!1,formatter:function(t){return y[t.signInStatus]},search:{type:"select",data:{options:this.searchOptions.status,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signInTime",title:this.i18n.signInfo.signTime,className:"text-left",width:"150px",hidden:!1},{id:"remark",title:this.i18n.signInfo.remark,className:"text-left",width:"250px",hidden:!1},{id:"opt",title:"",className:"text-right",hidden:!1,formatter:function(e){var a=[];return"NOT_SIGN"==e.signInStatus&&a.push({tag:"a",text:t.i18n.signInfo.recordByHand,className:"opt-btn",callback:function(e,a){t.signManualModal.userId=e.userId,t.signManualModal.userNo=e.userNo,t.signManualModal.signId=e.signInId,t.signManualModal.createDate=e.createDate,t.signManualModal.show=!0}}),t.isManager&&a.push({tag:"a",text:t.i18n.signInfo.remove,className:"opt-btn",callback:function(e,a){window.confirm("确定把"+e.name+"从此次签到中移除?")&&h.a.removePersonFromSign(e.signInId,e.userId,e.createDate,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast(t.i18n.tip.removeSuccess),void(t.tableParams.ts=+new Date)):t.$toast(a.message)})}}),a}}]:this.tableParams.columns=[{id:"name",title:this.i18n.signInfo.userName,className:"text-left",width:"55px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"userNo",title:this.i18n.signInfo.userNo,className:"text-left",width:"120px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"college",title:this.i18n.signInfo.college,className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code",placeholder:""}},formatter:function(t){return t.college}},{id:"classId",title:"班级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.classArr,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"grade",title:"年级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.gradeYear,optionsLabel:"label",optionsValue:"value",placeholder:""}}},{id:"educationLevel ",title:"培养层次",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.eduList,optionsLabel:"label",optionsValue:"value",placeholder:""}}},{id:"unit",title:"部门",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.unitList,optionsLabel:"name",optionsValue:"id",placeholder:""}}},{id:"signInStatus",title:this.i18n.signInfo.signStatus,className:"text-left",width:"60px",hidden:!1,formatter:function(t){return y[t.signInStatus]},search:{type:"select",data:{options:this.searchOptions.status,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signInTime",title:this.i18n.signInfo.signTime,className:"text-left",width:"150px",hidden:!1},{id:"remark",title:this.i18n.signInfo.remark,className:"text-left",width:"250px",hidden:!1},{id:"opt",title:"",className:"text-right",hidden:!1,formatter:function(e){var a=[];return"NOT_SIGN"==e.signInStatus&&a.push({tag:"a",text:t.i18n.signInfo.recordByHand,className:"opt-btn",callback:function(e,a){t.signManualModal.userId=e.userId,t.signManualModal.userNo=e.userNo,t.signManualModal.signId=e.signInId,t.signManualModal.createDate=e.createDate,t.signManualModal.show=!0}}),t.isManager&&a.push({tag:"a",text:t.i18n.signInfo.remove,className:"opt-btn",callback:function(e,a){window.confirm("确定把"+e.name+"从此次签到中移除?")&&h.a.removePersonFromSign(e.signInId,e.userId,e.createDate,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast(t.i18n.tip.removeSuccess),void(t.tableParams.ts=+new Date)):t.$toast(a.message)})}}),a}}]:"PROXY"===this.userType?this.tableParams.columns=[{id:"name",title:this.i18n.signInfo.userName,className:"text-left",width:"55px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"userNo",title:this.i18n.signInfo.userNo,className:"text-left",width:"120px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"collegeCode",title:this.i18n.signInfo.college,className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code",placeholder:""}},formatter:function(t){return t.college}},{id:"classId",title:"班级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.classArr,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"status",title:this.i18n.signInfo.signStatus,className:"text-left",width:"60px",hidden:!1,formatter:function(t){return y[t.signInStatus]},search:{type:"select",data:{options:this.searchOptions.status,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signInTime",title:this.i18n.signInfo.signTime,className:"text-left",width:"150px",hidden:!1},{id:"address",title:"打卡地点",className:"text-left",width:"150px",hidden:!1,formatter:function(e){var a=[];return a.push({tag:"a",text:e.address,className:"opt-btn",callback:function(e,a){t.showAddressDetail(e)}}),a}},{id:"remark",title:this.i18n.signInfo.remark,className:"text-left",width:"250px",hidden:!1},{id:"opt",title:"",className:"text-right",hidden:!1,formatter:function(e){var a=[];return"NOT_SIGN"==e.signInStatus&&a.push({tag:"a",text:t.i18n.signInfo.recordByHand,className:"opt-btn",callback:function(e,a){t.signManualModal.userId=e.userId,t.signManualModal.userNo=e.userNo,t.signManualModal.signId=e.signInId,t.signManualModal.createDate=e.createDate,t.signManualModal.show=!0}}),t.isManager&&a.push({tag:"a",text:t.i18n.signInfo.remove,className:"opt-btn",callback:function(e,a){window.confirm("确定把"+e.name+"从此次签到中移除?")&&h.a.removePersonFromSign(e.signInId,e.userId,e.createDate,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast(t.i18n.tip.removeSuccess),void(t.tableParams.ts=+new Date)):t.$toast(a.message)})}}),a}}]:this.tableParams.columns=[{id:"name",title:this.i18n.signInfo.userName,className:"text-left",width:"55px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"userNo",title:this.i18n.signInfo.userNo,className:"text-left",width:"120px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"college",title:this.i18n.signInfo.college,className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code",placeholder:""}},formatter:function(t){return t.college}},{id:"classId",title:"班级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.classArr,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"grade",title:"年级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.gradeYear,optionsLabel:"label",optionsValue:"value",placeholder:""}}},{id:"educationLevel ",title:"培养层次",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.eduList,optionsLabel:"label",optionsValue:"value",placeholder:""}}},{id:"unit",title:"部门",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.unitList,optionsLabel:"name",optionsValue:"id",placeholder:""}}},{id:"signInStatus",title:this.i18n.signInfo.signStatus,className:"text-left",width:"60px",hidden:!1,formatter:function(t){return y[t.signInStatus]},search:{type:"select",data:{options:this.searchOptions.status,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signInTime",title:this.i18n.signInfo.signTime,className:"text-left",width:"150px",hidden:!1},{id:"address",title:"打卡地点",className:"text-left",width:"150px",hidden:!1,formatter:function(e){var a=[];return a.push({tag:"a",text:e.address,className:"opt-btn",callback:function(e,a){t.showAddressDetail(e)}}),a}},{id:"remark",title:this.i18n.signInfo.remark,className:"text-left",width:"250px",hidden:!1},{id:"opt",title:"",className:"text-right",hidden:!1,formatter:function(e){var a=[];return e.picture&&a.push({tag:"a",text:"查看图片",className:"opt-btn",callback:function(e,a){t.showImgDetail(e.picture)}}),"NOT_SIGN"==e.signInStatus&&a.push({tag:"a",text:t.i18n.signInfo.recordByHand,className:"opt-btn",callback:function(e,a){t.signManualModal.userId=e.userId,t.signManualModal.userNo=e.userNo,t.signManualModal.signId=e.signInId,t.signManualModal.createDate=e.createDate,t.signManualModal.show=!0}}),t.isManager&&a.push({tag:"a",text:t.i18n.signInfo.remove,className:"opt-btn",callback:function(e,a){window.confirm("确定把"+e.name+"从此次签到中移除?")&&h.a.removePersonFromSign(e.signInId,e.userId,e.createDate,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast(t.i18n.tip.removeSuccess),void(t.tableParams.ts=+new Date)):t.$toast(a.message)})}}),a}}]},toEditSign:function(){this.editSignModal.show=!0},normalizeDateString:function(t){return t&&19!==t.length?t+":00":t},changeProxy:function(t){if(t.val){var e=t.val,a=!0,i=!1,s=void 0;try{for(var n,o=l()(this.proxy.proxies);!(a=(n=o.next()).done);a=!0){var r=n.value;r.id===e&&(this.setCurrentProxy(r),this.refreshQrcode())}}catch(t){i=!0,s=t}finally{try{!a&&o.return&&o.return()}finally{if(i)throw s}}}},saveSign:function(){var t=this;if(this.sign.needOut){var e=JSON.parse(o()(this.editSignModal));e.signInName=e.name,e.signInTimeStart=e.startTime,e.signInTimeEnd=e.endTime,e.dynamicCode=!!e.useDynamicCode,e.isLocation=!!e.scanQrcodeWithLocation,e.ranges=e.qrcodeLocations.map(function(t){return{longitude:t.lng,latitude:t.lat,distance:t.radius,address:t.address}});var a="api/ca/signIn/update/"+this.editSignModal.signId;Object(u.d)(a,e,"post").then(function(e){e.state?(t.editSignModal.useDynamicCode?(t.sign.useDynamicCode=!0,t.initQrcode()):(t.sign.useDynamicCode=!1,t.stopQrcodeTimer()),t.editSignModal.show=!1,t.$toast("操作成功!")):t.$toast(e.message)})}else h.a.editSign(this.editSignModal,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.syncSignInfo(),t.editSignModal.show=!1,"qrcode"===t.editSignModal.signWay?t.initQrcode():t.stopQrcodeTimer(),void t.$toast(t.i18n.tip.saveSuccess)):t.$toast(a.message)})},syncSignInfo:function(){this.sign.name=this.editSignModal.name,this.sign.startTime=this.editSignModal.startTime,this.sign.endTime=this.editSignModal.endTime,this.sign.hourStart=this.editSignModal.hourStart,this.sign.hourEnd=this.editSignModal.hourEnd,this.sign.useDynamicCode=this.editSignModal.useDynamicCode,this.sign.signWay=this.editSignModal.signWay,this.sign.scanQrcodeWithLocation=this.editSignModal.scanQrcodeWithLocation,this.sign.qrcodeLocations=this.editSignModal.qrcodeLocations,this.sign.locations=this.editSignModal.locations},showStat:function(){var t=this;this.statModal.loading=!0,this.statModal.show=!0;var e="",a="";this.statDate.length&&(e=this.statDate[0],a=this.statDate[1]),h.a.getGeneralSignStat(this.sign.id,e,a,function(e,a){if(e)return t.$toast(t.i18n.error.networkError);if(!a.state)return t.$toast(a.message);t.statModal.loading=!1;var i=a.data;if(!i)return t.statModal.noStat=!0;t.statModal.noStat=!1,t.statModal.generalChart.legend.done.num=i.countSign,t.statModal.generalChart.legend.todo.num=i.countNotSinIn,t.statModal.syncTime=i.timeTemp,t.$nextTick(function(){t.refreshGeneralChart()})})},getSignOptionWidth:function(t){var e=t.done/t.total,a=t.manual/t.total,i=t.todo/t.total;(0==t.total||i==e&&i==a)&&(i=e=a=.3333333);var s=this.statModal.totalWidth*e,n=this.statModal.totalWidth*a,o=this.statModal.totalWidth*i,r=0;return s<10&&(r+=10-s,s=10),n<10&&(r+=10-n,n=10),o<10&&(r+=10-o,o=10),s<n?n>o?n-=r:s>o?s-=r:o-=r:s>o?s-=r:n>o?n-=r:o-=r,{done:s,manual:n,todo:o}},initChartIfNotInit:function(){this.statModal.generalChart.instance=p.a.init(document.getElementById("general-chart"))},initQrcode:function(){var t=this;this.createSignUrl(function(e){e&&(t.qrcode.url=e,t.qrcode.instance?(t.qrcode.instance.clear(),t.qrcode.instance.makeCode(e)):t.sign.needOut||(t.qrcode.instance=new f.a("sign-qrcode",{text:e,width:400,height:400})),t.sign.useDynamicCode?t.startQrcodeTimer():t.stopQrcodeTimer())})},refreshQrcode:function(){var t=this;this.createSignUrl(function(e){e&&(t.qrcode.url=e,t.qrcode.instance?(t.qrcode.instance.clear(),t.qrcode.instance.makeCode(e)):t.sign.needOut||(t.qrcode.instance=new f.a("sign-qrcode",{text:e,width:400,height:400})))})},startQrcodeTimer:function(){var t=this;this.stopQrcodeTimer(),this.qrcode.timer=setInterval(function(){t.refreshQrcode()},1e4)},stopQrcodeTimer:function(){this.qrcode.timer&&(clearInterval(this.qrcode.timer),this.qrcode.timer=null)},refreshGeneralChart:function(){this.initChartIfNotInit(),this.statModal.generalChart.options.series[0].data=[{value:this.statModal.generalChart.legend.done.num,name:"已签到"},{name:"未签到",value:this.statModal.generalChart.legend.todo.num}],this.statModal.generalChart.instance.setOption(this.statModal.generalChart.options)},getRadioIcon:function(t){return t?"radio_button_checked":"radio_button_unchecked"},changeStatType:function(t){var e=this;this.statType=t;var a=this.statModal.control[t];for(var i in this.statModal.control)this.statModal.control[i].checked=!1;if(a.checked=!0,this.statModal.currentControl=t,"general"!=t){var s="",n="";this.statDate.length&&(s=this.statDate[0],n=this.statDate[1]),h.a.getSignStatByType(this.sign.id,a.type,s,n,function(t,i){return t?e.$toast(e.i18n.error.networkError):i.state?void(a.data=i.data.map(function(t){var a={overview:{total:t.overview.count,done:t.overview.countSign,manual:t.overview.countManualEntry,todo:t.overview.countNotSinIn},title:t.title,sort:t.sort};return a.widthData=e.getSignOptionWidth(a.overview),a})):e.$toast(i.message)})}else this.showStat()},fullscreen:function(){var t=this;this.qrcode.oldInstance=this.qrcode.instance,this.qrcode.fullscreen=!0,this.$nextTick(function(){t.sign.needOut?t.$parent.isAgent?t.qrcode.instance=new f.a("needOut-sign-qrcode-isAgent-fullscreen",{text:t.qrcode.url,width:400,height:400}):t.$parent.isPerson?t.qrcode.instance=new f.a("needOut-sign-qrcode-isPerson-fullscreen",{text:t.qrcode.url,width:400,height:400}):t.qrcode.instance=new f.a("needOut-sign-qrcode-fullscreen",{text:t.qrcode.url,width:400,height:400}):t.qrcode.instance=new f.a("sign-qrcode-fullscreen",{text:t.qrcode.url,width:400,height:400})}),this.sign.needOut&&(this.getHasSignList(),this.setInterFun=setInterval(function(){t.getHasSignList()},5e3))},getHasSignList:function(){var t=this,e=this.tableUrl;"signIn"===this.signTabVal?e+="&signInStatus=SIGN_IN":e+="&signOutStatus=SIGN_OUT",Object(u.d)(e).then(function(e){if(t.oldHasSignList&&(e.data.length||t.oldHasSignList.length)){var a=e.data.filter(function(e,a,i){return-1===t.oldHasSignList.indexOf(e.userNo)}),i="signIn"===t.signTabVal?"签到成功!":"签退成功!",s=0,n=t;a.length&&function t(){var e=a[s];n.$notify({title:"提示",message:e.college+e.name+i}),(s+=1)<a.length&&setTimeout(t,1e3)}()}t.oldHasSignList=e.data.map(function(t){return t.userNo})})},existFullscreen:function(){this.setInterFun&&(clearInterval(this.setInterFun),this.setInterFun=null,this.oldHasSignList=null),this.clearQrcodeInstance(),this.qrcode.instance.clear(),this.qrcode.fullscreen=!1,this.qrcode.instance=this.qrcode.oldInstance},clearQrcodeInstance:function(){for(var t=this.qrcode.instance._el;t.hasChildNodes();)t.removeChild(t.lastChild)},initManagedColleges:function(t){var e=this;h.a.getBaseSearchOptions(function(a,i){if(a)return e.$toast(e.i18n.error.networkError);if(!i.state)return e.$toast(i.message);var s=!0,n=!1,o=void 0;try{for(var r,c=l()(i.data);!(s=(r=c.next()).done);s=!0){var d=r.value;-1==d.id&&(d.id="")}}catch(a){n=!0,o=a}finally{try{!s&&c.return&&c.return()}finally{if(n)throw o}}e.searchOptions.managedColleges=i.data,e.searchOptions.colleges=e.searchOptions.managedColleges,t&&t()})},initProxies:function(){var t=this;h.a.getMyProxies(this.sign.id,function(e,a){if(e)return t.$toast(t.i18n.error.networkError);if(!a.state)return t.$toast(a.message);if(!a.data)return t.$toast(t.i18n.error.dataError);var i=[],s=[],n=[],o=[],r=!1,c=!1,d=!1,u=!1,h=!0,g=!1,p=void 0;try{for(var m,f=l()(a.data);!(h=(m=f.next()).done);h=!0){var v=m.value;switch(v.distribution){case S:i.push(t.createMixProxy(S,v.agentId,v.agentName,v.agentName,null,null)),r=!0;break;case _:for(var y in v.colleges)s.push(t.createMixProxy(_,v.agentId,v.agentName,v.colleges[y],null,y));c=!0;break;case I:for(var b in v.clazz)n.push(t.createMixProxy(I,v.agentId,v.agentName,v.clazz[b],b,null));d=!0;break;case w:o.push(t.createMixProxy(w,v.agentId,v.agentName,v.agentName,null,null)),u=!0}}}catch(e){g=!0,p=e}finally{try{!h&&f.return&&f.return()}finally{if(g)throw p}}t.proxy.proxies=i.concat(s.concat(n.concat(o))),t.setCurrentProxy(t.proxy.proxies[0]),t.$nextTick(function(){t.initQrcode()}),t.statModal.control.college.show=!1,t.statModal.control.instructor.show=!1,t.statModal.control.clazz.show=!1,r?(t.statModal.control.college.show=!0,t.statModal.control.instructor.show=!0,t.statModal.control.clazz.show=!0):c?(t.statModal.control.college.show=!0,t.statModal.control.clazz.show=!0):(u||d)&&(t.statModal.control.clazz.show=!0)})},setCurrentProxy:function(t){this.proxy.id=t.id,this.proxy.proxyId=t.proxyId,this.proxy.name=t.name,this.proxy.collegeCode=t.collegeCode,this.proxy.classId=t.classId,this.proxy.distributary=t.distributary,t.distributary===_?this.searchOptions.colleges=[{id:t.collegeCode,text:t.name}]:this.searchOptions.colleges=this.searchOptions.managedColleges,this.tableParams.ts=(new Date).getTime()},createMixProxy:function(t,e,a,i,s,n){return{id:t+"-"+e+"-"+(s||"__")+"-"+(n||"__"),proxyId:e,distributary:t,proxyName:a,name:i,classId:s||"",collegeCode:n||""}},signManual:function(){var t=this;if(!this.signManualModal.remark)return this.$toast("您还未填写备注");var e={createDate:this.signManualModal.createDate,signId:this.sign.id,userId:this.signManualModal.userId,remark:this.signManualModal.remark,callback:function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast(t.i18n.tip.setSuccess),t.tableParams.ts=(new Date).getTime(),void(t.signManualModal.show=!1)):t.$toast(a.message)}};h.a.signManual(e)},checkUser:function(){var t=this;if(!this.addPersonModal.userNo)return this.$toast("请输入学号");this.addPersonModal.userId=null,this.addPersonModal.tip="检测中...",h.a.checkUserNo(this.addPersonModal.userNo,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.addPersonModal.userId=a.data.userId,void(t.addPersonModal.userName=t.addPersonModal.tip=a.data.name)):"50001"==a.code?t.addPersonModal.tip="不存在该学号":t.$toast(a.message)})},afterSelectAddPerson:function(t){this.addPersonModal.userId=t.userId,this.addPersonModal.userNo=t.userNo,this.addPersonModal.name=t.name},cancelAddSignPeople:function(){this.addPersonModal.show=!1},addSignPeople:function(){var t=this;if(!this.addPersonModal.userId)return this.$toast("请输入学号或者姓名!");if(this.sign.needOut){var e="api/ca/signIn/"+this.addPersonModal.userId+"/"+this.sign.id;return this.sign.isAgent&&(e="api/ca/signIn/agent/"+this.addPersonModal.userId+"/"+this.sign.id),void Object(u.d)(e,{},"post").then(function(e){e.state?(t.$toast("添加成功"),t.tableParams.ts=+new Date,t.addPersonModal.show=!1):t.$toast(e.message)})}h.a.addSignPeople(this.project.id,this.sign.id,this.addPersonModal.userId,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast("添加成功"),t.tableParams.ts=+new Date,void(t.addPersonModal.show=!1)):"50003"==a.code?t.$toast("该人员已经在签到名单中"):t.$toast(a.message)})},createSignUrl:function(t){var e=this;this.sign.needOut?Object(u.d)("api/ca/system/saasId").then(function(a){var i="default";a.state&&(i=a.data);var s=window.location.origin+"/mobileTowCodeSign?isSign=true&signId="+e.sign.id+"&signTabVal="+e.signTabVal+"&timestamp="+(new Date).getTime()+"&sysId="+i;t(s)}):h.a.createSignUrl(this.sign.id,this.proxy.distributary,this.proxy.collegeCode,this.proxy.classId,this.qrCodeExpireTime,function(a,i){if(a)return t(),e.$toast(e.i18n.error.networkError);if(!i.state)return t(),e.$toast(i.message);var s=window.location.origin+i.data+"?scope=yiban_scan_result";t(s)})},getOutText:function(){var t=this;if(this.formFields.length)return!1;Object(u.e)({url:"/api/signIns/peoples/export/fields",type:"get",success:function(e){if(e.state)for(var a in e.data)t.formFields.push({fieldName:a,fieldTitle:e.data[a]});else t.formFields=[]}})},exportSigns:function(){var t=this.$refs["sign-table"].tableSearchFields||{};if(this.sign.needOut){var e=(new Date).format("yyyy-MM-dd")+this.sign.name;"signIn"===this.signTabVal?e+="签到列表":e+="签退列表";var a="/downloads/ca/signIn/person/export/"+this.signTabVal+"/"+this.sign.id+"?filename="+e+"&";for(var i in this.sign.isAgent&&(a="/downloads/ca/signIn/agent/person/export/"+this.signTabVal+"/"+this.sign.id+"?filename="+e+"&"),t)a+=i+"="+t[i]+"&";return a=a.substring(0,a.length-1),void(window.location.href=a)}if(this.isManager)this.getOutText(),this.outputModalShow=!0;else{var s=this.project.name+this.sign.name+".xlsx";h.a.exportSignsOfProxy(this.sign.id,this.proxy.proxyId,t.name,t.userNo,this.proxy.collegeCode||t.college,this.proxy.classId,t.signInStatus,s,this.dateArea)}}}},"beforeDestroy",function(){this.stopQrcodeTimer()}),{NOT_SIGN:"未签到",SIGN:"已签到",MANUAL_ENTRY:"手工签到",TIME_OUT_NOT_SIGN:"超时未签到"}),T={SIGN_IN:" 已签到",NOT_SIGN_IN:" 未签到",MANUAL_SIGN_IN:"手动签到",SIGN_OUT:" 已签退",NOT_SIGN_OUT:" 未签退",MANUAL_SIGN_OUT:"手动签退",ASK_FOR_LEAVE:"请假"},M="SCHOOL",x="COLLEGE",N="CLASS",k="RELATIONSHIP",L=s()({components:{VIcon:c.a,SignInfoModal:d.a},props:{project:Object,sign:Object,userType:String},data:function(){return{signWayText:{location:"定位签到",qrcode:"扫码签到",outside:"外勤打卡"},searchVal:"",statType:"",statDate:[],eduList:[],gradeYear:[],formFields:[],unitList:[],tableUrl:"",dateArea:"",outputModalShow:!1,outputList:[],downLoadDate:"",classArr:[],loader:v.a,lang:"zh-cn",datePickerStartTime:"",datePickerEndTime:"",showAdviceModal:!1,adviceParams:{sendTimeType:"IMMEDIATELY",sendTime:"",content:"",messageToTarget:"ALL_STUDENT"},sendTimeTypeList:[{label:"立即发送",value:"IMMEDIATELY"},{label:"定时发送",value:"TIMING"}],tableParams:{pagesize:10,idField:"id",columns:[],multi:!1,order:!0,search:!1,ts:+new Date},showAddModal:!1,signTabVal:"signIn",searchOptions:{colleges:[],status:[{id:"NOT_SIGN",text:"未签到"},{id:"SIGN",text:"已签到"},{id:"MANUAL_ENTRY",text:"手工签到"}],newSignInStatus:[{id:"SIGN_IN",text:"已签到"},{id:"NOT_SIGN_IN",text:"未签到"},{id:"MANUAL_SIGN_IN",text:"手动签到"},{id:"ASK_FOR_LEAVE",text:"请假"}],newSignOutStatus:[{id:"SIGN_OUT",text:"已签退"},{id:"NOT_SIGN_OUT",text:"未签退"},{id:"MANUAL_SIGN_OUT",text:"手动签退"},{id:"ASK_FOR_LEAVE",text:"请假"}],managedColleges:[]},addPersonModal:{show:!1,userNo:null,userName:null,userId:null,tip:null},signManualModal:{show:!1,remark:null,signId:null,userId:null,userNo:null},editSignModal:{hourStart:"",hourEnd:"",weekDay:"",weekDayList:[],show:!1,name:null,startTime:"",isSignOut:!1,startTimeToHours:"",endTimeToHours:"",endTime:"",signWays:{qrcode:"qrcode",location:"location",outside:"outside"},signWay:"qrcode",useDynamicCode:!1,scanQrcodeWithLocation:!1,locations:[],qrcodeLocations:[],activeLocationIndex:0,project:null,projectId:null,maxLength:20,dateFormat:"yyyy-MM-dd hh:ii:ss"},qrcode:{fullscreen:!1,oldInstance:null,url:"",instance:null,timer:null},statModal:{show:!1,syncTime:"",totalWidth:550,minWidth:10,loading:!1,noStat:!1,generalChart:{init:!1,instance:null,options:{tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},color:["rgba(92, 107, 192, 1)","rgba(92, 107, 192, .75)","rgba(92, 107, 192, .5)"],series:[{name:"统计",type:"pie",radius:"60%",center:["49%","41%"],data:[],label:{normal:{show:!0}},labelLine:{normal:{show:!0}},itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},legend:{done:{color:"rgba(92, 107, 192, 1)",text:"已签到",num:0},todo:{color:"rgba(92, 107, 192, 0.5)",text:"未签到",num:0}}},currentControl:"general",control:{general:{text:"总览",show:!0,checked:!0,loading:!1},college:{text:"各学院对比",show:!0,checked:!1,type:"COLLEGE",data:[],loading:!1},instructor:{text:"各辅导员对比",show:!0,checked:!1,type:"INSTRUCTOR",data:[],loading:!1},clazz:{text:"各班级对比",show:!0,checked:!1,type:"CLAZZ",data:[],loading:!1}}},proxy:{proxies:[],id:null,distributary:M,proxyId:null,name:"",classId:"",collegeCode:""},exporting:!1,showImgDetailStatus:!1,showAddressModal:!1,addressRecord:{},deleteImgWidth:1,imgDetailSrc:""}},beforeDestroy:function(){this.setInterFun&&(clearInterval(this.setInterFun),this.setInterFun=null,this.oldHasSignList=null)},created:function(){var t=this;if(this.setUrl(),this.getUnitList(),this.setGrade(),this.getEdu(),"loop"==this.sign.checkInType&&"week"==this.sign.frequency){this.editSignModal.weekDay=this.sign.weekDay,this.editSignModal.weekDayList=[];for(var e=this.sign.weekDay.split("&"),a=0;a<e.length;a++){var i=e[a].split(",");this.editSignModal.weekDayList.push({date:this.dateToCn(a),startTime:i[1],endTime:i[2]})}}var s=window.localStorage.getItem("lang");s&&Object(u.g)(s)&&(this.lang=s),this.datePickerStartTime=this.sign.startTime,this.datePickerEndTime=this.sign.endTime,Object(u.e)({url:"/api/relClass/classes/list",dataType:"json",type:"get",async:!1,success:function(e){e.state&&(t.classArr=e.data)}}),this.isProxy&&this.initProxies(),this.initEditSignModal(),this.sign.needOut?this.initTable():this.initManagedColleges(function(){t.initTable()}),this.stopQrcodeTimer()},mounted:function(){this.isProxy||"qrcode"===this.editSignModal.signWay&&this.initQrcode()},computed:{messageToTargetList:function(){return this.editSignModal.isSignOut?[{label:"所有人",value:"ALL_STUDENT"},{label:"未签到",value:"NOT_SIGN"},{label:"请假",value:"ASK_FOR_LEAVE"}]:[{label:"所有人",value:"ALL_STUDENT"},{label:"未签到",value:"NOT_SIGN"}]},tabList:function(){return this.editSignModal.isSignOut?[{id:"signIn",name:"签到"},{id:"signOut",name:"签退"}]:[{id:"signIn",name:"签到"}]},i18n:function(){return Object(u.g)(this.lang).iSign},isManager:function(){return"MANAGE"===this.userType},isALL:function(){return"ALL"===this.userType},isProxy:function(){return"PROXY"===this.userType},qrCodeExpireTime:function(){return this.sign.useDynamicCode?15:0}},watch:{signTabVal:function(){this.initTable(),this.refreshQrcode()},"tableParams.ts":function(){this.setUrl()}},methods:{goToSendMessage:function(){sessionStorage.setItem("signIdSend",this.sign.id),sessionStorage.setItem("fromOutSedMessage",!0),this.$addBread({route:"/messageBox/messageManage",title:"消息盒子"})},showImgDetail:function(t){this.showImgDetailStatus=!0,this.imgDetailSrc="/downloads/storage/images/"+t,window.onmousewheel=document.onmousewheel=this.scrollImg},showAddressDetail:function(t){this.showAddressModal=!0,this.addressRecord={lat:t.latitude,lng:t.longitude}},scrollImg:function(t){this.showImgDetailStatus&&(t.deltaY>0?this.deleteImgWidth<2&&(this.deleteImgWidth+=.1):this.deleteImgWidth>.2&&(this.deleteImgWidth-=.1))},statDateChange:function(t){t&&("general"!=this.statModal.currentControl?this.changeStatType(this.statModal.currentControl):this.showStat())},getUnitList:function(){var t=this;Object(u.e)({type:"get",url:"/api/colleges/units",success:function(e){e.state?t.unitList=e.data:t.unitList=[]}})},_sureToOutput:function(){if(!this.outputList.length)return this.$toast("请选择导出的字段");var t="/downloads/signIns/peoples/excel/"+this.userType+"?signInId="+this.sign.id+"&fields="+this.outputList.join(","),e=this.$refs["sign-table"].tableSearchFields||{};for(var a in this.dateArea.length&&(t+="&startTime="+this.dateArea[0]+"&endTime="+this.dateArea[1]+"&"),e)t+=a+"="+e[a]+"&";window.location.href=t},setUrl:function(){this.sign.needOut?(this.sign.isAgent&&(this.tableUrl="/table-data/ca/signIn/agent/person/page/"+this.signTabVal+"/"+this.sign.id+"?ts="+this.tableParams.ts),this.tableUrl="/table-data/ca/signIn/person/page/"+this.signTabVal+"/"+this.sign.id+"?ts="+this.tableParams.ts):this.isManager||this.isALL?this.tableUrl="/table-data/signIns/peoples/MANAGE?signInId="+this.sign.id+"&ts="+this.tableParams.ts:this.isProxy&&(this.proxy.proxyId?this.tableUrl="/table-data/signIns/"+this.sign.id+"/people/pages?ts="+this.tableParams.ts+"&agentId="+this.proxy.proxyId+"&classId="+(this.proxy.classId||"")+"&collegeCode="+(this.proxy.collegeCode||""):this.tableUrl="")},dateChange:function(t){var e=this;this.isALL=!0,this.isManager=!1,this.$nextTick(function(){e.isProxy?e.proxy.proxyId?e.tableUrl="/table-data/signIns/"+e.sign.id+"/people/pages?ts="+e.tableParams.ts+"&startTime="+t[0]+"&endTime="+t[1]+"&agentId="+e.proxy.proxyId+"&classId="+(e.proxy.classId||"")+"&collegeCode="+(e.proxy.collegeCode||""):e.tableUrl="":e.tableUrl="/table-data/signIns/peoples/MANAGE?signInId="+e.sign.id+"&startTime="+t[0]+"&endTime="+t[1]+"&ts="+(new Date).getTime()})},editMethod:function(t){var e=this;setTimeout(function(){if("day"==t.selectType)e.$set(e.editSignModal,"hourStart",e.editSignModal.startTimeToHours),e.$set(e.editSignModal,"hourEnd",e.editSignModal.endTimeToHours);else{var a=e.editSignModal.weekDay,i=[];e.editSignModal.weekDayList=[];for(var s=a.split("&"),n=0;n<s.length;n++){var o=s[n].split(",");i.push({date:e.dateToCn(n),startTime:o[1],endTime:o[2]})}e.$set(e.editSignModal,"weekDayList",i)}},300)},dateToCn:function(t){switch(t){case 0:return"星期一";case 1:return"星期二";case 2:return"星期三";case 3:return"星期四";case 4:return"星期五";case 5:return"星期六";case 6:return"星期日"}},setGrade:function(){for(var t=(new Date).getFullYear(),e=[],a=[],i=0;i<6;i++)e.push({label:t-i+"",value:t-i});for(var s=1;s<11;s++)a.push({label:t+s+"",value:t+s});this.gradeYear=e.reverse().concat(a)},getEdu:function(){var t=this;Object(u.e)({url:"/api/system/dicts?dictType=培养层次",type:"get",success:function(e){e.state?t.eduList=e.data:t.eduList=[]}})},_changeOutputList:function(t){var e=this.outputList.indexOf(t.fieldName);if(e>=0){this.outputList.splice(e,1);var a=this.outputList.indexOf("allChoice");a>=0&&this.outputList.splice(a,1)}else this.outputList.push(t.fieldName)},sendMessage:function(){var t=this,e="api/ca/signIn/person/message/"+this.signTabVal+"/"+this.sign.id;this.sign.isAgent&&(e="api/ca/signIn/agent/person/message/"+this.signTabVal+"/"+this.sign.id),this.adviceParams.sendTimeType?"TIMING"!==this.adviceParams.sendTimeType||this.adviceParams.sendTime?this.adviceParams.content?this.adviceParams.messageToTarget?Object(u.d)(e,this.adviceParams).then(function(e){e.state&&(t.showAdviceModal=!1,t.$toast("操作成功!"))}):this.$toast("请选择发送对象!"):this.$toast("请输入发送内容!"):this.$toast("发送时间不能为空!"):this.$toast("请选择发送!")},sendTimeSelected:function(t){t.value&&new Date(t.value)<new Date&&(this.$toast("发送时间已过期!"),this.adviceParams.sendTime="")},addPersonByOne:function(){this.addPersonModal.show=!0,this.showAddModal=!1},batchAddPerson:function(){var t=this;this.$parent.importParams={parentPageTitle:"",downloadTemplateUrl:"/ca/signIn/batch/template",downloadErrorTemplateUrl:"/ca/courses/batch/error",checkTemplateUrl:"/ca/signIn/batch/excel/"+this.sign.id,templateName:"批量导入模板",importBtnType:[{url:"/ca/signIn/batch/update",method:"post",isShowBtn:!0,name:"增量导入",success:function(e){t.$parent.timestamp="?timestamp="+(new Date).getTime(),t.$parent.curRoute="signInfo"}}]},this.sign.isAgent&&(this.$parent.importParams.checkTemplateUrl="/ca/signIn/agent/batch/excel/"+this.sign.id),this.$parent.quickAddRecord()},back:function(){this.$emit("back")},initEditSignModal:function(){this.editSignModal.signId=this.sign.id,this.editSignModal.projectId=this.sign.projectId,this.editSignModal.hourStart=this.sign.hourStart,this.editSignModal.hourEnd=this.sign.hourEnd,this.editSignModal.name=this.sign.name,this.editSignModal.startTime=this.sign.startTime,this.editSignModal.endTime=this.sign.endTime,this.editSignModal.useDynamicCode=this.sign.useDynamicCode,this.editSignModal.signWay=this.sign.signWay,this.editSignModal.scanQrcodeWithLocation=this.sign.scanQrcodeWithLocation,this.editSignModal.qrcodeLocations=this.sign.qrcodeLocations,this.editSignModal.locations=this.sign.locations.map(function(t){return t.init=!0,t}),this.editSignModal.signOutTimeEnd=this.sign.signOutTimeEnd,this.editSignModal.signOutTimeStart=this.sign.signOutTimeStart,this.editSignModal.isSignOut=this.sign.isSignOut,this.editSignModal.needOut=this.sign.needOut},initTable:function(){var t=this;if(this.sign.needOut){var e=this;this.tableParams.columns=[{id:"userNo",title:this.i18n.signInfo.userNo,className:"text-left",width:"120px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"name",title:this.i18n.signInfo.userName,className:"text-left",width:"55px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"college",title:this.i18n.signInfo.college,className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code",placeholder:""}},formatter:function(t){return t.college}},{id:"classId",title:"行政班级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.classArr,optionsLabel:"text",optionsValue:"id",placeholder:""}},formatter:function(t){return t.className}},{id:"signInStatus",title:"签到状态",className:"text-left",width:"80px",hidden:"signIn"!==e.signTabVal,formatter:function(t){return T[t.signInStatus]},search:{type:"select",data:{options:this.searchOptions.newSignInStatus,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signInTime",title:this.i18n.signInfo.signTime,className:"text-left",width:"150px",hidden:"signIn"!==e.signTabVal},{id:"signOutStatus",title:"签退状态",className:"text-left",width:"60px",hidden:"signIn"===e.signTabVal,formatter:function(t){return"请假"===T[t.signInStatus]?T[t.signInStatus]:T[t.signOutStatus]},search:{type:"select",data:{options:this.searchOptions.newSignOutStatus,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signOutTime",title:"签退时间",className:"text-left",width:"150px",hidden:"signIn"===e.signTabVal},{id:"opt",title:"操作",className:"text-right",hidden:!1,formatter:function(t){var a={signInStatus:{in:"SIGN_IN",not:"NOT_SIGN_IN",manual:"MANUAL_SIGN_IN"},signOutStatus:{in:"SIGN_OUT",not:"NOT_SIGN_OUT",manual:"MANUAL_SIGN_OUT"}},i=[],s="",n="";return"signIn"===e.signTabVal?(s="signInStatus",n="签到"):(s="signOutStatus",n="签退"),"ASK_FOR_LEAVE"==t.signInStatus?"signIn"===e.signTabVal&&i.push({tag:"a",text:"取消请假",className:"opt-btn",callback:function(t,a){var i="api/ca/signIn/cancel/askForLeave/"+e.signTabVal+"/"+t.userId+"/"+t.signInId;Object(u.d)(i,{},"post").then(function(t){e.tableParams.ts=+new Date})}}):"ASK_FOR_LEAVE"===t.signOutStatus?"signIn"!==e.signTabVal&&i.push({tag:"a",text:"取消请假",className:"opt-btn",callback:function(t,a){var i="api/ca/signIn/cancel/askForLeave/"+e.signTabVal+"/"+t.userId+"/"+t.signInId;Object(u.d)(i,{},"post").then(function(t){e.tableParams.ts=+new Date})}}):t[s]==a[s].not?(i.push({tag:"a",text:"手动"+n,className:"opt-btn",callback:function(t,a){var i="api/ca/signIn/manualSign/"+e.signTabVal+"/"+t.userId+"/"+t.signInId;Object(u.d)(i,{},"post").then(function(t){e.tableParams.ts=+new Date})}}),i.push({tag:"a",text:"请假",className:"opt-btn",callback:function(t,a){var i="api/ca/signIn/askForLeave/"+e.signTabVal+"/"+t.userId+"/"+t.signInId;Object(u.d)(i,{},"post").then(function(t){e.tableParams.ts=new Date})}})):t[s]==a[s].manual&&i.push({tag:"a",text:"取消手动"+n,className:"opt-btn",callback:function(t,a){var i="api/ca/signIn/cancel/manualSign/"+e.signTabVal+"/"+t.userId+"/"+t.signInId;Object(u.d)(i,{},"post").then(function(t){e.tableParams.ts=+new Date})}}),i.push({tag:"a",text:"删除",className:"opt-btn",callback:function(t,a){if(confirm("是否删除?")){var i="api/ca/signIn/delete/"+t.userId+"/"+t.signInId;Object(u.d)(i,{},"post").then(function(t){e.tableParams.ts=new Date})}}}),i}}]}else"outside"!==this.editSignModal.signWay?"PROXY"===this.userType?this.tableParams.columns=[{id:"name",title:this.i18n.signInfo.userName,className:"text-left",width:"55px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"userNo",title:this.i18n.signInfo.userNo,className:"text-left",width:"120px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"collegeCode",title:this.i18n.signInfo.college,className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code",placeholder:""}},formatter:function(t){return t.college}},{id:"classId",title:"班级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.classArr,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"status",title:this.i18n.signInfo.signStatus,className:"text-left",width:"60px",hidden:!1,formatter:function(t){return C[t.signInStatus]},search:{type:"select",data:{options:this.searchOptions.status,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signInTime",title:this.i18n.signInfo.signTime,className:"text-left",width:"150px",hidden:!1},{id:"remark",title:this.i18n.signInfo.remark,className:"text-left",width:"250px",hidden:!1},{id:"opt",title:"",className:"text-right",hidden:!1,formatter:function(e){var a=[];return"NOT_SIGN"==e.signInStatus&&a.push({tag:"a",text:t.i18n.signInfo.recordByHand,className:"opt-btn",callback:function(e,a){t.signManualModal.userId=e.userId,t.signManualModal.userNo=e.userNo,t.signManualModal.signId=e.signInId,t.signManualModal.createDate=e.createDate,t.signManualModal.show=!0}}),t.isManager&&a.push({tag:"a",text:t.i18n.signInfo.remove,className:"opt-btn",callback:function(e,a){window.confirm("确定把"+e.name+"从此次签到中移除?")&&h.a.removePersonFromSign(e.signInId,e.userId,e.createDate,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast(t.i18n.tip.removeSuccess),void(t.tableParams.ts=+new Date)):t.$toast(a.message)})}}),a}}]:this.tableParams.columns=[{id:"name",title:this.i18n.signInfo.userName,className:"text-left",width:"55px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"userNo",title:this.i18n.signInfo.userNo,className:"text-left",width:"120px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"college",title:this.i18n.signInfo.college,className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code",placeholder:""}},formatter:function(t){return t.college}},{id:"classId",title:"班级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.classArr,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"grade",title:"年级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.gradeYear,optionsLabel:"label",optionsValue:"value",placeholder:""}}},{id:"educationLevel ",title:"培养层次",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.eduList,optionsLabel:"label",optionsValue:"value",placeholder:""}}},{id:"unit",title:"部门",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.unitList,optionsLabel:"name",optionsValue:"id",placeholder:""}}},{id:"signInStatus",title:this.i18n.signInfo.signStatus,className:"text-left",width:"60px",hidden:!1,formatter:function(t){return C[t.signInStatus]},search:{type:"select",data:{options:this.searchOptions.status,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signInTime",title:this.i18n.signInfo.signTime,className:"text-left",width:"150px",hidden:!1},{id:"remark",title:this.i18n.signInfo.remark,className:"text-left",width:"250px",hidden:!1},{id:"opt",title:"",className:"text-right",hidden:!1,formatter:function(e){var a=[];return"NOT_SIGN"==e.signInStatus&&a.push({tag:"a",text:t.i18n.signInfo.recordByHand,className:"opt-btn",callback:function(e,a){t.signManualModal.userId=e.userId,t.signManualModal.userNo=e.userNo,t.signManualModal.signId=e.signInId,t.signManualModal.createDate=e.createDate,t.signManualModal.show=!0}}),t.isManager&&a.push({tag:"a",text:t.i18n.signInfo.remove,className:"opt-btn",callback:function(e,a){window.confirm("确定把"+e.name+"从此次签到中移除?")&&h.a.removePersonFromSign(e.signInId,e.userId,e.createDate,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast(t.i18n.tip.removeSuccess),void(t.tableParams.ts=+new Date)):t.$toast(a.message)})}}),a}}]:"PROXY"===this.userType?this.tableParams.columns=[{id:"name",title:this.i18n.signInfo.userName,className:"text-left",width:"55px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"userNo",title:this.i18n.signInfo.userNo,className:"text-left",width:"120px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"collegeCode",title:this.i18n.signInfo.college,className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code",placeholder:""}},formatter:function(t){return t.college}},{id:"classId",title:"班级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.classArr,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"status",title:this.i18n.signInfo.signStatus,className:"text-left",width:"60px",hidden:!1,formatter:function(t){return C[t.signInStatus]},search:{type:"select",data:{options:this.searchOptions.status,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signInTime",title:this.i18n.signInfo.signTime,className:"text-left",width:"150px",hidden:!1},{id:"address",title:"打卡地点",className:"text-left",width:"150px",hidden:!1,formatter:function(e){var a=[];return a.push({tag:"a",text:e.address,className:"opt-btn",callback:function(e,a){t.showAddressDetail(e)}}),a}},{id:"remark",title:this.i18n.signInfo.remark,className:"text-left",width:"250px",hidden:!1},{id:"opt",title:"",className:"text-right",hidden:!1,formatter:function(e){var a=[];return"NOT_SIGN"==e.signInStatus&&a.push({tag:"a",text:t.i18n.signInfo.recordByHand,className:"opt-btn",callback:function(e,a){t.signManualModal.userId=e.userId,t.signManualModal.userNo=e.userNo,t.signManualModal.signId=e.signInId,t.signManualModal.createDate=e.createDate,t.signManualModal.show=!0}}),t.isManager&&a.push({tag:"a",text:t.i18n.signInfo.remove,className:"opt-btn",callback:function(e,a){window.confirm("确定把"+e.name+"从此次签到中移除?")&&h.a.removePersonFromSign(e.signInId,e.userId,e.createDate,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast(t.i18n.tip.removeSuccess),void(t.tableParams.ts=+new Date)):t.$toast(a.message)})}}),a}}]:this.tableParams.columns=[{id:"name",title:this.i18n.signInfo.userName,className:"text-left",width:"55px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"userNo",title:this.i18n.signInfo.userNo,className:"text-left",width:"120px",hidden:!1,search:{type:"input",data:{placeholder:""}}},{id:"college",title:this.i18n.signInfo.college,className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{url:"/api/colleges",optionsLabel:"name",optionsValue:"code",placeholder:""}},formatter:function(t){return t.college}},{id:"classId",title:"班级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.classArr,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"grade",title:"年级",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.gradeYear,optionsLabel:"label",optionsValue:"value",placeholder:""}}},{id:"educationLevel ",title:"培养层次",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.eduList,optionsLabel:"label",optionsValue:"value",placeholder:""}}},{id:"unit",title:"部门",className:"text-left",width:"120px",hidden:!1,search:{type:"select",data:{options:this.unitList,optionsLabel:"name",optionsValue:"id",placeholder:""}}},{id:"signInStatus",title:this.i18n.signInfo.signStatus,className:"text-left",width:"60px",hidden:!1,formatter:function(t){return C[t.signInStatus]},search:{type:"select",data:{options:this.searchOptions.status,optionsLabel:"text",optionsValue:"id",placeholder:""}}},{id:"signInTime",title:this.i18n.signInfo.signTime,className:"text-left",width:"150px",hidden:!1},{id:"address",title:"打卡地点",className:"text-left",width:"150px",hidden:!1,formatter:function(e){var a=[];return a.push({tag:"a",text:e.address,className:"opt-btn",callback:function(e,a){t.showAddressDetail(e)}}),a}},{id:"remark",title:this.i18n.signInfo.remark,className:"text-left",width:"250px",hidden:!1},{id:"opt",title:"",className:"text-right",hidden:!1,formatter:function(e){var a=[];return e.picture&&a.push({tag:"a",text:"查看图片",className:"opt-btn",callback:function(e,a){t.showImgDetail(e.picture)}}),"NOT_SIGN"==e.signInStatus&&a.push({tag:"a",text:t.i18n.signInfo.recordByHand,className:"opt-btn",callback:function(e,a){t.signManualModal.userId=e.userId,t.signManualModal.userNo=e.userNo,t.signManualModal.signId=e.signInId,t.signManualModal.createDate=e.createDate,t.signManualModal.show=!0}}),t.isManager&&a.push({tag:"a",text:t.i18n.signInfo.remove,className:"opt-btn",callback:function(e,a){window.confirm("确定把"+e.name+"从此次签到中移除?")&&h.a.removePersonFromSign(e.signInId,e.userId,e.createDate,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast(t.i18n.tip.removeSuccess),void(t.tableParams.ts=+new Date)):t.$toast(a.message)})}}),a}}]},toEditSign:function(){this.editSignModal.show=!0},normalizeDateString:function(t){return t&&19!==t.length?t+":00":t},changeProxy:function(t){if(t.val){var e=t.val,a=!0,i=!1,s=void 0;try{for(var n,o=l()(this.proxy.proxies);!(a=(n=o.next()).done);a=!0){var r=n.value;r.id===e&&(this.setCurrentProxy(r),this.refreshQrcode())}}catch(t){i=!0,s=t}finally{try{!a&&o.return&&o.return()}finally{if(i)throw s}}}},saveSign:function(){var t=this;if(this.sign.needOut){var e=JSON.parse(o()(this.editSignModal));e.signInName=e.name,e.signInTimeStart=e.startTime,e.signInTimeEnd=e.endTime,e.dynamicCode=!!e.useDynamicCode,e.isLocation=!!e.scanQrcodeWithLocation,e.ranges=e.qrcodeLocations.map(function(t){return{longitude:t.lng,latitude:t.lat,distance:t.radius,address:t.address}});var a="api/ca/signIn/update/"+this.editSignModal.signId;Object(u.d)(a,e,"post").then(function(e){e.state?(t.editSignModal.useDynamicCode?(t.sign.useDynamicCode=!0,t.initQrcode()):(t.sign.useDynamicCode=!1,t.stopQrcodeTimer()),t.editSignModal.show=!1,t.$toast("操作成功!")):t.$toast(e.message)})}else h.a.editSign(this.editSignModal,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.syncSignInfo(),t.editSignModal.show=!1,"qrcode"===t.editSignModal.signWay?t.initQrcode():t.stopQrcodeTimer(),void t.$toast(t.i18n.tip.saveSuccess)):t.$toast(a.message)})},syncSignInfo:function(){this.sign.name=this.editSignModal.name,this.sign.startTime=this.editSignModal.startTime,this.sign.endTime=this.editSignModal.endTime,this.sign.hourStart=this.editSignModal.hourStart,this.sign.hourEnd=this.editSignModal.hourEnd,this.sign.useDynamicCode=this.editSignModal.useDynamicCode,this.sign.signWay=this.editSignModal.signWay,this.sign.scanQrcodeWithLocation=this.editSignModal.scanQrcodeWithLocation,this.sign.qrcodeLocations=this.editSignModal.qrcodeLocations,this.sign.locations=this.editSignModal.locations},showStat:function(){var t=this;this.statModal.loading=!0,this.statModal.show=!0;var e="",a="";this.statDate.length&&(e=this.statDate[0],a=this.statDate[1]),h.a.getGeneralSignStat(this.sign.id,e,a,function(e,a){if(e)return t.$toast(t.i18n.error.networkError);if(!a.state)return t.$toast(a.message);t.statModal.loading=!1;var i=a.data;if(!i)return t.statModal.noStat=!0;t.statModal.noStat=!1,t.statModal.generalChart.legend.done.num=i.countSign,t.statModal.generalChart.legend.todo.num=i.countNotSinIn,t.statModal.syncTime=i.timeTemp,t.$nextTick(function(){t.refreshGeneralChart()})})},getSignOptionWidth:function(t){var e=t.done/t.total,a=t.manual/t.total,i=t.todo/t.total;(0==t.total||i==e&&i==a)&&(i=e=a=.3333333);var s=this.statModal.totalWidth*e,n=this.statModal.totalWidth*a,o=this.statModal.totalWidth*i,r=0;return s<10&&(r+=10-s,s=10),n<10&&(r+=10-n,n=10),o<10&&(r+=10-o,o=10),s<n?n>o?n-=r:s>o?s-=r:o-=r:s>o?s-=r:n>o?n-=r:o-=r,{done:s,manual:n,todo:o}},initChartIfNotInit:function(){this.statModal.generalChart.instance=p.a.init(document.getElementById("general-chart"))},initQrcode:function(){var t=this;this.createSignUrl(function(e){e&&(t.qrcode.url=e,t.qrcode.instance?(t.qrcode.instance.clear(),t.qrcode.instance.makeCode(e)):t.sign.needOut||(t.qrcode.instance=new f.a("sign-qrcode",{text:e,width:400,height:400})),t.sign.useDynamicCode?t.startQrcodeTimer():t.stopQrcodeTimer())})},refreshQrcode:function(){var t=this;this.createSignUrl(function(e){e&&(t.qrcode.url=e,t.qrcode.instance?(t.qrcode.instance.clear(),t.qrcode.instance.makeCode(e)):t.sign.needOut||(t.qrcode.instance=new f.a("sign-qrcode",{text:e,width:400,height:400})))})},startQrcodeTimer:function(){var t=this;this.stopQrcodeTimer(),this.qrcode.timer=setInterval(function(){t.refreshQrcode()},1e4)},stopQrcodeTimer:function(){this.qrcode.timer&&(clearInterval(this.qrcode.timer),this.qrcode.timer=null)},refreshGeneralChart:function(){this.initChartIfNotInit(),this.statModal.generalChart.options.series[0].data=[{value:this.statModal.generalChart.legend.done.num,name:"已签到"},{name:"未签到",value:this.statModal.generalChart.legend.todo.num}],this.statModal.generalChart.instance.setOption(this.statModal.generalChart.options)},getRadioIcon:function(t){return t?"radio_button_checked":"radio_button_unchecked"},changeStatType:function(t){var e=this;this.statType=t;var a=this.statModal.control[t];for(var i in this.statModal.control)this.statModal.control[i].checked=!1;if(a.checked=!0,this.statModal.currentControl=t,"general"!=t){var s="",n="";this.statDate.length&&(s=this.statDate[0],n=this.statDate[1]),h.a.getSignStatByType(this.sign.id,a.type,s,n,function(t,i){return t?e.$toast(e.i18n.error.networkError):i.state?void(a.data=i.data.map(function(t){var a={overview:{total:t.overview.count,done:t.overview.countSign,manual:t.overview.countManualEntry,todo:t.overview.countNotSinIn},title:t.title,sort:t.sort};return a.widthData=e.getSignOptionWidth(a.overview),a})):e.$toast(i.message)})}else this.showStat()},fullscreen:function(){var t=this;this.qrcode.oldInstance=this.qrcode.instance,this.qrcode.fullscreen=!0,this.$nextTick(function(){t.sign.needOut?t.$parent.isAgent?t.qrcode.instance=new f.a("needOut-sign-qrcode-isAgent-fullscreen",{text:t.qrcode.url,width:400,height:400}):t.$parent.isPerson?t.qrcode.instance=new f.a("needOut-sign-qrcode-isPerson-fullscreen",{text:t.qrcode.url,width:400,height:400}):t.qrcode.instance=new f.a("needOut-sign-qrcode-fullscreen",{text:t.qrcode.url,width:400,height:400}):t.qrcode.instance=new f.a("sign-qrcode-fullscreen",{text:t.qrcode.url,width:400,height:400})}),this.sign.needOut&&(this.getHasSignList(),this.setInterFun=setInterval(function(){t.getHasSignList()},5e3))},getHasSignList:function(){var t=this,e=this.tableUrl;"signIn"===this.signTabVal?e+="&signInStatus=SIGN_IN":e+="&signOutStatus=SIGN_OUT",Object(u.d)(e).then(function(e){if(t.oldHasSignList&&(e.data.length||t.oldHasSignList.length)){var a=e.data.filter(function(e,a,i){return-1===t.oldHasSignList.indexOf(e.userNo)}),i="signIn"===t.signTabVal?"签到成功!":"签退成功!",s=0,n=t;a.length&&function t(){var e=a[s];n.$notify({title:"提示",message:e.college+e.name+i}),(s+=1)<a.length&&setTimeout(t,1e3)}()}t.oldHasSignList=e.data.map(function(t){return t.userNo})})},existFullscreen:function(){this.setInterFun&&(clearInterval(this.setInterFun),this.setInterFun=null,this.oldHasSignList=null),this.clearQrcodeInstance(),this.qrcode.instance.clear(),this.qrcode.fullscreen=!1,this.qrcode.instance=this.qrcode.oldInstance},clearQrcodeInstance:function(){for(var t=this.qrcode.instance._el;t.hasChildNodes();)t.removeChild(t.lastChild)},initManagedColleges:function(t){var e=this;h.a.getBaseSearchOptions(function(a,i){if(a)return e.$toast(e.i18n.error.networkError);if(!i.state)return e.$toast(i.message);var s=!0,n=!1,o=void 0;try{for(var r,c=l()(i.data);!(s=(r=c.next()).done);s=!0){var d=r.value;-1==d.id&&(d.id="")}}catch(a){n=!0,o=a}finally{try{!s&&c.return&&c.return()}finally{if(n)throw o}}e.searchOptions.managedColleges=i.data,e.searchOptions.colleges=e.searchOptions.managedColleges,t&&t()})},initProxies:function(){var t=this;h.a.getMyProxies(this.sign.id,function(e,a){if(e)return t.$toast(t.i18n.error.networkError);if(!a.state)return t.$toast(a.message);if(!a.data)return t.$toast(t.i18n.error.dataError);var i=[],s=[],n=[],o=[],r=!1,c=!1,d=!1,u=!1,h=!0,g=!1,p=void 0;try{for(var m,f=l()(a.data);!(h=(m=f.next()).done);h=!0){var v=m.value;switch(v.distribution){case M:i.push(t.createMixProxy(M,v.agentId,v.agentName,v.agentName,null,null)),r=!0;break;case x:for(var y in v.colleges)s.push(t.createMixProxy(x,v.agentId,v.agentName,v.colleges[y],null,y));c=!0;break;case N:for(var b in v.clazz)n.push(t.createMixProxy(N,v.agentId,v.agentName,v.clazz[b],b,null));d=!0;break;case k:o.push(t.createMixProxy(k,v.agentId,v.agentName,v.agentName,null,null)),u=!0}}}catch(e){g=!0,p=e}finally{try{!h&&f.return&&f.return()}finally{if(g)throw p}}t.proxy.proxies=i.concat(s.concat(n.concat(o))),t.setCurrentProxy(t.proxy.proxies[0]),t.$nextTick(function(){t.initQrcode()}),t.statModal.control.college.show=!1,t.statModal.control.instructor.show=!1,t.statModal.control.clazz.show=!1,r?(t.statModal.control.college.show=!0,t.statModal.control.instructor.show=!0,t.statModal.control.clazz.show=!0):c?(t.statModal.control.college.show=!0,t.statModal.control.clazz.show=!0):(u||d)&&(t.statModal.control.clazz.show=!0)})},setCurrentProxy:function(t){this.proxy.id=t.id,this.proxy.proxyId=t.proxyId,this.proxy.name=t.name,this.proxy.collegeCode=t.collegeCode,this.proxy.classId=t.classId,this.proxy.distributary=t.distributary,t.distributary===x?this.searchOptions.colleges=[{id:t.collegeCode,text:t.name}]:this.searchOptions.colleges=this.searchOptions.managedColleges,this.tableParams.ts=(new Date).getTime()},createMixProxy:function(t,e,a,i,s,n){return{id:t+"-"+e+"-"+(s||"__")+"-"+(n||"__"),proxyId:e,distributary:t,proxyName:a,name:i,classId:s||"",collegeCode:n||""}},signManual:function(){var t=this;if(!this.signManualModal.remark)return this.$toast("您还未填写备注");var e={createDate:this.signManualModal.createDate,signId:this.sign.id,userId:this.signManualModal.userId,remark:this.signManualModal.remark,callback:function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast(t.i18n.tip.setSuccess),t.tableParams.ts=(new Date).getTime(),void(t.signManualModal.show=!1)):t.$toast(a.message)}};h.a.signManual(e)},checkUser:function(){var t=this;if(!this.addPersonModal.userNo)return this.$toast("请输入学号");this.addPersonModal.userId=null,this.addPersonModal.tip="检测中...",h.a.checkUserNo(this.addPersonModal.userNo,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.addPersonModal.userId=a.data.userId,void(t.addPersonModal.userName=t.addPersonModal.tip=a.data.name)):"50001"==a.code?t.addPersonModal.tip="不存在该学号":t.$toast(a.message)})},afterSelectAddPerson:function(t){this.addPersonModal.userId=t.userId,this.addPersonModal.userNo=t.userNo,this.addPersonModal.name=t.name},cancelAddSignPeople:function(){this.addPersonModal.show=!1},addSignPeople:function(){var t=this;if(!this.addPersonModal.userId)return this.$toast("请输入学号或者姓名!");if(this.sign.needOut){var e="api/ca/signIn/"+this.addPersonModal.userId+"/"+this.sign.id;return this.sign.isAgent&&(e="api/ca/signIn/agent/"+this.addPersonModal.userId+"/"+this.sign.id),void Object(u.d)(e,{},"post").then(function(e){e.state?(t.$toast("添加成功"),t.tableParams.ts=+new Date,t.addPersonModal.show=!1):t.$toast(e.message)})}h.a.addSignPeople(this.project.id,this.sign.id,this.addPersonModal.userId,function(e,a){return e?t.$toast(t.i18n.error.networkError):a.state?(t.$toast("添加成功"),t.tableParams.ts=+new Date,void(t.addPersonModal.show=!1)):"50003"==a.code?t.$toast("该人员已经在签到名单中"):t.$toast(a.message)})},createSignUrl:function(t){var e=this;this.sign.needOut?Object(u.d)("api/ca/system/saasId").then(function(a){var i="default";a.state&&(i=a.data);var s=window.location.origin+"/mobileTowCodeSign?isSign=true&signId="+e.sign.id+"&signTabVal="+e.signTabVal+"&timestamp="+(new Date).getTime()+"&sysId="+i;t(s)}):h.a.createSignUrl(this.sign.id,this.proxy.distributary,this.proxy.collegeCode,this.proxy.classId,this.qrCodeExpireTime,function(a,i){if(a)return t(),e.$toast(e.i18n.error.networkError);if(!i.state)return t(),e.$toast(i.message);var s=window.location.origin+i.data+"?scope=yiban_scan_result";t(s)})},getOutText:function(){var t=this;if(this.formFields.length)return!1;Object(u.e)({url:"/api/signIns/peoples/export/fields",type:"get",success:function(e){if(e.state)for(var a in e.data)t.formFields.push({fieldName:a,fieldTitle:e.data[a]});else t.formFields=[]}})},exportSigns:function(){var t=this.$refs["sign-table"].tableSearchFields||{};if(this.sign.needOut){var e=(new Date).format("yyyy-MM-dd")+this.sign.name;"signIn"===this.signTabVal?e+="签到列表":e+="签退列表";var a="/downloads/ca/signIn/person/export/"+this.signTabVal+"/"+this.sign.id+"?filename="+e+"&";for(var i in this.sign.isAgent&&(a="/downloads/ca/signIn/agent/person/export/"+this.signTabVal+"/"+this.sign.id+"?filename="+e+"&"),t)a+=i+"="+t[i]+"&";return a=a.substring(0,a.length-1),void(window.location.href=a)}if(this.isManager)this.getOutText(),this.outputModalShow=!0;else{var s=this.project.name+this.sign.name+".xlsx";h.a.exportSignsOfProxy(this.sign.id,this.proxy.proxyId,t.name,t.userNo,this.proxy.collegeCode||t.college,this.proxy.classId,t.signInStatus,s,this.dateArea)}}}},"beforeDestroy",function(){this.stopQrcodeTimer()}),D={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{directives:[{name:"show",rawName:"v-show",value:t.qrcode.fullscreen,expression:"qrcode.fullscreen"}],attrs:{id:"qrcode-fullscreen"}},[i("v-icon",{attrs:{name:"close"},nativeOn:{click:function(e){return t.existFullscreen(e)}}}),t._v(" "),i("div",{staticClass:"qrcode-container"},[i("div",{attrs:{id:"sign-qrcode-name"}},[t._v(t._s(t.sign.name))]),t._v(" "),t.sign.useDynamicCode?i("div",{attrs:{id:"sign-qrcode-type"}},[t._v("动态码(刷新间隔10s)")]):t._e(),t._v(" "),t.editSignModal.needOut&&t.$parent.isAgent?i("div",{attrs:{id:"needOut-sign-qrcode-isAgent-fullscreen"}}):t.editSignModal.needOut&&t.$parent.isPerson?i("div",{attrs:{id:"needOut-sign-qrcode-isPerson-fullscreen"}}):t.editSignModal.needOut?i("div",{attrs:{id:"needOut-sign-qrcode-fullscreen"}}):i("div",{attrs:{id:"sign-qrcode-fullscreen"}}),t._v(" "),i("div",{attrs:{id:"sign-qrcode-time"}},[t._v(t._s(t.sign.startTime+" ~ "+t.sign.endTime))])])],1),t._v(" "),i("a",{staticClass:"box_flex align_center back_wrap",attrs:{type:"button"}},[i("i",{staticClass:"maticon back-icon-btn",domProps:{innerHTML:t._s(t.icons("arrow_back"))},on:{click:t.back}},[t._v("arrow_back")]),t._v(" "),i("span",{staticClass:"nav-title",on:{click:t.back}},[t._v(t._s(t.isProxy?t.sign.name:"返回"))])]),t._v(" "),i("div",{attrs:{id:"sign-info"}},[t.sign.needOut?i("div",{staticClass:"tab-div"},t._l(t.tabList,function(e,a){return i("div",{key:a,staticClass:"tab",class:t.signTabVal===e.id?"active":"",attrs:{title:e.name},on:{click:function(a){t.signTabVal=e.id}}},[t._v(t._s(e.name))])}),0):t._e(),t._v(" "),i("div",{staticClass:"box_flex",staticStyle:{"align-items":"stretch","margin-left":"-15px"}},[i("div",{staticClass:"col-md-9"},[i("v-table",{ref:"sign-table",attrs:{title:t.isManager?t.sign.name:"",url:t.tableUrl,pagesize:t.tableParams.pagesize,idField:t.tableParams.idField,columns:t.tableParams.columns,multiple:t.tableParams.multi,order:t.tableParams.order,search:t.tableParams.search}},[i("div",{attrs:{slot:"btn-group",role:"group"},slot:"btn-group"},[t.isProxy?i("div",{staticClass:"btn-group college-select pull-left"},[i("v-select",{attrs:{options:this.proxy.proxies,value:this.proxy.id,"options-value":"id","options-label":"name",required:!0,"close-on-select":"",justify:""},on:{afterSelected:t.changeProxy}})],1):t._e(),t._v(" "),"single"==t.sign.checkInType||t.editSignModal.needOut?t._e():i("div",{staticClass:"dateSelect pull-left"},[i("el-date-picker",{staticStyle:{width:"80%"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},on:{change:t.dateChange},model:{value:t.dateArea,callback:function(e){t.dateArea=e},expression:"dateArea"}})],1),t._v(" "),i("div",{staticClass:"pull-right"},[i("button",{staticClass:"btn btn-bgColor-style edit-btn",attrs:{type:"button"},on:{click:t.goToSendMessage}},[t._v("通知")]),t._v(" "),i("button",{staticClass:"btn btn-bgColor-style edit-btn",class:{disabled:t.exporting},attrs:{type:"button"},domProps:{innerHTML:t._s(t.exporting?t.loader.small+"导出中":t.i18n.export)},on:{click:t.exportSigns}}),t._v(" "),t.isManager?i("button",{staticClass:"btn btn-bgColor-style edit-btn",attrs:{type:"button"},on:{click:function(e){t.showAddModal=!0}}},[t._v(t._s(t.i18n.signInfo.editPeople))]):t._e(),t._v(" "),t.sign.needOut?t._e():i("button",{staticClass:"btn btn-bgColor-style stat-btn",attrs:{type:"button"},on:{click:t.showStat}},[i("v-icon",{staticClass:"pull-left",attrs:{name:"donut_large"}}),t._v("\n                "+t._s(t.i18n.signInfo.stat)+"\n              ")],1)])])])],1),t._v(" "),i("div",{class:["col-md-3","sign-detail","week"==t.sign.frequency?"over":""]},[i("div",{staticClass:"sign-detail-div"},[t.editSignModal.needOut?i("div",{staticClass:"info-row"},[i("span",{staticClass:"title"},[t._v("二维码")]),t._v(" "),i("img",{staticClass:"tow_code",attrs:{src:a("EBaK"),alt:""},on:{click:t.fullscreen}})]):t._e(),t._v(" "),i("div",{staticClass:"info-row"},[i("span",{staticClass:"title"},[t._v(t._s(t.editSignModal.name))]),t._v(" "),"PROXY"!==t.userType?i("v-icon",{staticClass:"edit",attrs:{name:"edit"},nativeOn:{click:function(e){return t.toEditSign(e)}}}):t._e()],1),t._v(" "),i("div",{staticClass:"info-row",staticStyle:{display:"flex"}},[i("span",{staticClass:"title"},[t._v(t._s("single"==t.sign.checkInType?t.i18n.signInfo.start:"开始日期"))]),t._v(" "),"single"==t.sign.checkInType?i("div",[i("span",{staticClass:"time"},[t._v(t._s(t.editSignModal.startTime))])]):"loop"==t.sign.checkInType?i("div",["day"==t.sign.frequency?i("span",{staticClass:"time"},[t._v(t._s(t.editSignModal.startTime.split(" ")[0]))]):t._e(),t._v(" "),"week"==t.sign.frequency?i("span",{staticClass:"time"},[t._v(t._s(t.editSignModal.startTime.split(" ")[0]))]):t._e()]):i("span",{staticClass:"time"},[t._v(t._s(t.editSignModal.startTime))])]),t._v(" "),i("div",{staticClass:"info-row",staticStyle:{display:"flex"}},[i("span",{staticClass:"title"},[t._v(t._s("single"==t.sign.checkInType?t.i18n.signInfo.end:"结束日期"))]),t._v(" "),"single"==t.sign.checkInType?i("div",[i("span",{staticClass:"time"},[t._v(t._s(t.editSignModal.endTime))])]):"loop"==t.sign.checkInType?i("div",["day"==t.sign.frequency?i("span",{staticClass:"time"},[t._v(t._s(t.editSignModal.endTime.split(" ")[0]))]):t._e(),t._v(" "),"week"==t.sign.frequency?i("span",{staticClass:"time"},[t._v(t._s(t.editSignModal.endTime.split(" ")[0]))]):t._e()]):i("span",{staticClass:"time"},[t._v(t._s(t.editSignModal.endTime))])]),t._v(" "),"loop"==t.sign.checkInType&&"day"==t.sign.frequency?[i("div",{staticClass:"weekDay"},[i("p",{staticClass:"info-row"},[i("i",[t._v("签到开始时间")]),t._v(" "),i("em",[t._v(t._s(t.editSignModal.hourStart?t.editSignModal.hourStart.substring(0,8):""))])]),t._v(" "),i("p",{staticClass:"info-row",staticStyle:{"border-bottom":"1px solid #e0e0e0"}},[i("i",[t._v("签到结束时间")]),t._v(" "),i("em",[t._v(t._s(t.editSignModal.hourEnd?t.editSignModal.hourEnd.substring(0,8):""))])])])]:t._e(),t._v(" "),"loop"==t.sign.checkInType&&"week"==t.sign.frequency?t._l(t.editSignModal.weekDayList,function(e,a){return i("div",{key:a,staticClass:"weekDay"},[i("span",[t._v(t._s(e.date))]),t._v(" "),i("p",{staticClass:"info-row"},[i("i",[t._v("签到开始时间")]),t._v(" "),i("em",[t._v(t._s(e.startTime))])]),t._v(" "),i("p",{staticClass:"info-row",staticStyle:{"border-bottom":"1px solid #e0e0e0"}},[i("i",[t._v("签到结束时间")]),t._v(" "),i("em",[t._v(t._s(e.endTime))])])])}):t._e(),t._v(" "),t.editSignModal.needOut?i("div",[i("div",{staticClass:"info-row"},[i("div",{staticClass:"switch",class:{on:t.editSignModal.isSignOut,readonly:!0}},[i("span",{staticClass:"label"},[t._v("需要签退")]),t._v(" "),t._m(0)])]),t._v(" "),t.editSignModal.isSignOut?i("div",{staticClass:"info-row"},[i("span",{staticClass:"title"},[t._v("签退开始时间")]),t._v(" "),i("span",{staticClass:"time"},[t._v(t._s(t.editSignModal.signOutTimeStart))])]):t._e(),t._v(" "),t.editSignModal.isSignOut?i("div",{staticClass:"info-row"},[i("span",{staticClass:"title"},[t._v("签退结束时间")]),t._v(" "),i("span",{staticClass:"time"},[t._v(t._s(t.editSignModal.signOutTimeEnd))])]):t._e()]):t._e(),t._v(" "),i("div",{staticClass:"info-row"},[i("span",{staticClass:"title"},[t._v("签到方式")]),t._v(" "),i("span",{staticClass:"time"},[t._v(t._s(t.signWayText[t.editSignModal.signWay]))])]),t._v(" "),"qrcode"===t.editSignModal.signWay?i("div",{staticClass:"info-row"},[i("div",{staticClass:"switch",class:{on:t.editSignModal.useDynamicCode,readonly:!0}},[i("span",{staticClass:"label"},[t._v(t._s(t.i18n.useDynamicCode))]),t._v(" "),t._m(1)])]):t._e(),t._v(" "),"qrcode"===t.editSignModal.signWay?i("div",{staticClass:"info-row"},[i("div",{staticClass:"switch",class:{on:t.editSignModal.scanQrcodeWithLocation,readonly:!0}},[i("span",{staticClass:"label"},[t._v("扫码定位限制")]),t._v(" "),t._m(2)])]):t._e(),t._v(" "),"qrcode"===t.editSignModal.signWay&&t.editSignModal.scanQrcodeWithLocation?i("div",{staticClass:"info-row auto-height"},[i("span",{staticClass:"title"},[t._v("地点")]),t._v(" "),i("div",{staticClass:"list"},t._l(t.editSignModal.qrcodeLocations,function(e,a){return i("div",{key:a,staticClass:"item"},[t._v(t._s(e.address+" 范围："+e.radius+"米"))])}),0)]):t._e(),t._v(" "),"location"===t.editSignModal.signWay?i("div",{staticClass:"info-row auto-height"},[i("span",{staticClass:"title"},[t._v("地点")]),t._v(" "),i("div",{staticClass:"list"},t._l(t.editSignModal.locations,function(e,a){return i("div",{key:a,staticClass:"item"},[t._v(t._s(e.address+" 范围："+e.radius+"米"))])}),0)]):t._e(),t._v(" "),"qrcode"!==t.editSignModal.signWay||t.editSignModal.needOut?t._e():i("div",{staticClass:"qr-code-container"},[i("div",{staticClass:"qr-code"},[i("v-icon",{attrs:{name:"zoom_out_map"},nativeOn:{click:function(e){return t.fullscreen(e)}}}),t._v(" "),i("div",{attrs:{id:"sign-qrcode"}})],1)])],2)])]),t._v(" "),i("v-modal",{attrs:{show:t.addPersonModal.show,effect:"fade",width:"400"}},[i("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[i("h5",{staticClass:"modal-title"},[t._v(t._s(t.i18n.signInfo.editPeople))])]),t._v(" "),i("div",{staticClass:"modal-body container-fluid",staticStyle:{overflow:"inherit"},attrs:{slot:"modal-body"},slot:"modal-body"},[t.editSignModal.needOut&&"PROXY"===t.userType?i("div",{staticClass:"form-group"},[i("detect",{attrs:{url:"api/ca/users/agent/students/searchResults",placeholder:t.请输入学号或者姓名},on:{afterSelected:t.afterSelectAddPerson}})],1):t.editSignModal.needOut?i("div",{staticClass:"form-group"},[i("detect",{ref:"searchVal",attrs:{url:"api/ca/users/students/searchResults",placeholder:t.请输入学号或者姓名},on:{afterSelected:t.afterSelectAddPerson}})],1):i("div",{staticClass:"form-group"},[i("detect",{ref:"searchVal",attrs:{url:"/api/users/check/searchResults",placeholder:t.请输入学号或者姓名},on:{afterSelected:t.afterSelectAddPerson}})],1)]),t._v(" "),i("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[i("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.cancelAddSignPeople}},[t._v(t._s(t.i18n.cancel))]),t._v(" "),i("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.addSignPeople}},[t._v(t._s(t.i18n.sure))])])]),t._v(" "),i("v-modal",{attrs:{show:t.showAdviceModal,effect:"fade",width:"520"}},[i("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[i("h5",{staticClass:"modal-title"},[t._v("通知")])]),t._v(" "),i("div",{staticClass:"modal-body form-wrap advice-modal",attrs:{slot:"modal-body"},slot:"modal-body"},[i("div",{staticClass:"form-group box_flex"},[i("div",{staticClass:"label require"},[i("span",[t._v("通知发送时间:")])]),t._v(" "),i("v-select",{attrs:{options:t.sendTimeTypeList,"options-value":"value","options-label":"label","close-on-select":"",justify:""},model:{value:t.adviceParams.sendTimeType,callback:function(e){t.$set(t.adviceParams,"sendTimeType",e)},expression:"adviceParams.sendTimeType"}})],1),t._v(" "),"TIMING"===t.adviceParams.sendTimeType?i("div",{staticClass:"form-group box_flex"},[i("div",{staticClass:"label require"},[i("span",[t._v("发送时间:")])]),t._v(" "),i("v-datepicker",{staticClass:"btn-block time-picker",attrs:{format:"yyyy-MM-dd hh:ii:ss",placeholder:"请选择发送时间",clearButton:!1},on:{daySelected:t.sendTimeSelected},model:{value:t.adviceParams.sendTime,callback:function(e){t.$set(t.adviceParams,"sendTime",e)},expression:"adviceParams.sendTime"}})],1):t._e(),t._v(" "),i("div",{staticClass:"form-group box_flex"},[i("div",{staticClass:"label require"},[i("span",[t._v("消息内容:")])]),t._v(" "),i("v-textarea",{staticStyle:{height:"88px"},attrs:{lineHeight:"22",placeholder:"请输入消息内容",rows:"6",maxlength:"255"},model:{value:t.adviceParams.content,callback:function(e){t.$set(t.adviceParams,"content",e)},expression:"adviceParams.content"}})],1),t._v(" "),i("div",{staticClass:"form-group box_flex"},[i("div",{staticClass:"label require"},[i("span",[t._v("发送对象:")])]),t._v(" "),i("v-select",{attrs:{options:t.messageToTargetList,"options-value":"value","options-label":"label","close-on-select":"",justify:""},model:{value:t.adviceParams.messageToTarget,callback:function(e){t.$set(t.adviceParams,"messageToTarget",e)},expression:"adviceParams.messageToTarget"}})],1)]),t._v(" "),i("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[i("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.showAdviceModal=!1}}},[t._v("取消")]),t._v(" "),i("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){return t.sendMessage()}}},[t._v("发送")])])]),t._v(" "),i("v-modal",{attrs:{show:t.showAddModal,effect:"fade",width:"420"}},[i("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[i("h5",{staticClass:"modal-title"},[t._v("新增签到人员")])]),t._v(" "),i("div",{staticClass:"modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[i("button",{staticClass:"btn submit-btn clearBtnBorder",staticStyle:{width:"380px","text-align":"center"},attrs:{type:"button"},on:{click:t.addPersonByOne}},[t._v("单条增加")]),t._v(" "),t.editSignModal.needOut?i("button",{staticClass:"btn submit-btn clearBtnBorder",staticStyle:{width:"380px","text-align":"center","margin-top":"20px"},attrs:{type:"button"},on:{click:function(e){return t.batchAddPerson()}}},[t._v("批量导入")]):t._e()]),t._v(" "),i("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[i("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.showAddModal=!1}}},[t._v("取消")])])]),t._v(" "),i("v-modal",{attrs:{show:t.signManualModal.show,effect:"fade",width:"400"}},[i("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[i("h5",{staticClass:"modal-title"},[t._v(t._s(t.i18n.signInfo.recordByHand))])]),t._v(" "),i("div",{staticClass:"modal-body container-fluid",attrs:{slot:"modal-body"},slot:"modal-body"},[i("div",{staticClass:"form-group"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.signManualModal.remark,expression:"signManualModal.remark"},{name:"focus",rawName:"v-focus"}],staticClass:"form-control modal-input",attrs:{type:"text",maxlength:"100",placeholder:t.i18n.signInfo.recordByHandPlaceholder},domProps:{value:t.signManualModal.remark},on:{input:function(e){e.target.composing||t.$set(t.signManualModal,"remark",e.target.value)}}})]),t._v(" "),i("div",{staticClass:"form-group"})]),t._v(" "),i("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[i("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.signManualModal.show=!1}}},[t._v(t._s(t.i18n.cancel))]),t._v(" "),i("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.signManual}},[t._v(t._s(t.i18n.sure))])])]),t._v(" "),i("v-modal",{attrs:{id:"stat-modal",show:t.statModal.show,effect:"fade",width:"900"}},[i("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[i("h5",{staticClass:"modal-title"},[i("v-icon",{attrs:{name:"close"},nativeOn:{click:function(e){t.statModal.show=!1}}}),t._v(" "),i("span",[t._v(t._s(t.i18n.signInfo.stat))]),t._v(" "),i("el-date-picker",{staticStyle:{width:"50%"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},on:{change:t.statDateChange},model:{value:t.statDate,callback:function(e){t.statDate=e},expression:"statDate"}})],1)]),t._v(" "),i("div",{staticClass:"modal-body container-fluid",attrs:{slot:"modal-body"},slot:"modal-body"},[t.statModal.loading?i("div",{staticClass:"loader",domProps:{innerHTML:t._s(t.loader.iconWithText)}}):t.statModal.noStat?i("div",{staticClass:"loader"},[t._v("暂无统计数据")]):i("div",{staticStyle:{display:"inline-block"}},[i("div",{attrs:{id:"stat-control"}},[i("ul",t._l(t.statModal.control,function(e,a){return e.show?i("li",{key:a,on:{click:function(e){return t.changeStatType(a)}}},[i("v-icon",{attrs:{name:t.getRadioIcon(e.checked)}}),t._v(" "),i("span",[t._v(t._s(e.text))])],1):t._e()}),0)]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"general"===t.statModal.currentControl,expression:"statModal.currentControl === 'general'"}]},[i("div",{attrs:{id:"general-chart-text"}},[i("ul",t._l(t.statModal.generalChart.legend,function(e,a){return i("li",{key:a},[i("span",{staticClass:"color",style:{background:e.color}}),t._v(" "),i("span",{staticClass:"text"},[t._v(t._s(e.text))]),t._v(" "),i("span",{staticClass:"num"},[t._v(t._s(e.num))])])}),0)]),t._v(" "),i("div",{attrs:{id:"general-chart"}})]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"general"!==t.statModal.currentControl,expression:"statModal.currentControl !== 'general'"}]},[i("div",{attrs:{id:"bar-chart"}},t._l(t.statModal.control,function(e,a){return"manage"!=a&&e.checked?i("ul",{key:a,staticClass:"items"},t._l(e.data,function(e){return i("li",{key:e.title,staticClass:"item"},[i("div",{staticClass:"title",attrs:{title:e.title}},[t._v(t._s(e.title))]),t._v(" "),i("div",{staticClass:"bar"},[i("ul",{staticClass:"bar-chart"},[i("li",{staticClass:"part bar-done",style:{width:e.widthData.done+"px"},attrs:{title:"已签到:"+e.overview.done}}),t._v(" "),i("li",{staticClass:"part bar-manual",style:{width:e.widthData.manual+"px"},attrs:{title:"手工签到:"+e.overview.manual}}),t._v(" "),i("li",{staticClass:"part bar-todo",style:{width:e.widthData.todo+"px"},attrs:{title:"未签到:"+e.overview.todo}})]),t._v(" "),i("ul",{staticClass:"bar-tip"},[i("li",{staticClass:"text",style:{width:e.widthData.done+"px"}},[t._v(t._s(e.widthData.done>36?"已签到 "+e.overview.done:""))]),t._v(" "),i("li",{staticClass:"text",style:{width:e.widthData.manual+"px"}},[t._v(t._s(e.widthData.manual>36?"手工签到 "+e.overview.manual:""))]),t._v(" "),i("li",{staticClass:"text",style:{width:e.widthData.todo+"px"}},[t._v(t._s(e.widthData.todo>36?"未签到 "+e.overview.todo:""))])])])])}),0):t._e()}),0)]),t._v(" "),i("div",{attrs:{id:"stat-sync-time"}},[t._v("以上数据统计截止至："+t._s(t.statModal.syncTime))])])])]),t._v(" "),i("sign-info-modal",{attrs:{title:"编辑签到",weekDay:t.sign.weekDay,frequency:t.sign.frequency,checkInType:t.sign.checkInType,signInfo:t.editSignModal,i18n:t.i18n},on:{editMethod:t.editMethod,confirm:t.saveSign}}),t._v(" "),i("v-modal",{attrs:{show:t.outputModalShow,effect:"fade",width:"550"}},[i("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[i("h5",{staticClass:"modal-title"},[t._v("导出——字段选择")])]),t._v(" "),i("div",{staticClass:"modal-body export-modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},[i("div",{staticClass:"loopTitle"},[i("h1",[t._v("选择导出时间范围")]),t._v(" "),"single"!=t.sign.checkInType?i("div",[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},on:{change:t.dateChange},model:{value:t.dateArea,callback:function(e){t.dateArea=e},expression:"dateArea"}})],1):t._e()]),t._v(" "),i("ul",{staticClass:"list-group outPut"},t._l(t.formFields,function(e,a){return i("li",{key:a,staticClass:"list-group-item field-item",class:t.outputList.indexOf(e.fieldName)<0?"":"output-active",on:{click:function(a){return t._changeOutputList(e)}}},[t.outputList.indexOf(e.fieldName)<0?i("i",{staticClass:"maticon",domProps:{innerHTML:t._s(t.icons("check_box_outline_blank"))}},[t._v("check_box_outline_blank")]):i("i",{staticClass:"maticon",domProps:{innerHTML:t._s(t.icons("check_box"))}},[t._v("check_box")]),t._v(" "),i("span",[t._v(t._s(e.fieldTitle))])])}),0)]),t._v(" "),i("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[i("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:function(e){t.outputModalShow=!1,t.outputList=[]}}},[t._v("取消")]),t._v(" "),i("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t._sureToOutput}},[t._v("确定")])])]),t._v(" "),i("v-modal",{staticClass:"img_modal",attrs:{show:t.showImgDetailStatus,backdrop:"true"},on:{onHide:function(e){t.showImgDetailStatus=!1}}},[i("div",{staticClass:"modal-body box_flex flex_center",style:{transform:"scale("+t.deleteImgWidth+")"},attrs:{slot:"modal-body"},on:{click:function(e){t.showImgDetailStatus=!1}},slot:"modal-body"},[i("img",{staticStyle:{width:"100%",height:"350px"},attrs:{id:"detailImg",src:t.imgDetailSrc,alt:""}})])]),t._v(" "),i("v-modal",{attrs:{show:t.showAddressModal,backdrop:"true"},on:{onHide:function(e){t.showAddressModal=!1}}},[i("div",{staticClass:"modal-body box_flex flex_center",staticStyle:{width:"600px",height:"400px"},attrs:{slot:"modal-body"},slot:"modal-body"},[t.addressRecord.lat?i("v-map",{attrs:{showPosition:!0,center:t.addressRecord}}):t._e()],1)])],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"slider"},[e("div",{staticClass:"pipe"}),this._v(" "),e("div",{staticClass:"head"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"slider"},[e("div",{staticClass:"pipe"}),this._v(" "),e("div",{staticClass:"head"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"slider"},[e("div",{staticClass:"pipe"}),this._v(" "),e("div",{staticClass:"head"})])}]};var A=a("C7Lr")(L,D,!1,function(t){a("tgYt"),a("qvNH")},null,null);e.a=A.exports},zDMS:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABjElEQVRYR+2WzypFURTGfx/Kn4mQYkqUCSMpmfAGZt5A8QQ8AE9AeQMzb8BADK4RE0VM3RIy8aewtHSvxL32OsfVnZxVu31OfXvtb61v772WaLKpyftTEAhnwMxGgC1gGmivI90zcAgsSjqPyJuFQAmYjDgFSpKmItgsBN7g48zMSDqo5dzMZoB9wCS1/AsBSb+SNjP7EwEz6wTWgAVgIBJFAFMGtoFVSY9f8T+iMbMNYCngNA9kU9JyisAN0JvHe2DNraS+FAHX8N/s+xmqJUFBIJqBS2C+otUOMBTRLSLBA+BXMWUTkk4cZGbjwHFqAfAoqSt1CK+C9z8PgbKkwRQBLyb+5rclIsoqwQtwJMmL2afVugV7QDcwBnQE0hqBPAGnwL2k2QgBx3gG+oGeSvn14uKjtTJX/x3rhao6Xr98e3m+A64BzwBZCEQiy4wpCEQysFtpPDKnN7DAG5W51CH0vm804CwP5EzSYorAMLAC+NxIuwDWJflc/x1o5I4RX+GmNOIsD6YgUGTgHbRojyGC3GaKAAAAAElFTkSuQmCC"},zKJS:function(t,e,a){"use strict";var i=a("HzJ8"),s=a.n(i),n=a("3cXf"),o=a.n(n),r=a("aA9S"),l=a.n(r),c=(a("kV13"),a("HJbL")),d=a("FEOm"),u=(c.a,d.a,String,String,Object,Object,String,Array,String,{components:{VIcon:c.a,Locations:d.a},props:{weekDay:String,checkInType:String,i18n:Object,signInfo:Object,title:String,locations:{type:Array,default:function(){return[]}},frequency:String},watch:{signInfo:function(t){this.signData=t,this.signData.signWays?"loop"===this.checkInType&&(this.signData.signWays={qrcode:"qrcode",location:"location",outside:"outside"}):"loop"==this.checkInType?this.signData.signWays={qrcode:"qrcode",location:"location",outside:"outside"}:this.signData.signWays={qrcode:"qrcode",location:"location"},this.formatDateArea()},dateArea:function(t,e){var a=this;this.noWatchDateArea?setTimeout(function(){a.noWatchDateArea=!1},100):t&&(new Date(t[0])<new Date?(this.$toast("选择失败！只能选择当前时间之后的签到时间！"),this.noWatchDateArea=!0,this.dateArea=e):new Date(t[0]).format("yyyy-MM-dd")!==new Date(t[1]).format("yyyy-MM-dd")?(this.$toast("签到开始与结束时间需要在同一天"),this.noWatchDateArea=!0,this.dateArea=e):(this.signData.startTime=t[0],this.signData.endTime=t[1]))},dateArea2:function(t,e){this.noWatchDateArea?this.noWatchDateArea=!1:t&&(new Date(t[0])<new Date?(this.$toast("选择失败！只能选择当前时间之后的签退时间！"),this.noWatchDateArea=!0,this.dateArea2=e):new Date(t[0]).format("yyyy-MM-dd")!==new Date(t[1]).format("yyyy-MM-dd")?(this.$toast("签退开始与结束时间需要在同一天"),this.noWatchDateArea=!0,this.dateArea2=e):(this.signData.signOutTimeStart=t[0],this.signData.signOutTimeEnd=t[1]))}},data:function(){return{weeklyDate:[],selectWeekDay:[],isChecked:!1,signDataBak:null,signData:{},dateArea:["",""],dateArea2:["",""],typeList:[{text:"每日签到",id:"day"},{text:"每周签到",id:"week"}],selectType:"day",pickOptions:{disabledDate:function(t){return t.getTime()+864e5<Date.now()}}}},created:function(){this.frequency&&(this.selectType=this.frequency),this.weeklyDate=[];for(var t=0;t<7;t++)this.weeklyDate.push({index:t,isChecked:!1,startHours:"",endHours:""});if(this.weekDay)for(var e=this.weekDay.split("&"),a=0;a<e.length;a++){var i=e[a].split(","),s=Number(i[0])-1;l()(this.weeklyDate[s],{index:s,isChecked:!0,startHours:i[1],endHours:i[2]})}this.signDataBak=JSON.parse(o()(this.signInfo)),this.signData=this.signInfo,"day"==this.frequency&&(this.signData.startTimeToHours=this.signInfo.hourStart,this.signData.endTimeToHours=this.signInfo.hourEnd),this.signData.signWays||("loop"==this.checkInType?this.signData.signWays={qrcode:"qrcode",location:"location",outside:"outside"}:this.signData.signWays={qrcode:"qrcode",location:"location"}),this.formatDateArea()},computed:{},methods:{checkboxChange:function(){},dateChange_day:function(t,e){"start"==e?2==this.signData.startTimeToHours.split(":").length&&(this.signData.startTimeToHours=t+":00"):2==this.signData.endTimeToHours.split(":").length&&(this.signData.endTimeToHours=t+":00")},dateChange:function(t,e){this.weeklyDate[e].startHours&&2==this.weeklyDate[e].startHours.split(":").length&&(this.weeklyDate[e].startHours=t+":00")},dateChange_end:function(t,e){this.weeklyDate[e].endHours&&2==this.weeklyDate[e].endHours.split(":").length&&(this.weeklyDate[e].endHours=t+":00")},dateToCn:function(t){switch(t){case 0:return"星期一";case 1:return"星期二";case 2:return"星期三";case 3:return"星期四";case 4:return"星期五";case 5:return"星期六";case 6:return"星期日"}},formatDateArea:function(){this.noWatchDateArea=!0,this.dateArea=["",""],this.dateArea2=["",""],this.signData.startTime&&(this.dateArea=[this.signData.startTime,this.signData.endTime]),this.signData.signOutTimeStart&&(this.dateArea2=[this.signData.signOutTimeStart,this.signData.signOutTimeEnd])},beforeStartTimeStartSelect:function(t){if("single"===this.checkInType)return!0;if(new Date(t).getTime()>(new Date).getTime()-864e5){if(this.signData.endTime){if(new Date(t)>new Date(this.signData.endTime))return this.$toast(this.i18n.endTimeMustBeAfterStartTime),!1;if(new Date(t).format("yyyy-MM-dd")!==new Date(this.signData.endTime).format("yyyy-MM-dd"))return this.$toast("签到开始与结束时间需要在同一天"),!1}return!0}return this.$toast("选择失败！只能选择当前时间之后的签到时间！"),!1},beforeEndTimeStartSelect:function(t){return"single"===this.checkInType||(new Date(t).getTime()>(new Date).getTime()-864e5?!(this.signData.startTime&&new Date(this.signData.startTime)>new Date(t))||(this.$toast(this.i18n.endTimeMustBeAfterStartTime),!1):(this.$toast("选择失败！只能选择当前时间之后的签到时间！"),!1))},beforeOutTimeStartSelect:function(t){return new Date(t)>new Date?!(this.signData.signOutTimeEnd&&new Date(t)>new Date(this.signData.signOutTimeEnd))||(this.$toast(this.i18n.endTimeMustBeAfterStartTime),!1):(this.$toast("选择失败！只能选择当前时间之后的签退时间！"),!1)},beforeOutTimeEndSelect:function(t){if(new Date(t)>new Date){if(this.signData.signOutTimeStart){if(new Date(this.signData.signOutTimeStart)>new Date(t))return this.$toast(this.i18n.endTimeMustBeAfterStartTime),!1;if(new Date(this.signData.signOutTimeStart).format("yyyy-MM-dd")!==new Date(t).format("yyyy-MM-dd"))return this.$toast("签退开始与结束时间需要在同一天"),!1}return!0}return this.$toast("选择失败！只能选择当前时间之后的签退时间！"),!1},changeIsSignOut:function(){"signOut"!==this.$parent.signTabVal?(this.signData.isSignOut=!this.signData.isSignOut,this.$forceUpdate()):this.$toast("签退列表使用中,无法取消签退!")},setSignWay:function(t){this.signData.signWay=t},cancel:function(){l()(this.signData,this.signInfo),"loop"==this.checkInType&&"day"==this.frequency&&(this.signData.startTimeToHours=this.signInfo.hourStart,this.signData.endTimeToHours=this.signInfo.hourEnd),this.signData.show=!1},confirm:function(){if(!this.signData.startTime)return this.$toast(this.i18n.error.pleaseChooseStartTime);if(!this.signData.endTime)return this.$toast(this.i18n.error.pleaseChooseEndTime);if(this.signData.isSignOut){if(!this.signData.signOutTimeStart)return this.$toast("请选择签退开始时间!");if(!this.signData.signOutTimeEnd)return this.$toast("请选择签退结束时间!");if(this.signData.signOutTimeStart>this.signData.signOutTimeEnd)return this.$toast("签退结束时间必须在开始时间之后!");if(new Date(this.signData.signOutTimeStart).format("yyyy-MM-dd")!==new Date(this.signData.signOutTimeEnd).format("yyyy-MM-dd"))return void this.$toast("签到开始与结束时间需要在同一天")}if(!this.signData.name)return this.$toast(this.i18n.error.pleaseFillInSignName);if(this.signData.signWay===this.signData.signWays.qrcode&&this.signData.scanQrcodeWithLocation){if(!this.signData.qrcodeLocations.length)return this.$toast("请添加地点");var t=!0,e=!1,a=void 0;try{for(var i,n=s()(this.signData.qrcodeLocations);!(t=(i=n.next()).done);t=!0){if(!i.value.init)return this.$toast("请选择地图中的地点作为中心点")}}catch(t){e=!0,a=t}finally{try{!t&&n.return&&n.return()}finally{if(e)throw a}}}if(this.signData.signWay===this.signData.signWays.location){if(!this.signData.locations.length)return this.$toast("请添加地点");var o=!0,r=!1,l=void 0;try{for(var c,d=s()(this.signData.locations);!(o=(c=d.next()).done);o=!0){if(!c.value.address)return this.$toast("请选择地图中的地点作为中心点")}}catch(t){r=!0,l=t}finally{try{!o&&d.return&&d.return()}finally{if(r)throw l}}}if("week"==this.selectType){this.selectWeekDay=[];for(var u=0;u<this.weeklyDate.length;u++)if(this.weeklyDate[u].isChecked){if(""==this.weeklyDate[u].startHours||""==this.weeklyDate[u].endHours)return this.$toast("请选择时间");var h=void 0,g=void 0;h=2==this.weeklyDate[u].startHours.split(":").length?this.weeklyDate[u].startHours+":00":this.weeklyDate[u].startHours,g=2==this.weeklyDate[u].endHours.split(":").length?this.weeklyDate[u].endHours+":00":this.weeklyDate[u].endHours,this.selectWeekDay.push(u+1+","+h+","+g)}if(0==this.selectWeekDay.length)return this.$toast("请选择签到日期");this.signData.weekDay=this.selectWeekDay.join("&")}this.signData.needOut?this.$emit("confirm",this.signData):("编辑签到"==this.title?(this.signData.checkInType=this.checkInType,this.selectType,this.$emit("editMethod",this.signData)):this.signData.checkInType=this.signInfo.project.checkInType,this.signData.selectType=this.selectType,this.$emit("confirm",this.signData))},signStartSelected:function(t){this.signData.startTime=t.value},signEndSelected:function(t){this.signData.endTime=t.value},signOutStartSelected:function(t){this.signData.signOutTimeStart=t.value},signOutEndSelected:function(t){this.signData.signOutTimeEnd=t.value}}}),h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-modal",{attrs:{show:t.signData.show,effect:"fade",width:"500"}},[a("div",{staticClass:"modal-header",attrs:{slot:"modal-header"},slot:"modal-header"},[a("h5",{staticClass:"modal-title"},[t._v(t._s(t.title))])]),t._v(" "),a("div",{staticClass:"modal-body modal-full-width container-fluid new-sign-modal-body",attrs:{slot:"modal-body"},slot:"modal-body"},["loop"==t.checkInType?a("div",{staticClass:"signType data-wrap"},[a("v-select",{staticClass:"seleced_role",staticStyle:{width:"50%"},attrs:{disabled:"编辑签到"==t.title,required:"",options:t.typeList,optionsLabel:"text",optionsValue:"id",placeholder:"请选择签到类型"},model:{value:t.selectType,callback:function(e){t.selectType=e},expression:"selectType"}})],1):t._e(),t._v(" "),a("div",{staticClass:"form-group data-wrap"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.signData.name,expression:"signData.name"}],staticClass:"form-control",attrs:{type:"text",maxlength:t.signData.maxLength,placeholder:t.i18n.addSignPlaceholder},domProps:{value:t.signData.name},on:{input:function(e){e.target.composing||t.$set(t.signData,"name",e.target.value)}}})]),t._v(" "),"single"==t.checkInType||t.signData.needOut?a("div",[t.signData.needOut?a("div",{staticClass:"box_flex flex_center data-wrap date_picker_wrap"},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{"picker-options":t.pickOptions,disabled:new Date(t.signData.startTime)<new Date,"value-format":"yyyy-MM-dd HH:mm:ss",clearable:!1,type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.dateArea,callback:function(e){t.dateArea=e},expression:"dateArea"}})],1):a("div",{staticClass:"form-group data-wrap box_flex box_center"},[a("v-datepicker",{ref:"startTime",staticClass:"btn-block time-picker",attrs:{value:t.signData.startTime,format:t.signData.dateFormat,placeholder:t.i18n.signStartPlaceholder,clearButton:!1},on:{daySelected:t.signStartSelected}}),t._v(" "),a("div",{staticClass:"date_center"},[t._v("至")]),t._v(" "),a("v-datepicker",{ref:"endTime",staticClass:"btn-block time-picker",attrs:{value:t.signData.endTime,format:t.signData.dateFormat,placeholder:t.i18n.signEndPlaceholder,clearButton:!1},on:{daySelected:t.signEndSelected}})],1)]):a("div",["day"==t.selectType?a("div",[a("div",{staticClass:"form-group data-wrap box_flex box_center"},[a("v-datepicker",{ref:"startTime",staticClass:"btn-block time-picker",attrs:{beforeSelect:t.beforeStartTimeStartSelect,value:t.signData.startTime,format:"yyyy-MM-dd",clearButton:!1},on:{daySelected:t.signStartSelected}}),t._v(" "),a("div",{staticClass:"date_center"},[t._v("至")]),t._v(" "),a("v-datepicker",{ref:"startTime",staticClass:"btn-block time-picker",attrs:{beforeSelect:t.beforeEndTimeStartSelect,value:t.signData.endTime,format:"yyyy-MM-dd",clearButton:!1},on:{daySelected:t.signEndSelected}})],1),t._v(" "),a("div",{staticClass:"notice"},[a("i",{staticClass:"el-icon-warning"}),t._v(" "),a("span",[t._v("开始日期和结束日期必须大于当日")])]),t._v(" "),a("div",{staticClass:"form-group data-wrap box_flex box_center my-elwrap"},[a("el-time-select",{staticStyle:{width:"30%"},attrs:{"picker-options":{start:"06:00",step:"00:15",end:"24:00",maxTime:t.signData.endTimeToHours},placeholder:"起始时间","value-format":"HH:mm:ss"},on:{change:function(e){return t.dateChange_day(t.signData.startTimeToHours,"start")}},model:{value:t.signData.startTimeToHours,callback:function(e){t.$set(t.signData,"startTimeToHours",e)},expression:"signData.startTimeToHours"}}),t._v(" "),a("el-time-select",{staticStyle:{width:"30%"},attrs:{"picker-options":{start:"06:00",step:"00:15",end:"24:00",minTime:t.signData.startTimeToHours},placeholder:"结束时间","value-format":"HH:mm:ss"},on:{change:function(e){return t.dateChange_day(t.signData.endTimeToHours,"end")}},model:{value:t.signData.endTimeToHours,callback:function(e){t.$set(t.signData,"endTimeToHours",e)},expression:"signData.endTimeToHours"}})],1)]):a("div",[a("div",{staticClass:"form-group data-wrap box_flex box_center"},[a("v-datepicker",{ref:"startTime",staticClass:"btn-block time-picker",attrs:{beforeSelect:t.beforeStartTimeStartSelect,value:t.signData.startTime,format:"yyyy-MM-dd",clearButton:!1},on:{daySelected:t.signStartSelected}}),t._v(" "),a("div",{staticClass:"date_center"},[t._v("至")]),t._v(" "),a("v-datepicker",{ref:"startTime",staticClass:"btn-block time-picker",attrs:{beforeSelect:t.beforeEndTimeStartSelect,value:t.signData.endTime,format:"yyyy-MM-dd",clearButton:!1},on:{daySelected:t.signEndSelected}})],1),t._v(" "),a("div",{staticClass:"weeklyDate"},t._l(t.weeklyDate,function(e,i){return a("div",{key:i,staticStyle:{display:"flex","line-height":"40px"}},[a("el-checkbox",{attrs:{disabled:"编辑签到"==t.title},on:{change:t.checkboxChange},model:{value:e.isChecked,callback:function(a){t.$set(e,"isChecked",a)},expression:"item.isChecked"}},[t._v(t._s(t.dateToCn(e.index)))]),t._v(" "),e.isChecked?a("div",{staticClass:"form-group data-wrap box_flex box_center my-elwrap"},[a("el-time-select",{staticStyle:{width:"40%"},attrs:{"picker-options":{start:"06:00",step:"00:15",end:"24:00",maxTime:e.endHours},placeholder:"起始时间","value-format":"HH:mm:ss"},on:{change:function(a){return t.dateChange(e.startHours,i)}},model:{value:e.startHours,callback:function(a){t.$set(e,"startHours",a)},expression:"item.startHours"}}),t._v(" "),a("el-time-select",{staticStyle:{width:"40%"},attrs:{"picker-options":{start:"06:00",step:"00:15",end:"24:00",minTime:e.startHours},placeholder:"结束时间","value-format":"HH:mm:ss"},on:{change:function(a){return t.dateChange_end(e.endHours,i)}},model:{value:e.endHours,callback:function(a){t.$set(e,"endHours",a)},expression:"item.endHours"}})],1):t._e()],1)}),0)])]),t._v(" "),t.signData.needOut?a("div",{staticClass:"data-wrap"},[a("div",{staticClass:"sign-ways"},[a("div",{staticClass:"switch box_flex box_between"},[a("span",{staticClass:"label"},[t._v("使用签退")]),t._v(" "),a("el-switch",{model:{value:t.signData.isSignOut,callback:function(e){t.$set(t.signData,"isSignOut",e)},expression:"signData.isSignOut"}})],1),t._v(" "),a("div",{staticClass:"form-group box_flex box_center date_picker_wrap"},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{"picker-options":t.pickOptions,disabled:t.signData.signOutTimeStart&&new Date(t.signData.signOutTimeStart)<new Date||!t.signData.isSignOut,"value-format":"yyyy-MM-dd HH:mm:ss",clearable:!1,type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.dateArea2,callback:function(e){t.dateArea2=e},expression:"dateArea2"}})],1)])]):t._e(),t._v(" "),a("div",{staticClass:"form-group"},[a("div",{staticClass:"sign-ways"},[a("div",{directives:[{name:"show",rawName:"v-show",value:!t.signData.needOut,expression:"!signData.needOut"}],staticClass:"sign-way",class:{active:t.signData.signWay===t.signData.signWays.qrcode},on:{click:function(e){return t.setSignWay(t.signData.signWays.qrcode)}}},[a("v-icon",{attrs:{name:t.signData.signWay===t.signData.signWays.qrcode?"radio_button_checked":"radio_button_unchecked"}}),t._v(" "),a("span",[t._v("扫码签到")])],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.signData.signWay===t.signData.signWays.qrcode,expression:"signData.signWay === signData.signWays.qrcode"}]},[a("div",{staticClass:"switch box_flex box_between"},[a("span",{staticClass:"label"},[t._v(t._s(t.i18n.useDynamicCode))]),t._v(" "),a("el-switch",{model:{value:t.signData.useDynamicCode,callback:function(e){t.$set(t.signData,"useDynamicCode",e)},expression:"signData.useDynamicCode"}})],1),t._v(" "),a("div",{staticClass:"switch box_flex box_between"},[a("span",{staticClass:"label"},[t._v("开启定位限制")]),t._v(" "),a("el-switch",{model:{value:t.signData.scanQrcodeWithLocation,callback:function(e){t.$set(t.signData,"scanQrcodeWithLocation",e)},expression:"signData.scanQrcodeWithLocation"}})],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.signData.scanQrcodeWithLocation,expression:"signData.scanQrcodeWithLocation"}],staticClass:"qrcode-locations"},[a("locations",{attrs:{moreAddress:!t.signData.needOut,locations:t.signData.qrcodeLocations}})],1)]),t._v(" "),t.signData.needOut?t._e():a("div",{staticClass:"sign-way",class:{active:t.signData.signWay===t.signData.signWays.location},on:{click:function(e){return t.setSignWay(t.signData.signWays.location)}}},[a("v-icon",{attrs:{name:t.signData.signWay===t.signData.signWays.location?"radio_button_checked":"radio_button_unchecked"}}),t._v(" "),a("span",[t._v("定位签到")])],1),t._v(" "),t.signData.needOut||"loop"!==t.checkInType?t._e():a("div",{staticClass:"sign-way",class:{active:t.signData.signWay===t.signData.signWays.outside},on:{click:function(e){return t.setSignWay(t.signData.signWays.outside)}}},[a("v-icon",{attrs:{name:t.signData.signWay===t.signData.signWays.outside?"radio_button_checked":"radio_button_unchecked"}}),t._v(" "),a("span",[t._v("外勤打卡")])],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.signData.signWay===t.signData.signWays.location,expression:"signData.signWay === signData.signWays.location"}]},[a("locations",{attrs:{locations:t.signData.locations}})],1)])])]),t._v(" "),a("div",{staticClass:"modal-footer",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("button",{staticClass:"btn cancel-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.cancel}},[t._v(t._s(t.i18n.cancel))]),t._v(" "),a("button",{staticClass:"btn submit-btn clearBtnBorder",attrs:{type:"button"},on:{click:t.confirm}},[t._v(t._s(t.i18n.sure))])])])},staticRenderFns:[]};var g=a("C7Lr")(u,h,!1,function(t){a("hazC"),a("PuR5")},"data-v-46b79174",null);e.a=g.exports}});